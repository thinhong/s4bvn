<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Phân phối liên tục – Statistics for babies</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./distr-exp.html" rel="next">
<link href="./distr-pois.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-832c273f0af7a47d06e59912ec7b3523.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-N2T5TFNFY7"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-N2T5TFNFY7', { 'anonymize_ip': true});
</script>
<script type="module" src="site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./distr-c.html">Phân phối liên tục</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Statistics for babies</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prob.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Xác suất</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Phân phối xác suất</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./distr-d.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Phân phối rời rạc</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-bin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Phân phối nhị thức</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-pois.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Phân phối Poisson</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./distr-c.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Phân phối liên tục</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-exp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Phân phối mũ</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-pl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Phân phối quy tắc lũy thừa</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lik.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Hàm hợp lý</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Bayesian</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./thanks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lời cảm ơn</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tài liệu tham khảo</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#phân-phối-exponential" id="toc-phân-phối-exponential" class="nav-link active" data-scroll-target="#phân-phối-exponential">Phân phối exponential</a></li>
  <li><a href="#phân-phối-pareto" id="toc-phân-phối-pareto" class="nav-link" data-scroll-target="#phân-phối-pareto">Phân phối Pareto</a></li>
  <li><a href="#phân-phối-gamma" id="toc-phân-phối-gamma" class="nav-link" data-scroll-target="#phân-phối-gamma">Phân phối gamma</a></li>
  <li><a href="#phân-phối-chuẩn" id="toc-phân-phối-chuẩn" class="nav-link" data-scroll-target="#phân-phối-chuẩn">Phân phối chuẩn</a></li>
  <li><a href="#phân-phối-chi-bình-phương" id="toc-phân-phối-chi-bình-phương" class="nav-link" data-scroll-target="#phân-phối-chi-bình-phương">Phân phối Chi-bình phương</a></li>
  <li><a href="#phân-phối-log-normal" id="toc-phân-phối-log-normal" class="nav-link" data-scroll-target="#phân-phối-log-normal">Phân phối log-normal</a>
  <ul class="collapse">
  <li><a href="#biến-tỉ-số" id="toc-biến-tỉ-số" class="nav-link" data-scroll-target="#biến-tỉ-số">Biến tỉ số</a></li>
  <li><a href="#tại-sao-dùng-log" id="toc-tại-sao-dùng-log" class="nav-link" data-scroll-target="#tại-sao-dùng-log">Tại sao dùng log?</a></li>
  <li><a href="#cơ-chế-tạo-ra-log-normal" id="toc-cơ-chế-tạo-ra-log-normal" class="nav-link" data-scroll-target="#cơ-chế-tạo-ra-log-normal">Cơ chế tạo ra log-normal</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Phân phối liên tục</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="phân-phối-exponential" class="level2">
<h2 class="anchored" data-anchor-id="phân-phối-exponential">Phân phối exponential</h2>
</section>
<section id="phân-phối-pareto" class="level2">
<h2 class="anchored" data-anchor-id="phân-phối-pareto">Phân phối Pareto</h2>
</section>
<section id="phân-phối-gamma" class="level2">
<h2 class="anchored" data-anchor-id="phân-phối-gamma">Phân phối gamma</h2>
</section>
<section id="phân-phối-chuẩn" class="level2">
<h2 class="anchored" data-anchor-id="phân-phối-chuẩn">Phân phối chuẩn</h2>
</section>
<section id="phân-phối-chi-bình-phương" class="level2">
<h2 class="anchored" data-anchor-id="phân-phối-chi-bình-phương">Phân phối Chi-bình phương</h2>
<p>Nếu <span class="math inline">\(Z_1, \dots, Z_k\)</span> là các biến ngẫu nhiên có phân phối chuẩn tắc (standard normal, là phân phối chuẩn có <span class="math inline">\(\mu = 0\)</span> và <span class="math inline">\(\sigma = 1\)</span>) độc lập, thì tổng bình phương của chúng:</p>
<p><span class="math display">\[X = \sum_{i=1}^{k} Z_i^2\]</span></p>
<p>sẽ tuân theo phân phối Chi-bình phương (chi-squared distribution) với <span class="math inline">\(k\)</span> bậc tự do. Kí hiệu:</p>
<p><span class="math display">\[X \sim \chi^2(k) \quad \text{hoặc} \quad X \sim \chi_k^2\]</span></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb1" data-startfrom="29" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 28;"><span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>viewof chi_squared_mechanism <span class="op">=</span> (() <span class="kw">=&gt;</span> {</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 1. CONFIGURATION &amp; STATE ---</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> state <span class="op">=</span> {</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="dt">running</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">k</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">speed</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span> <span class="co">// 1 (Slow) to 10 (Fast)</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="dt">histogram</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Float32Array</span>(<span class="dv">100</span>)<span class="op">,</span> <span class="co">// 100 bins</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="dt">totalSamples</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">xMax</span><span class="op">:</span> <span class="dv">15</span> <span class="co">// Range of the histogram</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> colors <span class="op">=</span> [<span class="st">"#ef4444"</span><span class="op">,</span> <span class="st">"#3b82f6"</span><span class="op">,</span> <span class="st">"#10b981"</span><span class="op">,</span> <span class="st">"#f59e0b"</span><span class="op">,</span> <span class="st">"#8b5cf6"</span><span class="op">,</span> <span class="st">"#ec4899"</span><span class="op">,</span> <span class="st">"#06b6d4"</span><span class="op">,</span> <span class="st">"#84cc16"</span>]<span class="op">;</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 2. SETUP DOM ---</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> wrapper <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-family: -apple-system, system-ui, sans-serif;</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="vs">    display: flex;</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="vs">    flex-direction: column;</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="vs">    align-items: center;</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="vs">    width: 100%;</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="vs">    max-width: 850px;</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="vs">    margin: 0 auto;</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="vs">    background: #fff;</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="vs">    border-radius: 8px;</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="vs">    box-shadow: 0 1px 3px rgba(0,0,0,0.1);</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="vs">    padding: 20px;</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Controls Row</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> controls <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  controls<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display: flex; gap: 30px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center;"</span><span class="op">;</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Helper for inputs</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> createControl <span class="op">=</span> (label<span class="op">,</span> type<span class="op">,</span> min<span class="op">,</span> max<span class="op">,</span> val<span class="op">,</span> fn) <span class="kw">=&gt;</span> {</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> div <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display: flex; flex-direction: column; width: 150px;"</span><span class="op">;</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> lbl <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"label"</span>)<span class="op">;</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    lbl<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>label<span class="sc">}</span><span class="vs">: </span><span class="sc">${</span>val<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    lbl<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"font-size: 13px; font-weight: 700; color: #4b5563; margin-bottom: 4px;"</span><span class="op">;</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> inp <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"input"</span>)<span class="op">;</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    inp<span class="op">.</span><span class="at">type</span> <span class="op">=</span> type<span class="op">;</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    inp<span class="op">.</span><span class="at">min</span> <span class="op">=</span> min<span class="op">;</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    inp<span class="op">.</span><span class="at">max</span> <span class="op">=</span> max<span class="op">;</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    inp<span class="op">.</span><span class="at">value</span> <span class="op">=</span> val<span class="op">;</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    inp<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">width</span> <span class="op">=</span> <span class="st">"100%"</span><span class="op">;</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    inp<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">accentColor</span> <span class="op">=</span> <span class="st">"#2563eb"</span><span class="op">;</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    inp<span class="op">.</span><span class="at">oninput</span> <span class="op">=</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> v <span class="op">=</span> <span class="pp">parseFloat</span>(e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>      lbl<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>label<span class="sc">}</span><span class="vs">: </span><span class="sc">${</span>v<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fn</span>(v)<span class="op">;</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    div<span class="op">.</span><span class="fu">appendChild</span>(lbl)<span class="op">;</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>    div<span class="op">.</span><span class="fu">appendChild</span>(inp)<span class="op">;</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { div<span class="op">,</span> inp<span class="op">,</span> lbl }<span class="op">;</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> kCtrl <span class="op">=</span> <span class="fu">createControl</span>(<span class="st">"Degrees (k)"</span><span class="op">,</span> <span class="st">"range"</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> (v) <span class="kw">=&gt;</span> {</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    state<span class="op">.</span><span class="at">k</span> <span class="op">=</span> v<span class="op">;</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resetSim</span>()<span class="op">;</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> speedCtrl <span class="op">=</span> <span class="fu">createControl</span>(<span class="st">"Speed"</span><span class="op">,</span> <span class="st">"range"</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> (v) <span class="kw">=&gt;</span> state<span class="op">.</span><span class="at">speed</span> <span class="op">=</span> v)<span class="op">;</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> resetBtn <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"button"</span>)<span class="op">;</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>  resetBtn<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">"Reset Simulation"</span><span class="op">;</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>  resetBtn<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"padding: 0 16px; background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 4px; font-weight: 600; color: #374151; cursor: pointer; height: 36px; align-self: flex-end;"</span><span class="op">;</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>  resetBtn<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> resetSim<span class="op">;</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>  controls<span class="op">.</span><span class="fu">appendChild</span>(kCtrl<span class="op">.</span><span class="at">div</span>)<span class="op">;</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>  controls<span class="op">.</span><span class="fu">appendChild</span>(speedCtrl<span class="op">.</span><span class="at">div</span>)<span class="op">;</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>  controls<span class="op">.</span><span class="fu">appendChild</span>(resetBtn)<span class="op">;</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(controls)<span class="op">;</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Canvas</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> canvas <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"canvas"</span>)<span class="op">;</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> width <span class="op">=</span> <span class="dv">800</span><span class="op">;</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> height <span class="op">=</span> <span class="dv">400</span><span class="op">;</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dpr <span class="op">=</span> <span class="bu">window</span><span class="op">.</span><span class="at">devicePixelRatio</span> <span class="op">||</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">width</span> <span class="op">=</span> width <span class="op">*</span> dpr<span class="op">;</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">height</span> <span class="op">=</span> height <span class="op">*</span> dpr<span class="op">;</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">width</span> <span class="op">=</span> <span class="st">"100%"</span><span class="op">;</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">maxWidth</span> <span class="op">=</span> <span class="st">"800px"</span><span class="op">;</span></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">height</span> <span class="op">=</span> <span class="st">"auto"</span><span class="op">;</span></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ctx <span class="op">=</span> canvas<span class="op">.</span><span class="fu">getContext</span>(<span class="st">"2d"</span>)<span class="op">;</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>  ctx<span class="op">.</span><span class="fu">scale</span>(dpr<span class="op">,</span> dpr)<span class="op">;</span></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(canvas)<span class="op">;</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 3. MATH HELPERS ---</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">randn</span>() {</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="op">-</span><span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>())) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>())<span class="op">;</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">gamma</span>(n) { <span class="co">// Lanczos approx for gamma</span></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> p <span class="op">=</span> [<span class="fl">0.99999999999980993</span><span class="op">,</span> <span class="fl">676.5203681218851</span><span class="op">,</span> <span class="op">-</span><span class="fl">1259.1392167224028</span><span class="op">,</span> <span class="fl">771.32342877765313</span><span class="op">,</span> <span class="op">-</span><span class="fl">176.61502916214059</span><span class="op">,</span> <span class="fl">12.507343278686905</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.13857109526572012</span><span class="op">,</span> <span class="fl">9.9843695780195716e-6</span><span class="op">,</span> <span class="fl">1.5056327351493116e-7</span>]<span class="op">;</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> g <span class="op">=</span> <span class="dv">7</span><span class="op">;</span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (n <span class="op">&lt;</span> <span class="fl">0.5</span>) <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> n) <span class="op">*</span> <span class="fu">gamma</span>(<span class="dv">1</span> <span class="op">-</span> n))<span class="op">;</span></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>      n <span class="op">-=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> a <span class="op">=</span> p[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> t <span class="op">=</span> n <span class="op">+</span> g <span class="op">+</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> p<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) a <span class="op">+=</span> p[i] <span class="op">/</span> (n <span class="op">+</span> i)<span class="op">;</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(t<span class="op">,</span> n <span class="op">+</span> <span class="fl">0.5</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="op">-</span>t) <span class="op">*</span> a<span class="op">;</span></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">pdf</span>(x<span class="op">,</span> k) {</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (x <span class="op">&lt;=</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> (<span class="dv">1</span> <span class="op">/</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(<span class="dv">2</span><span class="op">,</span> k <span class="op">/</span> <span class="dv">2</span>) <span class="op">*</span> <span class="fu">gamma</span>(k <span class="op">/</span> <span class="dv">2</span>))) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(x<span class="op">,</span> k <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="op">-</span>x <span class="op">/</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">resetSim</span>() {</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>    state<span class="op">.</span><span class="at">histogram</span> <span class="op">=</span> <span class="kw">new</span> <span class="bu">Float32Array</span>(<span class="dv">100</span>)<span class="op">;</span></span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>    state<span class="op">.</span><span class="at">totalSamples</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Adjust xMax based on k to keep it framed</span></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>    state<span class="op">.</span><span class="at">xMax</span> <span class="op">=</span> state<span class="op">.</span><span class="at">k</span> <span class="op">*</span> <span class="fl">2.5</span> <span class="op">+</span> <span class="dv">4</span><span class="op">;</span> </span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 4. RENDER LOOP ---</span></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">draw</span>() {</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">clearRect</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height)<span class="op">;</span></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Layout Constants</span></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> leftW <span class="op">=</span> <span class="dv">300</span><span class="op">;</span> <span class="co">// Width of "Mechanism" area</span></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartX <span class="op">=</span> <span class="dv">340</span><span class="op">;</span> <span class="co">// Start of Chart</span></span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartW <span class="op">=</span> width <span class="op">-</span> chartX <span class="op">-</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartH <span class="op">=</span> <span class="dv">300</span><span class="op">;</span></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartY <span class="op">=</span> <span class="dv">50</span><span class="op">;</span></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>    <span class="co">// --- A. DRAW MECHANISM (Left Side) ---</span></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Background box</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#f9fafb"</span><span class="op">;</span></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillRect</span>(<span class="dv">10</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> leftW<span class="op">,</span> height <span class="op">-</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"#e5e7eb"</span><span class="op">;</span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">strokeRect</span>(<span class="dv">10</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> leftW<span class="op">,</span> height <span class="op">-</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Labels</span></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#111827"</span><span class="op">;</span></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">font</span> <span class="op">=</span> <span class="st">"bold 14px sans-serif"</span><span class="op">;</span></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillText</span>(<span class="st">"Independent Z"</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">40</span>)<span class="op">;</span></span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillText</span>(<span class="st">"Z² Blocks"</span><span class="op">,</span> <span class="dv">140</span><span class="op">,</span> <span class="dv">40</span>)<span class="op">;</span></span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillText</span>(<span class="st">"Sum"</span><span class="op">,</span> <span class="dv">260</span><span class="op">,</span> <span class="dv">40</span>)<span class="op">;</span></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rowH <span class="op">=</span> (height <span class="op">-</span> <span class="dv">60</span>) <span class="op">/</span> <span class="dv">9</span><span class="op">;</span> <span class="co">// Max 8 rows comfortably</span></span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> barScale <span class="op">=</span> <span class="dv">20</span><span class="op">;</span> <span class="co">// Scale for Z visual</span></span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Run Simulation Step(s) based on speed</span></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> steps <span class="op">=</span> state<span class="op">.</span><span class="at">speed</span><span class="op">;</span></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> lastZ <span class="op">=</span> []<span class="op">;</span> <span class="co">// Store for visual</span></span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> lastZ2 <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> lastSum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> s<span class="op">=</span><span class="dv">0</span><span class="op">;</span> s<span class="op">&lt;</span>steps<span class="op">;</span> s<span class="op">++</span>) {</span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> sum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> zVals <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> z2Vals <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>state<span class="op">.</span><span class="at">k</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> z <span class="op">=</span> <span class="fu">randn</span>()<span class="op">;</span></span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> z2 <span class="op">=</span> z<span class="op">*</span>z<span class="op">;</span></span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>        sum <span class="op">+=</span> z2<span class="op">;</span></span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>        zVals<span class="op">.</span><span class="fu">push</span>(z)<span class="op">;</span></span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>        z2Vals<span class="op">.</span><span class="fu">push</span>(z2)<span class="op">;</span></span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Record Histogram</span></span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> binWidth <span class="op">=</span> state<span class="op">.</span><span class="at">xMax</span> <span class="op">/</span> state<span class="op">.</span><span class="at">histogram</span><span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> binIdx <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(sum <span class="op">/</span> binWidth)<span class="op">;</span></span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(binIdx <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> binIdx <span class="op">&lt;</span> state<span class="op">.</span><span class="at">histogram</span><span class="op">.</span><span class="at">length</span>) {</span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>        state<span class="op">.</span><span class="at">histogram</span>[binIdx]<span class="op">++;</span></span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>        state<span class="op">.</span><span class="at">totalSamples</span><span class="op">++;</span></span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Only save last frame for "Mechanism" drawing</span></span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(s <span class="op">===</span> steps <span class="op">-</span> <span class="dv">1</span>) {</span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>        lastZ <span class="op">=</span> zVals<span class="op">;</span></span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>        lastZ2 <span class="op">=</span> z2Vals<span class="op">;</span></span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>        lastSum <span class="op">=</span> sum<span class="op">;</span></span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Draw the Bars (Mechanism)</span></span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> stackY <span class="op">=</span> height <span class="op">-</span> <span class="dv">40</span><span class="op">;</span> <span class="co">// Start stacking from bottom of left panel area</span></span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> stackX <span class="op">=</span> <span class="dv">250</span><span class="op">;</span></span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1. Draw Individual Rows</span></span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>state<span class="op">.</span><span class="at">k</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> y <span class="op">=</span> <span class="dv">70</span> <span class="op">+</span> i <span class="op">*</span> <span class="dv">35</span><span class="op">;</span> <span class="co">// Row vertical pos</span></span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> color <span class="op">=</span> colors[i <span class="op">%</span> colors<span class="op">.</span><span class="at">length</span>]<span class="op">;</span></span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>       <span class="co">// Z Value (Dot on line)</span></span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"#d1d5db"</span><span class="op">;</span></span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">moveTo</span>(<span class="dv">30</span><span class="op">,</span> y)<span class="op">;</span> ctx<span class="op">.</span><span class="fu">lineTo</span>(<span class="dv">110</span><span class="op">,</span> y)<span class="op">;</span> <span class="co">// Axis</span></span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">moveTo</span>(<span class="dv">70</span><span class="op">,</span> y<span class="op">-</span><span class="dv">5</span>)<span class="op">;</span> ctx<span class="op">.</span><span class="fu">lineTo</span>(<span class="dv">70</span><span class="op">,</span> y<span class="op">+</span><span class="dv">5</span>)<span class="op">;</span> <span class="co">// Zero mark</span></span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> zX <span class="op">=</span> <span class="dv">70</span> <span class="op">+</span> lastZ[i] <span class="op">*</span> <span class="dv">15</span><span class="op">;</span> <span class="co">// Z visual position</span></span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#374151"</span><span class="op">;</span></span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">arc</span>(zX<span class="op">,</span> y<span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">*</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>       <span class="co">// Z² Block (Horizontal Bar)</span></span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> z2W <span class="op">=</span> lastZ2[i] <span class="op">*</span> <span class="dv">20</span><span class="op">;</span> <span class="co">// Block width scale</span></span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> color<span class="op">;</span></span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">fillRect</span>(<span class="dv">140</span><span class="op">,</span> y <span class="op">-</span> <span class="dv">6</span><span class="op">,</span> z2W<span class="op">,</span> <span class="dv">12</span>)<span class="op">;</span></span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>       <span class="co">// Draw Arrow</span></span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"#9ca3af"</span><span class="op">;</span></span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">moveTo</span>(<span class="dv">115</span><span class="op">,</span> y)<span class="op">;</span> ctx<span class="op">.</span><span class="fu">lineTo</span>(<span class="dv">135</span><span class="op">,</span> y)<span class="op">;</span></span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 2. Draw The Stack (Total)</span></span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>    <span class="co">// We visually stack the squares from the bottom up to show summation</span></span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> currentStackY <span class="op">=</span> height <span class="op">-</span> <span class="dv">40</span><span class="op">;</span></span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>state<span class="op">.</span><span class="at">k</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> color <span class="op">=</span> colors[i <span class="op">%</span> colors<span class="op">.</span><span class="at">length</span>]<span class="op">;</span></span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> h <span class="op">=</span> lastZ2[i] <span class="op">*</span> <span class="dv">30</span><span class="op">;</span> <span class="co">// Scale height for stack visibility</span></span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> color<span class="op">;</span></span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Draw segment of stack</span></span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="fu">fillRect</span>(stackX<span class="op">,</span> currentStackY <span class="op">-</span> h<span class="op">,</span> <span class="dv">20</span><span class="op">,</span> h)<span class="op">;</span></span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"white"</span><span class="op">;</span></span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="fu">strokeRect</span>(stackX<span class="op">,</span> currentStackY <span class="op">-</span> h<span class="op">,</span> <span class="dv">20</span><span class="op">,</span> h)<span class="op">;</span></span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a>        currentStackY <span class="op">-=</span> h<span class="op">;</span></span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Label Total</span></span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#000"</span><span class="op">;</span></span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">font</span> <span class="op">=</span> <span class="st">"bold 12px monospace"</span><span class="op">;</span></span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillText</span>(<span class="vs">`Σ = </span><span class="sc">${</span>lastSum<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> stackX <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> currentStackY <span class="op">-</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>    <span class="co">// --- B. DRAW HISTOGRAM (Right Side) ---</span></span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Axis Lines</span></span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"#374151"</span><span class="op">;</span></span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">moveTo</span>(chartX<span class="op">,</span> chartY <span class="op">+</span> chartH)<span class="op">;</span> ctx<span class="op">.</span><span class="fu">lineTo</span>(chartX <span class="op">+</span> chartW<span class="op">,</span> chartY <span class="op">+</span> chartH)<span class="op">;</span> <span class="co">// X</span></span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">moveTo</span>(chartX<span class="op">,</span> chartY <span class="op">+</span> chartH)<span class="op">;</span> ctx<span class="op">.</span><span class="fu">lineTo</span>(chartX<span class="op">,</span> chartY)<span class="op">;</span> <span class="co">// Y</span></span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Calculate Scale</span></span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Find max density for scaling Y axis</span></span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> maxCount <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>state<span class="op">.</span><span class="at">histogram</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="cf">if</span>(state<span class="op">.</span><span class="at">histogram</span>[i] <span class="op">&gt;</span> maxCount) maxCount <span class="op">=</span> state<span class="op">.</span><span class="at">histogram</span>[i]<span class="op">;</span></span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Normalize histogram to probability density to match PDF curve</span></span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Density = Count / (Total * BinWidth)</span></span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> binWidth <span class="op">=</span> state<span class="op">.</span><span class="at">xMax</span> <span class="op">/</span> state<span class="op">.</span><span class="at">histogram</span><span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a>    <span class="co">// We want the graphical max to align with theoretical max roughly</span></span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Or just scale purely on observed counts for robustness</span></span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yScale <span class="op">=</span> maxCount <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> (chartH <span class="op">*</span> <span class="fl">0.9</span>) <span class="op">/</span> maxCount <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Draw Bins</span></span>
<span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#93c5fd"</span><span class="op">;</span> <span class="co">// Blue bars</span></span>
<span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>state<span class="op">.</span><span class="at">histogram</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> h <span class="op">=</span> state<span class="op">.</span><span class="at">histogram</span>[i] <span class="op">*</span> yScale<span class="op">;</span></span>
<span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> x <span class="op">=</span> chartX <span class="op">+</span> (i <span class="op">/</span> state<span class="op">.</span><span class="at">histogram</span><span class="op">.</span><span class="at">length</span>) <span class="op">*</span> chartW<span class="op">;</span></span>
<span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> w <span class="op">=</span> (chartW <span class="op">/</span> state<span class="op">.</span><span class="at">histogram</span><span class="op">.</span><span class="at">length</span>) <span class="op">+</span> <span class="fl">0.5</span><span class="op">;</span> <span class="co">// +0.5 to close gaps</span></span>
<span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (h <span class="op">&gt;</span> <span class="dv">0</span>) ctx<span class="op">.</span><span class="fu">fillRect</span>(x<span class="op">,</span> chartY <span class="op">+</span> chartH <span class="op">-</span> h<span class="op">,</span> w<span class="op">,</span> h)<span class="op">;</span></span>
<span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Draw Theoretical PDF (Red Line)</span></span>
<span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"#ef4444"</span><span class="op">;</span></span>
<span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a>    <span class="co">// We need to scale PDF y-value to match the Histogram pixel height</span></span>
<span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Histogram Bar Height (pixels) = Count * yScale</span></span>
<span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Density = Count / (N * W)  =&gt; Count = Density * N * W</span></span>
<span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Pixel Y = Density * N * W * yScale</span></span>
<span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a>    <span class="co">// We can just find the peak of the PDF and match it to the peak of the histogram visually or mathematically</span></span>
<span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pixelFactor <span class="op">=</span> state<span class="op">.</span><span class="at">totalSamples</span> <span class="op">*</span> binWidth <span class="op">*</span> yScale<span class="op">;</span></span>
<span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> px <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> px <span class="op">&lt;=</span> chartW<span class="op">;</span> px<span class="op">+=</span><span class="dv">2</span>) {</span>
<span id="cb1-314"><a href="#cb1-314" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> xVal <span class="op">=</span> (px <span class="op">/</span> chartW) <span class="op">*</span> state<span class="op">.</span><span class="at">xMax</span><span class="op">;</span></span>
<span id="cb1-315"><a href="#cb1-315" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> yVal <span class="op">=</span> <span class="fu">pdf</span>(xVal<span class="op">,</span> state<span class="op">.</span><span class="at">k</span>)<span class="op">;</span></span>
<span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> plotY <span class="op">=</span> chartY <span class="op">+</span> chartH <span class="op">-</span> (yVal <span class="op">*</span> pixelFactor)<span class="op">;</span></span>
<span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (px <span class="op">===</span> <span class="dv">0</span>) ctx<span class="op">.</span><span class="fu">moveTo</span>(chartX <span class="op">+</span> px<span class="op">,</span> plotY)<span class="op">;</span></span>
<span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> ctx<span class="op">.</span><span class="fu">lineTo</span>(chartX <span class="op">+</span> px<span class="op">,</span> plotY)<span class="op">;</span></span>
<span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Chart Labels</span></span>
<span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#374151"</span><span class="op">;</span></span>
<span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">textAlign</span> <span class="op">=</span> <span class="st">"center"</span><span class="op">;</span></span>
<span id="cb1-326"><a href="#cb1-326" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillText</span>(<span class="st">"0"</span><span class="op">,</span> chartX<span class="op">,</span> chartY <span class="op">+</span> chartH <span class="op">+</span> <span class="dv">15</span>)<span class="op">;</span></span>
<span id="cb1-327"><a href="#cb1-327" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillText</span>(state<span class="op">.</span><span class="at">xMax</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>)<span class="op">,</span> chartX <span class="op">+</span> chartW<span class="op">,</span> chartY <span class="op">+</span> chartH <span class="op">+</span> <span class="dv">15</span>)<span class="op">;</span></span>
<span id="cb1-328"><a href="#cb1-328" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">font</span> <span class="op">=</span> <span class="st">"bold 14px sans-serif"</span><span class="op">;</span></span>
<span id="cb1-329"><a href="#cb1-329" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillText</span>(<span class="vs">`Histogram of Sums (N=</span><span class="sc">${</span>state<span class="op">.</span><span class="at">totalSamples</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> chartX <span class="op">+</span> chartW<span class="op">/</span><span class="dv">2</span><span class="op">,</span> chartY <span class="op">-</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb1-330"><a href="#cb1-330" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-331"><a href="#cb1-331" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#ef4444"</span><span class="op">;</span></span>
<span id="cb1-332"><a href="#cb1-332" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">textAlign</span> <span class="op">=</span> <span class="st">"right"</span><span class="op">;</span></span>
<span id="cb1-333"><a href="#cb1-333" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillText</span>(<span class="vs">`Theoretical χ²(k=</span><span class="sc">${</span>state<span class="op">.</span><span class="at">k</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> chartX <span class="op">+</span> chartW <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> chartY <span class="op">+</span> <span class="dv">30</span>)<span class="op">;</span></span>
<span id="cb1-334"><a href="#cb1-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-335"><a href="#cb1-335" aria-hidden="true" tabindex="-1"></a>    <span class="fu">requestAnimationFrame</span>(draw)<span class="op">;</span></span>
<span id="cb1-336"><a href="#cb1-336" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-337"><a href="#cb1-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-338"><a href="#cb1-338" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Start</span></span>
<span id="cb1-339"><a href="#cb1-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">requestAnimationFrame</span>(draw)<span class="op">;</span></span>
<span id="cb1-340"><a href="#cb1-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-341"><a href="#cb1-341" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> wrapper<span class="op">;</span></span>
<span id="cb1-342"><a href="#cb1-342" aria-hidden="true" tabindex="-1"></a>})()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-1" data-nodetype="declaration">

</div>
</div>
</div>
</section>
<section id="phân-phối-log-normal" class="level2">
<h2 class="anchored" data-anchor-id="phân-phối-log-normal">Phân phối log-normal</h2>
<section id="biến-tỉ-số" class="level3">
<h3 class="anchored" data-anchor-id="biến-tỉ-số">Biến tỉ số</h3>
<p>Biến tỉ số (ratio scale variables) là loại biến mà các đơn vị được đo lường trên thang tỉ số. Loại biến này có các đặc điểm sau <span class="citation" data-cites="motulsky2025">(<a href="references.html#ref-motulsky2025" role="doc-biblioref">Motulsky, Head, and Clarke 2025</a>)</span>:</p>
<ol type="1">
<li><p>Không tồn tại giá trị âm. Biến chỉ có thể nhận các giá trị dương</p></li>
<li><p>Giá trị 0 mang ý nghĩa tuyệt đối: Số 0 hoặc đại diện cho sự vắng mặt hoàn toàn của biến đó (không có), hoặc là một giới hạn tiệm cận.</p></li>
</ol>
<ul>
<li><p>0 = không có: Cân nặng hoặc chiều dài. Cân nặng bằng 0 nghĩa là không có trọng lượng. Chiều cao bằng 0 nghĩa là không có chiều cao.</p></li>
<li><p>0 = tiệm cận: Các chỉ số như EC50 hoặc Km. Các tham số này về lý thuyết không thể bằng 0, nhưng giá trị của chúng có thể cực nhỏ và tiến dần về 0.</p></li>
</ul>
<ol start="3" type="1">
<li><p>Chuyển đổi đơn vị chỉ dùng phép Nhân hoặc Chia</p></li>
<li><p>Việc tính tỉ số (ratio) mang ý nghĩa thực tiễn: Ví dụ, 4 cm dài gấp đôi 2 cm; 6 lít nước nhiều gấp 3 lần 2 lít nước</p></li>
</ol>
<p>Khi 1 biến là biến tỉ số thì sự khác biệt cần phải được đo bằng tỉ số (gấp bao nhiêu lần, bằng phép chia) chứ không phải là chênh lệch bao nhiêu giá trị (phép trừ).</p>
<p>Ví dụ: Nhiệt độ không phải là biến tỉ số</p>
<ol type="1">
<li><p>Có giá trị âm</p></li>
<li><p>Điểm 0 là quy ước, không phải tuyệt đối. 0°C không có nghĩa là “không có nhiệt độ”</p></li>
<li><p>Công thức chuyển đổi từ độ C sang độ F</p></li>
</ol>
<p><span class="math display">\[^\circ C = (^\circ F - 32) \times \frac{5}{9}\]</span></p>
<ol start="4" type="1">
<li>Tỉ số (ratio) không có ý nghĩa thực tiễn: 200°C không nóng gấp đôi 100°C. Sự thay đổi nhiệt độ phải được diễn đạt dưới dạng chênh lệch bao nhiêu giá trị (hiệu số).</li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Biến nào là biến tỉ số? Tại sao?</p>
<ul>
<li>Tuổi</li>
<li>Nồng độ kháng thể</li>
<li>Khoảng thời gian</li>
<li>Chỉ số IQ</li>
<li>Tải lượng virus (viral load)</li>
</ul>
</div>
</div>
<p>Khi log(biến) có phân phối chuẩn</p>
<p>Khi có outliers làm cho phân phối bị lệch phải.</p>
</section>
<section id="tại-sao-dùng-log" class="level3">
<h3 class="anchored" data-anchor-id="tại-sao-dùng-log">Tại sao dùng log?</h3>
<p><span class="math display">\[\log(a \times b) = \log(a) + \log(b)\]</span></p>
</section>
<section id="cơ-chế-tạo-ra-log-normal" class="level3">
<h3 class="anchored" data-anchor-id="cơ-chế-tạo-ra-log-normal">Cơ chế tạo ra log-normal</h3>
<p>Đặc trưng của phân phối log-normal là phép nhân.</p>
<p>Định lý giới hạn trung tâm cho biết rằng <strong>tổng</strong> của nhiều biến ngẫu nhiên độc lập sẽ tạo ra phân phối Chuẩn. Tương tự, <strong>tích</strong> của nhiều biến ngẫu nhiên sẽ tạo ra phân phối log-normal <span class="citation" data-cites="motulsky2025">(<a href="references.html#ref-motulsky2025" role="doc-biblioref">Motulsky, Head, and Clarke 2025</a>)</span>. Đây được gọi là Quy luật Tác động Tỉ lệ (Law of Proportionate Effect).</p>
<p>Một số cơ chế tạo ra phân phối này <span class="citation" data-cites="koch1966">(<a href="references.html#ref-koch1966" role="doc-biblioref">Koch 1966</a>)</span>:</p>
<ul>
<li>Sự tăng trưởng tích lũy: Giá trị của bước tiếp theo là kết quả của bước hiện tại nhân với một tỉ lệ biến động ngẫu nhiên (lãi suất, tốc độ tăng trưởng)</li>
</ul>
<p><span class="math inline">\(X_{t+1} = X_t \times (1 + r)\)</span></p>
<ul>
<li><p>Sự phân mảnh: Ngược lại với quá trình tích lũy, là quá trình phá vỡ một vật thể lớn thành nhiều mảnh nhỏ. Ví dụ: Kích thước của sỏi đá trong địa chất, hoặc các mảnh vụn khi nghiền bánh quy.</p></li>
<li><p>Sự phân chia sinh học: tế bào phân chia</p></li>
</ul>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-koch1966" class="csl-entry" role="listitem">
Koch, Arthur L. 1966. <span>“The Logarithm in Biology 1. Mechanisms Generating the Log-Normal Distribution Exactly.”</span> <em>Journal of Theoretical Biology</em> 12 (2): 276–90. <a href="https://doi.org/10.1016/0022-5193(66)90119-6">https://doi.org/10.1016/0022-5193(66)90119-6</a>.
</div>
<div id="ref-motulsky2025" class="csl-entry" role="listitem">
Motulsky, Harvey J., Trajen Head, and Paul B. S. Clarke. 2025. <span>“Analyzing Lognormal Data: A Nonmathematical Practical Guide.”</span> <em>Pharmacological Reviews</em> 77 (3): 100049. <a href="https://doi.org/10.1016/j.pharmr.2025.100049">https://doi.org/10.1016/j.pharmr.2025.100049</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBjaGlfc3F1YXJlZF9tZWNoYW5pc20gPSAoKCkgPT4ge1xyXG4gIC8vIC0tLSAxLiBDT05GSUdVUkFUSU9OICYgU1RBVEUgLS0tXHJcbiAgY29uc3Qgc3RhdGUgPSB7XHJcbiAgICBydW5uaW5nOiB0cnVlLFxyXG4gICAgazogMyxcclxuICAgIHNwZWVkOiA1LCAvLyAxIChTbG93KSB0byAxMCAoRmFzdClcclxuICAgIGhpc3RvZ3JhbTogbmV3IEZsb2F0MzJBcnJheSgxMDApLCAvLyAxMDAgYmluc1xyXG4gICAgdG90YWxTYW1wbGVzOiAwLFxyXG4gICAgeE1heDogMTUgLy8gUmFuZ2Ugb2YgdGhlIGhpc3RvZ3JhbVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IGNvbG9ycyA9IFtcIiNlZjQ0NDRcIiwgXCIjM2I4MmY2XCIsIFwiIzEwYjk4MVwiLCBcIiNmNTllMGJcIiwgXCIjOGI1Y2Y2XCIsIFwiI2VjNDg5OVwiLCBcIiMwNmI2ZDRcIiwgXCIjODRjYzE2XCJdO1xyXG5cclxuICAvLyAtLS0gMi4gU0VUVVAgRE9NIC0tLVxyXG4gIGNvbnN0IHdyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gIHdyYXBwZXIuc3R5bGUuY3NzVGV4dCA9IGBcclxuICAgIGZvbnQtZmFtaWx5OiAtYXBwbGUtc3lzdGVtLCBzeXN0ZW0tdWksIHNhbnMtc2VyaWY7XHJcbiAgICBkaXNwbGF5OiBmbGV4O1xyXG4gICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcclxuICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XHJcbiAgICB3aWR0aDogMTAwJTtcclxuICAgIG1heC13aWR0aDogODUwcHg7XHJcbiAgICBtYXJnaW46IDAgYXV0bztcclxuICAgIGJhY2tncm91bmQ6ICNmZmY7XHJcbiAgICBib3JkZXItcmFkaXVzOiA4cHg7XHJcbiAgICBib3gtc2hhZG93OiAwIDFweCAzcHggcmdiYSgwLDAsMCwwLjEpO1xyXG4gICAgcGFkZGluZzogMjBweDtcclxuICBgO1xyXG5cclxuICAvLyBDb250cm9scyBSb3dcclxuICBjb25zdCBjb250cm9scyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgY29udHJvbHMuc3R5bGUuY3NzVGV4dCA9IFwiZGlzcGxheTogZmxleDsgZ2FwOiAzMHB4OyBtYXJnaW4tYm90dG9tOiAyMHB4OyBmbGV4LXdyYXA6IHdyYXA7IGp1c3RpZnktY29udGVudDogY2VudGVyO1wiO1xyXG5cclxuICAvLyBIZWxwZXIgZm9yIGlucHV0c1xyXG4gIGNvbnN0IGNyZWF0ZUNvbnRyb2wgPSAobGFiZWwsIHR5cGUsIG1pbiwgbWF4LCB2YWwsIGZuKSA9PiB7XHJcbiAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgZGl2LnN0eWxlLmNzc1RleHQgPSBcImRpc3BsYXk6IGZsZXg7IGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47IHdpZHRoOiAxNTBweDtcIjtcclxuICAgIGNvbnN0IGxibCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsYWJlbFwiKTtcclxuICAgIGxibC50ZXh0Q29udGVudCA9IGAke2xhYmVsfTogJHt2YWx9YDtcclxuICAgIGxibC5zdHlsZS5jc3NUZXh0ID0gXCJmb250LXNpemU6IDEzcHg7IGZvbnQtd2VpZ2h0OiA3MDA7IGNvbG9yOiAjNGI1NTYzOyBtYXJnaW4tYm90dG9tOiA0cHg7XCI7XHJcbiAgICBcclxuICAgIGNvbnN0IGlucCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcclxuICAgIGlucC50eXBlID0gdHlwZTtcclxuICAgIGlucC5taW4gPSBtaW47XHJcbiAgICBpbnAubWF4ID0gbWF4O1xyXG4gICAgaW5wLnZhbHVlID0gdmFsO1xyXG4gICAgaW5wLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XHJcbiAgICBpbnAuc3R5bGUuYWNjZW50Q29sb3IgPSBcIiMyNTYzZWJcIjtcclxuXHJcbiAgICBpbnAub25pbnB1dCA9IChlKSA9PiB7XHJcbiAgICAgIGNvbnN0IHYgPSBwYXJzZUZsb2F0KGUudGFyZ2V0LnZhbHVlKTtcclxuICAgICAgbGJsLnRleHRDb250ZW50ID0gYCR7bGFiZWx9OiAke3Z9YDtcclxuICAgICAgZm4odik7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBkaXYuYXBwZW5kQ2hpbGQobGJsKTtcclxuICAgIGRpdi5hcHBlbmRDaGlsZChpbnApO1xyXG4gICAgcmV0dXJuIHsgZGl2LCBpbnAsIGxibCB9O1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGtDdHJsID0gY3JlYXRlQ29udHJvbChcIkRlZ3JlZXMgKGspXCIsIFwicmFuZ2VcIiwgMSwgOCwgMywgKHYpID0+IHtcclxuICAgIHN0YXRlLmsgPSB2O1xyXG4gICAgcmVzZXRTaW0oKTtcclxuICB9KTtcclxuICBcclxuICBjb25zdCBzcGVlZEN0cmwgPSBjcmVhdGVDb250cm9sKFwiU3BlZWRcIiwgXCJyYW5nZVwiLCAxLCA1MCwgNSwgKHYpID0+IHN0YXRlLnNwZWVkID0gdik7XHJcblxyXG4gIGNvbnN0IHJlc2V0QnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICByZXNldEJ0bi50ZXh0Q29udGVudCA9IFwiUmVzZXQgU2ltdWxhdGlvblwiO1xyXG4gIHJlc2V0QnRuLnN0eWxlLmNzc1RleHQgPSBcInBhZGRpbmc6IDAgMTZweDsgYmFja2dyb3VuZDogI2YzZjRmNjsgYm9yZGVyOiAxcHggc29saWQgI2QxZDVkYjsgYm9yZGVyLXJhZGl1czogNHB4OyBmb250LXdlaWdodDogNjAwOyBjb2xvcjogIzM3NDE1MTsgY3Vyc29yOiBwb2ludGVyOyBoZWlnaHQ6IDM2cHg7IGFsaWduLXNlbGY6IGZsZXgtZW5kO1wiO1xyXG4gIHJlc2V0QnRuLm9uY2xpY2sgPSByZXNldFNpbTtcclxuXHJcbiAgY29udHJvbHMuYXBwZW5kQ2hpbGQoa0N0cmwuZGl2KTtcclxuICBjb250cm9scy5hcHBlbmRDaGlsZChzcGVlZEN0cmwuZGl2KTtcclxuICBjb250cm9scy5hcHBlbmRDaGlsZChyZXNldEJ0bik7XHJcbiAgd3JhcHBlci5hcHBlbmRDaGlsZChjb250cm9scyk7XHJcblxyXG4gIC8vIENhbnZhc1xyXG4gIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XHJcbiAgY29uc3Qgd2lkdGggPSA4MDA7XHJcbiAgY29uc3QgaGVpZ2h0ID0gNDAwO1xyXG4gIGNvbnN0IGRwciA9IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIHx8IDE7XHJcbiAgY2FudmFzLndpZHRoID0gd2lkdGggKiBkcHI7XHJcbiAgY2FudmFzLmhlaWdodCA9IGhlaWdodCAqIGRwcjtcclxuICBjYW52YXMuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcclxuICBjYW52YXMuc3R5bGUubWF4V2lkdGggPSBcIjgwMHB4XCI7XHJcbiAgY2FudmFzLnN0eWxlLmhlaWdodCA9IFwiYXV0b1wiO1xyXG4gIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcbiAgY3R4LnNjYWxlKGRwciwgZHByKTtcclxuICB3cmFwcGVyLmFwcGVuZENoaWxkKGNhbnZhcyk7XHJcblxyXG4gIC8vIC0tLSAzLiBNQVRIIEhFTFBFUlMgLS0tXHJcbiAgZnVuY3Rpb24gcmFuZG4oKSB7XHJcbiAgICByZXR1cm4gTWF0aC5zcXJ0KC0yICogTWF0aC5sb2coTWF0aC5yYW5kb20oKSkpICogTWF0aC5jb3MoMiAqIE1hdGguUEkgKiBNYXRoLnJhbmRvbSgpKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGdhbW1hKG4pIHsgLy8gTGFuY3pvcyBhcHByb3ggZm9yIGdhbW1hXHJcbiAgICAgIHZhciBwID0gWzAuOTk5OTk5OTk5OTk5ODA5OTMsIDY3Ni41MjAzNjgxMjE4ODUxLCAtMTI1OS4xMzkyMTY3MjI0MDI4LCA3NzEuMzIzNDI4Nzc3NjUzMTMsIC0xNzYuNjE1MDI5MTYyMTQwNTksIDEyLjUwNzM0MzI3ODY4NjkwNSwgLTAuMTM4NTcxMDk1MjY1NzIwMTIsIDkuOTg0MzY5NTc4MDE5NTcxNmUtNiwgMS41MDU2MzI3MzUxNDkzMTE2ZS03XTtcclxuICAgICAgdmFyIGcgPSA3O1xyXG4gICAgICBpZiAobiA8IDAuNSkgcmV0dXJuIE1hdGguUEkgLyAoTWF0aC5zaW4oTWF0aC5QSSAqIG4pICogZ2FtbWEoMSAtIG4pKTtcclxuICAgICAgbiAtPSAxO1xyXG4gICAgICB2YXIgYSA9IHBbMF07XHJcbiAgICAgIHZhciB0ID0gbiArIGcgKyAwLjU7XHJcbiAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgcC5sZW5ndGg7IGkrKykgYSArPSBwW2ldIC8gKG4gKyBpKTtcclxuICAgICAgcmV0dXJuIE1hdGguc3FydCgyICogTWF0aC5QSSkgKiBNYXRoLnBvdyh0LCBuICsgMC41KSAqIE1hdGguZXhwKC10KSAqIGE7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBwZGYoeCwgaykge1xyXG4gICAgICBpZiAoeCA8PSAwKSByZXR1cm4gMDtcclxuICAgICAgcmV0dXJuICgxIC8gKE1hdGgucG93KDIsIGsgLyAyKSAqIGdhbW1hKGsgLyAyKSkpICogTWF0aC5wb3coeCwgayAvIDIgLSAxKSAqIE1hdGguZXhwKC14IC8gMik7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiByZXNldFNpbSgpIHtcclxuICAgIHN0YXRlLmhpc3RvZ3JhbSA9IG5ldyBGbG9hdDMyQXJyYXkoMTAwKTtcclxuICAgIHN0YXRlLnRvdGFsU2FtcGxlcyA9IDA7XHJcbiAgICAvLyBBZGp1c3QgeE1heCBiYXNlZCBvbiBrIHRvIGtlZXAgaXQgZnJhbWVkXHJcbiAgICBzdGF0ZS54TWF4ID0gc3RhdGUuayAqIDIuNSArIDQ7IFxyXG4gIH1cclxuXHJcbiAgLy8gLS0tIDQuIFJFTkRFUiBMT09QIC0tLVxyXG4gIGZ1bmN0aW9uIGRyYXcoKSB7XHJcbiAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xyXG4gICAgXHJcbiAgICAvLyBMYXlvdXQgQ29uc3RhbnRzXHJcbiAgICBjb25zdCBsZWZ0VyA9IDMwMDsgLy8gV2lkdGggb2YgXCJNZWNoYW5pc21cIiBhcmVhXHJcbiAgICBjb25zdCBjaGFydFggPSAzNDA7IC8vIFN0YXJ0IG9mIENoYXJ0XHJcbiAgICBjb25zdCBjaGFydFcgPSB3aWR0aCAtIGNoYXJ0WCAtIDIwO1xyXG4gICAgY29uc3QgY2hhcnRIID0gMzAwO1xyXG4gICAgY29uc3QgY2hhcnRZID0gNTA7XHJcblxyXG4gICAgLy8gLS0tIEEuIERSQVcgTUVDSEFOSVNNIChMZWZ0IFNpZGUpIC0tLVxyXG4gICAgLy8gQmFja2dyb3VuZCBib3hcclxuICAgIGN0eC5maWxsU3R5bGUgPSBcIiNmOWZhZmJcIjtcclxuICAgIGN0eC5maWxsUmVjdCgxMCwgMTAsIGxlZnRXLCBoZWlnaHQgLSAyMCk7XHJcbiAgICBjdHguc3Ryb2tlU3R5bGUgPSBcIiNlNWU3ZWJcIjtcclxuICAgIGN0eC5zdHJva2VSZWN0KDEwLCAxMCwgbGVmdFcsIGhlaWdodCAtIDIwKTtcclxuXHJcbiAgICAvLyBMYWJlbHNcclxuICAgIGN0eC5maWxsU3R5bGUgPSBcIiMxMTE4MjdcIjtcclxuICAgIGN0eC5mb250ID0gXCJib2xkIDE0cHggc2Fucy1zZXJpZlwiO1xyXG4gICAgY3R4LmZpbGxUZXh0KFwiSW5kZXBlbmRlbnQgWlwiLCAzMCwgNDApO1xyXG4gICAgY3R4LmZpbGxUZXh0KFwiWsKyIEJsb2Nrc1wiLCAxNDAsIDQwKTtcclxuICAgIGN0eC5maWxsVGV4dChcIlN1bVwiLCAyNjAsIDQwKTtcclxuXHJcbiAgICBjb25zdCByb3dIID0gKGhlaWdodCAtIDYwKSAvIDk7IC8vIE1heCA4IHJvd3MgY29tZm9ydGFibHlcclxuICAgIGNvbnN0IGJhclNjYWxlID0gMjA7IC8vIFNjYWxlIGZvciBaIHZpc3VhbFxyXG5cclxuICAgIC8vIFJ1biBTaW11bGF0aW9uIFN0ZXAocykgYmFzZWQgb24gc3BlZWRcclxuICAgIGNvbnN0IHN0ZXBzID0gc3RhdGUuc3BlZWQ7XHJcbiAgICBsZXQgbGFzdFogPSBbXTsgLy8gU3RvcmUgZm9yIHZpc3VhbFxyXG4gICAgbGV0IGxhc3RaMiA9IFtdO1xyXG4gICAgbGV0IGxhc3RTdW0gPSAwO1xyXG5cclxuICAgIGZvcihsZXQgcz0wOyBzPHN0ZXBzOyBzKyspIHtcclxuICAgICAgbGV0IHN1bSA9IDA7XHJcbiAgICAgIGxldCB6VmFscyA9IFtdO1xyXG4gICAgICBsZXQgejJWYWxzID0gW107XHJcbiAgICAgIFxyXG4gICAgICBmb3IobGV0IGk9MDsgaTxzdGF0ZS5rOyBpKyspIHtcclxuICAgICAgICBjb25zdCB6ID0gcmFuZG4oKTtcclxuICAgICAgICBjb25zdCB6MiA9IHoqejtcclxuICAgICAgICBzdW0gKz0gejI7XHJcbiAgICAgICAgelZhbHMucHVzaCh6KTtcclxuICAgICAgICB6MlZhbHMucHVzaCh6Mik7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFJlY29yZCBIaXN0b2dyYW1cclxuICAgICAgY29uc3QgYmluV2lkdGggPSBzdGF0ZS54TWF4IC8gc3RhdGUuaGlzdG9ncmFtLmxlbmd0aDtcclxuICAgICAgY29uc3QgYmluSWR4ID0gTWF0aC5mbG9vcihzdW0gLyBiaW5XaWR0aCk7XHJcbiAgICAgIGlmKGJpbklkeCA+PSAwICYmIGJpbklkeCA8IHN0YXRlLmhpc3RvZ3JhbS5sZW5ndGgpIHtcclxuICAgICAgICBzdGF0ZS5oaXN0b2dyYW1bYmluSWR4XSsrO1xyXG4gICAgICAgIHN0YXRlLnRvdGFsU2FtcGxlcysrO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBPbmx5IHNhdmUgbGFzdCBmcmFtZSBmb3IgXCJNZWNoYW5pc21cIiBkcmF3aW5nXHJcbiAgICAgIGlmKHMgPT09IHN0ZXBzIC0gMSkge1xyXG4gICAgICAgIGxhc3RaID0gelZhbHM7XHJcbiAgICAgICAgbGFzdFoyID0gejJWYWxzO1xyXG4gICAgICAgIGxhc3RTdW0gPSBzdW07XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBEcmF3IHRoZSBCYXJzIChNZWNoYW5pc20pXHJcbiAgICBsZXQgc3RhY2tZID0gaGVpZ2h0IC0gNDA7IC8vIFN0YXJ0IHN0YWNraW5nIGZyb20gYm90dG9tIG9mIGxlZnQgcGFuZWwgYXJlYVxyXG4gICAgY29uc3Qgc3RhY2tYID0gMjUwO1xyXG4gICAgXHJcbiAgICAvLyAxLiBEcmF3IEluZGl2aWR1YWwgUm93c1xyXG4gICAgZm9yKGxldCBpPTA7IGk8c3RhdGUuazsgaSsrKSB7XHJcbiAgICAgICBjb25zdCB5ID0gNzAgKyBpICogMzU7IC8vIFJvdyB2ZXJ0aWNhbCBwb3NcclxuICAgICAgIGNvbnN0IGNvbG9yID0gY29sb3JzW2kgJSBjb2xvcnMubGVuZ3RoXTtcclxuXHJcbiAgICAgICAvLyBaIFZhbHVlIChEb3Qgb24gbGluZSlcclxuICAgICAgIGN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgIGN0eC5zdHJva2VTdHlsZSA9IFwiI2QxZDVkYlwiO1xyXG4gICAgICAgY3R4Lm1vdmVUbygzMCwgeSk7IGN0eC5saW5lVG8oMTEwLCB5KTsgLy8gQXhpc1xyXG4gICAgICAgY3R4LnN0cm9rZSgpO1xyXG4gICAgICAgY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgICAgY3R4Lm1vdmVUbyg3MCwgeS01KTsgY3R4LmxpbmVUbyg3MCwgeSs1KTsgLy8gWmVybyBtYXJrXHJcbiAgICAgICBjdHguc3Ryb2tlKCk7XHJcblxyXG4gICAgICAgY29uc3QgelggPSA3MCArIGxhc3RaW2ldICogMTU7IC8vIFogdmlzdWFsIHBvc2l0aW9uXHJcbiAgICAgICBjdHguYmVnaW5QYXRoKCk7XHJcbiAgICAgICBjdHguZmlsbFN0eWxlID0gXCIjMzc0MTUxXCI7XHJcbiAgICAgICBjdHguYXJjKHpYLCB5LCA0LCAwLCBNYXRoLlBJKjIpO1xyXG4gICAgICAgY3R4LmZpbGwoKTtcclxuXHJcbiAgICAgICAvLyBawrIgQmxvY2sgKEhvcml6b250YWwgQmFyKVxyXG4gICAgICAgY29uc3QgejJXID0gbGFzdFoyW2ldICogMjA7IC8vIEJsb2NrIHdpZHRoIHNjYWxlXHJcbiAgICAgICBjdHguZmlsbFN0eWxlID0gY29sb3I7XHJcbiAgICAgICBjdHguZmlsbFJlY3QoMTQwLCB5IC0gNiwgejJXLCAxMik7XHJcbiAgICAgICBcclxuICAgICAgIC8vIERyYXcgQXJyb3dcclxuICAgICAgIGN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgIGN0eC5zdHJva2VTdHlsZSA9IFwiIzljYTNhZlwiO1xyXG4gICAgICAgY3R4Lm1vdmVUbygxMTUsIHkpOyBjdHgubGluZVRvKDEzNSwgeSk7XHJcbiAgICAgICBjdHguc3Ryb2tlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gMi4gRHJhdyBUaGUgU3RhY2sgKFRvdGFsKVxyXG4gICAgLy8gV2UgdmlzdWFsbHkgc3RhY2sgdGhlIHNxdWFyZXMgZnJvbSB0aGUgYm90dG9tIHVwIHRvIHNob3cgc3VtbWF0aW9uXHJcbiAgICBsZXQgY3VycmVudFN0YWNrWSA9IGhlaWdodCAtIDQwO1xyXG4gICAgZm9yKGxldCBpPTA7IGk8c3RhdGUuazsgaSsrKSB7XHJcbiAgICAgICAgY29uc3QgY29sb3IgPSBjb2xvcnNbaSAlIGNvbG9ycy5sZW5ndGhdO1xyXG4gICAgICAgIGNvbnN0IGggPSBsYXN0WjJbaV0gKiAzMDsgLy8gU2NhbGUgaGVpZ2h0IGZvciBzdGFjayB2aXNpYmlsaXR5XHJcbiAgICAgICAgXHJcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGNvbG9yO1xyXG4gICAgICAgIC8vIERyYXcgc2VnbWVudCBvZiBzdGFja1xyXG4gICAgICAgIGN0eC5maWxsUmVjdChzdGFja1gsIGN1cnJlbnRTdGFja1kgLSBoLCAyMCwgaCk7XHJcbiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gXCJ3aGl0ZVwiO1xyXG4gICAgICAgIGN0eC5zdHJva2VSZWN0KHN0YWNrWCwgY3VycmVudFN0YWNrWSAtIGgsIDIwLCBoKTtcclxuICAgICAgICBcclxuICAgICAgICBjdXJyZW50U3RhY2tZIC09IGg7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIExhYmVsIFRvdGFsXHJcbiAgICBjdHguZmlsbFN0eWxlID0gXCIjMDAwXCI7XHJcbiAgICBjdHguZm9udCA9IFwiYm9sZCAxMnB4IG1vbm9zcGFjZVwiO1xyXG4gICAgY3R4LmZpbGxUZXh0KGDOoyA9ICR7bGFzdFN1bS50b0ZpeGVkKDIpfWAsIHN0YWNrWCAtIDEwLCBjdXJyZW50U3RhY2tZIC0gMTApO1xyXG5cclxuXHJcbiAgICAvLyAtLS0gQi4gRFJBVyBISVNUT0dSQU0gKFJpZ2h0IFNpZGUpIC0tLVxyXG4gICAgLy8gQXhpcyBMaW5lc1xyXG4gICAgY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgY3R4LnN0cm9rZVN0eWxlID0gXCIjMzc0MTUxXCI7XHJcbiAgICBjdHgubW92ZVRvKGNoYXJ0WCwgY2hhcnRZICsgY2hhcnRIKTsgY3R4LmxpbmVUbyhjaGFydFggKyBjaGFydFcsIGNoYXJ0WSArIGNoYXJ0SCk7IC8vIFhcclxuICAgIGN0eC5tb3ZlVG8oY2hhcnRYLCBjaGFydFkgKyBjaGFydEgpOyBjdHgubGluZVRvKGNoYXJ0WCwgY2hhcnRZKTsgLy8gWVxyXG4gICAgY3R4LnN0cm9rZSgpO1xyXG5cclxuICAgIC8vIENhbGN1bGF0ZSBTY2FsZVxyXG4gICAgLy8gRmluZCBtYXggZGVuc2l0eSBmb3Igc2NhbGluZyBZIGF4aXNcclxuICAgIGxldCBtYXhDb3VudCA9IDA7XHJcbiAgICBmb3IobGV0IGk9MDsgaTxzdGF0ZS5oaXN0b2dyYW0ubGVuZ3RoOyBpKyspIGlmKHN0YXRlLmhpc3RvZ3JhbVtpXSA+IG1heENvdW50KSBtYXhDb3VudCA9IHN0YXRlLmhpc3RvZ3JhbVtpXTtcclxuICAgIFxyXG4gICAgLy8gTm9ybWFsaXplIGhpc3RvZ3JhbSB0byBwcm9iYWJpbGl0eSBkZW5zaXR5IHRvIG1hdGNoIFBERiBjdXJ2ZVxyXG4gICAgLy8gRGVuc2l0eSA9IENvdW50IC8gKFRvdGFsICogQmluV2lkdGgpXHJcbiAgICBjb25zdCBiaW5XaWR0aCA9IHN0YXRlLnhNYXggLyBzdGF0ZS5oaXN0b2dyYW0ubGVuZ3RoO1xyXG4gICAgLy8gV2Ugd2FudCB0aGUgZ3JhcGhpY2FsIG1heCB0byBhbGlnbiB3aXRoIHRoZW9yZXRpY2FsIG1heCByb3VnaGx5XHJcbiAgICAvLyBPciBqdXN0IHNjYWxlIHB1cmVseSBvbiBvYnNlcnZlZCBjb3VudHMgZm9yIHJvYnVzdG5lc3NcclxuICAgIFxyXG4gICAgY29uc3QgeVNjYWxlID0gbWF4Q291bnQgPiAwID8gKGNoYXJ0SCAqIDAuOSkgLyBtYXhDb3VudCA6IDE7XHJcblxyXG4gICAgLy8gRHJhdyBCaW5zXHJcbiAgICBjdHguZmlsbFN0eWxlID0gXCIjOTNjNWZkXCI7IC8vIEJsdWUgYmFyc1xyXG4gICAgZm9yKGxldCBpPTA7IGk8c3RhdGUuaGlzdG9ncmFtLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgY29uc3QgaCA9IHN0YXRlLmhpc3RvZ3JhbVtpXSAqIHlTY2FsZTtcclxuICAgICAgICBjb25zdCB4ID0gY2hhcnRYICsgKGkgLyBzdGF0ZS5oaXN0b2dyYW0ubGVuZ3RoKSAqIGNoYXJ0VztcclxuICAgICAgICBjb25zdCB3ID0gKGNoYXJ0VyAvIHN0YXRlLmhpc3RvZ3JhbS5sZW5ndGgpICsgMC41OyAvLyArMC41IHRvIGNsb3NlIGdhcHNcclxuICAgICAgICBcclxuICAgICAgICBpZiAoaCA+IDApIGN0eC5maWxsUmVjdCh4LCBjaGFydFkgKyBjaGFydEggLSBoLCB3LCBoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBEcmF3IFRoZW9yZXRpY2FsIFBERiAoUmVkIExpbmUpXHJcbiAgICBjdHguYmVnaW5QYXRoKCk7XHJcbiAgICBjdHguc3Ryb2tlU3R5bGUgPSBcIiNlZjQ0NDRcIjtcclxuICAgIGN0eC5saW5lV2lkdGggPSAzO1xyXG4gICAgXHJcbiAgICAvLyBXZSBuZWVkIHRvIHNjYWxlIFBERiB5LXZhbHVlIHRvIG1hdGNoIHRoZSBIaXN0b2dyYW0gcGl4ZWwgaGVpZ2h0XHJcbiAgICAvLyBIaXN0b2dyYW0gQmFyIEhlaWdodCAocGl4ZWxzKSA9IENvdW50ICogeVNjYWxlXHJcbiAgICAvLyBEZW5zaXR5ID0gQ291bnQgLyAoTiAqIFcpICA9PiBDb3VudCA9IERlbnNpdHkgKiBOICogV1xyXG4gICAgLy8gUGl4ZWwgWSA9IERlbnNpdHkgKiBOICogVyAqIHlTY2FsZVxyXG4gICAgLy8gV2UgY2FuIGp1c3QgZmluZCB0aGUgcGVhayBvZiB0aGUgUERGIGFuZCBtYXRjaCBpdCB0byB0aGUgcGVhayBvZiB0aGUgaGlzdG9ncmFtIHZpc3VhbGx5IG9yIG1hdGhlbWF0aWNhbGx5XHJcbiAgICBcclxuICAgIGNvbnN0IHBpeGVsRmFjdG9yID0gc3RhdGUudG90YWxTYW1wbGVzICogYmluV2lkdGggKiB5U2NhbGU7XHJcbiAgICBcclxuICAgIGZvcihsZXQgcHggPSAwOyBweCA8PSBjaGFydFc7IHB4Kz0yKSB7XHJcbiAgICAgICAgY29uc3QgeFZhbCA9IChweCAvIGNoYXJ0VykgKiBzdGF0ZS54TWF4O1xyXG4gICAgICAgIGNvbnN0IHlWYWwgPSBwZGYoeFZhbCwgc3RhdGUuayk7XHJcbiAgICAgICAgY29uc3QgcGxvdFkgPSBjaGFydFkgKyBjaGFydEggLSAoeVZhbCAqIHBpeGVsRmFjdG9yKTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAocHggPT09IDApIGN0eC5tb3ZlVG8oY2hhcnRYICsgcHgsIHBsb3RZKTtcclxuICAgICAgICBlbHNlIGN0eC5saW5lVG8oY2hhcnRYICsgcHgsIHBsb3RZKTtcclxuICAgIH1cclxuICAgIGN0eC5zdHJva2UoKTtcclxuXHJcbiAgICAvLyBDaGFydCBMYWJlbHNcclxuICAgIGN0eC5maWxsU3R5bGUgPSBcIiMzNzQxNTFcIjtcclxuICAgIGN0eC50ZXh0QWxpZ24gPSBcImNlbnRlclwiO1xyXG4gICAgY3R4LmZpbGxUZXh0KFwiMFwiLCBjaGFydFgsIGNoYXJ0WSArIGNoYXJ0SCArIDE1KTtcclxuICAgIGN0eC5maWxsVGV4dChzdGF0ZS54TWF4LnRvRml4ZWQoMCksIGNoYXJ0WCArIGNoYXJ0VywgY2hhcnRZICsgY2hhcnRIICsgMTUpO1xyXG4gICAgY3R4LmZvbnQgPSBcImJvbGQgMTRweCBzYW5zLXNlcmlmXCI7XHJcbiAgICBjdHguZmlsbFRleHQoYEhpc3RvZ3JhbSBvZiBTdW1zIChOPSR7c3RhdGUudG90YWxTYW1wbGVzfSlgLCBjaGFydFggKyBjaGFydFcvMiwgY2hhcnRZIC0gMTApO1xyXG4gICAgXHJcbiAgICBjdHguZmlsbFN0eWxlID0gXCIjZWY0NDQ0XCI7XHJcbiAgICBjdHgudGV4dEFsaWduID0gXCJyaWdodFwiO1xyXG4gICAgY3R4LmZpbGxUZXh0KGBUaGVvcmV0aWNhbCDPh8KyKGs9JHtzdGF0ZS5rfSlgLCBjaGFydFggKyBjaGFydFcgLSAxMCwgY2hhcnRZICsgMzApO1xyXG5cclxuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShkcmF3KTtcclxuICB9XHJcblxyXG4gIC8vIFN0YXJ0XHJcbiAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGRyYXcpO1xyXG5cclxuICByZXR1cm4gd3JhcHBlcjtcclxufSkoKTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdjaGlfc3F1YXJlZF9tZWNoYW5pc20nKSJ9XX0=
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../..";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "thinhong/s4bvn";
    script.dataset.repoId = "R_kgDOQtVYcQ";
    script.dataset.category = "General";
    script.dataset.categoryId = "DIC_kwDOQtVYcc4C00o0";
    script.dataset.mapping = "title";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./distr-pois.html" class="pagination-link" aria-label="Phân phối Poisson">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Phân phối Poisson</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./distr-exp.html" class="pagination-link" aria-label="Phân phối mũ">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Phân phối mũ</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>