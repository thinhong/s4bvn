<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Phân phối nhị thức – Statistics for babies</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./distr-pois.html" rel="next">
<link href="./distr-d.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-832c273f0af7a47d06e59912ec7b3523.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-N2T5TFNFY7"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-N2T5TFNFY7', { 'anonymize_ip': true});
</script>
<script type="module" src="site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./distr-d.html">Phân phối rời rạc</a></li><li class="breadcrumb-item"><a href="./distr-bin.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Phân phối nhị thức</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Statistics for babies</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prob.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Xác suất</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Phân phối xác suất</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./distr-d.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Phân phối rời rạc</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-bin.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Phân phối nhị thức</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-pois.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Phân phối Poisson</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./distr-c.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Phân phối liên tục</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-exp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Phân phối mũ</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-pl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Phân phối quy tắc lũy thừa</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lik.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Hàm hợp lý</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Bayesian</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./thanks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lời cảm ơn</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tài liệu tham khảo</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#ứng-dụng" id="toc-ứng-dụng" class="nav-link active" data-scroll-target="#ứng-dụng"><span class="header-section-number">3.1</span> Ứng dụng</a>
  <ul class="collapse">
  <li><a href="#khoảng-tin-cậy-của-tỉ-lệ" id="toc-khoảng-tin-cậy-của-tỉ-lệ" class="nav-link" data-scroll-target="#khoảng-tin-cậy-của-tỉ-lệ"><span class="header-section-number">3.1.1</span> Khoảng tin cậy của tỉ lệ</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./distr-d.html">Phân phối rời rạc</a></li><li class="breadcrumb-item"><a href="./distr-bin.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Phân phối nhị thức</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Phân phối nhị thức</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb1" data-startfrom="7" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 6;"><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>viewof binomial_dist <span class="op">=</span> (() <span class="kw">=&gt;</span> {</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 1. MATH</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lcCache <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">lc</span>(n<span class="op">,</span>k){</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(k<span class="op">&lt;</span><span class="dv">0</span><span class="op">||</span>k<span class="op">&gt;</span>n)<span class="cf">return</span> <span class="op">-</span><span class="kw">Infinity</span><span class="op">;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(k<span class="op">&gt;</span>n<span class="op">-</span>k)k<span class="op">=</span>n<span class="op">-</span>k<span class="op">;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> key<span class="op">=</span>(n<span class="op">&lt;&lt;</span><span class="dv">12</span>)<span class="op">|</span>k<span class="op">;</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(lcCache<span class="op">.</span><span class="fu">has</span>(key))<span class="cf">return</span> lcCache<span class="op">.</span><span class="fu">get</span>(key)<span class="op">;</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> r<span class="op">=</span><span class="dv">0</span><span class="op">;</span><span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>k<span class="op">;</span>i<span class="op">++</span>)r<span class="op">+=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(n<span class="op">-</span>i)<span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(i<span class="op">+</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    lcCache<span class="op">.</span><span class="fu">set</span>(key<span class="op">,</span>r)<span class="op">;</span><span class="cf">return</span> r<span class="op">;</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">pmf</span>(x<span class="op">,</span>n<span class="op">,</span>p){</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(x<span class="op">&lt;</span><span class="dv">0</span><span class="op">||</span>x<span class="op">&gt;</span>n)<span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(p<span class="op">&lt;=</span><span class="dv">0</span>)<span class="cf">return</span> x<span class="op">===</span><span class="dv">0</span><span class="op">?</span><span class="dv">1</span><span class="op">:</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(p<span class="op">&gt;=</span><span class="dv">1</span>)<span class="cf">return</span> x<span class="op">===</span>n<span class="op">?</span><span class="dv">1</span><span class="op">:</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="fu">lc</span>(n<span class="op">,</span>x)<span class="op">+</span>x<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(p)<span class="op">+</span>(n<span class="op">-</span>x)<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="dv">1</span><span class="op">-</span>p))<span class="op">;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 2. WRAPPER + STYLE</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> wrapper <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="vs">    display:flex;flex-direction:column;align-items:center;</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="vs">    width:100%;max-width:900px;margin:0 auto;</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> style <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"style"</span>)<span class="op">;</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  style<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="vs">    .bd-slider{position:relative;height:8px;border-radius:4px;background:#e2e8f0;}</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="vs">    .bd-slider-fill{position:absolute;left:0;top:0;height:100%;border-radius:4px;transition:width 0.04s;}</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="vs">    .bd-slider input[type=range]{</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="vs">      position:absolute;top:0;left:0;width:100%;height:100%;</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="vs">      -webkit-appearance:none;appearance:none;background:transparent;</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="vs">      cursor:pointer;margin:0;padding:0;</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="vs">    .bd-slider input[type=range]::-webkit-slider-thumb{</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="vs">      -webkit-appearance:none;appearance:none;</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="vs">      width:20px;height:20px;border-radius:50%;</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="vs">      border:3px solid #fff;box-shadow:0 1px 5px rgba(0,0,0,0.28);</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="vs">      cursor:pointer;margin-top:-6px;background:#475569;</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="vs">    .bd-slider input[type=range]::-moz-range-thumb{</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="vs">      width:14px;height:14px;border-radius:50%;</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="vs">      border:3px solid #fff;box-shadow:0 1px 5px rgba(0,0,0,0.28);</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="vs">      cursor:pointer;background:#475569;</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="vs">    .bd-slider input[type=range]::-webkit-slider-runnable-track{height:8px;background:transparent;}</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="vs">    .bd-slider input[type=range]::-moz-range-track{height:8px;background:transparent;}</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="vs">    .bd-slider-dark input[type=range]::-webkit-slider-thumb{background:#1e293b;}</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="vs">    .bd-slider-dark input[type=range]::-moz-range-thumb{background:#1e293b;}</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="vs">    .bd-slider-blue input[type=range]::-webkit-slider-thumb{background:#3b82f6;}</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="vs">    .bd-slider-blue input[type=range]::-moz-range-thumb{background:#3b82f6;}</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(style)<span class="op">;</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 3. SLIDERS</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">createSlider</span>(label<span class="op">,</span> min<span class="op">,</span> max<span class="op">,</span> step<span class="op">,</span> val<span class="op">,</span> color<span class="op">,</span> cls) {</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> row <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    row<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display:flex;flex-direction:column;flex:1;min-width:140px;"</span><span class="op">;</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> head <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    head<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display:flex;justify-content:space-between;align-items:baseline;margin-bottom:5px;"</span><span class="op">;</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> lbl <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"span"</span>)<span class="op">;</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    lbl<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"font-size:12px;font-weight:600;color:#64748b;letter-spacing:0.3px;text-transform:uppercase;"</span><span class="op">;</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    lbl<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> label<span class="op">;</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> valSpan <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"span"</span>)<span class="op">;</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>    valSpan<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`font-size:18px;font-weight:800;color:</span><span class="sc">${</span>color<span class="sc">}</span><span class="vs">;font-variant-numeric:tabular-nums;font-family:"SF Mono",SFMono-Regular,Menlo,Consolas,monospace;`</span><span class="op">;</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    valSpan<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> step <span class="op">&lt;</span> <span class="dv">1</span> <span class="op">?</span> <span class="bu">Number</span>(val)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">:</span> val<span class="op">;</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    head<span class="op">.</span><span class="fu">appendChild</span>(lbl)<span class="op">;</span> head<span class="op">.</span><span class="fu">appendChild</span>(valSpan)<span class="op">;</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> track <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>    track<span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="st">"bd-slider bd-slider-"</span> <span class="op">+</span> cls<span class="op">;</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> fill <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="st">"bd-slider-fill"</span><span class="op">;</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">background</span> <span class="op">=</span> color<span class="op">;</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">width</span> <span class="op">=</span> ((val <span class="op">-</span> min) <span class="op">/</span> (max <span class="op">-</span> min)) <span class="op">*</span> <span class="dv">100</span> <span class="op">+</span> <span class="st">"%"</span><span class="op">;</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>    track<span class="op">.</span><span class="fu">appendChild</span>(fill)<span class="op">;</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> input <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"input"</span>)<span class="op">;</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>    input<span class="op">.</span><span class="at">type</span> <span class="op">=</span> <span class="st">"range"</span><span class="op">;</span> input<span class="op">.</span><span class="at">min</span> <span class="op">=</span> min<span class="op">;</span> input<span class="op">.</span><span class="at">max</span> <span class="op">=</span> max<span class="op">;</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>    input<span class="op">.</span><span class="at">step</span> <span class="op">=</span> step<span class="op">;</span> input<span class="op">.</span><span class="at">value</span> <span class="op">=</span> val<span class="op">;</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>    track<span class="op">.</span><span class="fu">appendChild</span>(input)<span class="op">;</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>    row<span class="op">.</span><span class="fu">appendChild</span>(head)<span class="op">;</span> row<span class="op">.</span><span class="fu">appendChild</span>(track)<span class="op">;</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="dt">el</span><span class="op">:</span> row<span class="op">,</span> input<span class="op">,</span> valSpan<span class="op">,</span> fill<span class="op">,</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>      <span class="fu">val</span>() { <span class="cf">return</span> <span class="op">+</span>input<span class="op">.</span><span class="at">value</span><span class="op">;</span> }<span class="op">,</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sync</span>() {</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> v <span class="op">=</span> <span class="op">+</span>input<span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>        valSpan<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> step <span class="op">&lt;</span> <span class="dv">1</span> <span class="op">?</span> v<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">:</span> <span class="bu">String</span>(v)<span class="op">;</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>        fill<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">width</span> <span class="op">=</span> ((v <span class="op">-</span> min) <span class="op">/</span> (max <span class="op">-</span> min)) <span class="op">*</span> <span class="dv">100</span> <span class="op">+</span> <span class="st">"%"</span><span class="op">;</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> SL <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">n</span> <span class="op">=</span> <span class="fu">createSlider</span>(<span class="st">"n (trials)"</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="st">"#1e293b"</span><span class="op">,</span> <span class="st">"dark"</span>)<span class="op">;</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">p</span> <span class="op">=</span> <span class="fu">createSlider</span>(<span class="st">"p (success probability)"</span><span class="op">,</span> <span class="fl">0.01</span><span class="op">,</span> <span class="fl">0.99</span><span class="op">,</span> <span class="fl">0.01</span><span class="op">,</span> <span class="fl">0.50</span><span class="op">,</span> <span class="st">"#3b82f6"</span><span class="op">,</span> <span class="st">"blue"</span>)<span class="op">;</span></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ctrlRow <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>  ctrlRow<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display:flex;gap:28px;width:100%;margin-bottom:14px;padding-bottom:14px;border-bottom:1px solid #e2e8f0;"</span><span class="op">;</span></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>  ctrlRow<span class="op">.</span><span class="fu">appendChild</span>(SL<span class="op">.</span><span class="at">n</span><span class="op">.</span><span class="at">el</span>)<span class="op">;</span> ctrlRow<span class="op">.</span><span class="fu">appendChild</span>(SL<span class="op">.</span><span class="at">p</span><span class="op">.</span><span class="at">el</span>)<span class="op">;</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(ctrlRow)<span class="op">;</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 4. SVG CHART (pre-allocated pools)</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> NS <span class="op">=</span> <span class="st">"http://www.w3.org/2000/svg"</span><span class="op">;</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> W <span class="op">=</span> <span class="dv">760</span><span class="op">,</span> H <span class="op">=</span> <span class="dv">380</span><span class="op">;</span></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mg <span class="op">=</span> {<span class="dt">t</span><span class="op">:</span><span class="dv">16</span><span class="op">,</span> <span class="dt">r</span><span class="op">:</span><span class="dv">20</span><span class="op">,</span> <span class="dt">b</span><span class="op">:</span><span class="dv">48</span><span class="op">,</span> <span class="dt">l</span><span class="op">:</span><span class="dv">56</span>}<span class="op">;</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cw <span class="op">=</span> W<span class="op">-</span>mg<span class="op">.</span><span class="at">l</span><span class="op">-</span>mg<span class="op">.</span><span class="at">r</span><span class="op">,</span> ch <span class="op">=</span> H<span class="op">-</span>mg<span class="op">.</span><span class="at">t</span><span class="op">-</span>mg<span class="op">.</span><span class="at">b</span><span class="op">;</span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElementNS</span>(NS<span class="op">,</span><span class="st">"svg"</span>)<span class="op">;</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"viewBox"</span><span class="op">,</span><span class="vs">`0 0 </span><span class="sc">${</span>W<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>H<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`width:100%;max-width:</span><span class="sc">${</span>W<span class="sc">}</span><span class="vs">px;background:#fafbfc;border-radius:10px;border:1px solid #e2e8f0;`</span><span class="op">;</span></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">el</span>(tag<span class="op">,</span>a){<span class="kw">const</span> e<span class="op">=</span><span class="bu">document</span><span class="op">.</span><span class="fu">createElementNS</span>(NS<span class="op">,</span>tag)<span class="op">;</span><span class="cf">if</span>(a)<span class="cf">for</span>(<span class="kw">const</span>[k<span class="op">,</span>v]<span class="kw">of</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">entries</span>(a))e<span class="op">.</span><span class="fu">setAttribute</span>(k<span class="op">,</span>v)<span class="op">;</span><span class="cf">return</span> e<span class="op">;</span>}</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Grid</span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> gridLines<span class="op">=</span>[]<span class="op">;</span></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;=</span><span class="dv">4</span><span class="op">;</span>i<span class="op">++</span>){<span class="kw">const</span> l<span class="op">=</span><span class="fu">el</span>(<span class="st">"line"</span><span class="op">,</span>{<span class="dt">stroke</span><span class="op">:</span><span class="st">"#e2e8f0"</span><span class="op">,</span><span class="st">"stroke-width"</span><span class="op">:</span><span class="st">"0.7"</span>})<span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(l)<span class="op">;</span>gridLines<span class="op">.</span><span class="fu">push</span>(l)<span class="op">;</span>}</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Y labels</span></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yLabels<span class="op">=</span>[]<span class="op">;</span></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;=</span><span class="dv">4</span><span class="op">;</span>i<span class="op">++</span>){<span class="kw">const</span> t<span class="op">=</span><span class="fu">el</span>(<span class="st">"text"</span><span class="op">,</span>{<span class="st">"text-anchor"</span><span class="op">:</span><span class="st">"end"</span><span class="op">,</span><span class="dt">fill</span><span class="op">:</span><span class="st">"#94a3b8"</span><span class="op">,</span><span class="st">"font-size"</span><span class="op">:</span><span class="st">"10"</span><span class="op">,</span><span class="st">"font-family"</span><span class="op">:</span><span class="st">"'SF Mono',monospace"</span>})<span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(t)<span class="op">;</span>yLabels<span class="op">.</span><span class="fu">push</span>(t)<span class="op">;</span>}</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bar pool</span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> POOL<span class="op">=</span><span class="dv">101</span><span class="op">;</span></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bars<span class="op">=</span>[]<span class="op">;</span></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>POOL<span class="op">;</span>i<span class="op">++</span>){</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> r<span class="op">=</span><span class="fu">el</span>(<span class="st">"rect"</span><span class="op">,</span>{<span class="dt">rx</span><span class="op">:</span><span class="st">"2"</span><span class="op">,</span><span class="dt">fill</span><span class="op">:</span><span class="st">"#3b82f6"</span><span class="op">,</span><span class="dt">stroke</span><span class="op">:</span><span class="st">"#2563eb"</span><span class="op">,</span><span class="st">"stroke-width"</span><span class="op">:</span><span class="st">"0.5"</span>})<span class="op">;</span></span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>    r<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">"none"</span><span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(r)<span class="op">;</span>bars<span class="op">.</span><span class="fu">push</span>(r)<span class="op">;</span></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Hover bar</span></span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hoverBar<span class="op">=</span><span class="fu">el</span>(<span class="st">"rect"</span><span class="op">,</span>{<span class="dt">rx</span><span class="op">:</span><span class="st">"2"</span><span class="op">,</span><span class="dt">fill</span><span class="op">:</span><span class="st">"rgba(59,130,246,0.35)"</span><span class="op">,</span><span class="dt">stroke</span><span class="op">:</span><span class="st">"#1d4ed8"</span><span class="op">,</span><span class="st">"stroke-width"</span><span class="op">:</span><span class="st">"1"</span>})<span class="op">;</span></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>  hoverBar<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">"none"</span><span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(hoverBar)<span class="op">;</span></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>  <span class="co">// X axis</span></span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xAxisLine<span class="op">=</span><span class="fu">el</span>(<span class="st">"line"</span><span class="op">,</span>{<span class="dt">stroke</span><span class="op">:</span><span class="st">"#94a3b8"</span>})<span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(xAxisLine)<span class="op">;</span></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xTicks<span class="op">=</span>[]<span class="op">;</span></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span><span class="dv">30</span><span class="op">;</span>i<span class="op">++</span>){</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> ln<span class="op">=</span><span class="fu">el</span>(<span class="st">"line"</span><span class="op">,</span>{<span class="dt">stroke</span><span class="op">:</span><span class="st">"#94a3b8"</span><span class="op">,</span><span class="dt">y2</span><span class="op">:</span><span class="st">"5"</span>})<span class="op">;</span>ln<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">"none"</span><span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(ln)<span class="op">;</span></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> t<span class="op">=</span><span class="fu">el</span>(<span class="st">"text"</span><span class="op">,</span>{<span class="st">"text-anchor"</span><span class="op">:</span><span class="st">"middle"</span><span class="op">,</span><span class="dt">fill</span><span class="op">:</span><span class="st">"#64748b"</span><span class="op">,</span><span class="st">"font-size"</span><span class="op">:</span><span class="st">"11"</span><span class="op">,</span><span class="st">"font-family"</span><span class="op">:</span><span class="st">"'SF Mono',monospace"</span><span class="op">,</span><span class="dt">dy</span><span class="op">:</span><span class="st">"16"</span>})<span class="op">;</span>t<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">"none"</span><span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(t)<span class="op">;</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>    xTicks<span class="op">.</span><span class="fu">push</span>({ln<span class="op">,</span>t})<span class="op">;</span></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xLabel<span class="op">=</span><span class="fu">el</span>(<span class="st">"text"</span><span class="op">,</span>{<span class="st">"text-anchor"</span><span class="op">:</span><span class="st">"middle"</span><span class="op">,</span><span class="dt">fill</span><span class="op">:</span><span class="st">"#64748b"</span><span class="op">,</span><span class="st">"font-size"</span><span class="op">:</span><span class="st">"12"</span><span class="op">,</span><span class="dt">y</span><span class="op">:</span><span class="bu">String</span>(H<span class="op">-</span><span class="dv">4</span>)})<span class="op">;</span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>  xLabel<span class="op">.</span><span class="at">textContent</span><span class="op">=</span><span class="st">"Number of successes (k)"</span><span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(xLabel)<span class="op">;</span></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Y axis</span></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">appendChild</span>(<span class="fu">el</span>(<span class="st">"line"</span><span class="op">,</span>{<span class="dt">x1</span><span class="op">:</span><span class="bu">String</span>(mg<span class="op">.</span><span class="at">l</span>)<span class="op">,</span><span class="dt">x2</span><span class="op">:</span><span class="bu">String</span>(mg<span class="op">.</span><span class="at">l</span>)<span class="op">,</span><span class="dt">y1</span><span class="op">:</span><span class="bu">String</span>(mg<span class="op">.</span><span class="at">t</span>)<span class="op">,</span><span class="dt">y2</span><span class="op">:</span><span class="bu">String</span>(mg<span class="op">.</span><span class="at">t</span><span class="op">+</span>ch)<span class="op">,</span><span class="dt">stroke</span><span class="op">:</span><span class="st">"#94a3b8"</span>}))<span class="op">;</span></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yLabel<span class="op">=</span><span class="fu">el</span>(<span class="st">"text"</span><span class="op">,</span>{<span class="st">"text-anchor"</span><span class="op">:</span><span class="st">"middle"</span><span class="op">,</span><span class="dt">fill</span><span class="op">:</span><span class="st">"#64748b"</span><span class="op">,</span><span class="st">"font-size"</span><span class="op">:</span><span class="st">"12"</span><span class="op">,</span><span class="dt">x</span><span class="op">:</span><span class="st">"14"</span><span class="op">,</span><span class="dt">y</span><span class="op">:</span><span class="bu">String</span>(mg<span class="op">.</span><span class="at">t</span><span class="op">+</span>ch<span class="op">/</span><span class="dv">2</span>)<span class="op">,</span><span class="dt">transform</span><span class="op">:</span><span class="vs">`rotate(-90,14,</span><span class="sc">${</span>mg<span class="op">.</span><span class="at">t</span><span class="op">+</span>ch<span class="op">/</span><span class="dv">2</span><span class="sc">}</span><span class="vs">)`</span>})<span class="op">;</span></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>  yLabel<span class="op">.</span><span class="at">textContent</span><span class="op">=</span><span class="st">"P(X = k)"</span><span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(yLabel)<span class="op">;</span></span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Tooltip</span></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tipG<span class="op">=</span><span class="fu">el</span>(<span class="st">"g"</span>)<span class="op">;</span>tipG<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">"none"</span><span class="op">;</span></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tipRect<span class="op">=</span><span class="fu">el</span>(<span class="st">"rect"</span><span class="op">,</span>{<span class="dt">rx</span><span class="op">:</span><span class="st">"6"</span><span class="op">,</span><span class="dt">fill</span><span class="op">:</span><span class="st">"#1e293b"</span><span class="op">,</span><span class="dt">opacity</span><span class="op">:</span><span class="st">"0.92"</span>})<span class="op">;</span></span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tipText1<span class="op">=</span><span class="fu">el</span>(<span class="st">"text"</span><span class="op">,</span>{<span class="dt">fill</span><span class="op">:</span><span class="st">"#fff"</span><span class="op">,</span><span class="st">"font-size"</span><span class="op">:</span><span class="st">"12"</span><span class="op">,</span><span class="st">"font-weight"</span><span class="op">:</span><span class="st">"700"</span><span class="op">,</span><span class="st">"font-family"</span><span class="op">:</span><span class="st">"'SF Mono',monospace"</span>})<span class="op">;</span></span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tipText2<span class="op">=</span><span class="fu">el</span>(<span class="st">"text"</span><span class="op">,</span>{<span class="dt">fill</span><span class="op">:</span><span class="st">"#94a3b8"</span><span class="op">,</span><span class="st">"font-size"</span><span class="op">:</span><span class="st">"11"</span><span class="op">,</span><span class="st">"font-family"</span><span class="op">:</span><span class="st">"'SF Mono',monospace"</span>})<span class="op">;</span></span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>  tipG<span class="op">.</span><span class="fu">appendChild</span>(tipRect)<span class="op">;</span>tipG<span class="op">.</span><span class="fu">appendChild</span>(tipText1)<span class="op">;</span>tipG<span class="op">.</span><span class="fu">appendChild</span>(tipText2)<span class="op">;</span></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">appendChild</span>(tipG)<span class="op">;</span></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(svg)<span class="op">;</span></span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 5. RENDER</span></span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> curData<span class="op">=</span>[]<span class="op">,</span> curMaxY<span class="op">=</span><span class="dv">0</span><span class="op">,</span> hoverIdx<span class="op">=-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> sx<span class="op">,</span> sy<span class="op">,</span> barW<span class="op">,</span> baseline<span class="op">;</span></span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">render</span>(){</span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> nV<span class="op">=</span>SL<span class="op">.</span><span class="at">n</span><span class="op">.</span><span class="fu">val</span>()<span class="op">,</span> pV<span class="op">=</span>SL<span class="op">.</span><span class="at">p</span><span class="op">.</span><span class="fu">val</span>()<span class="op">;</span></span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> mean<span class="op">=</span>nV<span class="op">*</span>pV<span class="op">,</span> sd<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(nV<span class="op">*</span>pV<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>pV))<span class="op">;</span></span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> loX<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(mean<span class="op">-</span><span class="dv">4</span><span class="op">*</span>sd<span class="op">-</span><span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> hiX<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(nV<span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(mean<span class="op">+</span><span class="dv">4</span><span class="op">*</span>sd<span class="op">+</span><span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(nV<span class="op">&lt;=</span><span class="dv">30</span>){loX<span class="op">=</span><span class="dv">0</span><span class="op">;</span>hiX<span class="op">=</span>nV<span class="op">;</span>}</span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>    curData<span class="op">=</span>[]<span class="op">;</span>curMaxY<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> x<span class="op">=</span>loX<span class="op">;</span>x<span class="op">&lt;=</span>hiX<span class="op">;</span>x<span class="op">++</span>){</span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> p<span class="op">=</span><span class="fu">pmf</span>(x<span class="op">,</span>nV<span class="op">,</span>pV)<span class="op">;</span></span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>      curData<span class="op">.</span><span class="fu">push</span>({x<span class="op">,</span><span class="dt">prob</span><span class="op">:</span>p})<span class="op">;</span></span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(p<span class="op">&gt;</span>curMaxY)curMaxY<span class="op">=</span>p<span class="op">;</span></span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>    curMaxY<span class="op">*=</span><span class="fl">1.15</span><span class="op">;</span></span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(curMaxY<span class="op">&lt;</span><span class="fl">1e-9</span>)curMaxY<span class="op">=</span><span class="fl">0.01</span><span class="op">;</span></span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cnt<span class="op">=</span>hiX<span class="op">-</span>loX<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>    sx<span class="op">=</span>x<span class="kw">=&gt;</span>mg<span class="op">.</span><span class="at">l</span><span class="op">+</span>((x<span class="op">-</span>loX)<span class="op">/</span>(hiX<span class="op">-</span>loX))<span class="op">*</span>cw<span class="op">;</span></span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>    sy<span class="op">=</span>y<span class="kw">=&gt;</span>mg<span class="op">.</span><span class="at">t</span><span class="op">+</span>ch<span class="op">-</span>(y<span class="op">/</span>curMaxY)<span class="op">*</span>ch<span class="op">;</span></span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>    barW<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">28</span><span class="op">,</span>cw<span class="op">/</span>cnt<span class="op">*</span><span class="fl">0.75</span>))<span class="op">;</span></span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>    baseline<span class="op">=</span><span class="fu">sy</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Grid + Y labels</span></span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;=</span><span class="dv">4</span><span class="op">;</span>i<span class="op">++</span>){</span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> v<span class="op">=</span>(curMaxY<span class="op">/</span><span class="dv">4</span>)<span class="op">*</span>i<span class="op">,</span>yy<span class="op">=</span><span class="fu">sy</span>(v)<span class="op">;</span></span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>      gridLines[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x1"</span><span class="op">,</span>mg<span class="op">.</span><span class="at">l</span>)<span class="op">;</span>gridLines[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x2"</span><span class="op">,</span>W<span class="op">-</span>mg<span class="op">.</span><span class="at">r</span>)<span class="op">;</span></span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>      gridLines[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y1"</span><span class="op">,</span>yy)<span class="op">;</span>gridLines[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y2"</span><span class="op">,</span>yy)<span class="op">;</span></span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>      yLabels[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span>mg<span class="op">.</span><span class="at">l</span><span class="op">-</span><span class="dv">8</span>)<span class="op">;</span>yLabels[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span>yy<span class="op">+</span><span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>      yLabels[i]<span class="op">.</span><span class="at">textContent</span><span class="op">=</span>v<span class="op">.</span><span class="fu">toFixed</span>(v<span class="op">&lt;</span><span class="fl">0.01</span><span class="op">?</span><span class="dv">4</span><span class="op">:</span><span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Bars</span></span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>POOL<span class="op">;</span>i<span class="op">++</span>){</span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(i<span class="op">&lt;</span>curData<span class="op">.</span><span class="at">length</span>){</span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> d<span class="op">=</span>curData[i]<span class="op">;</span></span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> bx<span class="op">=</span><span class="fu">sx</span>(d<span class="op">.</span><span class="at">x</span>)<span class="op">-</span>barW<span class="op">/</span><span class="dv">2</span><span class="op">,</span>by<span class="op">=</span><span class="fu">sy</span>(d<span class="op">.</span><span class="at">prob</span>)<span class="op">;</span></span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>        bars[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span>bx)<span class="op">;</span>bars[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span>by)<span class="op">;</span></span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>        bars[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"width"</span><span class="op">,</span>barW)<span class="op">;</span>bars[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"height"</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span>baseline<span class="op">-</span>by))<span class="op">;</span></span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>        bars[i]<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">""</span><span class="op">;</span></span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span>{bars[i]<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">"none"</span><span class="op">;</span>}</span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>    <span class="co">// X axis</span></span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>    xAxisLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x1"</span><span class="op">,</span>mg<span class="op">.</span><span class="at">l</span>)<span class="op">;</span>xAxisLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x2"</span><span class="op">,</span>W<span class="op">-</span>mg<span class="op">.</span><span class="at">r</span>)<span class="op">;</span></span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>    xAxisLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y1"</span><span class="op">,</span>baseline)<span class="op">;</span>xAxisLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y2"</span><span class="op">,</span>baseline)<span class="op">;</span></span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>    xLabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span>mg<span class="op">.</span><span class="at">l</span><span class="op">+</span>cw<span class="op">/</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> span<span class="op">=</span>hiX<span class="op">-</span>loX<span class="op">;</span></span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> ts<span class="op">=</span>span<span class="op">&gt;</span><span class="dv">80</span><span class="op">?</span><span class="dv">10</span><span class="op">:</span>span<span class="op">&gt;</span><span class="dv">40</span><span class="op">?</span><span class="dv">5</span><span class="op">:</span>span<span class="op">&gt;</span><span class="dv">20</span><span class="op">?</span><span class="dv">2</span><span class="op">:</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> ti<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> x<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(loX<span class="op">/</span>ts)<span class="op">*</span>ts<span class="op">;</span>x<span class="op">&lt;=</span>hiX<span class="op">&amp;&amp;</span>ti<span class="op">&lt;</span><span class="dv">30</span><span class="op">;</span>x<span class="op">+=</span>ts){</span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> xx<span class="op">=</span><span class="fu">sx</span>(x)<span class="op">;</span></span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>      xTicks[ti]<span class="op">.</span><span class="at">ln</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x1"</span><span class="op">,</span>xx)<span class="op">;</span>xTicks[ti]<span class="op">.</span><span class="at">ln</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x2"</span><span class="op">,</span>xx)<span class="op">;</span></span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>      xTicks[ti]<span class="op">.</span><span class="at">ln</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y1"</span><span class="op">,</span>baseline)<span class="op">;</span>xTicks[ti]<span class="op">.</span><span class="at">ln</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y2"</span><span class="op">,</span>baseline<span class="op">+</span><span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>      xTicks[ti]<span class="op">.</span><span class="at">ln</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">""</span><span class="op">;</span></span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a>      xTicks[ti]<span class="op">.</span><span class="at">t</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span>xx)<span class="op">;</span>xTicks[ti]<span class="op">.</span><span class="at">t</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span>baseline<span class="op">+</span><span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>      xTicks[ti]<span class="op">.</span><span class="at">t</span><span class="op">.</span><span class="at">textContent</span><span class="op">=</span>x<span class="op">;</span>xTicks[ti]<span class="op">.</span><span class="at">t</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">""</span><span class="op">;</span></span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a>      ti<span class="op">++;</span></span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="op">;</span>ti<span class="op">&lt;</span><span class="dv">30</span><span class="op">;</span>ti<span class="op">++</span>){xTicks[ti]<span class="op">.</span><span class="at">ln</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">"none"</span><span class="op">;</span>xTicks[ti]<span class="op">.</span><span class="at">t</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">"none"</span><span class="op">;</span>}</span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateHover</span>()<span class="op">;</span></span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>    wrapper<span class="op">.</span><span class="at">value</span><span class="op">=</span>{<span class="dt">n</span><span class="op">:</span>nV<span class="op">,</span><span class="dt">p</span><span class="op">:</span>pV}<span class="op">;</span></span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>    wrapper<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">Event</span>(<span class="st">"input"</span><span class="op">,</span>{<span class="dt">bubbles</span><span class="op">:</span><span class="kw">true</span>}))<span class="op">;</span></span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 6. HOVER</span></span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateHover</span>(){</span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(hoverIdx<span class="op">&lt;</span><span class="dv">0</span><span class="op">||</span>hoverIdx<span class="op">&gt;=</span>curData<span class="op">.</span><span class="at">length</span>){</span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a>      hoverBar<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">"none"</span><span class="op">;</span>tipG<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">"none"</span><span class="op">;</span><span class="cf">return</span><span class="op">;</span></span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> d<span class="op">=</span>curData[hoverIdx]<span class="op">;</span></span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> bx<span class="op">=</span><span class="fu">sx</span>(d<span class="op">.</span><span class="at">x</span>)<span class="op">-</span>barW<span class="op">/</span><span class="dv">2</span><span class="op">,</span>by<span class="op">=</span><span class="fu">sy</span>(d<span class="op">.</span><span class="at">prob</span>)<span class="op">;</span></span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>    hoverBar<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span>bx<span class="op">-</span><span class="dv">1</span>)<span class="op">;</span>hoverBar<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span>by<span class="op">-</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a>    hoverBar<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"width"</span><span class="op">,</span>barW<span class="op">+</span><span class="dv">2</span>)<span class="op">;</span>hoverBar<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"height"</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span>baseline<span class="op">-</span>by)<span class="op">+</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>    hoverBar<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">""</span><span class="op">;</span></span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> t1<span class="op">=</span><span class="st">"k = "</span><span class="op">+</span>d<span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> t2<span class="op">=</span><span class="st">"P = "</span><span class="op">+</span>d<span class="op">.</span><span class="at">prob</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> tw<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(t1<span class="op">.</span><span class="at">length</span><span class="op">,</span>t2<span class="op">.</span><span class="at">length</span>)<span class="op">*</span><span class="fl">7.5</span><span class="op">+</span><span class="dv">16</span><span class="op">;</span></span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> th<span class="op">=</span><span class="dv">40</span><span class="op">;</span></span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> tx<span class="op">=</span><span class="fu">sx</span>(d<span class="op">.</span><span class="at">x</span>)<span class="op">+</span>barW<span class="op">/</span><span class="dv">2</span><span class="op">+</span><span class="dv">8</span><span class="op">,</span>ty<span class="op">=</span>by<span class="op">-</span><span class="dv">10</span><span class="op">;</span></span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(tx<span class="op">+</span>tw<span class="op">&gt;</span>W<span class="op">-</span>mg<span class="op">.</span><span class="at">r</span>)tx<span class="op">=</span><span class="fu">sx</span>(d<span class="op">.</span><span class="at">x</span>)<span class="op">-</span>barW<span class="op">/</span><span class="dv">2</span><span class="op">-</span>tw<span class="op">-</span><span class="dv">8</span><span class="op">;</span></span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(ty<span class="op">&lt;</span>mg<span class="op">.</span><span class="at">t</span>)ty<span class="op">=</span>mg<span class="op">.</span><span class="at">t</span><span class="op">+</span><span class="dv">4</span><span class="op">;</span></span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a>    tipRect<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span>tx)<span class="op">;</span>tipRect<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span>ty)<span class="op">;</span></span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a>    tipRect<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"width"</span><span class="op">,</span>tw)<span class="op">;</span>tipRect<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"height"</span><span class="op">,</span>th)<span class="op">;</span></span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a>    tipText1<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span>tx<span class="op">+</span><span class="dv">8</span>)<span class="op">;</span>tipText1<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span>ty<span class="op">+</span><span class="dv">16</span>)<span class="op">;</span>tipText1<span class="op">.</span><span class="at">textContent</span><span class="op">=</span>t1<span class="op">;</span></span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a>    tipText2<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span>tx<span class="op">+</span><span class="dv">8</span>)<span class="op">;</span>tipText2<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span>ty<span class="op">+</span><span class="dv">32</span>)<span class="op">;</span>tipText2<span class="op">.</span><span class="at">textContent</span><span class="op">=</span>t2<span class="op">;</span></span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a>    tipG<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">""</span><span class="op">;</span></span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">onMove</span>(e){</span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rect<span class="op">=</span>svg<span class="op">.</span><span class="fu">getBoundingClientRect</span>()<span class="op">;</span></span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> mouseX<span class="op">=</span>(e<span class="op">.</span><span class="at">clientX</span><span class="op">-</span>rect<span class="op">.</span><span class="at">left</span>)<span class="op">*</span>(W<span class="op">/</span>rect<span class="op">.</span><span class="at">width</span>)<span class="op">;</span></span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(mouseX<span class="op">&lt;</span>mg<span class="op">.</span><span class="at">l</span><span class="op">||</span>mouseX<span class="op">&gt;</span>W<span class="op">-</span>mg<span class="op">.</span><span class="at">r</span><span class="op">||!</span>curData<span class="op">.</span><span class="at">length</span>){hoverIdx<span class="op">=-</span><span class="dv">1</span><span class="op">;</span><span class="fu">updateHover</span>()<span class="op">;</span><span class="cf">return</span><span class="op">;</span>}</span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> best<span class="op">=-</span><span class="dv">1</span><span class="op">,</span>bestD<span class="op">=</span><span class="kw">Infinity</span><span class="op">;</span></span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>curData<span class="op">.</span><span class="at">length</span><span class="op">;</span>i<span class="op">++</span>){</span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> dist<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(<span class="fu">sx</span>(curData[i]<span class="op">.</span><span class="at">x</span>)<span class="op">-</span>mouseX)<span class="op">;</span></span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(dist<span class="op">&lt;</span>bestD){bestD<span class="op">=</span>dist<span class="op">;</span>best<span class="op">=</span>i<span class="op">;</span>}</span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(bestD<span class="op">&gt;</span>barW<span class="op">*</span><span class="fl">1.2</span>)best<span class="op">=-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(best<span class="op">!==</span>hoverIdx){hoverIdx<span class="op">=</span>best<span class="op">;</span><span class="fu">updateHover</span>()<span class="op">;</span>}</span>
<span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">onLeave</span>(){hoverIdx<span class="op">=-</span><span class="dv">1</span><span class="op">;</span><span class="fu">updateHover</span>()<span class="op">;</span>}</span>
<span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"mousemove"</span><span class="op">,</span>onMove)<span class="op">;</span></span>
<span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"mouseleave"</span><span class="op">,</span>onLeave)<span class="op">;</span></span>
<span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 7. EVENTS</span></span>
<span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> rafId<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">schedule</span>(){<span class="fu">cancelAnimationFrame</span>(rafId)<span class="op">;</span>rafId<span class="op">=</span><span class="fu">requestAnimationFrame</span>(render)<span class="op">;</span>}</span>
<span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">onN</span>(){SL<span class="op">.</span><span class="at">n</span><span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span><span class="fu">schedule</span>()<span class="op">;</span>}</span>
<span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">onP</span>(){SL<span class="op">.</span><span class="at">p</span><span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span><span class="fu">schedule</span>()<span class="op">;</span>}</span>
<span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">n</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span>onN)<span class="op">;</span></span>
<span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">p</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span>onP)<span class="op">;</span></span>
<span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 8. CLEANUP</span></span>
<span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb1-314"><a href="#cb1-314" aria-hidden="true" tabindex="-1"></a>  invalidation<span class="op">.</span><span class="fu">then</span>(()<span class="kw">=&gt;</span>{</span>
<span id="cb1-315"><a href="#cb1-315" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cancelAnimationFrame</span>(rafId)<span class="op">;</span></span>
<span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a>    SL<span class="op">.</span><span class="at">n</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"input"</span><span class="op">,</span>onN)<span class="op">;</span></span>
<span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a>    SL<span class="op">.</span><span class="at">p</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"input"</span><span class="op">,</span>onP)<span class="op">;</span></span>
<span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"mousemove"</span><span class="op">,</span>onMove)<span class="op">;</span></span>
<span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"mouseleave"</span><span class="op">,</span>onLeave)<span class="op">;</span></span>
<span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a>    lcCache<span class="op">.</span><span class="fu">clear</span>()<span class="op">;</span>curData<span class="op">=</span>[]<span class="op">;</span></span>
<span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="at">value</span><span class="op">=</span>{}<span class="op">;</span></span>
<span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> wrapper<span class="op">;</span></span>
<span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a>})()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb2" data-startfrom="332" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 331;"><span id="cb2-332"><a href="#cb2-332" aria-hidden="true" tabindex="-1"></a>viewof galton_board <span class="op">=</span> (() <span class="kw">=&gt;</span> {</span>
<span id="cb2-333"><a href="#cb2-333" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> TAU <span class="op">=</span> <span class="fl">6.283185307</span><span class="op">;</span></span>
<span id="cb2-334"><a href="#cb2-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-335"><a href="#cb2-335" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-336"><a href="#cb2-336" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 1. WRAPPER + STYLE</span></span>
<span id="cb2-337"><a href="#cb2-337" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-338"><a href="#cb2-338" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> wrapper <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb2-339"><a href="#cb2-339" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb2-340"><a href="#cb2-340" aria-hidden="true" tabindex="-1"></a><span class="vs">    display:flex;flex-direction:column;align-items:center;</span></span>
<span id="cb2-341"><a href="#cb2-341" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;</span></span>
<span id="cb2-342"><a href="#cb2-342" aria-hidden="true" tabindex="-1"></a><span class="vs">    width:100%;max-width:520px;margin:0 auto;</span></span>
<span id="cb2-343"><a href="#cb2-343" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb2-344"><a href="#cb2-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-345"><a href="#cb2-345" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> style <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"style"</span>)<span class="op">;</span></span>
<span id="cb2-346"><a href="#cb2-346" aria-hidden="true" tabindex="-1"></a>  style<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb2-347"><a href="#cb2-347" aria-hidden="true" tabindex="-1"></a><span class="vs">    .gt-slider{position:relative;height:8px;border-radius:4px;background:#e2e8f0;}</span></span>
<span id="cb2-348"><a href="#cb2-348" aria-hidden="true" tabindex="-1"></a><span class="vs">    .gt-slider-fill{position:absolute;left:0;top:0;height:100%;border-radius:4px;transition:width 0.04s;}</span></span>
<span id="cb2-349"><a href="#cb2-349" aria-hidden="true" tabindex="-1"></a><span class="vs">    .gt-slider input[type=range]{</span></span>
<span id="cb2-350"><a href="#cb2-350" aria-hidden="true" tabindex="-1"></a><span class="vs">      position:absolute;top:0;left:0;width:100%;height:100%;</span></span>
<span id="cb2-351"><a href="#cb2-351" aria-hidden="true" tabindex="-1"></a><span class="vs">      -webkit-appearance:none;appearance:none;background:transparent;</span></span>
<span id="cb2-352"><a href="#cb2-352" aria-hidden="true" tabindex="-1"></a><span class="vs">      cursor:pointer;margin:0;padding:0;</span></span>
<span id="cb2-353"><a href="#cb2-353" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb2-354"><a href="#cb2-354" aria-hidden="true" tabindex="-1"></a><span class="vs">    .gt-slider input[type=range]::-webkit-slider-thumb{</span></span>
<span id="cb2-355"><a href="#cb2-355" aria-hidden="true" tabindex="-1"></a><span class="vs">      -webkit-appearance:none;appearance:none;</span></span>
<span id="cb2-356"><a href="#cb2-356" aria-hidden="true" tabindex="-1"></a><span class="vs">      width:20px;height:20px;border-radius:50%;</span></span>
<span id="cb2-357"><a href="#cb2-357" aria-hidden="true" tabindex="-1"></a><span class="vs">      border:3px solid #fff;box-shadow:0 1px 5px rgba(0,0,0,0.28);</span></span>
<span id="cb2-358"><a href="#cb2-358" aria-hidden="true" tabindex="-1"></a><span class="vs">      cursor:pointer;margin-top:-6px;background:#475569;</span></span>
<span id="cb2-359"><a href="#cb2-359" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb2-360"><a href="#cb2-360" aria-hidden="true" tabindex="-1"></a><span class="vs">    .gt-slider input[type=range]::-moz-range-thumb{</span></span>
<span id="cb2-361"><a href="#cb2-361" aria-hidden="true" tabindex="-1"></a><span class="vs">      width:14px;height:14px;border-radius:50%;</span></span>
<span id="cb2-362"><a href="#cb2-362" aria-hidden="true" tabindex="-1"></a><span class="vs">      border:3px solid #fff;box-shadow:0 1px 5px rgba(0,0,0,0.28);</span></span>
<span id="cb2-363"><a href="#cb2-363" aria-hidden="true" tabindex="-1"></a><span class="vs">      cursor:pointer;background:#475569;</span></span>
<span id="cb2-364"><a href="#cb2-364" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb2-365"><a href="#cb2-365" aria-hidden="true" tabindex="-1"></a><span class="vs">    .gt-slider input[type=range]::-webkit-slider-runnable-track{height:8px;background:transparent;}</span></span>
<span id="cb2-366"><a href="#cb2-366" aria-hidden="true" tabindex="-1"></a><span class="vs">    .gt-slider input[type=range]::-moz-range-track{height:8px;background:transparent;}</span></span>
<span id="cb2-367"><a href="#cb2-367" aria-hidden="true" tabindex="-1"></a><span class="vs">    .gt-slider-blue input[type=range]::-webkit-slider-thumb{background:#3b82f6;}</span></span>
<span id="cb2-368"><a href="#cb2-368" aria-hidden="true" tabindex="-1"></a><span class="vs">    .gt-slider-blue input[type=range]::-moz-range-thumb{background:#3b82f6;}</span></span>
<span id="cb2-369"><a href="#cb2-369" aria-hidden="true" tabindex="-1"></a><span class="vs">    .gt-slider-amber input[type=range]::-webkit-slider-thumb{background:#d97706;}</span></span>
<span id="cb2-370"><a href="#cb2-370" aria-hidden="true" tabindex="-1"></a><span class="vs">    .gt-slider-amber input[type=range]::-moz-range-thumb{background:#d97706;}</span></span>
<span id="cb2-371"><a href="#cb2-371" aria-hidden="true" tabindex="-1"></a><span class="vs">    .gt-slider-dark input[type=range]::-webkit-slider-thumb{background:#1e293b;}</span></span>
<span id="cb2-372"><a href="#cb2-372" aria-hidden="true" tabindex="-1"></a><span class="vs">    .gt-slider-dark input[type=range]::-moz-range-thumb{background:#1e293b;}</span></span>
<span id="cb2-373"><a href="#cb2-373" aria-hidden="true" tabindex="-1"></a><span class="vs">    .gt-btn{</span></span>
<span id="cb2-374"><a href="#cb2-374" aria-hidden="true" tabindex="-1"></a><span class="vs">      flex:1;padding:8px 0;border-radius:8px;border:1px solid #d1d5db;</span></span>
<span id="cb2-375"><a href="#cb2-375" aria-hidden="true" tabindex="-1"></a><span class="vs">      background:#fff;color:#374151;font-size:13px;font-weight:600;</span></span>
<span id="cb2-376"><a href="#cb2-376" aria-hidden="true" tabindex="-1"></a><span class="vs">      cursor:pointer;transition:background 0.1s;font-family:inherit;text-align:center;</span></span>
<span id="cb2-377"><a href="#cb2-377" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb2-378"><a href="#cb2-378" aria-hidden="true" tabindex="-1"></a><span class="vs">    .gt-btn:hover{background:#f3f4f6;}</span></span>
<span id="cb2-379"><a href="#cb2-379" aria-hidden="true" tabindex="-1"></a><span class="vs">    .gt-btn-go{background:#3b82f6;color:#fff;border-color:#2563eb;}</span></span>
<span id="cb2-380"><a href="#cb2-380" aria-hidden="true" tabindex="-1"></a><span class="vs">    .gt-btn-go:hover{background:#2563eb;color:#fff;}</span></span>
<span id="cb2-381"><a href="#cb2-381" aria-hidden="true" tabindex="-1"></a><span class="vs">    .gt-btn-reset{background:#fef2f2;color:#dc2626;border-color:#fecaca;}</span></span>
<span id="cb2-382"><a href="#cb2-382" aria-hidden="true" tabindex="-1"></a><span class="vs">    .gt-btn-reset:hover{background:#fee2e2;color:#dc2626;}</span></span>
<span id="cb2-383"><a href="#cb2-383" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb2-384"><a href="#cb2-384" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(style)<span class="op">;</span></span>
<span id="cb2-385"><a href="#cb2-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-386"><a href="#cb2-386" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-387"><a href="#cb2-387" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 2. SLIDER FACTORY</span></span>
<span id="cb2-388"><a href="#cb2-388" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-389"><a href="#cb2-389" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">createSlider</span>(label<span class="op">,</span> min<span class="op">,</span> max<span class="op">,</span> step<span class="op">,</span> val<span class="op">,</span> color<span class="op">,</span> cls) {</span>
<span id="cb2-390"><a href="#cb2-390" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> row <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb2-391"><a href="#cb2-391" aria-hidden="true" tabindex="-1"></a>    row<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display:flex;flex-direction:column;flex:1;min-width:120px;"</span><span class="op">;</span></span>
<span id="cb2-392"><a href="#cb2-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-393"><a href="#cb2-393" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> head <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb2-394"><a href="#cb2-394" aria-hidden="true" tabindex="-1"></a>    head<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display:flex;justify-content:space-between;align-items:baseline;margin-bottom:5px;"</span><span class="op">;</span></span>
<span id="cb2-395"><a href="#cb2-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-396"><a href="#cb2-396" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> lbl <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"span"</span>)<span class="op">;</span></span>
<span id="cb2-397"><a href="#cb2-397" aria-hidden="true" tabindex="-1"></a>    lbl<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"font-size:11px;font-weight:600;color:#64748b;letter-spacing:0.3px;text-transform:uppercase;"</span><span class="op">;</span></span>
<span id="cb2-398"><a href="#cb2-398" aria-hidden="true" tabindex="-1"></a>    lbl<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> label<span class="op">;</span></span>
<span id="cb2-399"><a href="#cb2-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-400"><a href="#cb2-400" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> valSpan <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"span"</span>)<span class="op">;</span></span>
<span id="cb2-401"><a href="#cb2-401" aria-hidden="true" tabindex="-1"></a>    valSpan<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`font-size:17px;font-weight:800;color:</span><span class="sc">${</span>color<span class="sc">}</span><span class="vs">;font-variant-numeric:tabular-nums;font-family:"SF Mono",SFMono-Regular,Menlo,Consolas,monospace;`</span><span class="op">;</span></span>
<span id="cb2-402"><a href="#cb2-402" aria-hidden="true" tabindex="-1"></a>    valSpan<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> step <span class="op">&lt;</span> <span class="dv">1</span> <span class="op">?</span> <span class="bu">Number</span>(val)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>) <span class="op">:</span> val<span class="op">;</span></span>
<span id="cb2-403"><a href="#cb2-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-404"><a href="#cb2-404" aria-hidden="true" tabindex="-1"></a>    head<span class="op">.</span><span class="fu">appendChild</span>(lbl)<span class="op">;</span> head<span class="op">.</span><span class="fu">appendChild</span>(valSpan)<span class="op">;</span></span>
<span id="cb2-405"><a href="#cb2-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-406"><a href="#cb2-406" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> track <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb2-407"><a href="#cb2-407" aria-hidden="true" tabindex="-1"></a>    track<span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="st">"gt-slider gt-slider-"</span> <span class="op">+</span> cls<span class="op">;</span></span>
<span id="cb2-408"><a href="#cb2-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-409"><a href="#cb2-409" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> fill <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb2-410"><a href="#cb2-410" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="st">"gt-slider-fill"</span><span class="op">;</span></span>
<span id="cb2-411"><a href="#cb2-411" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">background</span> <span class="op">=</span> color<span class="op">;</span></span>
<span id="cb2-412"><a href="#cb2-412" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">width</span> <span class="op">=</span> ((val <span class="op">-</span> min) <span class="op">/</span> (max <span class="op">-</span> min)) <span class="op">*</span> <span class="dv">100</span> <span class="op">+</span> <span class="st">"%"</span><span class="op">;</span></span>
<span id="cb2-413"><a href="#cb2-413" aria-hidden="true" tabindex="-1"></a>    track<span class="op">.</span><span class="fu">appendChild</span>(fill)<span class="op">;</span></span>
<span id="cb2-414"><a href="#cb2-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-415"><a href="#cb2-415" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> input <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"input"</span>)<span class="op">;</span></span>
<span id="cb2-416"><a href="#cb2-416" aria-hidden="true" tabindex="-1"></a>    input<span class="op">.</span><span class="at">type</span> <span class="op">=</span> <span class="st">"range"</span><span class="op">;</span> input<span class="op">.</span><span class="at">min</span> <span class="op">=</span> min<span class="op">;</span> input<span class="op">.</span><span class="at">max</span> <span class="op">=</span> max<span class="op">;</span></span>
<span id="cb2-417"><a href="#cb2-417" aria-hidden="true" tabindex="-1"></a>    input<span class="op">.</span><span class="at">step</span> <span class="op">=</span> step<span class="op">;</span> input<span class="op">.</span><span class="at">value</span> <span class="op">=</span> val<span class="op">;</span></span>
<span id="cb2-418"><a href="#cb2-418" aria-hidden="true" tabindex="-1"></a>    track<span class="op">.</span><span class="fu">appendChild</span>(input)<span class="op">;</span></span>
<span id="cb2-419"><a href="#cb2-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-420"><a href="#cb2-420" aria-hidden="true" tabindex="-1"></a>    row<span class="op">.</span><span class="fu">appendChild</span>(head)<span class="op">;</span> row<span class="op">.</span><span class="fu">appendChild</span>(track)<span class="op">;</span></span>
<span id="cb2-421"><a href="#cb2-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-422"><a href="#cb2-422" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="dt">el</span><span class="op">:</span> row<span class="op">,</span> input<span class="op">,</span> valSpan<span class="op">,</span> fill<span class="op">,</span></span>
<span id="cb2-423"><a href="#cb2-423" aria-hidden="true" tabindex="-1"></a>      <span class="fu">val</span>() { <span class="cf">return</span> <span class="op">+</span>input<span class="op">.</span><span class="at">value</span><span class="op">;</span> }<span class="op">,</span></span>
<span id="cb2-424"><a href="#cb2-424" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sync</span>() {</span>
<span id="cb2-425"><a href="#cb2-425" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> v <span class="op">=</span> <span class="op">+</span>input<span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb2-426"><a href="#cb2-426" aria-hidden="true" tabindex="-1"></a>        valSpan<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> step <span class="op">&lt;</span> <span class="dv">1</span> <span class="op">?</span> v<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>) <span class="op">:</span> <span class="bu">String</span>(v)<span class="op">;</span></span>
<span id="cb2-427"><a href="#cb2-427" aria-hidden="true" tabindex="-1"></a>        fill<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">width</span> <span class="op">=</span> ((v <span class="op">-</span> min) <span class="op">/</span> (max <span class="op">-</span> min)) <span class="op">*</span> <span class="dv">100</span> <span class="op">+</span> <span class="st">"%"</span><span class="op">;</span></span>
<span id="cb2-428"><a href="#cb2-428" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-429"><a href="#cb2-429" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb2-430"><a href="#cb2-430" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-431"><a href="#cb2-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-432"><a href="#cb2-432" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> SL <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb2-433"><a href="#cb2-433" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">rows</span>  <span class="op">=</span> <span class="fu">createSlider</span>(<span class="st">"Peg rows"</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="st">"#1e293b"</span><span class="op">,</span> <span class="st">"dark"</span>)<span class="op">;</span></span>
<span id="cb2-434"><a href="#cb2-434" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">total</span> <span class="op">=</span> <span class="fu">createSlider</span>(<span class="st">"Balls"</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">800</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">200</span><span class="op">,</span> <span class="st">"#3b82f6"</span><span class="op">,</span> <span class="st">"blue"</span>)<span class="op">;</span></span>
<span id="cb2-435"><a href="#cb2-435" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">speed</span> <span class="op">=</span> <span class="fu">createSlider</span>(<span class="st">"Speed"</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="fl">0.1</span><span class="op">,</span> <span class="fl">2.0</span><span class="op">,</span> <span class="st">"#d97706"</span><span class="op">,</span> <span class="st">"amber"</span>)<span class="op">;</span></span>
<span id="cb2-436"><a href="#cb2-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-437"><a href="#cb2-437" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Row 1: peg rows + balls (2 equal columns)</span></span>
<span id="cb2-438"><a href="#cb2-438" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> r1 <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb2-439"><a href="#cb2-439" aria-hidden="true" tabindex="-1"></a>  r1<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display:flex;gap:24px;width:100%;margin-bottom:10px;"</span><span class="op">;</span></span>
<span id="cb2-440"><a href="#cb2-440" aria-hidden="true" tabindex="-1"></a>  r1<span class="op">.</span><span class="fu">appendChild</span>(SL<span class="op">.</span><span class="at">rows</span><span class="op">.</span><span class="at">el</span>)<span class="op">;</span> r1<span class="op">.</span><span class="fu">appendChild</span>(SL<span class="op">.</span><span class="at">total</span><span class="op">.</span><span class="at">el</span>)<span class="op">;</span></span>
<span id="cb2-441"><a href="#cb2-441" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(r1)<span class="op">;</span></span>
<span id="cb2-442"><a href="#cb2-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-443"><a href="#cb2-443" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Row 2: speed — matched to first column width via same flex layout + invisible spacer</span></span>
<span id="cb2-444"><a href="#cb2-444" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> r2 <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb2-445"><a href="#cb2-445" aria-hidden="true" tabindex="-1"></a>  r2<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display:flex;gap:24px;width:100%;margin-bottom:12px;"</span><span class="op">;</span></span>
<span id="cb2-446"><a href="#cb2-446" aria-hidden="true" tabindex="-1"></a>  r2<span class="op">.</span><span class="fu">appendChild</span>(SL<span class="op">.</span><span class="at">speed</span><span class="op">.</span><span class="at">el</span>)<span class="op">;</span></span>
<span id="cb2-447"><a href="#cb2-447" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> spacer <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb2-448"><a href="#cb2-448" aria-hidden="true" tabindex="-1"></a>  spacer<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"flex:1;min-width:120px;"</span><span class="op">;</span></span>
<span id="cb2-449"><a href="#cb2-449" aria-hidden="true" tabindex="-1"></a>  r2<span class="op">.</span><span class="fu">appendChild</span>(spacer)<span class="op">;</span></span>
<span id="cb2-450"><a href="#cb2-450" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(r2)<span class="op">;</span></span>
<span id="cb2-451"><a href="#cb2-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-452"><a href="#cb2-452" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Row 3: buttons</span></span>
<span id="cb2-453"><a href="#cb2-453" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> r3 <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb2-454"><a href="#cb2-454" aria-hidden="true" tabindex="-1"></a>  r3<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display:flex;gap:10px;width:100%;margin-bottom:14px;padding-bottom:14px;border-bottom:1px solid #e2e8f0;"</span><span class="op">;</span></span>
<span id="cb2-455"><a href="#cb2-455" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> btnGo <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"button"</span>)<span class="op">;</span></span>
<span id="cb2-456"><a href="#cb2-456" aria-hidden="true" tabindex="-1"></a>  btnGo<span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="st">"gt-btn gt-btn-go"</span><span class="op">;</span> btnGo<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">"▶  Start"</span><span class="op">;</span></span>
<span id="cb2-457"><a href="#cb2-457" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> btnStop <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"button"</span>)<span class="op">;</span></span>
<span id="cb2-458"><a href="#cb2-458" aria-hidden="true" tabindex="-1"></a>  btnStop<span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="st">"gt-btn"</span><span class="op">;</span> btnStop<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">"⏸  Pause"</span><span class="op">;</span></span>
<span id="cb2-459"><a href="#cb2-459" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> btnReset <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"button"</span>)<span class="op">;</span></span>
<span id="cb2-460"><a href="#cb2-460" aria-hidden="true" tabindex="-1"></a>  btnReset<span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="st">"gt-btn gt-btn-reset"</span><span class="op">;</span> btnReset<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">"↺  Reset"</span><span class="op">;</span></span>
<span id="cb2-461"><a href="#cb2-461" aria-hidden="true" tabindex="-1"></a>  r3<span class="op">.</span><span class="fu">appendChild</span>(btnGo)<span class="op">;</span> r3<span class="op">.</span><span class="fu">appendChild</span>(btnStop)<span class="op">;</span> r3<span class="op">.</span><span class="fu">appendChild</span>(btnReset)<span class="op">;</span></span>
<span id="cb2-462"><a href="#cb2-462" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(r3)<span class="op">;</span></span>
<span id="cb2-463"><a href="#cb2-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-464"><a href="#cb2-464" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-465"><a href="#cb2-465" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 3. RESPONSIVE CANVAS (fits on screen)</span></span>
<span id="cb2-466"><a href="#cb2-466" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-467"><a href="#cb2-467" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> LW <span class="op">=</span> <span class="dv">380</span><span class="op">,</span> LH <span class="op">=</span> <span class="dv">600</span><span class="op">,</span> ASPECT <span class="op">=</span> LH <span class="op">/</span> LW<span class="op">;</span></span>
<span id="cb2-468"><a href="#cb2-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-469"><a href="#cb2-469" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> canvasWrap <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb2-470"><a href="#cb2-470" aria-hidden="true" tabindex="-1"></a>  <span class="co">// max-height: 62vh ensures the canvas + controls all fit on one screen</span></span>
<span id="cb2-471"><a href="#cb2-471" aria-hidden="true" tabindex="-1"></a>  <span class="co">// width derived from height to maintain aspect ratio</span></span>
<span id="cb2-472"><a href="#cb2-472" aria-hidden="true" tabindex="-1"></a>  canvasWrap<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb2-473"><a href="#cb2-473" aria-hidden="true" tabindex="-1"></a><span class="vs">    width:100%;</span></span>
<span id="cb2-474"><a href="#cb2-474" aria-hidden="true" tabindex="-1"></a><span class="vs">    display:flex;justify-content:center;</span></span>
<span id="cb2-475"><a href="#cb2-475" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb2-476"><a href="#cb2-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-477"><a href="#cb2-477" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> canvas <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"canvas"</span>)<span class="op">;</span></span>
<span id="cb2-478"><a href="#cb2-478" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb2-479"><a href="#cb2-479" aria-hidden="true" tabindex="-1"></a><span class="vs">    max-height:62vh;</span></span>
<span id="cb2-480"><a href="#cb2-480" aria-hidden="true" tabindex="-1"></a><span class="vs">    width:auto;</span></span>
<span id="cb2-481"><a href="#cb2-481" aria-hidden="true" tabindex="-1"></a><span class="vs">    height:auto;</span></span>
<span id="cb2-482"><a href="#cb2-482" aria-hidden="true" tabindex="-1"></a><span class="vs">    border-radius:10px;</span></span>
<span id="cb2-483"><a href="#cb2-483" aria-hidden="true" tabindex="-1"></a><span class="vs">    border:1px solid #e2e8f0;</span></span>
<span id="cb2-484"><a href="#cb2-484" aria-hidden="true" tabindex="-1"></a><span class="vs">    display:block;</span></span>
<span id="cb2-485"><a href="#cb2-485" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb2-486"><a href="#cb2-486" aria-hidden="true" tabindex="-1"></a>  canvasWrap<span class="op">.</span><span class="fu">appendChild</span>(canvas)<span class="op">;</span></span>
<span id="cb2-487"><a href="#cb2-487" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(canvasWrap)<span class="op">;</span></span>
<span id="cb2-488"><a href="#cb2-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-489"><a href="#cb2-489" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ctx <span class="op">=</span> canvas<span class="op">.</span><span class="fu">getContext</span>(<span class="st">"2d"</span><span class="op">,</span> { <span class="dt">alpha</span><span class="op">:</span> <span class="kw">false</span> })<span class="op">;</span></span>
<span id="cb2-490"><a href="#cb2-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-491"><a href="#cb2-491" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">resizeCanvas</span>() {</span>
<span id="cb2-492"><a href="#cb2-492" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Determine available height: 62vh, then width from aspect</span></span>
<span id="cb2-493"><a href="#cb2-493" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> maxH <span class="op">=</span> <span class="bu">window</span><span class="op">.</span><span class="at">innerHeight</span> <span class="op">*</span> <span class="fl">0.62</span><span class="op">;</span></span>
<span id="cb2-494"><a href="#cb2-494" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> maxW <span class="op">=</span> canvasWrap<span class="op">.</span><span class="fu">getBoundingClientRect</span>()<span class="op">.</span><span class="at">width</span><span class="op">;</span></span>
<span id="cb2-495"><a href="#cb2-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-496"><a href="#cb2-496" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Height-limited: derive width from maxH</span></span>
<span id="cb2-497"><a href="#cb2-497" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> cssH <span class="op">=</span> maxH<span class="op">;</span></span>
<span id="cb2-498"><a href="#cb2-498" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> cssW <span class="op">=</span> cssH <span class="op">/</span> ASPECT<span class="op">;</span></span>
<span id="cb2-499"><a href="#cb2-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-500"><a href="#cb2-500" aria-hidden="true" tabindex="-1"></a>    <span class="co">// If that's wider than container, clamp to container</span></span>
<span id="cb2-501"><a href="#cb2-501" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (cssW <span class="op">&gt;</span> maxW) {</span>
<span id="cb2-502"><a href="#cb2-502" aria-hidden="true" tabindex="-1"></a>      cssW <span class="op">=</span> maxW<span class="op">;</span></span>
<span id="cb2-503"><a href="#cb2-503" aria-hidden="true" tabindex="-1"></a>      cssH <span class="op">=</span> cssW <span class="op">*</span> ASPECT<span class="op">;</span></span>
<span id="cb2-504"><a href="#cb2-504" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-505"><a href="#cb2-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-506"><a href="#cb2-506" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> dpr <span class="op">=</span> <span class="bu">window</span><span class="op">.</span><span class="at">devicePixelRatio</span> <span class="op">||</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-507"><a href="#cb2-507" aria-hidden="true" tabindex="-1"></a>    canvas<span class="op">.</span><span class="at">width</span> <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(cssW <span class="op">*</span> dpr)<span class="op">;</span></span>
<span id="cb2-508"><a href="#cb2-508" aria-hidden="true" tabindex="-1"></a>    canvas<span class="op">.</span><span class="at">height</span> <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(cssH <span class="op">*</span> dpr)<span class="op">;</span></span>
<span id="cb2-509"><a href="#cb2-509" aria-hidden="true" tabindex="-1"></a>    canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">width</span> <span class="op">=</span> cssW <span class="op">+</span> <span class="st">"px"</span><span class="op">;</span></span>
<span id="cb2-510"><a href="#cb2-510" aria-hidden="true" tabindex="-1"></a>    canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">height</span> <span class="op">=</span> cssH <span class="op">+</span> <span class="st">"px"</span><span class="op">;</span></span>
<span id="cb2-511"><a href="#cb2-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-512"><a href="#cb2-512" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">setTransform</span>((cssW <span class="op">*</span> dpr) <span class="op">/</span> LW<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> (cssW <span class="op">*</span> dpr) <span class="op">/</span> LW<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb2-513"><a href="#cb2-513" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-514"><a href="#cb2-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-515"><a href="#cb2-515" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ro <span class="op">=</span> <span class="kw">new</span> <span class="fu">ResizeObserver</span>(resizeCanvas)<span class="op">;</span></span>
<span id="cb2-516"><a href="#cb2-516" aria-hidden="true" tabindex="-1"></a>  ro<span class="op">.</span><span class="fu">observe</span>(canvasWrap)<span class="op">;</span></span>
<span id="cb2-517"><a href="#cb2-517" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resizeCanvas</span>()<span class="op">;</span></span>
<span id="cb2-518"><a href="#cb2-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-519"><a href="#cb2-519" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-520"><a href="#cb2-520" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 4. SIMULATION STATE</span></span>
<span id="cb2-521"><a href="#cb2-521" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-522"><a href="#cb2-522" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> CFG <span class="op">=</span> {}<span class="op">,</span> pegGrid <span class="op">=</span> []<span class="op">,</span> S <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb2-523"><a href="#cb2-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-524"><a href="#cb2-524" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">initSim</span>() {</span>
<span id="cb2-525"><a href="#cb2-525" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rows <span class="op">=</span> SL<span class="op">.</span><span class="at">rows</span><span class="op">.</span><span class="fu">val</span>()<span class="op">,</span> maxBalls <span class="op">=</span> SL<span class="op">.</span><span class="at">total</span><span class="op">.</span><span class="fu">val</span>()<span class="op">;</span></span>
<span id="cb2-526"><a href="#cb2-526" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pegSpacing <span class="op">=</span> LW <span class="op">/</span> (rows <span class="op">+</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb2-527"><a href="#cb2-527" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pegR <span class="op">=</span> pegSpacing <span class="op">*</span> <span class="fl">0.12</span><span class="op">;</span></span>
<span id="cb2-528"><a href="#cb2-528" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> ballR <span class="op">=</span> pegSpacing <span class="op">*</span> <span class="fl">0.23</span><span class="op">;</span></span>
<span id="cb2-529"><a href="#cb2-529" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rowH <span class="op">=</span> pegSpacing <span class="op">*</span> <span class="fl">0.85</span><span class="op">;</span></span>
<span id="cb2-530"><a href="#cb2-530" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> startY <span class="op">=</span> <span class="dv">60</span><span class="op">;</span></span>
<span id="cb2-531"><a href="#cb2-531" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> numBins <span class="op">=</span> rows <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-532"><a href="#cb2-532" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> binW <span class="op">=</span> pegSpacing<span class="op">;</span></span>
<span id="cb2-533"><a href="#cb2-533" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> totalBinW <span class="op">=</span> numBins <span class="op">*</span> binW<span class="op">;</span></span>
<span id="cb2-534"><a href="#cb2-534" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> binsX0 <span class="op">=</span> (LW <span class="op">-</span> totalBinW) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-535"><a href="#cb2-535" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> wallsTopY <span class="op">=</span> startY <span class="op">+</span> rows <span class="op">*</span> rowH <span class="op">+</span> <span class="dv">15</span><span class="op">;</span></span>
<span id="cb2-536"><a href="#cb2-536" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> floorY <span class="op">=</span> LH <span class="op">-</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb2-537"><a href="#cb2-537" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> stackStep <span class="op">=</span> ballR <span class="op">*</span> <span class="fl">0.6</span><span class="op">;</span></span>
<span id="cb2-538"><a href="#cb2-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-539"><a href="#cb2-539" aria-hidden="true" tabindex="-1"></a>    CFG <span class="op">=</span> { rows<span class="op">,</span> maxBalls<span class="op">,</span> pegSpacing<span class="op">,</span> pegR<span class="op">,</span> ballR<span class="op">,</span> rowH<span class="op">,</span> startY<span class="op">,</span></span>
<span id="cb2-540"><a href="#cb2-540" aria-hidden="true" tabindex="-1"></a>            numBins<span class="op">,</span> binW<span class="op">,</span> totalBinW<span class="op">,</span> binsX0<span class="op">,</span> wallsTopY<span class="op">,</span> floorY<span class="op">,</span> stackStep }<span class="op">;</span></span>
<span id="cb2-541"><a href="#cb2-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-542"><a href="#cb2-542" aria-hidden="true" tabindex="-1"></a>    pegGrid <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb2-543"><a href="#cb2-543" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> r <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> r <span class="op">&lt;</span> rows<span class="op">;</span> r<span class="op">++</span>) {</span>
<span id="cb2-544"><a href="#cb2-544" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> n <span class="op">=</span> r<span class="op">+</span><span class="dv">1</span><span class="op">,</span> rw <span class="op">=</span> (n<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>pegSpacing<span class="op">,</span> x0 <span class="op">=</span> (LW<span class="op">-</span>rw)<span class="op">/</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-545"><a href="#cb2-545" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> arr <span class="op">=</span> <span class="kw">new</span> <span class="bu">Float64Array</span>(n<span class="op">*</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb2-546"><a href="#cb2-546" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> y <span class="op">=</span> startY <span class="op">+</span> r <span class="op">*</span> rowH<span class="op">;</span></span>
<span id="cb2-547"><a href="#cb2-547" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (<span class="kw">let</span> p <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> p <span class="op">&lt;</span> n<span class="op">;</span> p<span class="op">++</span>) { arr[p<span class="op">*</span><span class="dv">2</span>]<span class="op">=</span>x0<span class="op">+</span>p<span class="op">*</span>pegSpacing<span class="op">;</span> arr[p<span class="op">*</span><span class="dv">2</span><span class="op">+</span><span class="dv">1</span>]<span class="op">=</span>y<span class="op">;</span> }</span>
<span id="cb2-548"><a href="#cb2-548" aria-hidden="true" tabindex="-1"></a>      pegGrid<span class="op">.</span><span class="fu">push</span>(arr)<span class="op">;</span></span>
<span id="cb2-549"><a href="#cb2-549" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-550"><a href="#cb2-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-551"><a href="#cb2-551" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (S<span class="op">.</span><span class="at">pool</span>) S<span class="op">.</span><span class="at">pool</span><span class="op">.</span><span class="at">length</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-552"><a href="#cb2-552" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (S<span class="op">.</span><span class="at">active</span>) S<span class="op">.</span><span class="at">active</span><span class="op">.</span><span class="at">length</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-553"><a href="#cb2-553" aria-hidden="true" tabindex="-1"></a>    S <span class="op">=</span> { <span class="dt">pool</span><span class="op">:</span>[]<span class="op">,</span> <span class="dt">active</span><span class="op">:</span>[]<span class="op">,</span> <span class="dt">bins</span><span class="op">:</span><span class="kw">new</span> <span class="bu">Int32Array</span>(numBins)<span class="op">,</span></span>
<span id="cb2-554"><a href="#cb2-554" aria-hidden="true" tabindex="-1"></a>          <span class="dt">spawned</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span> <span class="dt">running</span><span class="op">:</span><span class="kw">false</span><span class="op">,</span> <span class="dt">done</span><span class="op">:</span><span class="kw">false</span> }<span class="op">;</span></span>
<span id="cb2-555"><a href="#cb2-555" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-556"><a href="#cb2-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-557"><a href="#cb2-557" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-558"><a href="#cb2-558" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 5. BALL LOGIC (object pool)</span></span>
<span id="cb2-559"><a href="#cb2-559" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-560"><a href="#cb2-560" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">allocBall</span>() {</span>
<span id="cb2-561"><a href="#cb2-561" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (S<span class="op">.</span><span class="at">pool</span><span class="op">.</span><span class="at">length</span>) <span class="cf">return</span> S<span class="op">.</span><span class="at">pool</span><span class="op">.</span><span class="fu">pop</span>()<span class="op">;</span></span>
<span id="cb2-562"><a href="#cb2-562" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="dt">pathX</span><span class="op">:</span><span class="kw">new</span> <span class="bu">Float64Array</span>(<span class="dv">30</span>)<span class="op">,</span> <span class="dt">pathY</span><span class="op">:</span><span class="kw">new</span> <span class="bu">Float64Array</span>(<span class="dv">30</span>)<span class="op">,</span></span>
<span id="cb2-563"><a href="#cb2-563" aria-hidden="true" tabindex="-1"></a>             <span class="dt">pathLen</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span><span class="dt">seg</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span><span class="dt">t</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span><span class="dt">x</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span><span class="dt">y</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span><span class="dt">binIdx</span><span class="op">:</span><span class="dv">0</span> }<span class="op">;</span></span>
<span id="cb2-564"><a href="#cb2-564" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-565"><a href="#cb2-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-566"><a href="#cb2-566" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">buildPath</span>(b) {</span>
<span id="cb2-567"><a href="#cb2-567" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> {rows<span class="op">,</span>pegSpacing<span class="op">,</span>pegR<span class="op">,</span>ballR<span class="op">,</span>rowH<span class="op">,</span>startY<span class="op">,</span>binW<span class="op">,</span>binsX0<span class="op">,</span>wallsTopY<span class="op">,</span>floorY}<span class="op">=</span>CFG<span class="op">;</span></span>
<span id="cb2-568"><a href="#cb2-568" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> idx<span class="op">=</span><span class="dv">0</span><span class="op">,</span>pi<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-569"><a href="#cb2-569" aria-hidden="true" tabindex="-1"></a>    b<span class="op">.</span><span class="at">pathX</span>[pi]<span class="op">=</span>LW<span class="op">/</span><span class="dv">2</span><span class="op">;</span> b<span class="op">.</span><span class="at">pathY</span>[pi]<span class="op">=</span>startY<span class="op">-</span><span class="dv">20</span><span class="op">;</span> pi<span class="op">++;</span></span>
<span id="cb2-570"><a href="#cb2-570" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> r<span class="op">=</span><span class="dv">0</span><span class="op">;</span>r<span class="op">&lt;</span>rows<span class="op">;</span>r<span class="op">++</span>){</span>
<span id="cb2-571"><a href="#cb2-571" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> n<span class="op">=</span>r<span class="op">+</span><span class="dv">1</span><span class="op">,</span>rw<span class="op">=</span>(n<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>pegSpacing<span class="op">,</span>x0<span class="op">=</span>(LW<span class="op">-</span>rw)<span class="op">/</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-572"><a href="#cb2-572" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> px<span class="op">=</span>x0<span class="op">+</span>idx<span class="op">*</span>pegSpacing<span class="op">,</span>py<span class="op">=</span>startY<span class="op">+</span>r<span class="op">*</span>rowH<span class="op">;</span></span>
<span id="cb2-573"><a href="#cb2-573" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> right<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>()<span class="op">&gt;</span><span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb2-574"><a href="#cb2-574" aria-hidden="true" tabindex="-1"></a>      b<span class="op">.</span><span class="at">pathX</span>[pi]<span class="op">=</span>px<span class="op">+</span>(right<span class="op">?</span><span class="dv">1</span><span class="op">:-</span><span class="dv">1</span>)<span class="op">*</span>(pegR<span class="op">+</span>ballR)<span class="op">*</span><span class="fl">0.85</span><span class="op">;</span></span>
<span id="cb2-575"><a href="#cb2-575" aria-hidden="true" tabindex="-1"></a>      b<span class="op">.</span><span class="at">pathY</span>[pi]<span class="op">=</span>py<span class="op">;</span> pi<span class="op">++;</span></span>
<span id="cb2-576"><a href="#cb2-576" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(right)idx<span class="op">++;</span></span>
<span id="cb2-577"><a href="#cb2-577" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-578"><a href="#cb2-578" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cx<span class="op">=</span>binsX0<span class="op">+</span>idx<span class="op">*</span>binW<span class="op">+</span>binW<span class="op">/</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-579"><a href="#cb2-579" aria-hidden="true" tabindex="-1"></a>    b<span class="op">.</span><span class="at">pathX</span>[pi]<span class="op">=</span>cx<span class="op">;</span>b<span class="op">.</span><span class="at">pathY</span>[pi]<span class="op">=</span>wallsTopY<span class="op">;</span>pi<span class="op">++;</span></span>
<span id="cb2-580"><a href="#cb2-580" aria-hidden="true" tabindex="-1"></a>    b<span class="op">.</span><span class="at">pathX</span>[pi]<span class="op">=</span>cx<span class="op">;</span>b<span class="op">.</span><span class="at">pathY</span>[pi]<span class="op">=</span>floorY<span class="op">-</span>ballR<span class="op">;</span>pi<span class="op">++;</span></span>
<span id="cb2-581"><a href="#cb2-581" aria-hidden="true" tabindex="-1"></a>    b<span class="op">.</span><span class="at">pathLen</span><span class="op">=</span>pi<span class="op">;</span>b<span class="op">.</span><span class="at">seg</span><span class="op">=</span><span class="dv">0</span><span class="op">;</span>b<span class="op">.</span><span class="at">t</span><span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-582"><a href="#cb2-582" aria-hidden="true" tabindex="-1"></a>    b<span class="op">.</span><span class="at">x</span><span class="op">=</span>b<span class="op">.</span><span class="at">pathX</span>[<span class="dv">0</span>]<span class="op">;</span>b<span class="op">.</span><span class="at">y</span><span class="op">=</span>b<span class="op">.</span><span class="at">pathY</span>[<span class="dv">0</span>]<span class="op">;</span>b<span class="op">.</span><span class="at">binIdx</span><span class="op">=</span>idx<span class="op">;</span></span>
<span id="cb2-583"><a href="#cb2-583" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-584"><a href="#cb2-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-585"><a href="#cb2-585" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">spawn</span>(){</span>
<span id="cb2-586"><a href="#cb2-586" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(S<span class="op">.</span><span class="at">spawned</span><span class="op">&gt;=</span>CFG<span class="op">.</span><span class="at">maxBalls</span>)<span class="cf">return</span><span class="op">;</span></span>
<span id="cb2-587"><a href="#cb2-587" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> b<span class="op">=</span><span class="fu">allocBall</span>()<span class="op">;</span><span class="fu">buildPath</span>(b)<span class="op">;</span></span>
<span id="cb2-588"><a href="#cb2-588" aria-hidden="true" tabindex="-1"></a>    S<span class="op">.</span><span class="at">active</span><span class="op">.</span><span class="fu">push</span>(b)<span class="op">;</span>S<span class="op">.</span><span class="at">spawned</span><span class="op">++;</span></span>
<span id="cb2-589"><a href="#cb2-589" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-590"><a href="#cb2-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-591"><a href="#cb2-591" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">update</span>(dt){</span>
<span id="cb2-592"><a href="#cb2-592" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="op">!</span>S<span class="op">.</span><span class="at">running</span>)<span class="cf">return</span><span class="op">;</span></span>
<span id="cb2-593"><a href="#cb2-593" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> speed<span class="op">=</span>SL<span class="op">.</span><span class="at">speed</span><span class="op">.</span><span class="fu">val</span>()<span class="op">;</span></span>
<span id="cb2-594"><a href="#cb2-594" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(S<span class="op">.</span><span class="at">spawned</span><span class="op">&lt;</span>CFG<span class="op">.</span><span class="at">maxBalls</span><span class="op">&amp;&amp;</span><span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>()<span class="op">&lt;</span><span class="fl">0.25</span><span class="op">*</span>speed)<span class="fu">spawn</span>()<span class="op">;</span></span>
<span id="cb2-595"><a href="#cb2-595" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> mv<span class="op">=</span><span class="fl">3.0</span><span class="op">*</span>speed<span class="op">*</span>dt<span class="op">;</span></span>
<span id="cb2-596"><a href="#cb2-596" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> wi<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-597"><a href="#cb2-597" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>S<span class="op">.</span><span class="at">active</span><span class="op">.</span><span class="at">length</span><span class="op">;</span>i<span class="op">++</span>){</span>
<span id="cb2-598"><a href="#cb2-598" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> b<span class="op">=</span>S<span class="op">.</span><span class="at">active</span>[i]<span class="op">;</span></span>
<span id="cb2-599"><a href="#cb2-599" aria-hidden="true" tabindex="-1"></a>      b<span class="op">.</span><span class="at">t</span><span class="op">+=</span>mv<span class="op">;</span></span>
<span id="cb2-600"><a href="#cb2-600" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span>(b<span class="op">.</span><span class="at">t</span><span class="op">&gt;=</span><span class="dv">1</span><span class="op">&amp;&amp;</span>b<span class="op">.</span><span class="at">seg</span><span class="op">&lt;</span>b<span class="op">.</span><span class="at">pathLen</span><span class="op">-</span><span class="dv">2</span>){b<span class="op">.</span><span class="at">t</span><span class="op">-=</span><span class="dv">1</span><span class="op">;</span>b<span class="op">.</span><span class="at">seg</span><span class="op">++;</span>}</span>
<span id="cb2-601"><a href="#cb2-601" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(b<span class="op">.</span><span class="at">t</span><span class="op">&gt;=</span><span class="dv">1</span><span class="op">&amp;&amp;</span>b<span class="op">.</span><span class="at">seg</span><span class="op">&gt;=</span>b<span class="op">.</span><span class="at">pathLen</span><span class="op">-</span><span class="dv">2</span>){S<span class="op">.</span><span class="at">bins</span>[b<span class="op">.</span><span class="at">binIdx</span>]<span class="op">++;</span>S<span class="op">.</span><span class="at">pool</span><span class="op">.</span><span class="fu">push</span>(b)<span class="op">;</span><span class="cf">continue</span><span class="op">;</span>}</span>
<span id="cb2-602"><a href="#cb2-602" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> s<span class="op">=</span>b<span class="op">.</span><span class="at">seg</span><span class="op">,</span>t<span class="op">=</span>b<span class="op">.</span><span class="at">t</span><span class="op">,</span>ease<span class="op">=</span>t<span class="op">*</span>t<span class="op">;</span></span>
<span id="cb2-603"><a href="#cb2-603" aria-hidden="true" tabindex="-1"></a>      b<span class="op">.</span><span class="at">x</span><span class="op">=</span>b<span class="op">.</span><span class="at">pathX</span>[s]<span class="op">+</span>(b<span class="op">.</span><span class="at">pathX</span>[s<span class="op">+</span><span class="dv">1</span>]<span class="op">-</span>b<span class="op">.</span><span class="at">pathX</span>[s])<span class="op">*</span>t<span class="op">;</span></span>
<span id="cb2-604"><a href="#cb2-604" aria-hidden="true" tabindex="-1"></a>      b<span class="op">.</span><span class="at">y</span><span class="op">=</span>b<span class="op">.</span><span class="at">pathY</span>[s]<span class="op">+</span>(b<span class="op">.</span><span class="at">pathY</span>[s<span class="op">+</span><span class="dv">1</span>]<span class="op">-</span>b<span class="op">.</span><span class="at">pathY</span>[s])<span class="op">*</span>ease<span class="op">;</span></span>
<span id="cb2-605"><a href="#cb2-605" aria-hidden="true" tabindex="-1"></a>      S<span class="op">.</span><span class="at">active</span>[wi<span class="op">++</span>]<span class="op">=</span>b<span class="op">;</span></span>
<span id="cb2-606"><a href="#cb2-606" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-607"><a href="#cb2-607" aria-hidden="true" tabindex="-1"></a>    S<span class="op">.</span><span class="at">active</span><span class="op">.</span><span class="at">length</span><span class="op">=</span>wi<span class="op">;</span></span>
<span id="cb2-608"><a href="#cb2-608" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(S<span class="op">.</span><span class="at">spawned</span><span class="op">&gt;=</span>CFG<span class="op">.</span><span class="at">maxBalls</span><span class="op">&amp;&amp;</span>S<span class="op">.</span><span class="at">active</span><span class="op">.</span><span class="at">length</span><span class="op">===</span><span class="dv">0</span>){S<span class="op">.</span><span class="at">running</span><span class="op">=</span><span class="kw">false</span><span class="op">;</span>S<span class="op">.</span><span class="at">done</span><span class="op">=</span><span class="kw">true</span><span class="op">;</span>}</span>
<span id="cb2-609"><a href="#cb2-609" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-610"><a href="#cb2-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-611"><a href="#cb2-611" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-612"><a href="#cb2-612" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 6. DRAW — FLAT</span></span>
<span id="cb2-613"><a href="#cb2-613" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-614"><a href="#cb2-614" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">draw</span>(){</span>
<span id="cb2-615"><a href="#cb2-615" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> {pegR<span class="op">,</span>ballR<span class="op">,</span>numBins<span class="op">,</span>binW<span class="op">,</span>totalBinW<span class="op">,</span>binsX0<span class="op">,</span>wallsTopY<span class="op">,</span>floorY<span class="op">,</span>stackStep}<span class="op">=</span>CFG<span class="op">;</span></span>
<span id="cb2-616"><a href="#cb2-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-617"><a href="#cb2-617" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span><span class="op">=</span><span class="st">"#f8f9fa"</span><span class="op">;</span></span>
<span id="cb2-618"><a href="#cb2-618" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillRect</span>(<span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span>LW<span class="op">,</span>LH)<span class="op">;</span></span>
<span id="cb2-619"><a href="#cb2-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-620"><a href="#cb2-620" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Pegs</span></span>
<span id="cb2-621"><a href="#cb2-621" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span><span class="op">=</span><span class="st">"#94a3b8"</span><span class="op">;</span></span>
<span id="cb2-622"><a href="#cb2-622" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb2-623"><a href="#cb2-623" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> r<span class="op">=</span><span class="dv">0</span><span class="op">;</span>r<span class="op">&lt;</span>pegGrid<span class="op">.</span><span class="at">length</span><span class="op">;</span>r<span class="op">++</span>){</span>
<span id="cb2-624"><a href="#cb2-624" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> a<span class="op">=</span>pegGrid[r]<span class="op">;</span></span>
<span id="cb2-625"><a href="#cb2-625" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(<span class="kw">let</span> p<span class="op">=</span><span class="dv">0</span><span class="op">;</span>p<span class="op">&lt;</span>a<span class="op">.</span><span class="at">length</span><span class="op">;</span>p<span class="op">+=</span><span class="dv">2</span>){</span>
<span id="cb2-626"><a href="#cb2-626" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="fu">moveTo</span>(a[p]<span class="op">+</span>pegR<span class="op">,</span>a[p<span class="op">+</span><span class="dv">1</span>])<span class="op">;</span></span>
<span id="cb2-627"><a href="#cb2-627" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="fu">arc</span>(a[p]<span class="op">,</span>a[p<span class="op">+</span><span class="dv">1</span>]<span class="op">,</span>pegR<span class="op">,</span><span class="dv">0</span><span class="op">,</span>TAU)<span class="op">;</span></span>
<span id="cb2-628"><a href="#cb2-628" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-629"><a href="#cb2-629" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-630"><a href="#cb2-630" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb2-631"><a href="#cb2-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-632"><a href="#cb2-632" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Walls &amp; floor</span></span>
<span id="cb2-633"><a href="#cb2-633" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">strokeStyle</span><span class="op">=</span><span class="st">"#cbd5e1"</span><span class="op">;</span></span>
<span id="cb2-634"><a href="#cb2-634" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">lineWidth</span><span class="op">=</span><span class="fl">1.5</span><span class="op">;</span></span>
<span id="cb2-635"><a href="#cb2-635" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb2-636"><a href="#cb2-636" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">moveTo</span>(binsX0<span class="op">,</span>floorY)<span class="op">;</span></span>
<span id="cb2-637"><a href="#cb2-637" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">lineTo</span>(binsX0<span class="op">+</span>totalBinW<span class="op">,</span>floorY)<span class="op">;</span></span>
<span id="cb2-638"><a href="#cb2-638" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;=</span>numBins<span class="op">;</span>i<span class="op">++</span>){</span>
<span id="cb2-639"><a href="#cb2-639" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x<span class="op">=</span>binsX0<span class="op">+</span>i<span class="op">*</span>binW<span class="op">;</span></span>
<span id="cb2-640"><a href="#cb2-640" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="fu">moveTo</span>(x<span class="op">,</span>wallsTopY)<span class="op">;</span>ctx<span class="op">.</span><span class="fu">lineTo</span>(x<span class="op">,</span>floorY)<span class="op">;</span></span>
<span id="cb2-641"><a href="#cb2-641" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-642"><a href="#cb2-642" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb2-643"><a href="#cb2-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-644"><a href="#cb2-644" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Stacked balls</span></span>
<span id="cb2-645"><a href="#cb2-645" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span><span class="op">=</span><span class="st">"#3b82f6"</span><span class="op">;</span></span>
<span id="cb2-646"><a href="#cb2-646" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">strokeStyle</span><span class="op">=</span><span class="st">"#2563eb"</span><span class="op">;</span></span>
<span id="cb2-647"><a href="#cb2-647" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">lineWidth</span><span class="op">=</span><span class="fl">0.7</span><span class="op">;</span></span>
<span id="cb2-648"><a href="#cb2-648" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb2-649"><a href="#cb2-649" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>numBins<span class="op">;</span>i<span class="op">++</span>){</span>
<span id="cb2-650"><a href="#cb2-650" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> count<span class="op">=</span>S<span class="op">.</span><span class="at">bins</span>[i]<span class="op">;</span></span>
<span id="cb2-651"><a href="#cb2-651" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="op">!</span>count)<span class="cf">continue</span><span class="op">;</span></span>
<span id="cb2-652"><a href="#cb2-652" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> cx<span class="op">=</span>binsX0<span class="op">+</span>i<span class="op">*</span>binW<span class="op">+</span>binW<span class="op">/</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-653"><a href="#cb2-653" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(<span class="kw">let</span> j<span class="op">=</span><span class="dv">0</span><span class="op">;</span>j<span class="op">&lt;</span>count<span class="op">;</span>j<span class="op">++</span>){</span>
<span id="cb2-654"><a href="#cb2-654" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> cy<span class="op">=</span>floorY<span class="op">-</span>ballR<span class="op">-</span>j<span class="op">*</span>stackStep<span class="op">;</span></span>
<span id="cb2-655"><a href="#cb2-655" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(cy<span class="op">&lt;</span>wallsTopY)<span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-656"><a href="#cb2-656" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="fu">moveTo</span>(cx<span class="op">+</span>ballR<span class="op">,</span>cy)<span class="op">;</span></span>
<span id="cb2-657"><a href="#cb2-657" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="fu">arc</span>(cx<span class="op">,</span>cy<span class="op">,</span>ballR<span class="op">,</span><span class="dv">0</span><span class="op">,</span>TAU)<span class="op">;</span></span>
<span id="cb2-658"><a href="#cb2-658" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-659"><a href="#cb2-659" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-660"><a href="#cb2-660" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb2-661"><a href="#cb2-661" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb2-662"><a href="#cb2-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-663"><a href="#cb2-663" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Active balls</span></span>
<span id="cb2-664"><a href="#cb2-664" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span><span class="op">=</span><span class="st">"#3b82f6"</span><span class="op">;</span></span>
<span id="cb2-665"><a href="#cb2-665" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb2-666"><a href="#cb2-666" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>S<span class="op">.</span><span class="at">active</span><span class="op">.</span><span class="at">length</span><span class="op">;</span>i<span class="op">++</span>){</span>
<span id="cb2-667"><a href="#cb2-667" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> b<span class="op">=</span>S<span class="op">.</span><span class="at">active</span>[i]<span class="op">;</span></span>
<span id="cb2-668"><a href="#cb2-668" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="fu">moveTo</span>(b<span class="op">.</span><span class="at">x</span><span class="op">+</span>ballR<span class="op">,</span>b<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb2-669"><a href="#cb2-669" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="fu">arc</span>(b<span class="op">.</span><span class="at">x</span><span class="op">,</span>b<span class="op">.</span><span class="at">y</span><span class="op">,</span>ballR<span class="op">,</span><span class="dv">0</span><span class="op">,</span>TAU)<span class="op">;</span></span>
<span id="cb2-670"><a href="#cb2-670" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-671"><a href="#cb2-671" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb2-672"><a href="#cb2-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-673"><a href="#cb2-673" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Counter pill</span></span>
<span id="cb2-674"><a href="#cb2-674" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">font</span><span class="op">=</span><span class="st">"bold 12px 'SF Mono',SFMono-Regular,Menlo,monospace"</span><span class="op">;</span></span>
<span id="cb2-675"><a href="#cb2-675" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> txt<span class="op">=</span>S<span class="op">.</span><span class="at">spawned</span><span class="op">+</span><span class="st">" / "</span><span class="op">+</span>CFG<span class="op">.</span><span class="at">maxBalls</span><span class="op">;</span></span>
<span id="cb2-676"><a href="#cb2-676" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> tw<span class="op">=</span>ctx<span class="op">.</span><span class="fu">measureText</span>(txt)<span class="op">.</span><span class="at">width</span><span class="op">;</span></span>
<span id="cb2-677"><a href="#cb2-677" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> bx<span class="op">=</span><span class="dv">12</span><span class="op">,</span>by<span class="op">=</span><span class="dv">14</span><span class="op">,</span>bh<span class="op">=</span><span class="dv">20</span><span class="op">,</span>bpw<span class="op">=</span>tw<span class="op">+</span><span class="dv">16</span><span class="op">;</span></span>
<span id="cb2-678"><a href="#cb2-678" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span><span class="op">=</span><span class="st">"rgba(255,255,255,0.8)"</span><span class="op">;</span></span>
<span id="cb2-679"><a href="#cb2-679" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span>ctx<span class="op">.</span><span class="fu">roundRect</span>(bx<span class="op">,</span>by<span class="op">,</span>bpw<span class="op">,</span>bh<span class="op">,</span><span class="dv">10</span>)<span class="op">;</span>ctx<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb2-680"><a href="#cb2-680" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">strokeStyle</span><span class="op">=</span><span class="st">"#e2e8f0"</span><span class="op">;</span>ctx<span class="op">.</span><span class="at">lineWidth</span><span class="op">=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-681"><a href="#cb2-681" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span>ctx<span class="op">.</span><span class="fu">roundRect</span>(bx<span class="op">,</span>by<span class="op">,</span>bpw<span class="op">,</span>bh<span class="op">,</span><span class="dv">10</span>)<span class="op">;</span>ctx<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb2-682"><a href="#cb2-682" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span><span class="op">=</span><span class="st">"#334155"</span><span class="op">;</span>ctx<span class="op">.</span><span class="at">textAlign</span><span class="op">=</span><span class="st">"left"</span><span class="op">;</span></span>
<span id="cb2-683"><a href="#cb2-683" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillText</span>(txt<span class="op">,</span>bx<span class="op">+</span><span class="dv">8</span><span class="op">,</span>by<span class="op">+</span><span class="dv">14</span>)<span class="op">;</span></span>
<span id="cb2-684"><a href="#cb2-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-685"><a href="#cb2-685" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(S<span class="op">.</span><span class="at">done</span>){</span>
<span id="cb2-686"><a href="#cb2-686" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> d<span class="op">=</span><span class="st">"</span><span class="sc">\u2713</span><span class="st"> Complete"</span><span class="op">;</span></span>
<span id="cb2-687"><a href="#cb2-687" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> dw<span class="op">=</span>ctx<span class="op">.</span><span class="fu">measureText</span>(d)<span class="op">.</span><span class="at">width</span><span class="op">;</span></span>
<span id="cb2-688"><a href="#cb2-688" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="at">fillStyle</span><span class="op">=</span><span class="st">"rgba(240,253,244,0.9)"</span><span class="op">;</span></span>
<span id="cb2-689"><a href="#cb2-689" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span>ctx<span class="op">.</span><span class="fu">roundRect</span>(bx<span class="op">+</span>bpw<span class="op">+</span><span class="dv">6</span><span class="op">,</span>by<span class="op">,</span>dw<span class="op">+</span><span class="dv">16</span><span class="op">,</span>bh<span class="op">,</span><span class="dv">10</span>)<span class="op">;</span>ctx<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb2-690"><a href="#cb2-690" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="at">strokeStyle</span><span class="op">=</span><span class="st">"#bbf7d0"</span><span class="op">;</span>ctx<span class="op">.</span><span class="at">lineWidth</span><span class="op">=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-691"><a href="#cb2-691" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span>ctx<span class="op">.</span><span class="fu">roundRect</span>(bx<span class="op">+</span>bpw<span class="op">+</span><span class="dv">6</span><span class="op">,</span>by<span class="op">,</span>dw<span class="op">+</span><span class="dv">16</span><span class="op">,</span>bh<span class="op">,</span><span class="dv">10</span>)<span class="op">;</span>ctx<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb2-692"><a href="#cb2-692" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="at">fillStyle</span><span class="op">=</span><span class="st">"#16a34a"</span><span class="op">;</span></span>
<span id="cb2-693"><a href="#cb2-693" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="fu">fillText</span>(d<span class="op">,</span>bx<span class="op">+</span>bpw<span class="op">+</span><span class="dv">14</span><span class="op">,</span>by<span class="op">+</span><span class="dv">14</span>)<span class="op">;</span></span>
<span id="cb2-694"><a href="#cb2-694" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-695"><a href="#cb2-695" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-696"><a href="#cb2-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-697"><a href="#cb2-697" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-698"><a href="#cb2-698" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 7. LOOP</span></span>
<span id="cb2-699"><a href="#cb2-699" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-700"><a href="#cb2-700" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> lastT<span class="op">=</span><span class="dv">0</span><span class="op">,</span>rafId<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-701"><a href="#cb2-701" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">tick</span>(now){</span>
<span id="cb2-702"><a href="#cb2-702" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> dt<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>((now<span class="op">-</span>lastT)<span class="op">/</span><span class="dv">1000</span><span class="op">,</span><span class="fl">0.06</span>)<span class="op">;</span></span>
<span id="cb2-703"><a href="#cb2-703" aria-hidden="true" tabindex="-1"></a>    lastT<span class="op">=</span>now<span class="op">;</span><span class="fu">update</span>(dt)<span class="op">;</span><span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb2-704"><a href="#cb2-704" aria-hidden="true" tabindex="-1"></a>    rafId<span class="op">=</span><span class="fu">requestAnimationFrame</span>(tick)<span class="op">;</span></span>
<span id="cb2-705"><a href="#cb2-705" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-706"><a href="#cb2-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-707"><a href="#cb2-707" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-708"><a href="#cb2-708" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 8. EVENTS</span></span>
<span id="cb2-709"><a href="#cb2-709" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-710"><a href="#cb2-710" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">fullReset</span>(){</span>
<span id="cb2-711"><a href="#cb2-711" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cancelAnimationFrame</span>(rafId)<span class="op">;</span><span class="fu">initSim</span>()<span class="op">;</span></span>
<span id="cb2-712"><a href="#cb2-712" aria-hidden="true" tabindex="-1"></a>    SL<span class="op">.</span><span class="at">rows</span><span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span>SL<span class="op">.</span><span class="at">speed</span><span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span>SL<span class="op">.</span><span class="at">total</span><span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span></span>
<span id="cb2-713"><a href="#cb2-713" aria-hidden="true" tabindex="-1"></a>    lastT<span class="op">=</span><span class="bu">performance</span><span class="op">.</span><span class="fu">now</span>()<span class="op">;</span>rafId<span class="op">=</span><span class="fu">requestAnimationFrame</span>(tick)<span class="op">;</span></span>
<span id="cb2-714"><a href="#cb2-714" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-715"><a href="#cb2-715" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">onStart</span>(){<span class="cf">if</span>(S<span class="op">.</span><span class="at">done</span>)<span class="fu">fullReset</span>()<span class="op">;</span>S<span class="op">.</span><span class="at">running</span><span class="op">=</span><span class="kw">true</span><span class="op">;</span>}</span>
<span id="cb2-716"><a href="#cb2-716" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">onStop</span>(){S<span class="op">.</span><span class="at">running</span><span class="op">=</span><span class="kw">false</span><span class="op">;</span>}</span>
<span id="cb2-717"><a href="#cb2-717" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">onRows</span>(){SL<span class="op">.</span><span class="at">rows</span><span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span><span class="cf">if</span>(<span class="op">!</span>S<span class="op">.</span><span class="at">running</span>)<span class="fu">fullReset</span>()<span class="op">;</span>}</span>
<span id="cb2-718"><a href="#cb2-718" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">onTotal</span>(){SL<span class="op">.</span><span class="at">total</span><span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span><span class="cf">if</span>(<span class="op">!</span>S<span class="op">.</span><span class="at">running</span>)<span class="fu">fullReset</span>()<span class="op">;</span>}</span>
<span id="cb2-719"><a href="#cb2-719" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">onSpeed</span>(){SL<span class="op">.</span><span class="at">speed</span><span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span>}</span>
<span id="cb2-720"><a href="#cb2-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-721"><a href="#cb2-721" aria-hidden="true" tabindex="-1"></a>  btnGo<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"click"</span><span class="op">,</span>onStart)<span class="op">;</span></span>
<span id="cb2-722"><a href="#cb2-722" aria-hidden="true" tabindex="-1"></a>  btnStop<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"click"</span><span class="op">,</span>onStop)<span class="op">;</span></span>
<span id="cb2-723"><a href="#cb2-723" aria-hidden="true" tabindex="-1"></a>  btnReset<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"click"</span><span class="op">,</span>fullReset)<span class="op">;</span></span>
<span id="cb2-724"><a href="#cb2-724" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">rows</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span>onRows)<span class="op">;</span></span>
<span id="cb2-725"><a href="#cb2-725" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">total</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span>onTotal)<span class="op">;</span></span>
<span id="cb2-726"><a href="#cb2-726" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">speed</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span>onSpeed)<span class="op">;</span></span>
<span id="cb2-727"><a href="#cb2-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-728"><a href="#cb2-728" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-729"><a href="#cb2-729" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 9. INIT &amp; CLEANUP</span></span>
<span id="cb2-730"><a href="#cb2-730" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-731"><a href="#cb2-731" aria-hidden="true" tabindex="-1"></a>  <span class="fu">initSim</span>()<span class="op">;</span>lastT<span class="op">=</span><span class="bu">performance</span><span class="op">.</span><span class="fu">now</span>()<span class="op">;</span>rafId<span class="op">=</span><span class="fu">requestAnimationFrame</span>(tick)<span class="op">;</span></span>
<span id="cb2-732"><a href="#cb2-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-733"><a href="#cb2-733" aria-hidden="true" tabindex="-1"></a>  invalidation<span class="op">.</span><span class="fu">then</span>(()<span class="kw">=&gt;</span>{</span>
<span id="cb2-734"><a href="#cb2-734" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cancelAnimationFrame</span>(rafId)<span class="op">;</span></span>
<span id="cb2-735"><a href="#cb2-735" aria-hidden="true" tabindex="-1"></a>    ro<span class="op">.</span><span class="fu">disconnect</span>()<span class="op">;</span></span>
<span id="cb2-736"><a href="#cb2-736" aria-hidden="true" tabindex="-1"></a>    btnGo<span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"click"</span><span class="op">,</span>onStart)<span class="op">;</span></span>
<span id="cb2-737"><a href="#cb2-737" aria-hidden="true" tabindex="-1"></a>    btnStop<span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"click"</span><span class="op">,</span>onStop)<span class="op">;</span></span>
<span id="cb2-738"><a href="#cb2-738" aria-hidden="true" tabindex="-1"></a>    btnReset<span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"click"</span><span class="op">,</span>fullReset)<span class="op">;</span></span>
<span id="cb2-739"><a href="#cb2-739" aria-hidden="true" tabindex="-1"></a>    SL<span class="op">.</span><span class="at">rows</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"input"</span><span class="op">,</span>onRows)<span class="op">;</span></span>
<span id="cb2-740"><a href="#cb2-740" aria-hidden="true" tabindex="-1"></a>    SL<span class="op">.</span><span class="at">total</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"input"</span><span class="op">,</span>onTotal)<span class="op">;</span></span>
<span id="cb2-741"><a href="#cb2-741" aria-hidden="true" tabindex="-1"></a>    SL<span class="op">.</span><span class="at">speed</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"input"</span><span class="op">,</span>onSpeed)<span class="op">;</span></span>
<span id="cb2-742"><a href="#cb2-742" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(S<span class="op">.</span><span class="at">pool</span>)S<span class="op">.</span><span class="at">pool</span><span class="op">.</span><span class="at">length</span><span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-743"><a href="#cb2-743" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(S<span class="op">.</span><span class="at">active</span>)S<span class="op">.</span><span class="at">active</span><span class="op">.</span><span class="at">length</span><span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-744"><a href="#cb2-744" aria-hidden="true" tabindex="-1"></a>    S<span class="op">=</span>{}<span class="op">;</span>CFG<span class="op">=</span>{}<span class="op">;</span>pegGrid<span class="op">=</span>[]<span class="op">;</span></span>
<span id="cb2-745"><a href="#cb2-745" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb2-746"><a href="#cb2-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-747"><a href="#cb2-747" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="at">value</span><span class="op">=</span>{}<span class="op">;</span></span>
<span id="cb2-748"><a href="#cb2-748" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> wrapper<span class="op">;</span></span>
<span id="cb2-749"><a href="#cb2-749" aria-hidden="true" tabindex="-1"></a>})()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
</div>
</div>
<section id="ứng-dụng" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="ứng-dụng"><span class="header-section-number">3.1</span> Ứng dụng</h2>
<section id="khoảng-tin-cậy-của-tỉ-lệ" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="khoảng-tin-cậy-của-tỉ-lệ"><span class="header-section-number">3.1.1</span> Khoảng tin cậy của tỉ lệ</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb3" data-startfrom="759" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 758;"><span id="cb3-759"><a href="#cb3-759" aria-hidden="true" tabindex="-1"></a>viewof binomial_ci <span class="op">=</span> (() <span class="kw">=&gt;</span> {</span>
<span id="cb3-760"><a href="#cb3-760" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-761"><a href="#cb3-761" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 1. MATH</span></span>
<span id="cb3-762"><a href="#cb3-762" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-763"><a href="#cb3-763" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lcCache <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb3-764"><a href="#cb3-764" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">lc</span>(n<span class="op">,</span>k){</span>
<span id="cb3-765"><a href="#cb3-765" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(k<span class="op">&lt;</span><span class="dv">0</span><span class="op">||</span>k<span class="op">&gt;</span>n)<span class="cf">return</span><span class="op">-</span><span class="kw">Infinity</span><span class="op">;</span><span class="cf">if</span>(k<span class="op">&gt;</span>n<span class="op">-</span>k)k<span class="op">=</span>n<span class="op">-</span>k<span class="op">;</span></span>
<span id="cb3-766"><a href="#cb3-766" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> key<span class="op">=</span>(n<span class="op">&lt;&lt;</span><span class="dv">12</span>)<span class="op">|</span>k<span class="op">;</span><span class="cf">if</span>(lcCache<span class="op">.</span><span class="fu">has</span>(key))<span class="cf">return</span> lcCache<span class="op">.</span><span class="fu">get</span>(key)<span class="op">;</span></span>
<span id="cb3-767"><a href="#cb3-767" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> r<span class="op">=</span><span class="dv">0</span><span class="op">;</span><span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>k<span class="op">;</span>i<span class="op">++</span>)r<span class="op">+=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(n<span class="op">-</span>i)<span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(i<span class="op">+</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-768"><a href="#cb3-768" aria-hidden="true" tabindex="-1"></a>    lcCache<span class="op">.</span><span class="fu">set</span>(key<span class="op">,</span>r)<span class="op">;</span><span class="cf">return</span> r<span class="op">;</span></span>
<span id="cb3-769"><a href="#cb3-769" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-770"><a href="#cb3-770" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">pmf</span>(x<span class="op">,</span>n<span class="op">,</span>p){</span>
<span id="cb3-771"><a href="#cb3-771" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(x<span class="op">&lt;</span><span class="dv">0</span><span class="op">||</span>x<span class="op">&gt;</span>n)<span class="cf">return</span> <span class="dv">0</span><span class="op">;</span><span class="cf">if</span>(p<span class="op">&lt;=</span><span class="dv">0</span>)<span class="cf">return</span> x<span class="op">===</span><span class="dv">0</span><span class="op">?</span><span class="dv">1</span><span class="op">:</span><span class="dv">0</span><span class="op">;</span><span class="cf">if</span>(p<span class="op">&gt;=</span><span class="dv">1</span>)<span class="cf">return</span> x<span class="op">===</span>n<span class="op">?</span><span class="dv">1</span><span class="op">:</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-772"><a href="#cb3-772" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="fu">lc</span>(n<span class="op">,</span>x)<span class="op">+</span>x<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(p)<span class="op">+</span>(n<span class="op">-</span>x)<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="dv">1</span><span class="op">-</span>p))<span class="op">;</span></span>
<span id="cb3-773"><a href="#cb3-773" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-774"><a href="#cb3-774" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">rTail</span>(k<span class="op">,</span>n<span class="op">,</span>p){<span class="kw">let</span> s<span class="op">=</span><span class="dv">0</span><span class="op">;</span><span class="cf">for</span>(<span class="kw">let</span> x<span class="op">=</span>k<span class="op">;</span>x<span class="op">&lt;=</span>n<span class="op">;</span>x<span class="op">++</span>)s<span class="op">+=</span><span class="fu">pmf</span>(x<span class="op">,</span>n<span class="op">,</span>p)<span class="op">;</span><span class="cf">return</span> s<span class="op">;</span>}</span>
<span id="cb3-775"><a href="#cb3-775" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">lTail</span>(k<span class="op">,</span>n<span class="op">,</span>p){<span class="kw">let</span> s<span class="op">=</span><span class="dv">0</span><span class="op">;</span><span class="cf">for</span>(<span class="kw">let</span> x<span class="op">=</span><span class="dv">0</span><span class="op">;</span>x<span class="op">&lt;=</span>k<span class="op">;</span>x<span class="op">++</span>)s<span class="op">+=</span><span class="fu">pmf</span>(x<span class="op">,</span>n<span class="op">,</span>p)<span class="op">;</span><span class="cf">return</span> s<span class="op">;</span>}</span>
<span id="cb3-776"><a href="#cb3-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-777"><a href="#cb3-777" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-778"><a href="#cb3-778" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 2. DOM</span></span>
<span id="cb3-779"><a href="#cb3-779" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-780"><a href="#cb3-780" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> wrapper <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb3-781"><a href="#cb3-781" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb3-782"><a href="#cb3-782" aria-hidden="true" tabindex="-1"></a><span class="vs">    display:flex;flex-direction:column;align-items:center;</span></span>
<span id="cb3-783"><a href="#cb3-783" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;</span></span>
<span id="cb3-784"><a href="#cb3-784" aria-hidden="true" tabindex="-1"></a><span class="vs">    width:100%;max-width:900px;margin:0 auto;</span></span>
<span id="cb3-785"><a href="#cb3-785" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb3-786"><a href="#cb3-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-787"><a href="#cb3-787" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ── Global thumb style ──</span></span>
<span id="cb3-788"><a href="#cb3-788" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> style <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"style"</span>)<span class="op">;</span></span>
<span id="cb3-789"><a href="#cb3-789" aria-hidden="true" tabindex="-1"></a>  style<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb3-790"><a href="#cb3-790" aria-hidden="true" tabindex="-1"></a><span class="vs">    .ci-slider { position:relative; height:8px; border-radius:4px; background:#e2e8f0; }</span></span>
<span id="cb3-791"><a href="#cb3-791" aria-hidden="true" tabindex="-1"></a><span class="vs">    .ci-slider-fill { position:absolute;left:0;top:0;height:100%;border-radius:4px;transition:width 0.04s; }</span></span>
<span id="cb3-792"><a href="#cb3-792" aria-hidden="true" tabindex="-1"></a><span class="vs">    .ci-slider input[type=range] {</span></span>
<span id="cb3-793"><a href="#cb3-793" aria-hidden="true" tabindex="-1"></a><span class="vs">      position:absolute;top:0;left:0;width:100%;height:100%;</span></span>
<span id="cb3-794"><a href="#cb3-794" aria-hidden="true" tabindex="-1"></a><span class="vs">      -webkit-appearance:none;appearance:none;background:transparent;</span></span>
<span id="cb3-795"><a href="#cb3-795" aria-hidden="true" tabindex="-1"></a><span class="vs">      cursor:pointer;margin:0;padding:0;</span></span>
<span id="cb3-796"><a href="#cb3-796" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb3-797"><a href="#cb3-797" aria-hidden="true" tabindex="-1"></a><span class="vs">    .ci-slider input[type=range]::-webkit-slider-thumb {</span></span>
<span id="cb3-798"><a href="#cb3-798" aria-hidden="true" tabindex="-1"></a><span class="vs">      -webkit-appearance:none;appearance:none;</span></span>
<span id="cb3-799"><a href="#cb3-799" aria-hidden="true" tabindex="-1"></a><span class="vs">      width:20px;height:20px;border-radius:50%;</span></span>
<span id="cb3-800"><a href="#cb3-800" aria-hidden="true" tabindex="-1"></a><span class="vs">      border:3px solid #fff;box-shadow:0 1px 5px rgba(0,0,0,0.3);</span></span>
<span id="cb3-801"><a href="#cb3-801" aria-hidden="true" tabindex="-1"></a><span class="vs">      cursor:pointer;margin-top:-6px;</span></span>
<span id="cb3-802"><a href="#cb3-802" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb3-803"><a href="#cb3-803" aria-hidden="true" tabindex="-1"></a><span class="vs">    .ci-slider input[type=range]::-moz-range-thumb {</span></span>
<span id="cb3-804"><a href="#cb3-804" aria-hidden="true" tabindex="-1"></a><span class="vs">      width:14px;height:14px;border-radius:50%;</span></span>
<span id="cb3-805"><a href="#cb3-805" aria-hidden="true" tabindex="-1"></a><span class="vs">      border:3px solid #fff;box-shadow:0 1px 5px rgba(0,0,0,0.3);</span></span>
<span id="cb3-806"><a href="#cb3-806" aria-hidden="true" tabindex="-1"></a><span class="vs">      cursor:pointer;</span></span>
<span id="cb3-807"><a href="#cb3-807" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb3-808"><a href="#cb3-808" aria-hidden="true" tabindex="-1"></a><span class="vs">    .ci-slider input[type=range]::-webkit-slider-runnable-track{height:8px;background:transparent;}</span></span>
<span id="cb3-809"><a href="#cb3-809" aria-hidden="true" tabindex="-1"></a><span class="vs">    .ci-slider input[type=range]::-moz-range-track{height:8px;background:transparent;}</span></span>
<span id="cb3-810"><a href="#cb3-810" aria-hidden="true" tabindex="-1"></a><span class="vs">    .ci-slider-dark input[type=range]::-webkit-slider-thumb{background:#1e293b;}</span></span>
<span id="cb3-811"><a href="#cb3-811" aria-hidden="true" tabindex="-1"></a><span class="vs">    .ci-slider-dark input[type=range]::-moz-range-thumb{background:#1e293b;}</span></span>
<span id="cb3-812"><a href="#cb3-812" aria-hidden="true" tabindex="-1"></a><span class="vs">    .ci-slider-gray input[type=range]::-webkit-slider-thumb{background:#475569;}</span></span>
<span id="cb3-813"><a href="#cb3-813" aria-hidden="true" tabindex="-1"></a><span class="vs">    .ci-slider-gray input[type=range]::-moz-range-thumb{background:#475569;}</span></span>
<span id="cb3-814"><a href="#cb3-814" aria-hidden="true" tabindex="-1"></a><span class="vs">    .ci-slider-red input[type=range]::-webkit-slider-thumb{background:#dc2626;}</span></span>
<span id="cb3-815"><a href="#cb3-815" aria-hidden="true" tabindex="-1"></a><span class="vs">    .ci-slider-red input[type=range]::-moz-range-thumb{background:#dc2626;}</span></span>
<span id="cb3-816"><a href="#cb3-816" aria-hidden="true" tabindex="-1"></a><span class="vs">    .ci-slider-teal input[type=range]::-webkit-slider-thumb{background:#0891b2;}</span></span>
<span id="cb3-817"><a href="#cb3-817" aria-hidden="true" tabindex="-1"></a><span class="vs">    .ci-slider-teal input[type=range]::-moz-range-thumb{background:#0891b2;}</span></span>
<span id="cb3-818"><a href="#cb3-818" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb3-819"><a href="#cb3-819" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(style)<span class="op">;</span></span>
<span id="cb3-820"><a href="#cb3-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-821"><a href="#cb3-821" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ── Slider factory ──</span></span>
<span id="cb3-822"><a href="#cb3-822" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">createSlider</span>(label<span class="op">,</span> min<span class="op">,</span> max<span class="op">,</span> step<span class="op">,</span> val<span class="op">,</span> color<span class="op">,</span> trackColor<span class="op">,</span> cls) {</span>
<span id="cb3-823"><a href="#cb3-823" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> row <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb3-824"><a href="#cb3-824" aria-hidden="true" tabindex="-1"></a>    row<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display:flex;flex-direction:column;flex:1;min-width:180px;"</span><span class="op">;</span></span>
<span id="cb3-825"><a href="#cb3-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-826"><a href="#cb3-826" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> head <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb3-827"><a href="#cb3-827" aria-hidden="true" tabindex="-1"></a>    head<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display:flex;justify-content:space-between;align-items:baseline;margin-bottom:5px;"</span><span class="op">;</span></span>
<span id="cb3-828"><a href="#cb3-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-829"><a href="#cb3-829" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> lbl <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"span"</span>)<span class="op">;</span></span>
<span id="cb3-830"><a href="#cb3-830" aria-hidden="true" tabindex="-1"></a>    lbl<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"font-size:12px;font-weight:600;color:#64748b;letter-spacing:0.3px;text-transform:uppercase;"</span><span class="op">;</span></span>
<span id="cb3-831"><a href="#cb3-831" aria-hidden="true" tabindex="-1"></a>    lbl<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> label<span class="op">;</span></span>
<span id="cb3-832"><a href="#cb3-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-833"><a href="#cb3-833" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> valSpan <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"span"</span>)<span class="op">;</span></span>
<span id="cb3-834"><a href="#cb3-834" aria-hidden="true" tabindex="-1"></a>    valSpan<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`font-size:18px;font-weight:800;color:</span><span class="sc">${</span>color<span class="sc">}</span><span class="vs">;font-variant-numeric:tabular-nums;font-family:"SF Mono",SFMono-Regular,Menlo,Consolas,monospace;`</span><span class="op">;</span></span>
<span id="cb3-835"><a href="#cb3-835" aria-hidden="true" tabindex="-1"></a>    valSpan<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> step <span class="op">&lt;</span> <span class="dv">1</span> <span class="op">?</span> <span class="bu">Number</span>(val)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>) <span class="op">:</span> val<span class="op">;</span></span>
<span id="cb3-836"><a href="#cb3-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-837"><a href="#cb3-837" aria-hidden="true" tabindex="-1"></a>    head<span class="op">.</span><span class="fu">appendChild</span>(lbl)<span class="op">;</span> head<span class="op">.</span><span class="fu">appendChild</span>(valSpan)<span class="op">;</span></span>
<span id="cb3-838"><a href="#cb3-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-839"><a href="#cb3-839" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> track <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb3-840"><a href="#cb3-840" aria-hidden="true" tabindex="-1"></a>    track<span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="st">"ci-slider ci-slider-"</span> <span class="op">+</span> cls<span class="op">;</span></span>
<span id="cb3-841"><a href="#cb3-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-842"><a href="#cb3-842" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> fill <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb3-843"><a href="#cb3-843" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="st">"ci-slider-fill"</span><span class="op">;</span></span>
<span id="cb3-844"><a href="#cb3-844" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">background</span> <span class="op">=</span> trackColor<span class="op">;</span></span>
<span id="cb3-845"><a href="#cb3-845" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">width</span> <span class="op">=</span> ((val <span class="op">-</span> min) <span class="op">/</span> (max <span class="op">-</span> min)) <span class="op">*</span> <span class="dv">100</span> <span class="op">+</span> <span class="st">"%"</span><span class="op">;</span></span>
<span id="cb3-846"><a href="#cb3-846" aria-hidden="true" tabindex="-1"></a>    track<span class="op">.</span><span class="fu">appendChild</span>(fill)<span class="op">;</span></span>
<span id="cb3-847"><a href="#cb3-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-848"><a href="#cb3-848" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> input <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"input"</span>)<span class="op">;</span></span>
<span id="cb3-849"><a href="#cb3-849" aria-hidden="true" tabindex="-1"></a>    input<span class="op">.</span><span class="at">type</span> <span class="op">=</span> <span class="st">"range"</span><span class="op">;</span> input<span class="op">.</span><span class="at">min</span> <span class="op">=</span> min<span class="op">;</span> input<span class="op">.</span><span class="at">max</span> <span class="op">=</span> max<span class="op">;</span></span>
<span id="cb3-850"><a href="#cb3-850" aria-hidden="true" tabindex="-1"></a>    input<span class="op">.</span><span class="at">step</span> <span class="op">=</span> step<span class="op">;</span> input<span class="op">.</span><span class="at">value</span> <span class="op">=</span> val<span class="op">;</span></span>
<span id="cb3-851"><a href="#cb3-851" aria-hidden="true" tabindex="-1"></a>    track<span class="op">.</span><span class="fu">appendChild</span>(input)<span class="op">;</span></span>
<span id="cb3-852"><a href="#cb3-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-853"><a href="#cb3-853" aria-hidden="true" tabindex="-1"></a>    row<span class="op">.</span><span class="fu">appendChild</span>(head)<span class="op">;</span> row<span class="op">.</span><span class="fu">appendChild</span>(track)<span class="op">;</span></span>
<span id="cb3-854"><a href="#cb3-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-855"><a href="#cb3-855" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="dt">el</span><span class="op">:</span> row<span class="op">,</span> input<span class="op">,</span> valSpan<span class="op">,</span> fill<span class="op">,</span></span>
<span id="cb3-856"><a href="#cb3-856" aria-hidden="true" tabindex="-1"></a>      <span class="fu">update</span>(v<span class="op">,</span> lo<span class="op">,</span> hi) {</span>
<span id="cb3-857"><a href="#cb3-857" aria-hidden="true" tabindex="-1"></a>        valSpan<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> step <span class="op">&lt;</span> <span class="dv">1</span> <span class="op">?</span> <span class="bu">Number</span>(v)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>) <span class="op">:</span> <span class="bu">String</span>(v)<span class="op">;</span></span>
<span id="cb3-858"><a href="#cb3-858" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (lo <span class="op">!=</span> <span class="kw">null</span>) input<span class="op">.</span><span class="at">min</span> <span class="op">=</span> lo<span class="op">;</span></span>
<span id="cb3-859"><a href="#cb3-859" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (hi <span class="op">!=</span> <span class="kw">null</span>) input<span class="op">.</span><span class="at">max</span> <span class="op">=</span> hi<span class="op">;</span></span>
<span id="cb3-860"><a href="#cb3-860" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> pct <span class="op">=</span> ((v <span class="op">-</span> <span class="bu">Number</span>(input<span class="op">.</span><span class="at">min</span>)) <span class="op">/</span> (<span class="bu">Number</span>(input<span class="op">.</span><span class="at">max</span>) <span class="op">-</span> <span class="bu">Number</span>(input<span class="op">.</span><span class="at">min</span>))) <span class="op">*</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb3-861"><a href="#cb3-861" aria-hidden="true" tabindex="-1"></a>        fill<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">width</span> <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">100</span><span class="op">,</span> pct)) <span class="op">+</span> <span class="st">"%"</span><span class="op">;</span></span>
<span id="cb3-862"><a href="#cb3-862" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-863"><a href="#cb3-863" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb3-864"><a href="#cb3-864" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-865"><a href="#cb3-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-866"><a href="#cb3-866" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> S <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb3-867"><a href="#cb3-867" aria-hidden="true" tabindex="-1"></a>  S<span class="op">.</span><span class="at">k</span>  <span class="op">=</span> <span class="fu">createSlider</span>(<span class="st">"Số lần thành công (k)"</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">200</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">31</span><span class="op">,</span> <span class="st">"#1e293b"</span><span class="op">,</span> <span class="st">"#1e293b"</span><span class="op">,</span> <span class="st">"dark"</span>)<span class="op">;</span></span>
<span id="cb3-868"><a href="#cb3-868" aria-hidden="true" tabindex="-1"></a>  S<span class="op">.</span><span class="at">n</span>  <span class="op">=</span> <span class="fu">createSlider</span>(<span class="st">"Số phép thử (n)"</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">200</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="st">"#475569"</span><span class="op">,</span> <span class="st">"#475569"</span><span class="op">,</span> <span class="st">"gray"</span>)<span class="op">;</span></span>
<span id="cb3-869"><a href="#cb3-869" aria-hidden="true" tabindex="-1"></a>  S<span class="op">.</span><span class="at">pL</span> <span class="op">=</span> <span class="fu">createSlider</span>(<span class="st">"Giới hạn dưới"</span><span class="op">,</span> <span class="fl">0.001</span><span class="op">,</span> <span class="fl">0.999</span><span class="op">,</span> <span class="fl">0.001</span><span class="op">,</span> <span class="fl">0.3</span><span class="op">,</span> <span class="st">"#dc2626"</span><span class="op">,</span> <span class="st">"#dc2626"</span><span class="op">,</span> <span class="st">"red"</span>)<span class="op">;</span></span>
<span id="cb3-870"><a href="#cb3-870" aria-hidden="true" tabindex="-1"></a>  S<span class="op">.</span><span class="at">pH</span> <span class="op">=</span> <span class="fu">createSlider</span>(<span class="st">"Giới hạn trên"</span><span class="op">,</span> <span class="fl">0.001</span><span class="op">,</span> <span class="fl">0.999</span><span class="op">,</span> <span class="fl">0.001</span><span class="op">,</span> <span class="fl">0.8</span><span class="op">,</span> <span class="st">"#0891b2"</span><span class="op">,</span> <span class="st">"#0891b2"</span><span class="op">,</span> <span class="st">"teal"</span>)<span class="op">;</span></span>
<span id="cb3-871"><a href="#cb3-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-872"><a href="#cb3-872" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> row1 <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb3-873"><a href="#cb3-873" aria-hidden="true" tabindex="-1"></a>  row1<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display:flex;gap:32px;width:100%;padding:0 0 14px;margin-bottom:14px;border-bottom:1px solid #e2e8f0;"</span><span class="op">;</span></span>
<span id="cb3-874"><a href="#cb3-874" aria-hidden="true" tabindex="-1"></a>  row1<span class="op">.</span><span class="fu">appendChild</span>(S<span class="op">.</span><span class="at">k</span><span class="op">.</span><span class="at">el</span>)<span class="op">;</span> row1<span class="op">.</span><span class="fu">appendChild</span>(S<span class="op">.</span><span class="at">n</span><span class="op">.</span><span class="at">el</span>)<span class="op">;</span></span>
<span id="cb3-875"><a href="#cb3-875" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(row1)<span class="op">;</span></span>
<span id="cb3-876"><a href="#cb3-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-877"><a href="#cb3-877" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> row2 <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb3-878"><a href="#cb3-878" aria-hidden="true" tabindex="-1"></a>  row2<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display:flex;gap:32px;width:100%;margin-bottom:6px;"</span><span class="op">;</span></span>
<span id="cb3-879"><a href="#cb3-879" aria-hidden="true" tabindex="-1"></a>  row2<span class="op">.</span><span class="fu">appendChild</span>(S<span class="op">.</span><span class="at">pL</span><span class="op">.</span><span class="at">el</span>)<span class="op">;</span> row2<span class="op">.</span><span class="fu">appendChild</span>(S<span class="op">.</span><span class="at">pH</span><span class="op">.</span><span class="at">el</span>)<span class="op">;</span></span>
<span id="cb3-880"><a href="#cb3-880" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(row2)<span class="op">;</span></span>
<span id="cb3-881"><a href="#cb3-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-882"><a href="#cb3-882" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ── Tail readouts ──</span></span>
<span id="cb3-883"><a href="#cb3-883" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> readout <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb3-884"><a href="#cb3-884" aria-hidden="true" tabindex="-1"></a>  readout<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display:flex;gap:14px;width:100%;margin:10px 0 14px;flex-wrap:wrap;"</span><span class="op">;</span></span>
<span id="cb3-885"><a href="#cb3-885" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">makeBox</span>(bg<span class="op">,</span> border) {</span>
<span id="cb3-886"><a href="#cb3-886" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> b <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb3-887"><a href="#cb3-887" aria-hidden="true" tabindex="-1"></a>    b<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`flex:1;min-width:260px;padding:10px 14px;border-radius:8px;background:</span><span class="sc">${</span>bg<span class="sc">}</span><span class="vs">;border:1px solid </span><span class="sc">${</span>border<span class="sc">}</span><span class="vs">;font-size:13px;line-height:1.6;color:#334155;font-family:"SF Mono",SFMono-Regular,Menlo,Consolas,monospace;`</span><span class="op">;</span></span>
<span id="cb3-888"><a href="#cb3-888" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> b<span class="op">;</span></span>
<span id="cb3-889"><a href="#cb3-889" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-890"><a href="#cb3-890" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> boxL <span class="op">=</span> <span class="fu">makeBox</span>(<span class="st">"#fef2f2"</span><span class="op">,</span><span class="st">"#fecaca"</span>)<span class="op">;</span></span>
<span id="cb3-891"><a href="#cb3-891" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> boxR <span class="op">=</span> <span class="fu">makeBox</span>(<span class="st">"#ecfeff"</span><span class="op">,</span><span class="st">"#a5f3fc"</span>)<span class="op">;</span></span>
<span id="cb3-892"><a href="#cb3-892" aria-hidden="true" tabindex="-1"></a>  readout<span class="op">.</span><span class="fu">appendChild</span>(boxL)<span class="op">;</span> readout<span class="op">.</span><span class="fu">appendChild</span>(boxR)<span class="op">;</span></span>
<span id="cb3-893"><a href="#cb3-893" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(readout)<span class="op">;</span></span>
<span id="cb3-894"><a href="#cb3-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-895"><a href="#cb3-895" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-896"><a href="#cb3-896" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 3. SVG (pre-allocated pools)</span></span>
<span id="cb3-897"><a href="#cb3-897" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-898"><a href="#cb3-898" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> NS<span class="op">=</span><span class="st">"http://www.w3.org/2000/svg"</span><span class="op">;</span></span>
<span id="cb3-899"><a href="#cb3-899" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> W<span class="op">=</span><span class="dv">760</span><span class="op">,</span>H<span class="op">=</span><span class="dv">400</span><span class="op">,</span>mg<span class="op">=</span>{<span class="dt">t</span><span class="op">:</span><span class="dv">26</span><span class="op">,</span><span class="dt">r</span><span class="op">:</span><span class="dv">20</span><span class="op">,</span><span class="dt">b</span><span class="op">:</span><span class="dv">48</span><span class="op">,</span><span class="dt">l</span><span class="op">:</span><span class="dv">56</span>}<span class="op">,</span>cw<span class="op">=</span>W<span class="op">-</span>mg<span class="op">.</span><span class="at">l</span><span class="op">-</span>mg<span class="op">.</span><span class="at">r</span><span class="op">,</span>ch<span class="op">=</span>H<span class="op">-</span>mg<span class="op">.</span><span class="at">t</span><span class="op">-</span>mg<span class="op">.</span><span class="at">b</span><span class="op">;</span></span>
<span id="cb3-900"><a href="#cb3-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-901"><a href="#cb3-901" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg<span class="op">=</span><span class="bu">document</span><span class="op">.</span><span class="fu">createElementNS</span>(NS<span class="op">,</span><span class="st">"svg"</span>)<span class="op">;</span></span>
<span id="cb3-902"><a href="#cb3-902" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"viewBox"</span><span class="op">,</span><span class="vs">`0 0 </span><span class="sc">${</span>W<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>H<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb3-903"><a href="#cb3-903" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span><span class="op">=</span><span class="vs">`width:100%;max-width:</span><span class="sc">${</span>W<span class="sc">}</span><span class="vs">px;background:#fafbfc;border-radius:10px;border:1px solid #e2e8f0;`</span><span class="op">;</span></span>
<span id="cb3-904"><a href="#cb3-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-905"><a href="#cb3-905" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">el</span>(tag<span class="op">,</span>a){<span class="kw">const</span> e<span class="op">=</span><span class="bu">document</span><span class="op">.</span><span class="fu">createElementNS</span>(NS<span class="op">,</span>tag)<span class="op">;</span><span class="cf">if</span>(a)<span class="cf">for</span>(<span class="kw">const</span>[k<span class="op">,</span>v]<span class="kw">of</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">entries</span>(a))e<span class="op">.</span><span class="fu">setAttribute</span>(k<span class="op">,</span>v)<span class="op">;</span><span class="cf">return</span> e<span class="op">;</span>}</span>
<span id="cb3-906"><a href="#cb3-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-907"><a href="#cb3-907" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Grid</span></span>
<span id="cb3-908"><a href="#cb3-908" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> gridLines<span class="op">=</span>[]<span class="op">;</span></span>
<span id="cb3-909"><a href="#cb3-909" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;=</span><span class="dv">4</span><span class="op">;</span>i<span class="op">++</span>){<span class="kw">const</span> l<span class="op">=</span><span class="fu">el</span>(<span class="st">"line"</span><span class="op">,</span>{<span class="dt">stroke</span><span class="op">:</span><span class="st">"#e2e8f0"</span><span class="op">,</span><span class="st">"stroke-width"</span><span class="op">:</span><span class="st">"0.7"</span>})<span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(l)<span class="op">;</span>gridLines<span class="op">.</span><span class="fu">push</span>(l)<span class="op">;</span>}</span>
<span id="cb3-910"><a href="#cb3-910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-911"><a href="#cb3-911" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Y labels</span></span>
<span id="cb3-912"><a href="#cb3-912" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yLabels<span class="op">=</span>[]<span class="op">;</span></span>
<span id="cb3-913"><a href="#cb3-913" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;=</span><span class="dv">4</span><span class="op">;</span>i<span class="op">++</span>){<span class="kw">const</span> t<span class="op">=</span><span class="fu">el</span>(<span class="st">"text"</span><span class="op">,</span>{<span class="st">"text-anchor"</span><span class="op">:</span><span class="st">"end"</span><span class="op">,</span><span class="dt">fill</span><span class="op">:</span><span class="st">"#94a3b8"</span><span class="op">,</span><span class="st">"font-size"</span><span class="op">:</span><span class="st">"10"</span><span class="op">,</span><span class="st">"font-family"</span><span class="op">:</span><span class="st">"'SF Mono',monospace"</span>})<span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(t)<span class="op">;</span>yLabels<span class="op">.</span><span class="fu">push</span>(t)<span class="op">;</span>}</span>
<span id="cb3-914"><a href="#cb3-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-915"><a href="#cb3-915" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bar pools</span></span>
<span id="cb3-916"><a href="#cb3-916" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> POOL<span class="op">=</span><span class="dv">201</span><span class="op">;</span></span>
<span id="cb3-917"><a href="#cb3-917" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> barsR<span class="op">=</span>[]<span class="op">,</span>barsL<span class="op">=</span>[]<span class="op">;</span></span>
<span id="cb3-918"><a href="#cb3-918" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>POOL<span class="op">;</span>i<span class="op">++</span>){</span>
<span id="cb3-919"><a href="#cb3-919" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> r<span class="op">=</span><span class="fu">el</span>(<span class="st">"rect"</span><span class="op">,</span>{<span class="dt">rx</span><span class="op">:</span><span class="st">"1"</span>})<span class="op">;</span>r<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">"none"</span><span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(r)<span class="op">;</span>barsR<span class="op">.</span><span class="fu">push</span>(r)<span class="op">;</span></span>
<span id="cb3-920"><a href="#cb3-920" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> l<span class="op">=</span><span class="fu">el</span>(<span class="st">"rect"</span><span class="op">,</span>{<span class="dt">rx</span><span class="op">:</span><span class="st">"1"</span>})<span class="op">;</span>l<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">"none"</span><span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(l)<span class="op">;</span>barsL<span class="op">.</span><span class="fu">push</span>(l)<span class="op">;</span></span>
<span id="cb3-921"><a href="#cb3-921" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-922"><a href="#cb3-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-923"><a href="#cb3-923" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Paths</span></span>
<span id="cb3-924"><a href="#cb3-924" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> path1<span class="op">=</span><span class="fu">el</span>(<span class="st">"path"</span><span class="op">,</span>{<span class="dt">fill</span><span class="op">:</span><span class="st">"none"</span><span class="op">,</span><span class="st">"stroke-width"</span><span class="op">:</span><span class="st">"2.2"</span><span class="op">,</span><span class="dt">opacity</span><span class="op">:</span><span class="st">"0.9"</span>})<span class="op">;</span></span>
<span id="cb3-925"><a href="#cb3-925" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> path2<span class="op">=</span><span class="fu">el</span>(<span class="st">"path"</span><span class="op">,</span>{<span class="dt">fill</span><span class="op">:</span><span class="st">"none"</span><span class="op">,</span><span class="st">"stroke-width"</span><span class="op">:</span><span class="st">"2"</span><span class="op">,</span><span class="st">"stroke-dasharray"</span><span class="op">:</span><span class="st">"4,3"</span><span class="op">,</span><span class="dt">opacity</span><span class="op">:</span><span class="st">"0.55"</span>})<span class="op">;</span></span>
<span id="cb3-926"><a href="#cb3-926" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> path3<span class="op">=</span><span class="fu">el</span>(<span class="st">"path"</span><span class="op">,</span>{<span class="dt">fill</span><span class="op">:</span><span class="st">"none"</span><span class="op">,</span><span class="st">"stroke-width"</span><span class="op">:</span><span class="st">"2.2"</span><span class="op">,</span><span class="dt">opacity</span><span class="op">:</span><span class="st">"0.9"</span>})<span class="op">;</span></span>
<span id="cb3-927"><a href="#cb3-927" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">appendChild</span>(path1)<span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(path2)<span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(path3)<span class="op">;</span></span>
<span id="cb3-928"><a href="#cb3-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-929"><a href="#cb3-929" aria-hidden="true" tabindex="-1"></a>  <span class="co">// k line</span></span>
<span id="cb3-930"><a href="#cb3-930" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> kLine<span class="op">=</span><span class="fu">el</span>(<span class="st">"line"</span><span class="op">,</span>{<span class="dt">stroke</span><span class="op">:</span><span class="st">"#1e293b"</span><span class="op">,</span><span class="st">"stroke-width"</span><span class="op">:</span><span class="st">"1.3"</span><span class="op">,</span><span class="st">"stroke-dasharray"</span><span class="op">:</span><span class="st">"6,4"</span><span class="op">,</span><span class="dt">opacity</span><span class="op">:</span><span class="st">"0.5"</span>})<span class="op">;</span></span>
<span id="cb3-931"><a href="#cb3-931" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> kLbl<span class="op">=</span><span class="fu">el</span>(<span class="st">"text"</span><span class="op">,</span>{<span class="st">"text-anchor"</span><span class="op">:</span><span class="st">"middle"</span><span class="op">,</span><span class="dt">fill</span><span class="op">:</span><span class="st">"#1e293b"</span><span class="op">,</span><span class="st">"font-size"</span><span class="op">:</span><span class="st">"12"</span><span class="op">,</span><span class="st">"font-weight"</span><span class="op">:</span><span class="st">"700"</span><span class="op">,</span><span class="st">"font-family"</span><span class="op">:</span><span class="st">"'SF Mono',monospace"</span>})<span class="op">;</span></span>
<span id="cb3-932"><a href="#cb3-932" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">appendChild</span>(kLine)<span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(kLbl)<span class="op">;</span></span>
<span id="cb3-933"><a href="#cb3-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-934"><a href="#cb3-934" aria-hidden="true" tabindex="-1"></a>  <span class="co">// X axis</span></span>
<span id="cb3-935"><a href="#cb3-935" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xAx<span class="op">=</span><span class="fu">el</span>(<span class="st">"line"</span><span class="op">,</span>{<span class="dt">stroke</span><span class="op">:</span><span class="st">"#94a3b8"</span>})<span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(xAx)<span class="op">;</span></span>
<span id="cb3-936"><a href="#cb3-936" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xTicks<span class="op">=</span>[]<span class="op">;</span></span>
<span id="cb3-937"><a href="#cb3-937" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span><span class="dv">30</span><span class="op">;</span>i<span class="op">++</span>){</span>
<span id="cb3-938"><a href="#cb3-938" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> ln<span class="op">=</span><span class="fu">el</span>(<span class="st">"line"</span><span class="op">,</span>{<span class="dt">stroke</span><span class="op">:</span><span class="st">"#94a3b8"</span><span class="op">,</span><span class="dt">y2</span><span class="op">:</span><span class="st">"5"</span>})<span class="op">;</span>ln<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">"none"</span><span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(ln)<span class="op">;</span></span>
<span id="cb3-939"><a href="#cb3-939" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> t<span class="op">=</span><span class="fu">el</span>(<span class="st">"text"</span><span class="op">,</span>{<span class="st">"text-anchor"</span><span class="op">:</span><span class="st">"middle"</span><span class="op">,</span><span class="dt">fill</span><span class="op">:</span><span class="st">"#64748b"</span><span class="op">,</span><span class="st">"font-size"</span><span class="op">:</span><span class="st">"11"</span><span class="op">,</span><span class="st">"font-family"</span><span class="op">:</span><span class="st">"'SF Mono',monospace"</span><span class="op">,</span><span class="dt">dy</span><span class="op">:</span><span class="st">"16"</span>})<span class="op">;</span>t<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">"none"</span><span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(t)<span class="op">;</span></span>
<span id="cb3-940"><a href="#cb3-940" aria-hidden="true" tabindex="-1"></a>    xTicks<span class="op">.</span><span class="fu">push</span>({ln<span class="op">,</span>t})<span class="op">;</span></span>
<span id="cb3-941"><a href="#cb3-941" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-942"><a href="#cb3-942" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xLbl<span class="op">=</span><span class="fu">el</span>(<span class="st">"text"</span><span class="op">,</span>{<span class="st">"text-anchor"</span><span class="op">:</span><span class="st">"middle"</span><span class="op">,</span><span class="dt">fill</span><span class="op">:</span><span class="st">"#64748b"</span><span class="op">,</span><span class="st">"font-size"</span><span class="op">:</span><span class="st">"12"</span><span class="op">,</span><span class="dt">y</span><span class="op">:</span><span class="bu">String</span>(H<span class="op">-</span><span class="dv">4</span>)})<span class="op">;</span></span>
<span id="cb3-943"><a href="#cb3-943" aria-hidden="true" tabindex="-1"></a>  xLbl<span class="op">.</span><span class="at">textContent</span><span class="op">=</span><span class="st">"Số lần thành công"</span><span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(xLbl)<span class="op">;</span></span>
<span id="cb3-944"><a href="#cb3-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-945"><a href="#cb3-945" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Y axis</span></span>
<span id="cb3-946"><a href="#cb3-946" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">appendChild</span>(<span class="fu">el</span>(<span class="st">"line"</span><span class="op">,</span>{<span class="dt">x1</span><span class="op">:</span><span class="bu">String</span>(mg<span class="op">.</span><span class="at">l</span>)<span class="op">,</span><span class="dt">x2</span><span class="op">:</span><span class="bu">String</span>(mg<span class="op">.</span><span class="at">l</span>)<span class="op">,</span><span class="dt">y1</span><span class="op">:</span><span class="bu">String</span>(mg<span class="op">.</span><span class="at">t</span>)<span class="op">,</span><span class="dt">y2</span><span class="op">:</span><span class="bu">String</span>(mg<span class="op">.</span><span class="at">t</span><span class="op">+</span>ch)<span class="op">,</span><span class="dt">stroke</span><span class="op">:</span><span class="st">"#94a3b8"</span>}))<span class="op">;</span></span>
<span id="cb3-947"><a href="#cb3-947" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yLbl<span class="op">=</span><span class="fu">el</span>(<span class="st">"text"</span><span class="op">,</span>{<span class="st">"text-anchor"</span><span class="op">:</span><span class="st">"middle"</span><span class="op">,</span><span class="dt">fill</span><span class="op">:</span><span class="st">"#64748b"</span><span class="op">,</span><span class="st">"font-size"</span><span class="op">:</span><span class="st">"12"</span><span class="op">,</span><span class="dt">x</span><span class="op">:</span><span class="st">"14"</span><span class="op">,</span><span class="dt">y</span><span class="op">:</span><span class="bu">String</span>(mg<span class="op">.</span><span class="at">t</span><span class="op">+</span>ch<span class="op">/</span><span class="dv">2</span>)<span class="op">,</span><span class="dt">transform</span><span class="op">:</span><span class="vs">`rotate(-90,14,</span><span class="sc">${</span>mg<span class="op">.</span><span class="at">t</span><span class="op">+</span>ch<span class="op">/</span><span class="dv">2</span><span class="sc">}</span><span class="vs">)`</span>})<span class="op">;</span></span>
<span id="cb3-948"><a href="#cb3-948" aria-hidden="true" tabindex="-1"></a>  yLbl<span class="op">.</span><span class="at">textContent</span><span class="op">=</span><span class="st">"P(X = x)"</span><span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(yLbl)<span class="op">;</span></span>
<span id="cb3-949"><a href="#cb3-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-950"><a href="#cb3-950" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Annotations</span></span>
<span id="cb3-951"><a href="#cb3-951" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> annR<span class="op">=</span><span class="fu">el</span>(<span class="st">"text"</span><span class="op">,</span>{<span class="dt">fill</span><span class="op">:</span><span class="st">"#dc2626"</span><span class="op">,</span><span class="st">"font-size"</span><span class="op">:</span><span class="st">"12"</span><span class="op">,</span><span class="st">"font-weight"</span><span class="op">:</span><span class="st">"700"</span><span class="op">,</span><span class="st">"font-family"</span><span class="op">:</span><span class="st">"'SF Mono',monospace"</span>})<span class="op">;</span></span>
<span id="cb3-952"><a href="#cb3-952" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> annRs<span class="op">=</span><span class="fu">el</span>(<span class="st">"text"</span><span class="op">,</span>{<span class="dt">fill</span><span class="op">:</span><span class="st">"#dc2626"</span><span class="op">,</span><span class="st">"font-size"</span><span class="op">:</span><span class="st">"10"</span><span class="op">,</span><span class="dt">opacity</span><span class="op">:</span><span class="st">"0.6"</span><span class="op">,</span><span class="st">"font-family"</span><span class="op">:</span><span class="st">"'SF Mono',monospace"</span>})<span class="op">;</span></span>
<span id="cb3-953"><a href="#cb3-953" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> annL<span class="op">=</span><span class="fu">el</span>(<span class="st">"text"</span><span class="op">,</span>{<span class="dt">fill</span><span class="op">:</span><span class="st">"#0891b2"</span><span class="op">,</span><span class="st">"font-size"</span><span class="op">:</span><span class="st">"12"</span><span class="op">,</span><span class="st">"font-weight"</span><span class="op">:</span><span class="st">"700"</span><span class="op">,</span><span class="st">"font-family"</span><span class="op">:</span><span class="st">"'SF Mono',monospace"</span>})<span class="op">;</span></span>
<span id="cb3-954"><a href="#cb3-954" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> annLs<span class="op">=</span><span class="fu">el</span>(<span class="st">"text"</span><span class="op">,</span>{<span class="dt">fill</span><span class="op">:</span><span class="st">"#0891b2"</span><span class="op">,</span><span class="st">"font-size"</span><span class="op">:</span><span class="st">"10"</span><span class="op">,</span><span class="dt">opacity</span><span class="op">:</span><span class="st">"0.6"</span><span class="op">,</span><span class="st">"font-family"</span><span class="op">:</span><span class="st">"'SF Mono',monospace"</span>})<span class="op">;</span></span>
<span id="cb3-955"><a href="#cb3-955" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">appendChild</span>(annR)<span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(annRs)<span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(annL)<span class="op">;</span>svg<span class="op">.</span><span class="fu">appendChild</span>(annLs)<span class="op">;</span></span>
<span id="cb3-956"><a href="#cb3-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-957"><a href="#cb3-957" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(svg)<span class="op">;</span></span>
<span id="cb3-958"><a href="#cb3-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-959"><a href="#cb3-959" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-960"><a href="#cb3-960" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 4. RENDER</span></span>
<span id="cb3-961"><a href="#cb3-961" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-962"><a href="#cb3-962" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> rafId<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-963"><a href="#cb3-963" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> C1<span class="op">=</span><span class="st">"#dc2626"</span><span class="op">,</span>C2<span class="op">=</span><span class="st">"#94a3b8"</span><span class="op">,</span>C3<span class="op">=</span><span class="st">"#0891b2"</span><span class="op">;</span></span>
<span id="cb3-964"><a href="#cb3-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-965"><a href="#cb3-965" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">render</span>(){</span>
<span id="cb3-966"><a href="#cb3-966" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> nV<span class="op">=+</span>S<span class="op">.</span><span class="at">n</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb3-967"><a href="#cb3-967" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> kV<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="op">+</span>S<span class="op">.</span><span class="at">k</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="at">value</span><span class="op">,</span>nV)<span class="op">;</span></span>
<span id="cb3-968"><a href="#cb3-968" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pLV<span class="op">=+</span>S<span class="op">.</span><span class="at">pL</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb3-969"><a href="#cb3-969" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pHV<span class="op">=+</span>S<span class="op">.</span><span class="at">pH</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb3-970"><a href="#cb3-970" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pH<span class="op">=</span>nV<span class="op">&gt;</span><span class="dv">0</span><span class="op">?</span>kV<span class="op">/</span>nV<span class="op">:</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-971"><a href="#cb3-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-972"><a href="#cb3-972" aria-hidden="true" tabindex="-1"></a>    S<span class="op">.</span><span class="at">k</span><span class="op">.</span><span class="fu">update</span>(kV<span class="op">,</span><span class="dv">0</span><span class="op">,</span>nV)<span class="op">;</span></span>
<span id="cb3-973"><a href="#cb3-973" aria-hidden="true" tabindex="-1"></a>    S<span class="op">.</span><span class="at">n</span><span class="op">.</span><span class="fu">update</span>(nV)<span class="op">;</span></span>
<span id="cb3-974"><a href="#cb3-974" aria-hidden="true" tabindex="-1"></a>    S<span class="op">.</span><span class="at">pL</span><span class="op">.</span><span class="fu">update</span>(pLV<span class="op">,</span><span class="fl">0.001</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(pH<span class="op">,</span><span class="fl">0.998</span>))<span class="op">;</span></span>
<span id="cb3-975"><a href="#cb3-975" aria-hidden="true" tabindex="-1"></a>    S<span class="op">.</span><span class="at">pH</span><span class="op">.</span><span class="fu">update</span>(pHV<span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(pH<span class="op">,</span><span class="fl">0.002</span>)<span class="op">,</span><span class="fl">0.999</span>)<span class="op">;</span></span>
<span id="cb3-976"><a href="#cb3-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-977"><a href="#cb3-977" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> ps<span class="op">=</span>[pLV<span class="op">,</span>pH<span class="op">,</span>pHV]<span class="op">.</span><span class="fu">filter</span>(p<span class="kw">=&gt;</span>p<span class="op">&gt;</span><span class="dv">0</span><span class="op">&amp;&amp;</span>p<span class="op">&lt;</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-978"><a href="#cb3-978" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> loX<span class="op">=</span>kV<span class="op">,</span>hiX<span class="op">=</span>kV<span class="op">;</span></span>
<span id="cb3-979"><a href="#cb3-979" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">const</span> p <span class="kw">of</span> ps){<span class="kw">const</span> mu<span class="op">=</span>nV<span class="op">*</span>p<span class="op">,</span>sd<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(nV<span class="op">*</span>p<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>p))<span class="op">;</span>loX<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(loX<span class="op">,</span>mu<span class="op">-</span><span class="fl">3.8</span><span class="op">*</span>sd)<span class="op">;</span>hiX<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(hiX<span class="op">,</span>mu<span class="op">+</span><span class="fl">3.8</span><span class="op">*</span>sd)<span class="op">;</span>}</span>
<span id="cb3-980"><a href="#cb3-980" aria-hidden="true" tabindex="-1"></a>    loX<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(loX))<span class="op">;</span>hiX<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(nV<span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(hiX))<span class="op">;</span></span>
<span id="cb3-981"><a href="#cb3-981" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cnt<span class="op">=</span>hiX<span class="op">-</span>loX<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-982"><a href="#cb3-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-983"><a href="#cb3-983" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> maxY<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-984"><a href="#cb3-984" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> y1<span class="op">=</span><span class="kw">new</span> <span class="bu">Float64Array</span>(cnt)<span class="op">,</span>y2<span class="op">=</span><span class="kw">new</span> <span class="bu">Float64Array</span>(cnt)<span class="op">,</span>y3<span class="op">=</span><span class="kw">new</span> <span class="bu">Float64Array</span>(cnt)<span class="op">;</span></span>
<span id="cb3-985"><a href="#cb3-985" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>cnt<span class="op">;</span>i<span class="op">++</span>){</span>
<span id="cb3-986"><a href="#cb3-986" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x<span class="op">=</span>loX<span class="op">+</span>i<span class="op">;</span></span>
<span id="cb3-987"><a href="#cb3-987" aria-hidden="true" tabindex="-1"></a>      y1[i]<span class="op">=</span><span class="fu">pmf</span>(x<span class="op">,</span>nV<span class="op">,</span>pLV)<span class="op">;</span>y2[i]<span class="op">=</span><span class="fu">pmf</span>(x<span class="op">,</span>nV<span class="op">,</span>pH)<span class="op">;</span>y3[i]<span class="op">=</span><span class="fu">pmf</span>(x<span class="op">,</span>nV<span class="op">,</span>pHV)<span class="op">;</span></span>
<span id="cb3-988"><a href="#cb3-988" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> m<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(y1[i]<span class="op">,</span>y2[i]<span class="op">,</span>y3[i])<span class="op">;</span><span class="cf">if</span>(m<span class="op">&gt;</span>maxY)maxY<span class="op">=</span>m<span class="op">;</span></span>
<span id="cb3-989"><a href="#cb3-989" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-990"><a href="#cb3-990" aria-hidden="true" tabindex="-1"></a>    maxY<span class="op">*=</span><span class="fl">1.15</span><span class="op">;</span><span class="cf">if</span>(maxY<span class="op">&lt;</span><span class="fl">1e-9</span>)maxY<span class="op">=</span><span class="fl">0.01</span><span class="op">;</span></span>
<span id="cb3-991"><a href="#cb3-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-992"><a href="#cb3-992" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sx<span class="op">=</span>x<span class="kw">=&gt;</span>mg<span class="op">.</span><span class="at">l</span><span class="op">+</span>((x<span class="op">-</span>loX)<span class="op">/</span>(hiX<span class="op">-</span>loX))<span class="op">*</span>cw<span class="op">;</span></span>
<span id="cb3-993"><a href="#cb3-993" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sy<span class="op">=</span>y<span class="kw">=&gt;</span>mg<span class="op">.</span><span class="at">t</span><span class="op">+</span>ch<span class="op">-</span>(y<span class="op">/</span>maxY)<span class="op">*</span>ch<span class="op">;</span></span>
<span id="cb3-994"><a href="#cb3-994" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> bw<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="fl">1.5</span><span class="op">,</span>cw<span class="op">/</span>cnt<span class="op">*</span><span class="fl">0.5</span>)<span class="op">;</span></span>
<span id="cb3-995"><a href="#cb3-995" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> base<span class="op">=</span><span class="fu">sy</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb3-996"><a href="#cb3-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-997"><a href="#cb3-997" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;=</span><span class="dv">4</span><span class="op">;</span>i<span class="op">++</span>){</span>
<span id="cb3-998"><a href="#cb3-998" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> v<span class="op">=</span>(maxY<span class="op">/</span><span class="dv">4</span>)<span class="op">*</span>i<span class="op">,</span>yy<span class="op">=</span><span class="fu">sy</span>(v)<span class="op">;</span></span>
<span id="cb3-999"><a href="#cb3-999" aria-hidden="true" tabindex="-1"></a>      gridLines[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x1"</span><span class="op">,</span>mg<span class="op">.</span><span class="at">l</span>)<span class="op">;</span>gridLines[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x2"</span><span class="op">,</span>W<span class="op">-</span>mg<span class="op">.</span><span class="at">r</span>)<span class="op">;</span></span>
<span id="cb3-1000"><a href="#cb3-1000" aria-hidden="true" tabindex="-1"></a>      gridLines[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y1"</span><span class="op">,</span>yy)<span class="op">;</span>gridLines[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y2"</span><span class="op">,</span>yy)<span class="op">;</span></span>
<span id="cb3-1001"><a href="#cb3-1001" aria-hidden="true" tabindex="-1"></a>      yLabels[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span>mg<span class="op">.</span><span class="at">l</span><span class="op">-</span><span class="dv">8</span>)<span class="op">;</span>yLabels[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span>yy<span class="op">+</span><span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb3-1002"><a href="#cb3-1002" aria-hidden="true" tabindex="-1"></a>      yLabels[i]<span class="op">.</span><span class="at">textContent</span><span class="op">=</span>v<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb3-1003"><a href="#cb3-1003" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-1004"><a href="#cb3-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1005"><a href="#cb3-1005" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> bi<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-1006"><a href="#cb3-1006" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>cnt<span class="op">;</span>i<span class="op">++</span>){<span class="kw">const</span> x<span class="op">=</span>loX<span class="op">+</span>i<span class="op">;</span><span class="cf">if</span>(x<span class="op">&gt;=</span>kV<span class="op">&amp;&amp;</span>bi<span class="op">&lt;</span>POOL){</span>
<span id="cb3-1007"><a href="#cb3-1007" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> b<span class="op">=</span>barsR[bi<span class="op">++</span>]<span class="op">;</span><span class="kw">const</span> h<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span>base<span class="op">-</span><span class="fu">sy</span>(y1[i]))<span class="op">;</span></span>
<span id="cb3-1008"><a href="#cb3-1008" aria-hidden="true" tabindex="-1"></a>      b<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span><span class="fu">sx</span>(x)<span class="op">-</span>bw<span class="op">/</span><span class="dv">2</span>)<span class="op">;</span>b<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span><span class="fu">sy</span>(y1[i]))<span class="op">;</span></span>
<span id="cb3-1009"><a href="#cb3-1009" aria-hidden="true" tabindex="-1"></a>      b<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"width"</span><span class="op">,</span>bw)<span class="op">;</span>b<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"height"</span><span class="op">,</span>h)<span class="op">;</span></span>
<span id="cb3-1010"><a href="#cb3-1010" aria-hidden="true" tabindex="-1"></a>      b<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"rgba(220,38,38,0.18)"</span>)<span class="op">;</span>b<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"stroke"</span><span class="op">,</span>C1)<span class="op">;</span>b<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="st">"0.6"</span>)<span class="op">;</span></span>
<span id="cb3-1011"><a href="#cb3-1011" aria-hidden="true" tabindex="-1"></a>      b<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">""</span><span class="op">;</span></span>
<span id="cb3-1012"><a href="#cb3-1012" aria-hidden="true" tabindex="-1"></a>    }}</span>
<span id="cb3-1013"><a href="#cb3-1013" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="op">;</span>bi<span class="op">&lt;</span>POOL<span class="op">;</span>bi<span class="op">++</span>)barsR[bi]<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">"none"</span><span class="op">;</span></span>
<span id="cb3-1014"><a href="#cb3-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1015"><a href="#cb3-1015" aria-hidden="true" tabindex="-1"></a>    bi<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-1016"><a href="#cb3-1016" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>cnt<span class="op">;</span>i<span class="op">++</span>){<span class="kw">const</span> x<span class="op">=</span>loX<span class="op">+</span>i<span class="op">;</span><span class="cf">if</span>(x<span class="op">&lt;=</span>kV<span class="op">&amp;&amp;</span>bi<span class="op">&lt;</span>POOL){</span>
<span id="cb3-1017"><a href="#cb3-1017" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> b<span class="op">=</span>barsL[bi<span class="op">++</span>]<span class="op">;</span><span class="kw">const</span> h<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span>base<span class="op">-</span><span class="fu">sy</span>(y3[i]))<span class="op">;</span></span>
<span id="cb3-1018"><a href="#cb3-1018" aria-hidden="true" tabindex="-1"></a>      b<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span><span class="fu">sx</span>(x)<span class="op">-</span>bw<span class="op">/</span><span class="dv">2</span>)<span class="op">;</span>b<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span><span class="fu">sy</span>(y3[i]))<span class="op">;</span></span>
<span id="cb3-1019"><a href="#cb3-1019" aria-hidden="true" tabindex="-1"></a>      b<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"width"</span><span class="op">,</span>bw)<span class="op">;</span>b<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"height"</span><span class="op">,</span>h)<span class="op">;</span></span>
<span id="cb3-1020"><a href="#cb3-1020" aria-hidden="true" tabindex="-1"></a>      b<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"rgba(8,145,178,0.15)"</span>)<span class="op">;</span>b<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"stroke"</span><span class="op">,</span>C3)<span class="op">;</span>b<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="st">"0.6"</span>)<span class="op">;</span></span>
<span id="cb3-1021"><a href="#cb3-1021" aria-hidden="true" tabindex="-1"></a>      b<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">""</span><span class="op">;</span></span>
<span id="cb3-1022"><a href="#cb3-1022" aria-hidden="true" tabindex="-1"></a>    }}</span>
<span id="cb3-1023"><a href="#cb3-1023" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="op">;</span>bi<span class="op">&lt;</span>POOL<span class="op">;</span>bi<span class="op">++</span>)barsL[bi]<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">"none"</span><span class="op">;</span></span>
<span id="cb3-1024"><a href="#cb3-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1025"><a href="#cb3-1025" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> d1<span class="op">=</span><span class="st">""</span><span class="op">,</span>d2<span class="op">=</span><span class="st">""</span><span class="op">,</span>d3<span class="op">=</span><span class="st">""</span><span class="op">;</span></span>
<span id="cb3-1026"><a href="#cb3-1026" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>cnt<span class="op">;</span>i<span class="op">++</span>){</span>
<span id="cb3-1027"><a href="#cb3-1027" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x<span class="op">=</span>loX<span class="op">+</span>i<span class="op">,</span>cmd<span class="op">=</span>i<span class="op">?</span><span class="st">"L"</span><span class="op">:</span><span class="st">"M"</span><span class="op">,</span>px<span class="op">=</span><span class="fu">sx</span>(x)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-1028"><a href="#cb3-1028" aria-hidden="true" tabindex="-1"></a>      d1<span class="op">+=</span>cmd<span class="op">+</span>px<span class="op">+</span><span class="st">","</span><span class="op">+</span><span class="fu">sy</span>(y1[i])<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-1029"><a href="#cb3-1029" aria-hidden="true" tabindex="-1"></a>      d2<span class="op">+=</span>cmd<span class="op">+</span>px<span class="op">+</span><span class="st">","</span><span class="op">+</span><span class="fu">sy</span>(y2[i])<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-1030"><a href="#cb3-1030" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">+=</span>cmd<span class="op">+</span>px<span class="op">+</span><span class="st">","</span><span class="op">+</span><span class="fu">sy</span>(y3[i])<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-1031"><a href="#cb3-1031" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-1032"><a href="#cb3-1032" aria-hidden="true" tabindex="-1"></a>    path1<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"d"</span><span class="op">,</span>d1)<span class="op">;</span>path1<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"stroke"</span><span class="op">,</span>C1)<span class="op">;</span></span>
<span id="cb3-1033"><a href="#cb3-1033" aria-hidden="true" tabindex="-1"></a>    path2<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"d"</span><span class="op">,</span>d2)<span class="op">;</span>path2<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"stroke"</span><span class="op">,</span>C2)<span class="op">;</span></span>
<span id="cb3-1034"><a href="#cb3-1034" aria-hidden="true" tabindex="-1"></a>    path3<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"d"</span><span class="op">,</span>d3)<span class="op">;</span>path3<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"stroke"</span><span class="op">,</span>C3)<span class="op">;</span></span>
<span id="cb3-1035"><a href="#cb3-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1036"><a href="#cb3-1036" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> kx<span class="op">=</span><span class="fu">sx</span>(kV)<span class="op">;</span></span>
<span id="cb3-1037"><a href="#cb3-1037" aria-hidden="true" tabindex="-1"></a>    kLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x1"</span><span class="op">,</span>kx)<span class="op">;</span>kLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x2"</span><span class="op">,</span>kx)<span class="op">;</span></span>
<span id="cb3-1038"><a href="#cb3-1038" aria-hidden="true" tabindex="-1"></a>    kLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y1"</span><span class="op">,</span>mg<span class="op">.</span><span class="at">t</span>)<span class="op">;</span>kLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y2"</span><span class="op">,</span>base)<span class="op">;</span></span>
<span id="cb3-1039"><a href="#cb3-1039" aria-hidden="true" tabindex="-1"></a>    kLbl<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span>kx)<span class="op">;</span>kLbl<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span>mg<span class="op">.</span><span class="at">t</span><span class="op">-</span><span class="dv">8</span>)<span class="op">;</span>kLbl<span class="op">.</span><span class="at">textContent</span><span class="op">=</span><span class="st">"k = "</span><span class="op">+</span>kV<span class="op">;</span></span>
<span id="cb3-1040"><a href="#cb3-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1041"><a href="#cb3-1041" aria-hidden="true" tabindex="-1"></a>    xAx<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x1"</span><span class="op">,</span>mg<span class="op">.</span><span class="at">l</span>)<span class="op">;</span>xAx<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x2"</span><span class="op">,</span>W<span class="op">-</span>mg<span class="op">.</span><span class="at">r</span>)<span class="op">;</span></span>
<span id="cb3-1042"><a href="#cb3-1042" aria-hidden="true" tabindex="-1"></a>    xAx<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y1"</span><span class="op">,</span>base)<span class="op">;</span>xAx<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y2"</span><span class="op">,</span>base)<span class="op">;</span></span>
<span id="cb3-1043"><a href="#cb3-1043" aria-hidden="true" tabindex="-1"></a>    xLbl<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span>mg<span class="op">.</span><span class="at">l</span><span class="op">+</span>cw<span class="op">/</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-1044"><a href="#cb3-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1045"><a href="#cb3-1045" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> span<span class="op">=</span>hiX<span class="op">-</span>loX<span class="op">;</span></span>
<span id="cb3-1046"><a href="#cb3-1046" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> ts<span class="op">=</span>span<span class="op">&gt;</span><span class="dv">80</span><span class="op">?</span><span class="dv">10</span><span class="op">:</span>span<span class="op">&gt;</span><span class="dv">40</span><span class="op">?</span><span class="dv">5</span><span class="op">:</span>span<span class="op">&gt;</span><span class="dv">20</span><span class="op">?</span><span class="dv">2</span><span class="op">:</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-1047"><a href="#cb3-1047" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> ti<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-1048"><a href="#cb3-1048" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> x<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(loX<span class="op">/</span>ts)<span class="op">*</span>ts<span class="op">;</span>x<span class="op">&lt;=</span>hiX<span class="op">&amp;&amp;</span>ti<span class="op">&lt;</span><span class="dv">30</span><span class="op">;</span>x<span class="op">+=</span>ts){</span>
<span id="cb3-1049"><a href="#cb3-1049" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> xx<span class="op">=</span><span class="fu">sx</span>(x)<span class="op">;</span></span>
<span id="cb3-1050"><a href="#cb3-1050" aria-hidden="true" tabindex="-1"></a>      xTicks[ti]<span class="op">.</span><span class="at">ln</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x1"</span><span class="op">,</span>xx)<span class="op">;</span>xTicks[ti]<span class="op">.</span><span class="at">ln</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x2"</span><span class="op">,</span>xx)<span class="op">;</span></span>
<span id="cb3-1051"><a href="#cb3-1051" aria-hidden="true" tabindex="-1"></a>      xTicks[ti]<span class="op">.</span><span class="at">ln</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y1"</span><span class="op">,</span>base)<span class="op">;</span>xTicks[ti]<span class="op">.</span><span class="at">ln</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y2"</span><span class="op">,</span>base<span class="op">+</span><span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb3-1052"><a href="#cb3-1052" aria-hidden="true" tabindex="-1"></a>      xTicks[ti]<span class="op">.</span><span class="at">ln</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">""</span><span class="op">;</span></span>
<span id="cb3-1053"><a href="#cb3-1053" aria-hidden="true" tabindex="-1"></a>      xTicks[ti]<span class="op">.</span><span class="at">t</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span>xx)<span class="op">;</span>xTicks[ti]<span class="op">.</span><span class="at">t</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span>base<span class="op">+</span><span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb3-1054"><a href="#cb3-1054" aria-hidden="true" tabindex="-1"></a>      xTicks[ti]<span class="op">.</span><span class="at">t</span><span class="op">.</span><span class="at">textContent</span><span class="op">=</span>x<span class="op">;</span>xTicks[ti]<span class="op">.</span><span class="at">t</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">""</span><span class="op">;</span></span>
<span id="cb3-1055"><a href="#cb3-1055" aria-hidden="true" tabindex="-1"></a>      ti<span class="op">++;</span></span>
<span id="cb3-1056"><a href="#cb3-1056" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-1057"><a href="#cb3-1057" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="op">;</span>ti<span class="op">&lt;</span><span class="dv">30</span><span class="op">;</span>ti<span class="op">++</span>){xTicks[ti]<span class="op">.</span><span class="at">ln</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">"none"</span><span class="op">;</span>xTicks[ti]<span class="op">.</span><span class="at">t</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span><span class="op">=</span><span class="st">"none"</span><span class="op">;</span>}</span>
<span id="cb3-1058"><a href="#cb3-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1059"><a href="#cb3-1059" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rt<span class="op">=</span><span class="fu">rTail</span>(kV<span class="op">,</span>nV<span class="op">,</span>pLV)<span class="op">;</span></span>
<span id="cb3-1060"><a href="#cb3-1060" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> lt<span class="op">=</span><span class="fu">lTail</span>(kV<span class="op">,</span>nV<span class="op">,</span>pHV)<span class="op">;</span></span>
<span id="cb3-1061"><a href="#cb3-1061" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rtOk<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(rt<span class="op">-</span><span class="fl">0.025</span>)<span class="op">&lt;</span><span class="fl">0.003</span><span class="op">;</span></span>
<span id="cb3-1062"><a href="#cb3-1062" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> ltOk<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(lt<span class="op">-</span><span class="fl">0.025</span>)<span class="op">&lt;</span><span class="fl">0.003</span><span class="op">;</span></span>
<span id="cb3-1063"><a href="#cb3-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1064"><a href="#cb3-1064" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> ok<span class="op">=</span><span class="st">"</span><span class="sc">\u2713</span><span class="st"> </span><span class="sc">\u2248</span><span class="st"> 2.5%"</span><span class="op">,</span>no<span class="op">=</span><span class="st">"</span><span class="sc">\u2190</span><span class="st"> cần </span><span class="sc">\u2248</span><span class="st"> 2.5%"</span><span class="op">;</span></span>
<span id="cb3-1065"><a href="#cb3-1065" aria-hidden="true" tabindex="-1"></a>    boxL<span class="op">.</span><span class="at">innerHTML</span><span class="op">=</span><span class="st">'&lt;b style="color:'</span><span class="op">+</span>C1<span class="op">+</span><span class="st">'"&gt;Giới hạn dưới&lt;/b&gt;&lt;br&gt;'</span><span class="op">+</span></span>
<span id="cb3-1066"><a href="#cb3-1066" aria-hidden="true" tabindex="-1"></a>      <span class="st">"P(X </span><span class="sc">\u2265</span><span class="st"> "</span><span class="op">+</span>kV<span class="op">+</span><span class="st">" | p="</span><span class="op">+</span>pLV<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="op">+</span><span class="st">") = "</span><span class="op">+</span></span>
<span id="cb3-1067"><a href="#cb3-1067" aria-hidden="true" tabindex="-1"></a>      <span class="st">'&lt;b style="color:'</span><span class="op">+</span>(rtOk<span class="op">?</span><span class="st">"#16a34a"</span><span class="op">:</span><span class="st">"#d97706"</span>)<span class="op">+</span><span class="st">'"&gt;'</span><span class="op">+</span>(rt<span class="op">*</span><span class="dv">100</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">+</span><span class="st">"%&lt;/b&gt; "</span><span class="op">+</span></span>
<span id="cb3-1068"><a href="#cb3-1068" aria-hidden="true" tabindex="-1"></a>      <span class="st">'&lt;span style="color:'</span><span class="op">+</span>(rtOk<span class="op">?</span><span class="st">"#16a34a"</span><span class="op">:</span><span class="st">"#d97706"</span>)<span class="op">+</span><span class="st">'"&gt;'</span><span class="op">+</span>(rtOk<span class="op">?</span>ok<span class="op">:</span>no)<span class="op">+</span><span class="st">"&lt;/span&gt;"</span><span class="op">;</span></span>
<span id="cb3-1069"><a href="#cb3-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1070"><a href="#cb3-1070" aria-hidden="true" tabindex="-1"></a>    boxR<span class="op">.</span><span class="at">innerHTML</span><span class="op">=</span><span class="st">'&lt;b style="color:'</span><span class="op">+</span>C3<span class="op">+</span><span class="st">'"&gt;Giới hạn trên&lt;/b&gt;&lt;br&gt;'</span><span class="op">+</span></span>
<span id="cb3-1071"><a href="#cb3-1071" aria-hidden="true" tabindex="-1"></a>      <span class="st">"P(X </span><span class="sc">\u2264</span><span class="st"> "</span><span class="op">+</span>kV<span class="op">+</span><span class="st">" | p="</span><span class="op">+</span>pHV<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="op">+</span><span class="st">") = "</span><span class="op">+</span></span>
<span id="cb3-1072"><a href="#cb3-1072" aria-hidden="true" tabindex="-1"></a>      <span class="st">'&lt;b style="color:'</span><span class="op">+</span>(ltOk<span class="op">?</span><span class="st">"#16a34a"</span><span class="op">:</span><span class="st">"#d97706"</span>)<span class="op">+</span><span class="st">'"&gt;'</span><span class="op">+</span>(lt<span class="op">*</span><span class="dv">100</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">+</span><span class="st">"%&lt;/b&gt; "</span><span class="op">+</span></span>
<span id="cb3-1073"><a href="#cb3-1073" aria-hidden="true" tabindex="-1"></a>      <span class="st">'&lt;span style="color:'</span><span class="op">+</span>(ltOk<span class="op">?</span><span class="st">"#16a34a"</span><span class="op">:</span><span class="st">"#d97706"</span>)<span class="op">+</span><span class="st">'"&gt;'</span><span class="op">+</span>(ltOk<span class="op">?</span>ok<span class="op">:</span>no)<span class="op">+</span><span class="st">"&lt;/span&gt;"</span><span class="op">;</span></span>
<span id="cb3-1074"><a href="#cb3-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1075"><a href="#cb3-1075" aria-hidden="true" tabindex="-1"></a>    wrapper<span class="op">.</span><span class="at">value</span><span class="op">=</span>{<span class="dt">n</span><span class="op">:</span>nV<span class="op">,</span><span class="dt">k</span><span class="op">:</span>kV<span class="op">,</span><span class="dt">pL</span><span class="op">:</span>pLV<span class="op">,</span><span class="dt">pH</span><span class="op">:</span>pHV<span class="op">,</span><span class="dt">pHat</span><span class="op">:</span>pH<span class="op">,</span>rt<span class="op">,</span>lt}<span class="op">;</span></span>
<span id="cb3-1076"><a href="#cb3-1076" aria-hidden="true" tabindex="-1"></a>    wrapper<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">Event</span>(<span class="st">"input"</span><span class="op">,</span>{<span class="dt">bubbles</span><span class="op">:</span><span class="kw">true</span>}))<span class="op">;</span></span>
<span id="cb3-1077"><a href="#cb3-1077" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-1078"><a href="#cb3-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1079"><a href="#cb3-1079" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-1080"><a href="#cb3-1080" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 5. EVENTS</span></span>
<span id="cb3-1081"><a href="#cb3-1081" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-1082"><a href="#cb3-1082" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">schedule</span>(){<span class="fu">cancelAnimationFrame</span>(rafId)<span class="op">;</span>rafId<span class="op">=</span><span class="fu">requestAnimationFrame</span>(render)<span class="op">;</span>}</span>
<span id="cb3-1083"><a href="#cb3-1083" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">const</span> s <span class="kw">of</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(S))s<span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span>schedule)<span class="op">;</span></span>
<span id="cb3-1084"><a href="#cb3-1084" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb3-1085"><a href="#cb3-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1086"><a href="#cb3-1086" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="at">dispose</span><span class="op">=</span>()<span class="kw">=&gt;</span>{</span>
<span id="cb3-1087"><a href="#cb3-1087" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cancelAnimationFrame</span>(rafId)<span class="op">;</span></span>
<span id="cb3-1088"><a href="#cb3-1088" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">const</span> s <span class="kw">of</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(S))s<span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"input"</span><span class="op">,</span>schedule)<span class="op">;</span></span>
<span id="cb3-1089"><a href="#cb3-1089" aria-hidden="true" tabindex="-1"></a>    lcCache<span class="op">.</span><span class="fu">clear</span>()<span class="op">;</span></span>
<span id="cb3-1090"><a href="#cb3-1090" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb3-1091"><a href="#cb3-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1092"><a href="#cb3-1092" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> wrapper<span class="op">;</span></span>
<span id="cb3-1093"><a href="#cb3-1093" aria-hidden="true" tabindex="-1"></a>})()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">binom.test</span>(<span class="dv">31</span>, <span class="dv">50</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Exact binomial test

data:  31 and 50
number of successes = 31, number of trials = 50, p-value = 0.1189
alternative hypothesis: true probability of success is not equal to 0.5
95 percent confidence interval:
 0.4717492 0.7534989
sample estimates:
probability of success 
                  0.62 </code></pre>
</div>
</div>
<p><span class="math inline">\(\mathbb{P}(X \ge x | p_L) = 0.025\)</span></p>
<p><span class="math inline">\(\mathbb{P}(X \le x | p_U) = 0.025\)</span></p>


</section>
</section>

</main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxudmlld29mIGJpbm9taWFsX2Rpc3QgPSAoKCkgPT4ge1xuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbiAgLy8gMS4gTUFUSFxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbiAgY29uc3QgbGNDYWNoZSA9IG5ldyBNYXAoKTtcbiAgZnVuY3Rpb24gbGMobixrKXtcbiAgICBpZihrPDB8fGs+bilyZXR1cm4gLUluZmluaXR5O1xuICAgIGlmKGs+bi1rKWs9bi1rO1xuICAgIGNvbnN0IGtleT0objw8MTIpfGs7XG4gICAgaWYobGNDYWNoZS5oYXMoa2V5KSlyZXR1cm4gbGNDYWNoZS5nZXQoa2V5KTtcbiAgICBsZXQgcj0wO2ZvcihsZXQgaT0wO2k8aztpKyspcis9TWF0aC5sb2cobi1pKS1NYXRoLmxvZyhpKzEpO1xuICAgIGxjQ2FjaGUuc2V0KGtleSxyKTtyZXR1cm4gcjtcbiAgfVxuICBmdW5jdGlvbiBwbWYoeCxuLHApe1xuICAgIGlmKHg8MHx8eD5uKXJldHVybiAwO1xuICAgIGlmKHA8PTApcmV0dXJuIHg9PT0wPzE6MDtcbiAgICBpZihwPj0xKXJldHVybiB4PT09bj8xOjA7XG4gICAgcmV0dXJuIE1hdGguZXhwKGxjKG4seCkreCpNYXRoLmxvZyhwKSsobi14KSpNYXRoLmxvZygxLXApKTtcbiAgfVxuXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxuICAvLyAyLiBXUkFQUEVSICsgU1RZTEVcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXG4gIGNvbnN0IHdyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICB3cmFwcGVyLnN0eWxlLmNzc1RleHQgPSBgXG4gICAgZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbjthbGlnbi1pdGVtczpjZW50ZXI7XG4gICAgZm9udC1mYW1pbHk6LWFwcGxlLXN5c3RlbSxCbGlua01hY1N5c3RlbUZvbnQsXCJTZWdvZSBVSVwiLFJvYm90byxzYW5zLXNlcmlmO1xuICAgIHdpZHRoOjEwMCU7bWF4LXdpZHRoOjkwMHB4O21hcmdpbjowIGF1dG87XG4gIGA7XG5cbiAgY29uc3Qgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3R5bGVcIik7XG4gIHN0eWxlLnRleHRDb250ZW50ID0gYFxuICAgIC5iZC1zbGlkZXJ7cG9zaXRpb246cmVsYXRpdmU7aGVpZ2h0OjhweDtib3JkZXItcmFkaXVzOjRweDtiYWNrZ3JvdW5kOiNlMmU4ZjA7fVxuICAgIC5iZC1zbGlkZXItZmlsbHtwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0OjA7dG9wOjA7aGVpZ2h0OjEwMCU7Ym9yZGVyLXJhZGl1czo0cHg7dHJhbnNpdGlvbjp3aWR0aCAwLjA0czt9XG4gICAgLmJkLXNsaWRlciBpbnB1dFt0eXBlPXJhbmdlXXtcbiAgICAgIHBvc2l0aW9uOmFic29sdXRlO3RvcDowO2xlZnQ6MDt3aWR0aDoxMDAlO2hlaWdodDoxMDAlO1xuICAgICAgLXdlYmtpdC1hcHBlYXJhbmNlOm5vbmU7YXBwZWFyYW5jZTpub25lO2JhY2tncm91bmQ6dHJhbnNwYXJlbnQ7XG4gICAgICBjdXJzb3I6cG9pbnRlcjttYXJnaW46MDtwYWRkaW5nOjA7XG4gICAgfVxuICAgIC5iZC1zbGlkZXIgaW5wdXRbdHlwZT1yYW5nZV06Oi13ZWJraXQtc2xpZGVyLXRodW1ie1xuICAgICAgLXdlYmtpdC1hcHBlYXJhbmNlOm5vbmU7YXBwZWFyYW5jZTpub25lO1xuICAgICAgd2lkdGg6MjBweDtoZWlnaHQ6MjBweDtib3JkZXItcmFkaXVzOjUwJTtcbiAgICAgIGJvcmRlcjozcHggc29saWQgI2ZmZjtib3gtc2hhZG93OjAgMXB4IDVweCByZ2JhKDAsMCwwLDAuMjgpO1xuICAgICAgY3Vyc29yOnBvaW50ZXI7bWFyZ2luLXRvcDotNnB4O2JhY2tncm91bmQ6IzQ3NTU2OTtcbiAgICB9XG4gICAgLmJkLXNsaWRlciBpbnB1dFt0eXBlPXJhbmdlXTo6LW1vei1yYW5nZS10aHVtYntcbiAgICAgIHdpZHRoOjE0cHg7aGVpZ2h0OjE0cHg7Ym9yZGVyLXJhZGl1czo1MCU7XG4gICAgICBib3JkZXI6M3B4IHNvbGlkICNmZmY7Ym94LXNoYWRvdzowIDFweCA1cHggcmdiYSgwLDAsMCwwLjI4KTtcbiAgICAgIGN1cnNvcjpwb2ludGVyO2JhY2tncm91bmQ6IzQ3NTU2OTtcbiAgICB9XG4gICAgLmJkLXNsaWRlciBpbnB1dFt0eXBlPXJhbmdlXTo6LXdlYmtpdC1zbGlkZXItcnVubmFibGUtdHJhY2t7aGVpZ2h0OjhweDtiYWNrZ3JvdW5kOnRyYW5zcGFyZW50O31cbiAgICAuYmQtc2xpZGVyIGlucHV0W3R5cGU9cmFuZ2VdOjotbW96LXJhbmdlLXRyYWNre2hlaWdodDo4cHg7YmFja2dyb3VuZDp0cmFuc3BhcmVudDt9XG4gICAgLmJkLXNsaWRlci1kYXJrIGlucHV0W3R5cGU9cmFuZ2VdOjotd2Via2l0LXNsaWRlci10aHVtYntiYWNrZ3JvdW5kOiMxZTI5M2I7fVxuICAgIC5iZC1zbGlkZXItZGFyayBpbnB1dFt0eXBlPXJhbmdlXTo6LW1vei1yYW5nZS10aHVtYntiYWNrZ3JvdW5kOiMxZTI5M2I7fVxuICAgIC5iZC1zbGlkZXItYmx1ZSBpbnB1dFt0eXBlPXJhbmdlXTo6LXdlYmtpdC1zbGlkZXItdGh1bWJ7YmFja2dyb3VuZDojM2I4MmY2O31cbiAgICAuYmQtc2xpZGVyLWJsdWUgaW5wdXRbdHlwZT1yYW5nZV06Oi1tb3otcmFuZ2UtdGh1bWJ7YmFja2dyb3VuZDojM2I4MmY2O31cbiAgYDtcbiAgd3JhcHBlci5hcHBlbmRDaGlsZChzdHlsZSk7XG5cbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXG4gIC8vIDMuIFNMSURFUlNcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXG4gIGZ1bmN0aW9uIGNyZWF0ZVNsaWRlcihsYWJlbCwgbWluLCBtYXgsIHN0ZXAsIHZhbCwgY29sb3IsIGNscykge1xuICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgcm93LnN0eWxlLmNzc1RleHQgPSBcImRpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47ZmxleDoxO21pbi13aWR0aDoxNDBweDtcIjtcblxuICAgIGNvbnN0IGhlYWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGhlYWQuc3R5bGUuY3NzVGV4dCA9IFwiZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO2FsaWduLWl0ZW1zOmJhc2VsaW5lO21hcmdpbi1ib3R0b206NXB4O1wiO1xuXG4gICAgY29uc3QgbGJsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgbGJsLnN0eWxlLmNzc1RleHQgPSBcImZvbnQtc2l6ZToxMnB4O2ZvbnQtd2VpZ2h0OjYwMDtjb2xvcjojNjQ3NDhiO2xldHRlci1zcGFjaW5nOjAuM3B4O3RleHQtdHJhbnNmb3JtOnVwcGVyY2FzZTtcIjtcbiAgICBsYmwudGV4dENvbnRlbnQgPSBsYWJlbDtcblxuICAgIGNvbnN0IHZhbFNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICB2YWxTcGFuLnN0eWxlLmNzc1RleHQgPSBgZm9udC1zaXplOjE4cHg7Zm9udC13ZWlnaHQ6ODAwO2NvbG9yOiR7Y29sb3J9O2ZvbnQtdmFyaWFudC1udW1lcmljOnRhYnVsYXItbnVtcztmb250LWZhbWlseTpcIlNGIE1vbm9cIixTRk1vbm8tUmVndWxhcixNZW5sbyxDb25zb2xhcyxtb25vc3BhY2U7YDtcbiAgICB2YWxTcGFuLnRleHRDb250ZW50ID0gc3RlcCA8IDEgPyBOdW1iZXIodmFsKS50b0ZpeGVkKDIpIDogdmFsO1xuXG4gICAgaGVhZC5hcHBlbmRDaGlsZChsYmwpOyBoZWFkLmFwcGVuZENoaWxkKHZhbFNwYW4pO1xuXG4gICAgY29uc3QgdHJhY2sgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHRyYWNrLmNsYXNzTmFtZSA9IFwiYmQtc2xpZGVyIGJkLXNsaWRlci1cIiArIGNscztcblxuICAgIGNvbnN0IGZpbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGZpbGwuY2xhc3NOYW1lID0gXCJiZC1zbGlkZXItZmlsbFwiO1xuICAgIGZpbGwuc3R5bGUuYmFja2dyb3VuZCA9IGNvbG9yO1xuICAgIGZpbGwuc3R5bGUud2lkdGggPSAoKHZhbCAtIG1pbikgLyAobWF4IC0gbWluKSkgKiAxMDAgKyBcIiVcIjtcbiAgICB0cmFjay5hcHBlbmRDaGlsZChmaWxsKTtcblxuICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuICAgIGlucHV0LnR5cGUgPSBcInJhbmdlXCI7IGlucHV0Lm1pbiA9IG1pbjsgaW5wdXQubWF4ID0gbWF4O1xuICAgIGlucHV0LnN0ZXAgPSBzdGVwOyBpbnB1dC52YWx1ZSA9IHZhbDtcbiAgICB0cmFjay5hcHBlbmRDaGlsZChpbnB1dCk7XG5cbiAgICByb3cuYXBwZW5kQ2hpbGQoaGVhZCk7IHJvdy5hcHBlbmRDaGlsZCh0cmFjayk7XG5cbiAgICByZXR1cm4geyBlbDogcm93LCBpbnB1dCwgdmFsU3BhbiwgZmlsbCxcbiAgICAgIHZhbCgpIHsgcmV0dXJuICtpbnB1dC52YWx1ZTsgfSxcbiAgICAgIHN5bmMoKSB7XG4gICAgICAgIGNvbnN0IHYgPSAraW5wdXQudmFsdWU7XG4gICAgICAgIHZhbFNwYW4udGV4dENvbnRlbnQgPSBzdGVwIDwgMSA/IHYudG9GaXhlZCgyKSA6IFN0cmluZyh2KTtcbiAgICAgICAgZmlsbC5zdHlsZS53aWR0aCA9ICgodiAtIG1pbikgLyAobWF4IC0gbWluKSkgKiAxMDAgKyBcIiVcIjtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgY29uc3QgU0wgPSB7fTtcbiAgU0wubiA9IGNyZWF0ZVNsaWRlcihcIm4gKHRyaWFscylcIiwgMSwgMTAwLCAxLCAyMCwgXCIjMWUyOTNiXCIsIFwiZGFya1wiKTtcbiAgU0wucCA9IGNyZWF0ZVNsaWRlcihcInAgKHN1Y2Nlc3MgcHJvYmFiaWxpdHkpXCIsIDAuMDEsIDAuOTksIDAuMDEsIDAuNTAsIFwiIzNiODJmNlwiLCBcImJsdWVcIik7XG5cbiAgY29uc3QgY3RybFJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gIGN0cmxSb3cuc3R5bGUuY3NzVGV4dCA9IFwiZGlzcGxheTpmbGV4O2dhcDoyOHB4O3dpZHRoOjEwMCU7bWFyZ2luLWJvdHRvbToxNHB4O3BhZGRpbmctYm90dG9tOjE0cHg7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI2UyZThmMDtcIjtcbiAgY3RybFJvdy5hcHBlbmRDaGlsZChTTC5uLmVsKTsgY3RybFJvdy5hcHBlbmRDaGlsZChTTC5wLmVsKTtcbiAgd3JhcHBlci5hcHBlbmRDaGlsZChjdHJsUm93KTtcblxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbiAgLy8gNC4gU1ZHIENIQVJUIChwcmUtYWxsb2NhdGVkIHBvb2xzKVxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbiAgY29uc3QgTlMgPSBcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCI7XG4gIGNvbnN0IFcgPSA3NjAsIEggPSAzODA7XG4gIGNvbnN0IG1nID0ge3Q6MTYsIHI6MjAsIGI6NDgsIGw6NTZ9O1xuICBjb25zdCBjdyA9IFctbWcubC1tZy5yLCBjaCA9IEgtbWcudC1tZy5iO1xuXG4gIGNvbnN0IHN2ZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhOUyxcInN2Z1wiKTtcbiAgc3ZnLnNldEF0dHJpYnV0ZShcInZpZXdCb3hcIixgMCAwICR7V30gJHtIfWApO1xuICBzdmcuc3R5bGUuY3NzVGV4dCA9IGB3aWR0aDoxMDAlO21heC13aWR0aDoke1d9cHg7YmFja2dyb3VuZDojZmFmYmZjO2JvcmRlci1yYWRpdXM6MTBweDtib3JkZXI6MXB4IHNvbGlkICNlMmU4ZjA7YDtcblxuICBmdW5jdGlvbiBlbCh0YWcsYSl7Y29uc3QgZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoTlMsdGFnKTtpZihhKWZvcihjb25zdFtrLHZdb2YgT2JqZWN0LmVudHJpZXMoYSkpZS5zZXRBdHRyaWJ1dGUoayx2KTtyZXR1cm4gZTt9XG5cbiAgLy8gR3JpZFxuICBjb25zdCBncmlkTGluZXM9W107XG4gIGZvcihsZXQgaT0wO2k8PTQ7aSsrKXtjb25zdCBsPWVsKFwibGluZVwiLHtzdHJva2U6XCIjZTJlOGYwXCIsXCJzdHJva2Utd2lkdGhcIjpcIjAuN1wifSk7c3ZnLmFwcGVuZENoaWxkKGwpO2dyaWRMaW5lcy5wdXNoKGwpO31cblxuICAvLyBZIGxhYmVsc1xuICBjb25zdCB5TGFiZWxzPVtdO1xuICBmb3IobGV0IGk9MDtpPD00O2krKyl7Y29uc3QgdD1lbChcInRleHRcIix7XCJ0ZXh0LWFuY2hvclwiOlwiZW5kXCIsZmlsbDpcIiM5NGEzYjhcIixcImZvbnQtc2l6ZVwiOlwiMTBcIixcImZvbnQtZmFtaWx5XCI6XCInU0YgTW9ubycsbW9ub3NwYWNlXCJ9KTtzdmcuYXBwZW5kQ2hpbGQodCk7eUxhYmVscy5wdXNoKHQpO31cblxuICAvLyBCYXIgcG9vbFxuICBjb25zdCBQT09MPTEwMTtcbiAgY29uc3QgYmFycz1bXTtcbiAgZm9yKGxldCBpPTA7aTxQT09MO2krKyl7XG4gICAgY29uc3Qgcj1lbChcInJlY3RcIix7cng6XCIyXCIsZmlsbDpcIiMzYjgyZjZcIixzdHJva2U6XCIjMjU2M2ViXCIsXCJzdHJva2Utd2lkdGhcIjpcIjAuNVwifSk7XG4gICAgci5zdHlsZS5kaXNwbGF5PVwibm9uZVwiO3N2Zy5hcHBlbmRDaGlsZChyKTtiYXJzLnB1c2gocik7XG4gIH1cblxuICAvLyBIb3ZlciBiYXJcbiAgY29uc3QgaG92ZXJCYXI9ZWwoXCJyZWN0XCIse3J4OlwiMlwiLGZpbGw6XCJyZ2JhKDU5LDEzMCwyNDYsMC4zNSlcIixzdHJva2U6XCIjMWQ0ZWQ4XCIsXCJzdHJva2Utd2lkdGhcIjpcIjFcIn0pO1xuICBob3ZlckJhci5zdHlsZS5kaXNwbGF5PVwibm9uZVwiO3N2Zy5hcHBlbmRDaGlsZChob3ZlckJhcik7XG5cbiAgLy8gWCBheGlzXG4gIGNvbnN0IHhBeGlzTGluZT1lbChcImxpbmVcIix7c3Ryb2tlOlwiIzk0YTNiOFwifSk7c3ZnLmFwcGVuZENoaWxkKHhBeGlzTGluZSk7XG4gIGNvbnN0IHhUaWNrcz1bXTtcbiAgZm9yKGxldCBpPTA7aTwzMDtpKyspe1xuICAgIGNvbnN0IGxuPWVsKFwibGluZVwiLHtzdHJva2U6XCIjOTRhM2I4XCIseTI6XCI1XCJ9KTtsbi5zdHlsZS5kaXNwbGF5PVwibm9uZVwiO3N2Zy5hcHBlbmRDaGlsZChsbik7XG4gICAgY29uc3QgdD1lbChcInRleHRcIix7XCJ0ZXh0LWFuY2hvclwiOlwibWlkZGxlXCIsZmlsbDpcIiM2NDc0OGJcIixcImZvbnQtc2l6ZVwiOlwiMTFcIixcImZvbnQtZmFtaWx5XCI6XCInU0YgTW9ubycsbW9ub3NwYWNlXCIsZHk6XCIxNlwifSk7dC5zdHlsZS5kaXNwbGF5PVwibm9uZVwiO3N2Zy5hcHBlbmRDaGlsZCh0KTtcbiAgICB4VGlja3MucHVzaCh7bG4sdH0pO1xuICB9XG4gIGNvbnN0IHhMYWJlbD1lbChcInRleHRcIix7XCJ0ZXh0LWFuY2hvclwiOlwibWlkZGxlXCIsZmlsbDpcIiM2NDc0OGJcIixcImZvbnQtc2l6ZVwiOlwiMTJcIix5OlN0cmluZyhILTQpfSk7XG4gIHhMYWJlbC50ZXh0Q29udGVudD1cIk51bWJlciBvZiBzdWNjZXNzZXMgKGspXCI7c3ZnLmFwcGVuZENoaWxkKHhMYWJlbCk7XG5cbiAgLy8gWSBheGlzXG4gIHN2Zy5hcHBlbmRDaGlsZChlbChcImxpbmVcIix7eDE6U3RyaW5nKG1nLmwpLHgyOlN0cmluZyhtZy5sKSx5MTpTdHJpbmcobWcudCkseTI6U3RyaW5nKG1nLnQrY2gpLHN0cm9rZTpcIiM5NGEzYjhcIn0pKTtcbiAgY29uc3QgeUxhYmVsPWVsKFwidGV4dFwiLHtcInRleHQtYW5jaG9yXCI6XCJtaWRkbGVcIixmaWxsOlwiIzY0NzQ4YlwiLFwiZm9udC1zaXplXCI6XCIxMlwiLHg6XCIxNFwiLHk6U3RyaW5nKG1nLnQrY2gvMiksdHJhbnNmb3JtOmByb3RhdGUoLTkwLDE0LCR7bWcudCtjaC8yfSlgfSk7XG4gIHlMYWJlbC50ZXh0Q29udGVudD1cIlAoWCA9IGspXCI7c3ZnLmFwcGVuZENoaWxkKHlMYWJlbCk7XG5cbiAgLy8gVG9vbHRpcFxuICBjb25zdCB0aXBHPWVsKFwiZ1wiKTt0aXBHLnN0eWxlLmRpc3BsYXk9XCJub25lXCI7XG4gIGNvbnN0IHRpcFJlY3Q9ZWwoXCJyZWN0XCIse3J4OlwiNlwiLGZpbGw6XCIjMWUyOTNiXCIsb3BhY2l0eTpcIjAuOTJcIn0pO1xuICBjb25zdCB0aXBUZXh0MT1lbChcInRleHRcIix7ZmlsbDpcIiNmZmZcIixcImZvbnQtc2l6ZVwiOlwiMTJcIixcImZvbnQtd2VpZ2h0XCI6XCI3MDBcIixcImZvbnQtZmFtaWx5XCI6XCInU0YgTW9ubycsbW9ub3NwYWNlXCJ9KTtcbiAgY29uc3QgdGlwVGV4dDI9ZWwoXCJ0ZXh0XCIse2ZpbGw6XCIjOTRhM2I4XCIsXCJmb250LXNpemVcIjpcIjExXCIsXCJmb250LWZhbWlseVwiOlwiJ1NGIE1vbm8nLG1vbm9zcGFjZVwifSk7XG4gIHRpcEcuYXBwZW5kQ2hpbGQodGlwUmVjdCk7dGlwRy5hcHBlbmRDaGlsZCh0aXBUZXh0MSk7dGlwRy5hcHBlbmRDaGlsZCh0aXBUZXh0Mik7XG4gIHN2Zy5hcHBlbmRDaGlsZCh0aXBHKTtcblxuICB3cmFwcGVyLmFwcGVuZENoaWxkKHN2Zyk7XG5cbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXG4gIC8vIDUuIFJFTkRFUlxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbiAgbGV0IGN1ckRhdGE9W10sIGN1ck1heFk9MCwgaG92ZXJJZHg9LTE7XG4gIGxldCBzeCwgc3ksIGJhclcsIGJhc2VsaW5lO1xuXG4gIGZ1bmN0aW9uIHJlbmRlcigpe1xuICAgIGNvbnN0IG5WPVNMLm4udmFsKCksIHBWPVNMLnAudmFsKCk7XG4gICAgY29uc3QgbWVhbj1uVipwViwgc2Q9TWF0aC5zcXJ0KG5WKnBWKigxLXBWKSk7XG5cbiAgICBsZXQgbG9YPU1hdGgubWF4KDAsTWF0aC5mbG9vcihtZWFuLTQqc2QtMSkpO1xuICAgIGxldCBoaVg9TWF0aC5taW4oblYsTWF0aC5jZWlsKG1lYW4rNCpzZCsxKSk7XG4gICAgaWYoblY8PTMwKXtsb1g9MDtoaVg9blY7fVxuXG4gICAgY3VyRGF0YT1bXTtjdXJNYXhZPTA7XG4gICAgZm9yKGxldCB4PWxvWDt4PD1oaVg7eCsrKXtcbiAgICAgIGNvbnN0IHA9cG1mKHgsblYscFYpO1xuICAgICAgY3VyRGF0YS5wdXNoKHt4LHByb2I6cH0pO1xuICAgICAgaWYocD5jdXJNYXhZKWN1ck1heFk9cDtcbiAgICB9XG4gICAgY3VyTWF4WSo9MS4xNTtcbiAgICBpZihjdXJNYXhZPDFlLTkpY3VyTWF4WT0wLjAxO1xuXG4gICAgY29uc3QgY250PWhpWC1sb1grMTtcbiAgICBzeD14PT5tZy5sKygoeC1sb1gpLyhoaVgtbG9YKSkqY3c7XG4gICAgc3k9eT0+bWcudCtjaC0oeS9jdXJNYXhZKSpjaDtcbiAgICBiYXJXPU1hdGgubWF4KDIsTWF0aC5taW4oMjgsY3cvY250KjAuNzUpKTtcbiAgICBiYXNlbGluZT1zeSgwKTtcblxuICAgIC8vIEdyaWQgKyBZIGxhYmVsc1xuICAgIGZvcihsZXQgaT0wO2k8PTQ7aSsrKXtcbiAgICAgIGNvbnN0IHY9KGN1ck1heFkvNCkqaSx5eT1zeSh2KTtcbiAgICAgIGdyaWRMaW5lc1tpXS5zZXRBdHRyaWJ1dGUoXCJ4MVwiLG1nLmwpO2dyaWRMaW5lc1tpXS5zZXRBdHRyaWJ1dGUoXCJ4MlwiLFctbWcucik7XG4gICAgICBncmlkTGluZXNbaV0uc2V0QXR0cmlidXRlKFwieTFcIix5eSk7Z3JpZExpbmVzW2ldLnNldEF0dHJpYnV0ZShcInkyXCIseXkpO1xuICAgICAgeUxhYmVsc1tpXS5zZXRBdHRyaWJ1dGUoXCJ4XCIsbWcubC04KTt5TGFiZWxzW2ldLnNldEF0dHJpYnV0ZShcInlcIix5eSs0KTtcbiAgICAgIHlMYWJlbHNbaV0udGV4dENvbnRlbnQ9di50b0ZpeGVkKHY8MC4wMT80OjMpO1xuICAgIH1cblxuICAgIC8vIEJhcnNcbiAgICBmb3IobGV0IGk9MDtpPFBPT0w7aSsrKXtcbiAgICAgIGlmKGk8Y3VyRGF0YS5sZW5ndGgpe1xuICAgICAgICBjb25zdCBkPWN1ckRhdGFbaV07XG4gICAgICAgIGNvbnN0IGJ4PXN4KGQueCktYmFyVy8yLGJ5PXN5KGQucHJvYik7XG4gICAgICAgIGJhcnNbaV0uc2V0QXR0cmlidXRlKFwieFwiLGJ4KTtiYXJzW2ldLnNldEF0dHJpYnV0ZShcInlcIixieSk7XG4gICAgICAgIGJhcnNbaV0uc2V0QXR0cmlidXRlKFwid2lkdGhcIixiYXJXKTtiYXJzW2ldLnNldEF0dHJpYnV0ZShcImhlaWdodFwiLE1hdGgubWF4KDAsYmFzZWxpbmUtYnkpKTtcbiAgICAgICAgYmFyc1tpXS5zdHlsZS5kaXNwbGF5PVwiXCI7XG4gICAgICB9ZWxzZXtiYXJzW2ldLnN0eWxlLmRpc3BsYXk9XCJub25lXCI7fVxuICAgIH1cblxuICAgIC8vIFggYXhpc1xuICAgIHhBeGlzTGluZS5zZXRBdHRyaWJ1dGUoXCJ4MVwiLG1nLmwpO3hBeGlzTGluZS5zZXRBdHRyaWJ1dGUoXCJ4MlwiLFctbWcucik7XG4gICAgeEF4aXNMaW5lLnNldEF0dHJpYnV0ZShcInkxXCIsYmFzZWxpbmUpO3hBeGlzTGluZS5zZXRBdHRyaWJ1dGUoXCJ5MlwiLGJhc2VsaW5lKTtcbiAgICB4TGFiZWwuc2V0QXR0cmlidXRlKFwieFwiLG1nLmwrY3cvMik7XG5cbiAgICBjb25zdCBzcGFuPWhpWC1sb1g7XG4gICAgY29uc3QgdHM9c3Bhbj44MD8xMDpzcGFuPjQwPzU6c3Bhbj4yMD8yOjE7XG4gICAgbGV0IHRpPTA7XG4gICAgZm9yKGxldCB4PU1hdGguY2VpbChsb1gvdHMpKnRzO3g8PWhpWCYmdGk8MzA7eCs9dHMpe1xuICAgICAgY29uc3QgeHg9c3goeCk7XG4gICAgICB4VGlja3NbdGldLmxuLnNldEF0dHJpYnV0ZShcIngxXCIseHgpO3hUaWNrc1t0aV0ubG4uc2V0QXR0cmlidXRlKFwieDJcIix4eCk7XG4gICAgICB4VGlja3NbdGldLmxuLnNldEF0dHJpYnV0ZShcInkxXCIsYmFzZWxpbmUpO3hUaWNrc1t0aV0ubG4uc2V0QXR0cmlidXRlKFwieTJcIixiYXNlbGluZSs1KTtcbiAgICAgIHhUaWNrc1t0aV0ubG4uc3R5bGUuZGlzcGxheT1cIlwiO1xuICAgICAgeFRpY2tzW3RpXS50LnNldEF0dHJpYnV0ZShcInhcIix4eCk7eFRpY2tzW3RpXS50LnNldEF0dHJpYnV0ZShcInlcIixiYXNlbGluZSs1KTtcbiAgICAgIHhUaWNrc1t0aV0udC50ZXh0Q29udGVudD14O3hUaWNrc1t0aV0udC5zdHlsZS5kaXNwbGF5PVwiXCI7XG4gICAgICB0aSsrO1xuICAgIH1cbiAgICBmb3IoO3RpPDMwO3RpKyspe3hUaWNrc1t0aV0ubG4uc3R5bGUuZGlzcGxheT1cIm5vbmVcIjt4VGlja3NbdGldLnQuc3R5bGUuZGlzcGxheT1cIm5vbmVcIjt9XG5cbiAgICB1cGRhdGVIb3ZlcigpO1xuICAgIHdyYXBwZXIudmFsdWU9e246blYscDpwVn07XG4gICAgd3JhcHBlci5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudChcImlucHV0XCIse2J1YmJsZXM6dHJ1ZX0pKTtcbiAgfVxuXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxuICAvLyA2LiBIT1ZFUlxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbiAgZnVuY3Rpb24gdXBkYXRlSG92ZXIoKXtcbiAgICBpZihob3ZlcklkeDwwfHxob3ZlcklkeD49Y3VyRGF0YS5sZW5ndGgpe1xuICAgICAgaG92ZXJCYXIuc3R5bGUuZGlzcGxheT1cIm5vbmVcIjt0aXBHLnN0eWxlLmRpc3BsYXk9XCJub25lXCI7cmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBkPWN1ckRhdGFbaG92ZXJJZHhdO1xuICAgIGNvbnN0IGJ4PXN4KGQueCktYmFyVy8yLGJ5PXN5KGQucHJvYik7XG4gICAgaG92ZXJCYXIuc2V0QXR0cmlidXRlKFwieFwiLGJ4LTEpO2hvdmVyQmFyLnNldEF0dHJpYnV0ZShcInlcIixieS0xKTtcbiAgICBob3ZlckJhci5zZXRBdHRyaWJ1dGUoXCJ3aWR0aFwiLGJhclcrMik7aG92ZXJCYXIuc2V0QXR0cmlidXRlKFwiaGVpZ2h0XCIsTWF0aC5tYXgoMCxiYXNlbGluZS1ieSkrMik7XG4gICAgaG92ZXJCYXIuc3R5bGUuZGlzcGxheT1cIlwiO1xuXG4gICAgY29uc3QgdDE9XCJrID0gXCIrZC54O1xuICAgIGNvbnN0IHQyPVwiUCA9IFwiK2QucHJvYi50b0ZpeGVkKDUpO1xuICAgIGNvbnN0IHR3PU1hdGgubWF4KHQxLmxlbmd0aCx0Mi5sZW5ndGgpKjcuNSsxNjtcbiAgICBjb25zdCB0aD00MDtcbiAgICBsZXQgdHg9c3goZC54KStiYXJXLzIrOCx0eT1ieS0xMDtcbiAgICBpZih0eCt0dz5XLW1nLnIpdHg9c3goZC54KS1iYXJXLzItdHctODtcbiAgICBpZih0eTxtZy50KXR5PW1nLnQrNDtcblxuICAgIHRpcFJlY3Quc2V0QXR0cmlidXRlKFwieFwiLHR4KTt0aXBSZWN0LnNldEF0dHJpYnV0ZShcInlcIix0eSk7XG4gICAgdGlwUmVjdC5zZXRBdHRyaWJ1dGUoXCJ3aWR0aFwiLHR3KTt0aXBSZWN0LnNldEF0dHJpYnV0ZShcImhlaWdodFwiLHRoKTtcbiAgICB0aXBUZXh0MS5zZXRBdHRyaWJ1dGUoXCJ4XCIsdHgrOCk7dGlwVGV4dDEuc2V0QXR0cmlidXRlKFwieVwiLHR5KzE2KTt0aXBUZXh0MS50ZXh0Q29udGVudD10MTtcbiAgICB0aXBUZXh0Mi5zZXRBdHRyaWJ1dGUoXCJ4XCIsdHgrOCk7dGlwVGV4dDIuc2V0QXR0cmlidXRlKFwieVwiLHR5KzMyKTt0aXBUZXh0Mi50ZXh0Q29udGVudD10MjtcbiAgICB0aXBHLnN0eWxlLmRpc3BsYXk9XCJcIjtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uTW92ZShlKXtcbiAgICBjb25zdCByZWN0PXN2Zy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBjb25zdCBtb3VzZVg9KGUuY2xpZW50WC1yZWN0LmxlZnQpKihXL3JlY3Qud2lkdGgpO1xuICAgIGlmKG1vdXNlWDxtZy5sfHxtb3VzZVg+Vy1tZy5yfHwhY3VyRGF0YS5sZW5ndGgpe2hvdmVySWR4PS0xO3VwZGF0ZUhvdmVyKCk7cmV0dXJuO31cbiAgICBsZXQgYmVzdD0tMSxiZXN0RD1JbmZpbml0eTtcbiAgICBmb3IobGV0IGk9MDtpPGN1ckRhdGEubGVuZ3RoO2krKyl7XG4gICAgICBjb25zdCBkaXN0PU1hdGguYWJzKHN4KGN1ckRhdGFbaV0ueCktbW91c2VYKTtcbiAgICAgIGlmKGRpc3Q8YmVzdEQpe2Jlc3REPWRpc3Q7YmVzdD1pO31cbiAgICB9XG4gICAgaWYoYmVzdEQ+YmFyVyoxLjIpYmVzdD0tMTtcbiAgICBpZihiZXN0IT09aG92ZXJJZHgpe2hvdmVySWR4PWJlc3Q7dXBkYXRlSG92ZXIoKTt9XG4gIH1cbiAgZnVuY3Rpb24gb25MZWF2ZSgpe2hvdmVySWR4PS0xO3VwZGF0ZUhvdmVyKCk7fVxuXG4gIHN2Zy5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsb25Nb3ZlKTtcbiAgc3ZnLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIsb25MZWF2ZSk7XG5cbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXG4gIC8vIDcuIEVWRU5UU1xuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbiAgbGV0IHJhZklkPTA7XG4gIGZ1bmN0aW9uIHNjaGVkdWxlKCl7Y2FuY2VsQW5pbWF0aW9uRnJhbWUocmFmSWQpO3JhZklkPXJlcXVlc3RBbmltYXRpb25GcmFtZShyZW5kZXIpO31cbiAgZnVuY3Rpb24gb25OKCl7U0wubi5zeW5jKCk7c2NoZWR1bGUoKTt9XG4gIGZ1bmN0aW9uIG9uUCgpe1NMLnAuc3luYygpO3NjaGVkdWxlKCk7fVxuICBTTC5uLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLG9uTik7XG4gIFNMLnAuaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsb25QKTtcblxuICByZW5kZXIoKTtcblxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbiAgLy8gOC4gQ0xFQU5VUFxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbiAgaW52YWxpZGF0aW9uLnRoZW4oKCk9PntcbiAgICBjYW5jZWxBbmltYXRpb25GcmFtZShyYWZJZCk7XG4gICAgU0wubi5pbnB1dC5yZW1vdmVFdmVudExpc3RlbmVyKFwiaW5wdXRcIixvbk4pO1xuICAgIFNMLnAuaW5wdXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsb25QKTtcbiAgICBzdmcucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLG9uTW92ZSk7XG4gICAgc3ZnLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIsb25MZWF2ZSk7XG4gICAgbGNDYWNoZS5jbGVhcigpO2N1ckRhdGE9W107XG4gIH0pO1xuXG4gIHdyYXBwZXIudmFsdWU9e307XG4gIHJldHVybiB3cmFwcGVyO1xufSkoKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG52aWV3b2YgZ2FsdG9uX2JvYXJkID0gKCgpID0+IHtcbiAgY29uc3QgVEFVID0gNi4yODMxODUzMDc7XG5cbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXG4gIC8vIDEuIFdSQVBQRVIgKyBTVFlMRVxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbiAgY29uc3Qgd3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gIHdyYXBwZXIuc3R5bGUuY3NzVGV4dCA9IGBcbiAgICBkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1uO2FsaWduLWl0ZW1zOmNlbnRlcjtcbiAgICBmb250LWZhbWlseTotYXBwbGUtc3lzdGVtLEJsaW5rTWFjU3lzdGVtRm9udCxcIlNlZ29lIFVJXCIsUm9ib3RvLHNhbnMtc2VyaWY7XG4gICAgd2lkdGg6MTAwJTttYXgtd2lkdGg6NTIwcHg7bWFyZ2luOjAgYXV0bztcbiAgYDtcblxuICBjb25zdCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzdHlsZVwiKTtcbiAgc3R5bGUudGV4dENvbnRlbnQgPSBgXG4gICAgLmd0LXNsaWRlcntwb3NpdGlvbjpyZWxhdGl2ZTtoZWlnaHQ6OHB4O2JvcmRlci1yYWRpdXM6NHB4O2JhY2tncm91bmQ6I2UyZThmMDt9XG4gICAgLmd0LXNsaWRlci1maWxse3Bvc2l0aW9uOmFic29sdXRlO2xlZnQ6MDt0b3A6MDtoZWlnaHQ6MTAwJTtib3JkZXItcmFkaXVzOjRweDt0cmFuc2l0aW9uOndpZHRoIDAuMDRzO31cbiAgICAuZ3Qtc2xpZGVyIGlucHV0W3R5cGU9cmFuZ2Vde1xuICAgICAgcG9zaXRpb246YWJzb2x1dGU7dG9wOjA7bGVmdDowO3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7XG4gICAgICAtd2Via2l0LWFwcGVhcmFuY2U6bm9uZTthcHBlYXJhbmNlOm5vbmU7YmFja2dyb3VuZDp0cmFuc3BhcmVudDtcbiAgICAgIGN1cnNvcjpwb2ludGVyO21hcmdpbjowO3BhZGRpbmc6MDtcbiAgICB9XG4gICAgLmd0LXNsaWRlciBpbnB1dFt0eXBlPXJhbmdlXTo6LXdlYmtpdC1zbGlkZXItdGh1bWJ7XG4gICAgICAtd2Via2l0LWFwcGVhcmFuY2U6bm9uZTthcHBlYXJhbmNlOm5vbmU7XG4gICAgICB3aWR0aDoyMHB4O2hlaWdodDoyMHB4O2JvcmRlci1yYWRpdXM6NTAlO1xuICAgICAgYm9yZGVyOjNweCBzb2xpZCAjZmZmO2JveC1zaGFkb3c6MCAxcHggNXB4IHJnYmEoMCwwLDAsMC4yOCk7XG4gICAgICBjdXJzb3I6cG9pbnRlcjttYXJnaW4tdG9wOi02cHg7YmFja2dyb3VuZDojNDc1NTY5O1xuICAgIH1cbiAgICAuZ3Qtc2xpZGVyIGlucHV0W3R5cGU9cmFuZ2VdOjotbW96LXJhbmdlLXRodW1ie1xuICAgICAgd2lkdGg6MTRweDtoZWlnaHQ6MTRweDtib3JkZXItcmFkaXVzOjUwJTtcbiAgICAgIGJvcmRlcjozcHggc29saWQgI2ZmZjtib3gtc2hhZG93OjAgMXB4IDVweCByZ2JhKDAsMCwwLDAuMjgpO1xuICAgICAgY3Vyc29yOnBvaW50ZXI7YmFja2dyb3VuZDojNDc1NTY5O1xuICAgIH1cbiAgICAuZ3Qtc2xpZGVyIGlucHV0W3R5cGU9cmFuZ2VdOjotd2Via2l0LXNsaWRlci1ydW5uYWJsZS10cmFja3toZWlnaHQ6OHB4O2JhY2tncm91bmQ6dHJhbnNwYXJlbnQ7fVxuICAgIC5ndC1zbGlkZXIgaW5wdXRbdHlwZT1yYW5nZV06Oi1tb3otcmFuZ2UtdHJhY2t7aGVpZ2h0OjhweDtiYWNrZ3JvdW5kOnRyYW5zcGFyZW50O31cbiAgICAuZ3Qtc2xpZGVyLWJsdWUgaW5wdXRbdHlwZT1yYW5nZV06Oi13ZWJraXQtc2xpZGVyLXRodW1ie2JhY2tncm91bmQ6IzNiODJmNjt9XG4gICAgLmd0LXNsaWRlci1ibHVlIGlucHV0W3R5cGU9cmFuZ2VdOjotbW96LXJhbmdlLXRodW1ie2JhY2tncm91bmQ6IzNiODJmNjt9XG4gICAgLmd0LXNsaWRlci1hbWJlciBpbnB1dFt0eXBlPXJhbmdlXTo6LXdlYmtpdC1zbGlkZXItdGh1bWJ7YmFja2dyb3VuZDojZDk3NzA2O31cbiAgICAuZ3Qtc2xpZGVyLWFtYmVyIGlucHV0W3R5cGU9cmFuZ2VdOjotbW96LXJhbmdlLXRodW1ie2JhY2tncm91bmQ6I2Q5NzcwNjt9XG4gICAgLmd0LXNsaWRlci1kYXJrIGlucHV0W3R5cGU9cmFuZ2VdOjotd2Via2l0LXNsaWRlci10aHVtYntiYWNrZ3JvdW5kOiMxZTI5M2I7fVxuICAgIC5ndC1zbGlkZXItZGFyayBpbnB1dFt0eXBlPXJhbmdlXTo6LW1vei1yYW5nZS10aHVtYntiYWNrZ3JvdW5kOiMxZTI5M2I7fVxuICAgIC5ndC1idG57XG4gICAgICBmbGV4OjE7cGFkZGluZzo4cHggMDtib3JkZXItcmFkaXVzOjhweDtib3JkZXI6MXB4IHNvbGlkICNkMWQ1ZGI7XG4gICAgICBiYWNrZ3JvdW5kOiNmZmY7Y29sb3I6IzM3NDE1MTtmb250LXNpemU6MTNweDtmb250LXdlaWdodDo2MDA7XG4gICAgICBjdXJzb3I6cG9pbnRlcjt0cmFuc2l0aW9uOmJhY2tncm91bmQgMC4xcztmb250LWZhbWlseTppbmhlcml0O3RleHQtYWxpZ246Y2VudGVyO1xuICAgIH1cbiAgICAuZ3QtYnRuOmhvdmVye2JhY2tncm91bmQ6I2YzZjRmNjt9XG4gICAgLmd0LWJ0bi1nb3tiYWNrZ3JvdW5kOiMzYjgyZjY7Y29sb3I6I2ZmZjtib3JkZXItY29sb3I6IzI1NjNlYjt9XG4gICAgLmd0LWJ0bi1nbzpob3ZlcntiYWNrZ3JvdW5kOiMyNTYzZWI7Y29sb3I6I2ZmZjt9XG4gICAgLmd0LWJ0bi1yZXNldHtiYWNrZ3JvdW5kOiNmZWYyZjI7Y29sb3I6I2RjMjYyNjtib3JkZXItY29sb3I6I2ZlY2FjYTt9XG4gICAgLmd0LWJ0bi1yZXNldDpob3ZlcntiYWNrZ3JvdW5kOiNmZWUyZTI7Y29sb3I6I2RjMjYyNjt9XG4gIGA7XG4gIHdyYXBwZXIuYXBwZW5kQ2hpbGQoc3R5bGUpO1xuXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxuICAvLyAyLiBTTElERVIgRkFDVE9SWVxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbiAgZnVuY3Rpb24gY3JlYXRlU2xpZGVyKGxhYmVsLCBtaW4sIG1heCwgc3RlcCwgdmFsLCBjb2xvciwgY2xzKSB7XG4gICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICByb3cuc3R5bGUuY3NzVGV4dCA9IFwiZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbjtmbGV4OjE7bWluLXdpZHRoOjEyMHB4O1wiO1xuXG4gICAgY29uc3QgaGVhZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgaGVhZC5zdHlsZS5jc3NUZXh0ID0gXCJkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47YWxpZ24taXRlbXM6YmFzZWxpbmU7bWFyZ2luLWJvdHRvbTo1cHg7XCI7XG5cbiAgICBjb25zdCBsYmwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICBsYmwuc3R5bGUuY3NzVGV4dCA9IFwiZm9udC1zaXplOjExcHg7Zm9udC13ZWlnaHQ6NjAwO2NvbG9yOiM2NDc0OGI7bGV0dGVyLXNwYWNpbmc6MC4zcHg7dGV4dC10cmFuc2Zvcm06dXBwZXJjYXNlO1wiO1xuICAgIGxibC50ZXh0Q29udGVudCA9IGxhYmVsO1xuXG4gICAgY29uc3QgdmFsU3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICAgIHZhbFNwYW4uc3R5bGUuY3NzVGV4dCA9IGBmb250LXNpemU6MTdweDtmb250LXdlaWdodDo4MDA7Y29sb3I6JHtjb2xvcn07Zm9udC12YXJpYW50LW51bWVyaWM6dGFidWxhci1udW1zO2ZvbnQtZmFtaWx5OlwiU0YgTW9ub1wiLFNGTW9uby1SZWd1bGFyLE1lbmxvLENvbnNvbGFzLG1vbm9zcGFjZTtgO1xuICAgIHZhbFNwYW4udGV4dENvbnRlbnQgPSBzdGVwIDwgMSA/IE51bWJlcih2YWwpLnRvRml4ZWQoMSkgOiB2YWw7XG5cbiAgICBoZWFkLmFwcGVuZENoaWxkKGxibCk7IGhlYWQuYXBwZW5kQ2hpbGQodmFsU3Bhbik7XG5cbiAgICBjb25zdCB0cmFjayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgdHJhY2suY2xhc3NOYW1lID0gXCJndC1zbGlkZXIgZ3Qtc2xpZGVyLVwiICsgY2xzO1xuXG4gICAgY29uc3QgZmlsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgZmlsbC5jbGFzc05hbWUgPSBcImd0LXNsaWRlci1maWxsXCI7XG4gICAgZmlsbC5zdHlsZS5iYWNrZ3JvdW5kID0gY29sb3I7XG4gICAgZmlsbC5zdHlsZS53aWR0aCA9ICgodmFsIC0gbWluKSAvIChtYXggLSBtaW4pKSAqIDEwMCArIFwiJVwiO1xuICAgIHRyYWNrLmFwcGVuZENoaWxkKGZpbGwpO1xuXG4gICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG4gICAgaW5wdXQudHlwZSA9IFwicmFuZ2VcIjsgaW5wdXQubWluID0gbWluOyBpbnB1dC5tYXggPSBtYXg7XG4gICAgaW5wdXQuc3RlcCA9IHN0ZXA7IGlucHV0LnZhbHVlID0gdmFsO1xuICAgIHRyYWNrLmFwcGVuZENoaWxkKGlucHV0KTtcblxuICAgIHJvdy5hcHBlbmRDaGlsZChoZWFkKTsgcm93LmFwcGVuZENoaWxkKHRyYWNrKTtcblxuICAgIHJldHVybiB7IGVsOiByb3csIGlucHV0LCB2YWxTcGFuLCBmaWxsLFxuICAgICAgdmFsKCkgeyByZXR1cm4gK2lucHV0LnZhbHVlOyB9LFxuICAgICAgc3luYygpIHtcbiAgICAgICAgY29uc3QgdiA9ICtpbnB1dC52YWx1ZTtcbiAgICAgICAgdmFsU3Bhbi50ZXh0Q29udGVudCA9IHN0ZXAgPCAxID8gdi50b0ZpeGVkKDEpIDogU3RyaW5nKHYpO1xuICAgICAgICBmaWxsLnN0eWxlLndpZHRoID0gKCh2IC0gbWluKSAvIChtYXggLSBtaW4pKSAqIDEwMCArIFwiJVwiO1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBjb25zdCBTTCA9IHt9O1xuICBTTC5yb3dzICA9IGNyZWF0ZVNsaWRlcihcIlBlZyByb3dzXCIsIDgsIDIwLCAxLCAxMCwgXCIjMWUyOTNiXCIsIFwiZGFya1wiKTtcbiAgU0wudG90YWwgPSBjcmVhdGVTbGlkZXIoXCJCYWxsc1wiLCA1MCwgODAwLCAxMCwgMjAwLCBcIiMzYjgyZjZcIiwgXCJibHVlXCIpO1xuICBTTC5zcGVlZCA9IGNyZWF0ZVNsaWRlcihcIlNwZWVkXCIsIDAuNSwgMywgMC4xLCAyLjAsIFwiI2Q5NzcwNlwiLCBcImFtYmVyXCIpO1xuXG4gIC8vIFJvdyAxOiBwZWcgcm93cyArIGJhbGxzICgyIGVxdWFsIGNvbHVtbnMpXG4gIGNvbnN0IHIxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgcjEuc3R5bGUuY3NzVGV4dCA9IFwiZGlzcGxheTpmbGV4O2dhcDoyNHB4O3dpZHRoOjEwMCU7bWFyZ2luLWJvdHRvbToxMHB4O1wiO1xuICByMS5hcHBlbmRDaGlsZChTTC5yb3dzLmVsKTsgcjEuYXBwZW5kQ2hpbGQoU0wudG90YWwuZWwpO1xuICB3cmFwcGVyLmFwcGVuZENoaWxkKHIxKTtcblxuICAvLyBSb3cgMjogc3BlZWQg4oCUIG1hdGNoZWQgdG8gZmlyc3QgY29sdW1uIHdpZHRoIHZpYSBzYW1lIGZsZXggbGF5b3V0ICsgaW52aXNpYmxlIHNwYWNlclxuICBjb25zdCByMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gIHIyLnN0eWxlLmNzc1RleHQgPSBcImRpc3BsYXk6ZmxleDtnYXA6MjRweDt3aWR0aDoxMDAlO21hcmdpbi1ib3R0b206MTJweDtcIjtcbiAgcjIuYXBwZW5kQ2hpbGQoU0wuc3BlZWQuZWwpO1xuICBjb25zdCBzcGFjZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICBzcGFjZXIuc3R5bGUuY3NzVGV4dCA9IFwiZmxleDoxO21pbi13aWR0aDoxMjBweDtcIjtcbiAgcjIuYXBwZW5kQ2hpbGQoc3BhY2VyKTtcbiAgd3JhcHBlci5hcHBlbmRDaGlsZChyMik7XG5cbiAgLy8gUm93IDM6IGJ1dHRvbnNcbiAgY29uc3QgcjMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICByMy5zdHlsZS5jc3NUZXh0ID0gXCJkaXNwbGF5OmZsZXg7Z2FwOjEwcHg7d2lkdGg6MTAwJTttYXJnaW4tYm90dG9tOjE0cHg7cGFkZGluZy1ib3R0b206MTRweDtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjZTJlOGYwO1wiO1xuICBjb25zdCBidG5HbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gIGJ0bkdvLmNsYXNzTmFtZSA9IFwiZ3QtYnRuIGd0LWJ0bi1nb1wiOyBidG5Hby50ZXh0Q29udGVudCA9IFwi4pa2ICBTdGFydFwiO1xuICBjb25zdCBidG5TdG9wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgYnRuU3RvcC5jbGFzc05hbWUgPSBcImd0LWJ0blwiOyBidG5TdG9wLnRleHRDb250ZW50ID0gXCLij7ggIFBhdXNlXCI7XG4gIGNvbnN0IGJ0blJlc2V0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgYnRuUmVzZXQuY2xhc3NOYW1lID0gXCJndC1idG4gZ3QtYnRuLXJlc2V0XCI7IGJ0blJlc2V0LnRleHRDb250ZW50ID0gXCLihrogIFJlc2V0XCI7XG4gIHIzLmFwcGVuZENoaWxkKGJ0bkdvKTsgcjMuYXBwZW5kQ2hpbGQoYnRuU3RvcCk7IHIzLmFwcGVuZENoaWxkKGJ0blJlc2V0KTtcbiAgd3JhcHBlci5hcHBlbmRDaGlsZChyMyk7XG5cbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXG4gIC8vIDMuIFJFU1BPTlNJVkUgQ0FOVkFTIChmaXRzIG9uIHNjcmVlbilcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXG4gIGNvbnN0IExXID0gMzgwLCBMSCA9IDYwMCwgQVNQRUNUID0gTEggLyBMVztcblxuICBjb25zdCBjYW52YXNXcmFwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgLy8gbWF4LWhlaWdodDogNjJ2aCBlbnN1cmVzIHRoZSBjYW52YXMgKyBjb250cm9scyBhbGwgZml0IG9uIG9uZSBzY3JlZW5cbiAgLy8gd2lkdGggZGVyaXZlZCBmcm9tIGhlaWdodCB0byBtYWludGFpbiBhc3BlY3QgcmF0aW9cbiAgY2FudmFzV3JhcC5zdHlsZS5jc3NUZXh0ID0gYFxuICAgIHdpZHRoOjEwMCU7XG4gICAgZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpjZW50ZXI7XG4gIGA7XG5cbiAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgY2FudmFzLnN0eWxlLmNzc1RleHQgPSBgXG4gICAgbWF4LWhlaWdodDo2MnZoO1xuICAgIHdpZHRoOmF1dG87XG4gICAgaGVpZ2h0OmF1dG87XG4gICAgYm9yZGVyLXJhZGl1czoxMHB4O1xuICAgIGJvcmRlcjoxcHggc29saWQgI2UyZThmMDtcbiAgICBkaXNwbGF5OmJsb2NrO1xuICBgO1xuICBjYW52YXNXcmFwLmFwcGVuZENoaWxkKGNhbnZhcyk7XG4gIHdyYXBwZXIuYXBwZW5kQ2hpbGQoY2FudmFzV3JhcCk7XG5cbiAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiLCB7IGFscGhhOiBmYWxzZSB9KTtcblxuICBmdW5jdGlvbiByZXNpemVDYW52YXMoKSB7XG4gICAgLy8gRGV0ZXJtaW5lIGF2YWlsYWJsZSBoZWlnaHQ6IDYydmgsIHRoZW4gd2lkdGggZnJvbSBhc3BlY3RcbiAgICBjb25zdCBtYXhIID0gd2luZG93LmlubmVySGVpZ2h0ICogMC42MjtcbiAgICBjb25zdCBtYXhXID0gY2FudmFzV3JhcC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcblxuICAgIC8vIEhlaWdodC1saW1pdGVkOiBkZXJpdmUgd2lkdGggZnJvbSBtYXhIXG4gICAgbGV0IGNzc0ggPSBtYXhIO1xuICAgIGxldCBjc3NXID0gY3NzSCAvIEFTUEVDVDtcblxuICAgIC8vIElmIHRoYXQncyB3aWRlciB0aGFuIGNvbnRhaW5lciwgY2xhbXAgdG8gY29udGFpbmVyXG4gICAgaWYgKGNzc1cgPiBtYXhXKSB7XG4gICAgICBjc3NXID0gbWF4VztcbiAgICAgIGNzc0ggPSBjc3NXICogQVNQRUNUO1xuICAgIH1cblxuICAgIGNvbnN0IGRwciA9IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIHx8IDE7XG4gICAgY2FudmFzLndpZHRoID0gTWF0aC5yb3VuZChjc3NXICogZHByKTtcbiAgICBjYW52YXMuaGVpZ2h0ID0gTWF0aC5yb3VuZChjc3NIICogZHByKTtcbiAgICBjYW52YXMuc3R5bGUud2lkdGggPSBjc3NXICsgXCJweFwiO1xuICAgIGNhbnZhcy5zdHlsZS5oZWlnaHQgPSBjc3NIICsgXCJweFwiO1xuXG4gICAgY3R4LnNldFRyYW5zZm9ybSgoY3NzVyAqIGRwcikgLyBMVywgMCwgMCwgKGNzc1cgKiBkcHIpIC8gTFcsIDAsIDApO1xuICB9XG5cbiAgY29uc3Qgcm8gPSBuZXcgUmVzaXplT2JzZXJ2ZXIocmVzaXplQ2FudmFzKTtcbiAgcm8ub2JzZXJ2ZShjYW52YXNXcmFwKTtcbiAgcmVzaXplQ2FudmFzKCk7XG5cbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXG4gIC8vIDQuIFNJTVVMQVRJT04gU1RBVEVcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXG4gIGxldCBDRkcgPSB7fSwgcGVnR3JpZCA9IFtdLCBTID0ge307XG5cbiAgZnVuY3Rpb24gaW5pdFNpbSgpIHtcbiAgICBjb25zdCByb3dzID0gU0wucm93cy52YWwoKSwgbWF4QmFsbHMgPSBTTC50b3RhbC52YWwoKTtcbiAgICBjb25zdCBwZWdTcGFjaW5nID0gTFcgLyAocm93cyArIDMpO1xuICAgIGNvbnN0IHBlZ1IgPSBwZWdTcGFjaW5nICogMC4xMjtcbiAgICBjb25zdCBiYWxsUiA9IHBlZ1NwYWNpbmcgKiAwLjIzO1xuICAgIGNvbnN0IHJvd0ggPSBwZWdTcGFjaW5nICogMC44NTtcbiAgICBjb25zdCBzdGFydFkgPSA2MDtcbiAgICBjb25zdCBudW1CaW5zID0gcm93cyArIDE7XG4gICAgY29uc3QgYmluVyA9IHBlZ1NwYWNpbmc7XG4gICAgY29uc3QgdG90YWxCaW5XID0gbnVtQmlucyAqIGJpblc7XG4gICAgY29uc3QgYmluc1gwID0gKExXIC0gdG90YWxCaW5XKSAvIDI7XG4gICAgY29uc3Qgd2FsbHNUb3BZID0gc3RhcnRZICsgcm93cyAqIHJvd0ggKyAxNTtcbiAgICBjb25zdCBmbG9vclkgPSBMSCAtIDEwO1xuICAgIGNvbnN0IHN0YWNrU3RlcCA9IGJhbGxSICogMC42O1xuXG4gICAgQ0ZHID0geyByb3dzLCBtYXhCYWxscywgcGVnU3BhY2luZywgcGVnUiwgYmFsbFIsIHJvd0gsIHN0YXJ0WSxcbiAgICAgICAgICAgIG51bUJpbnMsIGJpblcsIHRvdGFsQmluVywgYmluc1gwLCB3YWxsc1RvcFksIGZsb29yWSwgc3RhY2tTdGVwIH07XG5cbiAgICBwZWdHcmlkID0gW107XG4gICAgZm9yIChsZXQgciA9IDA7IHIgPCByb3dzOyByKyspIHtcbiAgICAgIGNvbnN0IG4gPSByKzEsIHJ3ID0gKG4tMSkqcGVnU3BhY2luZywgeDAgPSAoTFctcncpLzI7XG4gICAgICBjb25zdCBhcnIgPSBuZXcgRmxvYXQ2NEFycmF5KG4qMik7XG4gICAgICBjb25zdCB5ID0gc3RhcnRZICsgciAqIHJvd0g7XG4gICAgICBmb3IgKGxldCBwID0gMDsgcCA8IG47IHArKykgeyBhcnJbcCoyXT14MCtwKnBlZ1NwYWNpbmc7IGFycltwKjIrMV09eTsgfVxuICAgICAgcGVnR3JpZC5wdXNoKGFycik7XG4gICAgfVxuXG4gICAgaWYgKFMucG9vbCkgUy5wb29sLmxlbmd0aCA9IDA7XG4gICAgaWYgKFMuYWN0aXZlKSBTLmFjdGl2ZS5sZW5ndGggPSAwO1xuICAgIFMgPSB7IHBvb2w6W10sIGFjdGl2ZTpbXSwgYmluczpuZXcgSW50MzJBcnJheShudW1CaW5zKSxcbiAgICAgICAgICBzcGF3bmVkOjAsIHJ1bm5pbmc6ZmFsc2UsIGRvbmU6ZmFsc2UgfTtcbiAgfVxuXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxuICAvLyA1LiBCQUxMIExPR0lDIChvYmplY3QgcG9vbClcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXG4gIGZ1bmN0aW9uIGFsbG9jQmFsbCgpIHtcbiAgICBpZiAoUy5wb29sLmxlbmd0aCkgcmV0dXJuIFMucG9vbC5wb3AoKTtcbiAgICByZXR1cm4geyBwYXRoWDpuZXcgRmxvYXQ2NEFycmF5KDMwKSwgcGF0aFk6bmV3IEZsb2F0NjRBcnJheSgzMCksXG4gICAgICAgICAgICAgcGF0aExlbjowLHNlZzowLHQ6MCx4OjAseTowLGJpbklkeDowIH07XG4gIH1cblxuICBmdW5jdGlvbiBidWlsZFBhdGgoYikge1xuICAgIGNvbnN0IHtyb3dzLHBlZ1NwYWNpbmcscGVnUixiYWxsUixyb3dILHN0YXJ0WSxiaW5XLGJpbnNYMCx3YWxsc1RvcFksZmxvb3JZfT1DRkc7XG4gICAgbGV0IGlkeD0wLHBpPTA7XG4gICAgYi5wYXRoWFtwaV09TFcvMjsgYi5wYXRoWVtwaV09c3RhcnRZLTIwOyBwaSsrO1xuICAgIGZvcihsZXQgcj0wO3I8cm93cztyKyspe1xuICAgICAgY29uc3Qgbj1yKzEscnc9KG4tMSkqcGVnU3BhY2luZyx4MD0oTFctcncpLzI7XG4gICAgICBjb25zdCBweD14MCtpZHgqcGVnU3BhY2luZyxweT1zdGFydFkrcipyb3dIO1xuICAgICAgY29uc3QgcmlnaHQ9TWF0aC5yYW5kb20oKT4wLjU7XG4gICAgICBiLnBhdGhYW3BpXT1weCsocmlnaHQ/MTotMSkqKHBlZ1IrYmFsbFIpKjAuODU7XG4gICAgICBiLnBhdGhZW3BpXT1weTsgcGkrKztcbiAgICAgIGlmKHJpZ2h0KWlkeCsrO1xuICAgIH1cbiAgICBjb25zdCBjeD1iaW5zWDAraWR4KmJpblcrYmluVy8yO1xuICAgIGIucGF0aFhbcGldPWN4O2IucGF0aFlbcGldPXdhbGxzVG9wWTtwaSsrO1xuICAgIGIucGF0aFhbcGldPWN4O2IucGF0aFlbcGldPWZsb29yWS1iYWxsUjtwaSsrO1xuICAgIGIucGF0aExlbj1waTtiLnNlZz0wO2IudD0wO1xuICAgIGIueD1iLnBhdGhYWzBdO2IueT1iLnBhdGhZWzBdO2IuYmluSWR4PWlkeDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNwYXduKCl7XG4gICAgaWYoUy5zcGF3bmVkPj1DRkcubWF4QmFsbHMpcmV0dXJuO1xuICAgIGNvbnN0IGI9YWxsb2NCYWxsKCk7YnVpbGRQYXRoKGIpO1xuICAgIFMuYWN0aXZlLnB1c2goYik7Uy5zcGF3bmVkKys7XG4gIH1cblxuICBmdW5jdGlvbiB1cGRhdGUoZHQpe1xuICAgIGlmKCFTLnJ1bm5pbmcpcmV0dXJuO1xuICAgIGNvbnN0IHNwZWVkPVNMLnNwZWVkLnZhbCgpO1xuICAgIGlmKFMuc3Bhd25lZDxDRkcubWF4QmFsbHMmJk1hdGgucmFuZG9tKCk8MC4yNSpzcGVlZClzcGF3bigpO1xuICAgIGNvbnN0IG12PTMuMCpzcGVlZCpkdDtcbiAgICBsZXQgd2k9MDtcbiAgICBmb3IobGV0IGk9MDtpPFMuYWN0aXZlLmxlbmd0aDtpKyspe1xuICAgICAgY29uc3QgYj1TLmFjdGl2ZVtpXTtcbiAgICAgIGIudCs9bXY7XG4gICAgICB3aGlsZShiLnQ+PTEmJmIuc2VnPGIucGF0aExlbi0yKXtiLnQtPTE7Yi5zZWcrKzt9XG4gICAgICBpZihiLnQ+PTEmJmIuc2VnPj1iLnBhdGhMZW4tMil7Uy5iaW5zW2IuYmluSWR4XSsrO1MucG9vbC5wdXNoKGIpO2NvbnRpbnVlO31cbiAgICAgIGNvbnN0IHM9Yi5zZWcsdD1iLnQsZWFzZT10KnQ7XG4gICAgICBiLng9Yi5wYXRoWFtzXSsoYi5wYXRoWFtzKzFdLWIucGF0aFhbc10pKnQ7XG4gICAgICBiLnk9Yi5wYXRoWVtzXSsoYi5wYXRoWVtzKzFdLWIucGF0aFlbc10pKmVhc2U7XG4gICAgICBTLmFjdGl2ZVt3aSsrXT1iO1xuICAgIH1cbiAgICBTLmFjdGl2ZS5sZW5ndGg9d2k7XG4gICAgaWYoUy5zcGF3bmVkPj1DRkcubWF4QmFsbHMmJlMuYWN0aXZlLmxlbmd0aD09PTApe1MucnVubmluZz1mYWxzZTtTLmRvbmU9dHJ1ZTt9XG4gIH1cblxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbiAgLy8gNi4gRFJBVyDigJQgRkxBVFxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbiAgZnVuY3Rpb24gZHJhdygpe1xuICAgIGNvbnN0IHtwZWdSLGJhbGxSLG51bUJpbnMsYmluVyx0b3RhbEJpblcsYmluc1gwLHdhbGxzVG9wWSxmbG9vclksc3RhY2tTdGVwfT1DRkc7XG5cbiAgICBjdHguZmlsbFN0eWxlPVwiI2Y4ZjlmYVwiO1xuICAgIGN0eC5maWxsUmVjdCgwLDAsTFcsTEgpO1xuXG4gICAgLy8gUGVnc1xuICAgIGN0eC5maWxsU3R5bGU9XCIjOTRhM2I4XCI7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGZvcihsZXQgcj0wO3I8cGVnR3JpZC5sZW5ndGg7cisrKXtcbiAgICAgIGNvbnN0IGE9cGVnR3JpZFtyXTtcbiAgICAgIGZvcihsZXQgcD0wO3A8YS5sZW5ndGg7cCs9Mil7XG4gICAgICAgIGN0eC5tb3ZlVG8oYVtwXStwZWdSLGFbcCsxXSk7XG4gICAgICAgIGN0eC5hcmMoYVtwXSxhW3ArMV0scGVnUiwwLFRBVSk7XG4gICAgICB9XG4gICAgfVxuICAgIGN0eC5maWxsKCk7XG5cbiAgICAvLyBXYWxscyAmIGZsb29yXG4gICAgY3R4LnN0cm9rZVN0eWxlPVwiI2NiZDVlMVwiO1xuICAgIGN0eC5saW5lV2lkdGg9MS41O1xuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBjdHgubW92ZVRvKGJpbnNYMCxmbG9vclkpO1xuICAgIGN0eC5saW5lVG8oYmluc1gwK3RvdGFsQmluVyxmbG9vclkpO1xuICAgIGZvcihsZXQgaT0wO2k8PW51bUJpbnM7aSsrKXtcbiAgICAgIGNvbnN0IHg9Ymluc1gwK2kqYmluVztcbiAgICAgIGN0eC5tb3ZlVG8oeCx3YWxsc1RvcFkpO2N0eC5saW5lVG8oeCxmbG9vclkpO1xuICAgIH1cbiAgICBjdHguc3Ryb2tlKCk7XG5cbiAgICAvLyBTdGFja2VkIGJhbGxzXG4gICAgY3R4LmZpbGxTdHlsZT1cIiMzYjgyZjZcIjtcbiAgICBjdHguc3Ryb2tlU3R5bGU9XCIjMjU2M2ViXCI7XG4gICAgY3R4LmxpbmVXaWR0aD0wLjc7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGZvcihsZXQgaT0wO2k8bnVtQmlucztpKyspe1xuICAgICAgY29uc3QgY291bnQ9Uy5iaW5zW2ldO1xuICAgICAgaWYoIWNvdW50KWNvbnRpbnVlO1xuICAgICAgY29uc3QgY3g9Ymluc1gwK2kqYmluVytiaW5XLzI7XG4gICAgICBmb3IobGV0IGo9MDtqPGNvdW50O2orKyl7XG4gICAgICAgIGNvbnN0IGN5PWZsb29yWS1iYWxsUi1qKnN0YWNrU3RlcDtcbiAgICAgICAgaWYoY3k8d2FsbHNUb3BZKWJyZWFrO1xuICAgICAgICBjdHgubW92ZVRvKGN4K2JhbGxSLGN5KTtcbiAgICAgICAgY3R4LmFyYyhjeCxjeSxiYWxsUiwwLFRBVSk7XG4gICAgICB9XG4gICAgfVxuICAgIGN0eC5maWxsKCk7XG4gICAgY3R4LnN0cm9rZSgpO1xuXG4gICAgLy8gQWN0aXZlIGJhbGxzXG4gICAgY3R4LmZpbGxTdHlsZT1cIiMzYjgyZjZcIjtcbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgZm9yKGxldCBpPTA7aTxTLmFjdGl2ZS5sZW5ndGg7aSsrKXtcbiAgICAgIGNvbnN0IGI9Uy5hY3RpdmVbaV07XG4gICAgICBjdHgubW92ZVRvKGIueCtiYWxsUixiLnkpO1xuICAgICAgY3R4LmFyYyhiLngsYi55LGJhbGxSLDAsVEFVKTtcbiAgICB9XG4gICAgY3R4LmZpbGwoKTtcblxuICAgIC8vIENvdW50ZXIgcGlsbFxuICAgIGN0eC5mb250PVwiYm9sZCAxMnB4ICdTRiBNb25vJyxTRk1vbm8tUmVndWxhcixNZW5sbyxtb25vc3BhY2VcIjtcbiAgICBjb25zdCB0eHQ9Uy5zcGF3bmVkK1wiIC8gXCIrQ0ZHLm1heEJhbGxzO1xuICAgIGNvbnN0IHR3PWN0eC5tZWFzdXJlVGV4dCh0eHQpLndpZHRoO1xuICAgIGNvbnN0IGJ4PTEyLGJ5PTE0LGJoPTIwLGJwdz10dysxNjtcbiAgICBjdHguZmlsbFN0eWxlPVwicmdiYSgyNTUsMjU1LDI1NSwwLjgpXCI7XG4gICAgY3R4LmJlZ2luUGF0aCgpO2N0eC5yb3VuZFJlY3QoYngsYnksYnB3LGJoLDEwKTtjdHguZmlsbCgpO1xuICAgIGN0eC5zdHJva2VTdHlsZT1cIiNlMmU4ZjBcIjtjdHgubGluZVdpZHRoPTE7XG4gICAgY3R4LmJlZ2luUGF0aCgpO2N0eC5yb3VuZFJlY3QoYngsYnksYnB3LGJoLDEwKTtjdHguc3Ryb2tlKCk7XG4gICAgY3R4LmZpbGxTdHlsZT1cIiMzMzQxNTVcIjtjdHgudGV4dEFsaWduPVwibGVmdFwiO1xuICAgIGN0eC5maWxsVGV4dCh0eHQsYngrOCxieSsxNCk7XG5cbiAgICBpZihTLmRvbmUpe1xuICAgICAgY29uc3QgZD1cIlxcdTI3MTMgQ29tcGxldGVcIjtcbiAgICAgIGNvbnN0IGR3PWN0eC5tZWFzdXJlVGV4dChkKS53aWR0aDtcbiAgICAgIGN0eC5maWxsU3R5bGU9XCJyZ2JhKDI0MCwyNTMsMjQ0LDAuOSlcIjtcbiAgICAgIGN0eC5iZWdpblBhdGgoKTtjdHgucm91bmRSZWN0KGJ4K2Jwdys2LGJ5LGR3KzE2LGJoLDEwKTtjdHguZmlsbCgpO1xuICAgICAgY3R4LnN0cm9rZVN0eWxlPVwiI2JiZjdkMFwiO2N0eC5saW5lV2lkdGg9MTtcbiAgICAgIGN0eC5iZWdpblBhdGgoKTtjdHgucm91bmRSZWN0KGJ4K2Jwdys2LGJ5LGR3KzE2LGJoLDEwKTtjdHguc3Ryb2tlKCk7XG4gICAgICBjdHguZmlsbFN0eWxlPVwiIzE2YTM0YVwiO1xuICAgICAgY3R4LmZpbGxUZXh0KGQsYngrYnB3KzE0LGJ5KzE0KTtcbiAgICB9XG4gIH1cblxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbiAgLy8gNy4gTE9PUFxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbiAgbGV0IGxhc3RUPTAscmFmSWQ9MDtcbiAgZnVuY3Rpb24gdGljayhub3cpe1xuICAgIGNvbnN0IGR0PU1hdGgubWluKChub3ctbGFzdFQpLzEwMDAsMC4wNik7XG4gICAgbGFzdFQ9bm93O3VwZGF0ZShkdCk7ZHJhdygpO1xuICAgIHJhZklkPXJlcXVlc3RBbmltYXRpb25GcmFtZSh0aWNrKTtcbiAgfVxuXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxuICAvLyA4LiBFVkVOVFNcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXG4gIGZ1bmN0aW9uIGZ1bGxSZXNldCgpe1xuICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKHJhZklkKTtpbml0U2ltKCk7XG4gICAgU0wucm93cy5zeW5jKCk7U0wuc3BlZWQuc3luYygpO1NMLnRvdGFsLnN5bmMoKTtcbiAgICBsYXN0VD1wZXJmb3JtYW5jZS5ub3coKTtyYWZJZD1yZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGljayk7XG4gIH1cbiAgZnVuY3Rpb24gb25TdGFydCgpe2lmKFMuZG9uZSlmdWxsUmVzZXQoKTtTLnJ1bm5pbmc9dHJ1ZTt9XG4gIGZ1bmN0aW9uIG9uU3RvcCgpe1MucnVubmluZz1mYWxzZTt9XG4gIGZ1bmN0aW9uIG9uUm93cygpe1NMLnJvd3Muc3luYygpO2lmKCFTLnJ1bm5pbmcpZnVsbFJlc2V0KCk7fVxuICBmdW5jdGlvbiBvblRvdGFsKCl7U0wudG90YWwuc3luYygpO2lmKCFTLnJ1bm5pbmcpZnVsbFJlc2V0KCk7fVxuICBmdW5jdGlvbiBvblNwZWVkKCl7U0wuc3BlZWQuc3luYygpO31cblxuICBidG5Hby5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIixvblN0YXJ0KTtcbiAgYnRuU3RvcC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIixvblN0b3ApO1xuICBidG5SZXNldC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIixmdWxsUmVzZXQpO1xuICBTTC5yb3dzLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLG9uUm93cyk7XG4gIFNMLnRvdGFsLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLG9uVG90YWwpO1xuICBTTC5zcGVlZC5pbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIixvblNwZWVkKTtcblxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbiAgLy8gOS4gSU5JVCAmIENMRUFOVVBcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXG4gIGluaXRTaW0oKTtsYXN0VD1wZXJmb3JtYW5jZS5ub3coKTtyYWZJZD1yZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGljayk7XG5cbiAgaW52YWxpZGF0aW9uLnRoZW4oKCk9PntcbiAgICBjYW5jZWxBbmltYXRpb25GcmFtZShyYWZJZCk7XG4gICAgcm8uZGlzY29ubmVjdCgpO1xuICAgIGJ0bkdvLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLG9uU3RhcnQpO1xuICAgIGJ0blN0b3AucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsb25TdG9wKTtcbiAgICBidG5SZXNldC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIixmdWxsUmVzZXQpO1xuICAgIFNMLnJvd3MuaW5wdXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsb25Sb3dzKTtcbiAgICBTTC50b3RhbC5pbnB1dC5yZW1vdmVFdmVudExpc3RlbmVyKFwiaW5wdXRcIixvblRvdGFsKTtcbiAgICBTTC5zcGVlZC5pbnB1dC5yZW1vdmVFdmVudExpc3RlbmVyKFwiaW5wdXRcIixvblNwZWVkKTtcbiAgICBpZihTLnBvb2wpUy5wb29sLmxlbmd0aD0wO1xuICAgIGlmKFMuYWN0aXZlKVMuYWN0aXZlLmxlbmd0aD0wO1xuICAgIFM9e307Q0ZHPXt9O3BlZ0dyaWQ9W107XG4gIH0pO1xuXG4gIHdyYXBwZXIudmFsdWU9e307XG4gIHJldHVybiB3cmFwcGVyO1xufSkoKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG52aWV3b2YgYmlub21pYWxfY2kgPSAoKCkgPT4ge1xuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbiAgLy8gMS4gTUFUSFxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbiAgY29uc3QgbGNDYWNoZSA9IG5ldyBNYXAoKTtcbiAgZnVuY3Rpb24gbGMobixrKXtcbiAgICBpZihrPDB8fGs+bilyZXR1cm4tSW5maW5pdHk7aWYoaz5uLWspaz1uLWs7XG4gICAgY29uc3Qga2V5PShuPDwxMil8aztpZihsY0NhY2hlLmhhcyhrZXkpKXJldHVybiBsY0NhY2hlLmdldChrZXkpO1xuICAgIGxldCByPTA7Zm9yKGxldCBpPTA7aTxrO2krKylyKz1NYXRoLmxvZyhuLWkpLU1hdGgubG9nKGkrMSk7XG4gICAgbGNDYWNoZS5zZXQoa2V5LHIpO3JldHVybiByO1xuICB9XG4gIGZ1bmN0aW9uIHBtZih4LG4scCl7XG4gICAgaWYoeDwwfHx4Pm4pcmV0dXJuIDA7aWYocDw9MClyZXR1cm4geD09PTA/MTowO2lmKHA+PTEpcmV0dXJuIHg9PT1uPzE6MDtcbiAgICByZXR1cm4gTWF0aC5leHAobGMobix4KSt4Kk1hdGgubG9nKHApKyhuLXgpKk1hdGgubG9nKDEtcCkpO1xuICB9XG4gIGZ1bmN0aW9uIHJUYWlsKGssbixwKXtsZXQgcz0wO2ZvcihsZXQgeD1rO3g8PW47eCsrKXMrPXBtZih4LG4scCk7cmV0dXJuIHM7fVxuICBmdW5jdGlvbiBsVGFpbChrLG4scCl7bGV0IHM9MDtmb3IobGV0IHg9MDt4PD1rO3grKylzKz1wbWYoeCxuLHApO3JldHVybiBzO31cblxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbiAgLy8gMi4gRE9NXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxuICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgd3JhcHBlci5zdHlsZS5jc3NUZXh0ID0gYFxuICAgIGRpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47YWxpZ24taXRlbXM6Y2VudGVyO1xuICAgIGZvbnQtZmFtaWx5Oi1hcHBsZS1zeXN0ZW0sQmxpbmtNYWNTeXN0ZW1Gb250LFwiU2Vnb2UgVUlcIixSb2JvdG8sc2Fucy1zZXJpZjtcbiAgICB3aWR0aDoxMDAlO21heC13aWR0aDo5MDBweDttYXJnaW46MCBhdXRvO1xuICBgO1xuXG4gIC8vIOKUgOKUgCBHbG9iYWwgdGh1bWIgc3R5bGUg4pSA4pSAXG4gIGNvbnN0IHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInN0eWxlXCIpO1xuICBzdHlsZS50ZXh0Q29udGVudCA9IGBcbiAgICAuY2ktc2xpZGVyIHsgcG9zaXRpb246cmVsYXRpdmU7IGhlaWdodDo4cHg7IGJvcmRlci1yYWRpdXM6NHB4OyBiYWNrZ3JvdW5kOiNlMmU4ZjA7IH1cbiAgICAuY2ktc2xpZGVyLWZpbGwgeyBwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0OjA7dG9wOjA7aGVpZ2h0OjEwMCU7Ym9yZGVyLXJhZGl1czo0cHg7dHJhbnNpdGlvbjp3aWR0aCAwLjA0czsgfVxuICAgIC5jaS1zbGlkZXIgaW5wdXRbdHlwZT1yYW5nZV0ge1xuICAgICAgcG9zaXRpb246YWJzb2x1dGU7dG9wOjA7bGVmdDowO3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7XG4gICAgICAtd2Via2l0LWFwcGVhcmFuY2U6bm9uZTthcHBlYXJhbmNlOm5vbmU7YmFja2dyb3VuZDp0cmFuc3BhcmVudDtcbiAgICAgIGN1cnNvcjpwb2ludGVyO21hcmdpbjowO3BhZGRpbmc6MDtcbiAgICB9XG4gICAgLmNpLXNsaWRlciBpbnB1dFt0eXBlPXJhbmdlXTo6LXdlYmtpdC1zbGlkZXItdGh1bWIge1xuICAgICAgLXdlYmtpdC1hcHBlYXJhbmNlOm5vbmU7YXBwZWFyYW5jZTpub25lO1xuICAgICAgd2lkdGg6MjBweDtoZWlnaHQ6MjBweDtib3JkZXItcmFkaXVzOjUwJTtcbiAgICAgIGJvcmRlcjozcHggc29saWQgI2ZmZjtib3gtc2hhZG93OjAgMXB4IDVweCByZ2JhKDAsMCwwLDAuMyk7XG4gICAgICBjdXJzb3I6cG9pbnRlcjttYXJnaW4tdG9wOi02cHg7XG4gICAgfVxuICAgIC5jaS1zbGlkZXIgaW5wdXRbdHlwZT1yYW5nZV06Oi1tb3otcmFuZ2UtdGh1bWIge1xuICAgICAgd2lkdGg6MTRweDtoZWlnaHQ6MTRweDtib3JkZXItcmFkaXVzOjUwJTtcbiAgICAgIGJvcmRlcjozcHggc29saWQgI2ZmZjtib3gtc2hhZG93OjAgMXB4IDVweCByZ2JhKDAsMCwwLDAuMyk7XG4gICAgICBjdXJzb3I6cG9pbnRlcjtcbiAgICB9XG4gICAgLmNpLXNsaWRlciBpbnB1dFt0eXBlPXJhbmdlXTo6LXdlYmtpdC1zbGlkZXItcnVubmFibGUtdHJhY2t7aGVpZ2h0OjhweDtiYWNrZ3JvdW5kOnRyYW5zcGFyZW50O31cbiAgICAuY2ktc2xpZGVyIGlucHV0W3R5cGU9cmFuZ2VdOjotbW96LXJhbmdlLXRyYWNre2hlaWdodDo4cHg7YmFja2dyb3VuZDp0cmFuc3BhcmVudDt9XG4gICAgLmNpLXNsaWRlci1kYXJrIGlucHV0W3R5cGU9cmFuZ2VdOjotd2Via2l0LXNsaWRlci10aHVtYntiYWNrZ3JvdW5kOiMxZTI5M2I7fVxuICAgIC5jaS1zbGlkZXItZGFyayBpbnB1dFt0eXBlPXJhbmdlXTo6LW1vei1yYW5nZS10aHVtYntiYWNrZ3JvdW5kOiMxZTI5M2I7fVxuICAgIC5jaS1zbGlkZXItZ3JheSBpbnB1dFt0eXBlPXJhbmdlXTo6LXdlYmtpdC1zbGlkZXItdGh1bWJ7YmFja2dyb3VuZDojNDc1NTY5O31cbiAgICAuY2ktc2xpZGVyLWdyYXkgaW5wdXRbdHlwZT1yYW5nZV06Oi1tb3otcmFuZ2UtdGh1bWJ7YmFja2dyb3VuZDojNDc1NTY5O31cbiAgICAuY2ktc2xpZGVyLXJlZCBpbnB1dFt0eXBlPXJhbmdlXTo6LXdlYmtpdC1zbGlkZXItdGh1bWJ7YmFja2dyb3VuZDojZGMyNjI2O31cbiAgICAuY2ktc2xpZGVyLXJlZCBpbnB1dFt0eXBlPXJhbmdlXTo6LW1vei1yYW5nZS10aHVtYntiYWNrZ3JvdW5kOiNkYzI2MjY7fVxuICAgIC5jaS1zbGlkZXItdGVhbCBpbnB1dFt0eXBlPXJhbmdlXTo6LXdlYmtpdC1zbGlkZXItdGh1bWJ7YmFja2dyb3VuZDojMDg5MWIyO31cbiAgICAuY2ktc2xpZGVyLXRlYWwgaW5wdXRbdHlwZT1yYW5nZV06Oi1tb3otcmFuZ2UtdGh1bWJ7YmFja2dyb3VuZDojMDg5MWIyO31cbiAgYDtcbiAgd3JhcHBlci5hcHBlbmRDaGlsZChzdHlsZSk7XG5cbiAgLy8g4pSA4pSAIFNsaWRlciBmYWN0b3J5IOKUgOKUgFxuICBmdW5jdGlvbiBjcmVhdGVTbGlkZXIobGFiZWwsIG1pbiwgbWF4LCBzdGVwLCB2YWwsIGNvbG9yLCB0cmFja0NvbG9yLCBjbHMpIHtcbiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHJvdy5zdHlsZS5jc3NUZXh0ID0gXCJkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1uO2ZsZXg6MTttaW4td2lkdGg6MTgwcHg7XCI7XG5cbiAgICBjb25zdCBoZWFkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBoZWFkLnN0eWxlLmNzc1RleHQgPSBcImRpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjthbGlnbi1pdGVtczpiYXNlbGluZTttYXJnaW4tYm90dG9tOjVweDtcIjtcblxuICAgIGNvbnN0IGxibCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICAgIGxibC5zdHlsZS5jc3NUZXh0ID0gXCJmb250LXNpemU6MTJweDtmb250LXdlaWdodDo2MDA7Y29sb3I6IzY0NzQ4YjtsZXR0ZXItc3BhY2luZzowLjNweDt0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7XCI7XG4gICAgbGJsLnRleHRDb250ZW50ID0gbGFiZWw7XG5cbiAgICBjb25zdCB2YWxTcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgdmFsU3Bhbi5zdHlsZS5jc3NUZXh0ID0gYGZvbnQtc2l6ZToxOHB4O2ZvbnQtd2VpZ2h0OjgwMDtjb2xvcjoke2NvbG9yfTtmb250LXZhcmlhbnQtbnVtZXJpYzp0YWJ1bGFyLW51bXM7Zm9udC1mYW1pbHk6XCJTRiBNb25vXCIsU0ZNb25vLVJlZ3VsYXIsTWVubG8sQ29uc29sYXMsbW9ub3NwYWNlO2A7XG4gICAgdmFsU3Bhbi50ZXh0Q29udGVudCA9IHN0ZXAgPCAxID8gTnVtYmVyKHZhbCkudG9GaXhlZCgzKSA6IHZhbDtcblxuICAgIGhlYWQuYXBwZW5kQ2hpbGQobGJsKTsgaGVhZC5hcHBlbmRDaGlsZCh2YWxTcGFuKTtcblxuICAgIGNvbnN0IHRyYWNrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICB0cmFjay5jbGFzc05hbWUgPSBcImNpLXNsaWRlciBjaS1zbGlkZXItXCIgKyBjbHM7XG5cbiAgICBjb25zdCBmaWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBmaWxsLmNsYXNzTmFtZSA9IFwiY2ktc2xpZGVyLWZpbGxcIjtcbiAgICBmaWxsLnN0eWxlLmJhY2tncm91bmQgPSB0cmFja0NvbG9yO1xuICAgIGZpbGwuc3R5bGUud2lkdGggPSAoKHZhbCAtIG1pbikgLyAobWF4IC0gbWluKSkgKiAxMDAgKyBcIiVcIjtcbiAgICB0cmFjay5hcHBlbmRDaGlsZChmaWxsKTtcblxuICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuICAgIGlucHV0LnR5cGUgPSBcInJhbmdlXCI7IGlucHV0Lm1pbiA9IG1pbjsgaW5wdXQubWF4ID0gbWF4O1xuICAgIGlucHV0LnN0ZXAgPSBzdGVwOyBpbnB1dC52YWx1ZSA9IHZhbDtcbiAgICB0cmFjay5hcHBlbmRDaGlsZChpbnB1dCk7XG5cbiAgICByb3cuYXBwZW5kQ2hpbGQoaGVhZCk7IHJvdy5hcHBlbmRDaGlsZCh0cmFjayk7XG5cbiAgICByZXR1cm4geyBlbDogcm93LCBpbnB1dCwgdmFsU3BhbiwgZmlsbCxcbiAgICAgIHVwZGF0ZSh2LCBsbywgaGkpIHtcbiAgICAgICAgdmFsU3Bhbi50ZXh0Q29udGVudCA9IHN0ZXAgPCAxID8gTnVtYmVyKHYpLnRvRml4ZWQoMykgOiBTdHJpbmcodik7XG4gICAgICAgIGlmIChsbyAhPSBudWxsKSBpbnB1dC5taW4gPSBsbztcbiAgICAgICAgaWYgKGhpICE9IG51bGwpIGlucHV0Lm1heCA9IGhpO1xuICAgICAgICBjb25zdCBwY3QgPSAoKHYgLSBOdW1iZXIoaW5wdXQubWluKSkgLyAoTnVtYmVyKGlucHV0Lm1heCkgLSBOdW1iZXIoaW5wdXQubWluKSkpICogMTAwO1xuICAgICAgICBmaWxsLnN0eWxlLndpZHRoID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMTAwLCBwY3QpKSArIFwiJVwiO1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBjb25zdCBTID0ge307XG4gIFMuayAgPSBjcmVhdGVTbGlkZXIoXCJT4buRIGzhuqduIHRow6BuaCBjw7RuZyAoaylcIiwgMCwgMjAwLCAxLCAzMSwgXCIjMWUyOTNiXCIsIFwiIzFlMjkzYlwiLCBcImRhcmtcIik7XG4gIFMubiAgPSBjcmVhdGVTbGlkZXIoXCJT4buRIHBow6lwIHRo4butIChuKVwiLCAxMCwgMjAwLCAxLCA1MCwgXCIjNDc1NTY5XCIsIFwiIzQ3NTU2OVwiLCBcImdyYXlcIik7XG4gIFMucEwgPSBjcmVhdGVTbGlkZXIoXCJHaeG7m2kgaOG6oW4gZMaw4bubaVwiLCAwLjAwMSwgMC45OTksIDAuMDAxLCAwLjMsIFwiI2RjMjYyNlwiLCBcIiNkYzI2MjZcIiwgXCJyZWRcIik7XG4gIFMucEggPSBjcmVhdGVTbGlkZXIoXCJHaeG7m2kgaOG6oW4gdHLDqm5cIiwgMC4wMDEsIDAuOTk5LCAwLjAwMSwgMC44LCBcIiMwODkxYjJcIiwgXCIjMDg5MWIyXCIsIFwidGVhbFwiKTtcblxuICBjb25zdCByb3cxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgcm93MS5zdHlsZS5jc3NUZXh0ID0gXCJkaXNwbGF5OmZsZXg7Z2FwOjMycHg7d2lkdGg6MTAwJTtwYWRkaW5nOjAgMCAxNHB4O21hcmdpbi1ib3R0b206MTRweDtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjZTJlOGYwO1wiO1xuICByb3cxLmFwcGVuZENoaWxkKFMuay5lbCk7IHJvdzEuYXBwZW5kQ2hpbGQoUy5uLmVsKTtcbiAgd3JhcHBlci5hcHBlbmRDaGlsZChyb3cxKTtcblxuICBjb25zdCByb3cyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgcm93Mi5zdHlsZS5jc3NUZXh0ID0gXCJkaXNwbGF5OmZsZXg7Z2FwOjMycHg7d2lkdGg6MTAwJTttYXJnaW4tYm90dG9tOjZweDtcIjtcbiAgcm93Mi5hcHBlbmRDaGlsZChTLnBMLmVsKTsgcm93Mi5hcHBlbmRDaGlsZChTLnBILmVsKTtcbiAgd3JhcHBlci5hcHBlbmRDaGlsZChyb3cyKTtcblxuICAvLyDilIDilIAgVGFpbCByZWFkb3V0cyDilIDilIBcbiAgY29uc3QgcmVhZG91dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gIHJlYWRvdXQuc3R5bGUuY3NzVGV4dCA9IFwiZGlzcGxheTpmbGV4O2dhcDoxNHB4O3dpZHRoOjEwMCU7bWFyZ2luOjEwcHggMCAxNHB4O2ZsZXgtd3JhcDp3cmFwO1wiO1xuICBmdW5jdGlvbiBtYWtlQm94KGJnLCBib3JkZXIpIHtcbiAgICBjb25zdCBiID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBiLnN0eWxlLmNzc1RleHQgPSBgZmxleDoxO21pbi13aWR0aDoyNjBweDtwYWRkaW5nOjEwcHggMTRweDtib3JkZXItcmFkaXVzOjhweDtiYWNrZ3JvdW5kOiR7Ymd9O2JvcmRlcjoxcHggc29saWQgJHtib3JkZXJ9O2ZvbnQtc2l6ZToxM3B4O2xpbmUtaGVpZ2h0OjEuNjtjb2xvcjojMzM0MTU1O2ZvbnQtZmFtaWx5OlwiU0YgTW9ub1wiLFNGTW9uby1SZWd1bGFyLE1lbmxvLENvbnNvbGFzLG1vbm9zcGFjZTtgO1xuICAgIHJldHVybiBiO1xuICB9XG4gIGNvbnN0IGJveEwgPSBtYWtlQm94KFwiI2ZlZjJmMlwiLFwiI2ZlY2FjYVwiKTtcbiAgY29uc3QgYm94UiA9IG1ha2VCb3goXCIjZWNmZWZmXCIsXCIjYTVmM2ZjXCIpO1xuICByZWFkb3V0LmFwcGVuZENoaWxkKGJveEwpOyByZWFkb3V0LmFwcGVuZENoaWxkKGJveFIpO1xuICB3cmFwcGVyLmFwcGVuZENoaWxkKHJlYWRvdXQpO1xuXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxuICAvLyAzLiBTVkcgKHByZS1hbGxvY2F0ZWQgcG9vbHMpXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxuICBjb25zdCBOUz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCI7XG4gIGNvbnN0IFc9NzYwLEg9NDAwLG1nPXt0OjI2LHI6MjAsYjo0OCxsOjU2fSxjdz1XLW1nLmwtbWcucixjaD1ILW1nLnQtbWcuYjtcblxuICBjb25zdCBzdmc9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKE5TLFwic3ZnXCIpO1xuICBzdmcuc2V0QXR0cmlidXRlKFwidmlld0JveFwiLGAwIDAgJHtXfSAke0h9YCk7XG4gIHN2Zy5zdHlsZS5jc3NUZXh0PWB3aWR0aDoxMDAlO21heC13aWR0aDoke1d9cHg7YmFja2dyb3VuZDojZmFmYmZjO2JvcmRlci1yYWRpdXM6MTBweDtib3JkZXI6MXB4IHNvbGlkICNlMmU4ZjA7YDtcblxuICBmdW5jdGlvbiBlbCh0YWcsYSl7Y29uc3QgZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoTlMsdGFnKTtpZihhKWZvcihjb25zdFtrLHZdb2YgT2JqZWN0LmVudHJpZXMoYSkpZS5zZXRBdHRyaWJ1dGUoayx2KTtyZXR1cm4gZTt9XG5cbiAgLy8gR3JpZFxuICBjb25zdCBncmlkTGluZXM9W107XG4gIGZvcihsZXQgaT0wO2k8PTQ7aSsrKXtjb25zdCBsPWVsKFwibGluZVwiLHtzdHJva2U6XCIjZTJlOGYwXCIsXCJzdHJva2Utd2lkdGhcIjpcIjAuN1wifSk7c3ZnLmFwcGVuZENoaWxkKGwpO2dyaWRMaW5lcy5wdXNoKGwpO31cblxuICAvLyBZIGxhYmVsc1xuICBjb25zdCB5TGFiZWxzPVtdO1xuICBmb3IobGV0IGk9MDtpPD00O2krKyl7Y29uc3QgdD1lbChcInRleHRcIix7XCJ0ZXh0LWFuY2hvclwiOlwiZW5kXCIsZmlsbDpcIiM5NGEzYjhcIixcImZvbnQtc2l6ZVwiOlwiMTBcIixcImZvbnQtZmFtaWx5XCI6XCInU0YgTW9ubycsbW9ub3NwYWNlXCJ9KTtzdmcuYXBwZW5kQ2hpbGQodCk7eUxhYmVscy5wdXNoKHQpO31cblxuICAvLyBCYXIgcG9vbHNcbiAgY29uc3QgUE9PTD0yMDE7XG4gIGNvbnN0IGJhcnNSPVtdLGJhcnNMPVtdO1xuICBmb3IobGV0IGk9MDtpPFBPT0w7aSsrKXtcbiAgICBjb25zdCByPWVsKFwicmVjdFwiLHtyeDpcIjFcIn0pO3Iuc3R5bGUuZGlzcGxheT1cIm5vbmVcIjtzdmcuYXBwZW5kQ2hpbGQocik7YmFyc1IucHVzaChyKTtcbiAgICBjb25zdCBsPWVsKFwicmVjdFwiLHtyeDpcIjFcIn0pO2wuc3R5bGUuZGlzcGxheT1cIm5vbmVcIjtzdmcuYXBwZW5kQ2hpbGQobCk7YmFyc0wucHVzaChsKTtcbiAgfVxuXG4gIC8vIFBhdGhzXG4gIGNvbnN0IHBhdGgxPWVsKFwicGF0aFwiLHtmaWxsOlwibm9uZVwiLFwic3Ryb2tlLXdpZHRoXCI6XCIyLjJcIixvcGFjaXR5OlwiMC45XCJ9KTtcbiAgY29uc3QgcGF0aDI9ZWwoXCJwYXRoXCIse2ZpbGw6XCJub25lXCIsXCJzdHJva2Utd2lkdGhcIjpcIjJcIixcInN0cm9rZS1kYXNoYXJyYXlcIjpcIjQsM1wiLG9wYWNpdHk6XCIwLjU1XCJ9KTtcbiAgY29uc3QgcGF0aDM9ZWwoXCJwYXRoXCIse2ZpbGw6XCJub25lXCIsXCJzdHJva2Utd2lkdGhcIjpcIjIuMlwiLG9wYWNpdHk6XCIwLjlcIn0pO1xuICBzdmcuYXBwZW5kQ2hpbGQocGF0aDEpO3N2Zy5hcHBlbmRDaGlsZChwYXRoMik7c3ZnLmFwcGVuZENoaWxkKHBhdGgzKTtcblxuICAvLyBrIGxpbmVcbiAgY29uc3Qga0xpbmU9ZWwoXCJsaW5lXCIse3N0cm9rZTpcIiMxZTI5M2JcIixcInN0cm9rZS13aWR0aFwiOlwiMS4zXCIsXCJzdHJva2UtZGFzaGFycmF5XCI6XCI2LDRcIixvcGFjaXR5OlwiMC41XCJ9KTtcbiAgY29uc3Qga0xibD1lbChcInRleHRcIix7XCJ0ZXh0LWFuY2hvclwiOlwibWlkZGxlXCIsZmlsbDpcIiMxZTI5M2JcIixcImZvbnQtc2l6ZVwiOlwiMTJcIixcImZvbnQtd2VpZ2h0XCI6XCI3MDBcIixcImZvbnQtZmFtaWx5XCI6XCInU0YgTW9ubycsbW9ub3NwYWNlXCJ9KTtcbiAgc3ZnLmFwcGVuZENoaWxkKGtMaW5lKTtzdmcuYXBwZW5kQ2hpbGQoa0xibCk7XG5cbiAgLy8gWCBheGlzXG4gIGNvbnN0IHhBeD1lbChcImxpbmVcIix7c3Ryb2tlOlwiIzk0YTNiOFwifSk7c3ZnLmFwcGVuZENoaWxkKHhBeCk7XG4gIGNvbnN0IHhUaWNrcz1bXTtcbiAgZm9yKGxldCBpPTA7aTwzMDtpKyspe1xuICAgIGNvbnN0IGxuPWVsKFwibGluZVwiLHtzdHJva2U6XCIjOTRhM2I4XCIseTI6XCI1XCJ9KTtsbi5zdHlsZS5kaXNwbGF5PVwibm9uZVwiO3N2Zy5hcHBlbmRDaGlsZChsbik7XG4gICAgY29uc3QgdD1lbChcInRleHRcIix7XCJ0ZXh0LWFuY2hvclwiOlwibWlkZGxlXCIsZmlsbDpcIiM2NDc0OGJcIixcImZvbnQtc2l6ZVwiOlwiMTFcIixcImZvbnQtZmFtaWx5XCI6XCInU0YgTW9ubycsbW9ub3NwYWNlXCIsZHk6XCIxNlwifSk7dC5zdHlsZS5kaXNwbGF5PVwibm9uZVwiO3N2Zy5hcHBlbmRDaGlsZCh0KTtcbiAgICB4VGlja3MucHVzaCh7bG4sdH0pO1xuICB9XG4gIGNvbnN0IHhMYmw9ZWwoXCJ0ZXh0XCIse1widGV4dC1hbmNob3JcIjpcIm1pZGRsZVwiLGZpbGw6XCIjNjQ3NDhiXCIsXCJmb250LXNpemVcIjpcIjEyXCIseTpTdHJpbmcoSC00KX0pO1xuICB4TGJsLnRleHRDb250ZW50PVwiU+G7kSBs4bqnbiB0aMOgbmggY8O0bmdcIjtzdmcuYXBwZW5kQ2hpbGQoeExibCk7XG5cbiAgLy8gWSBheGlzXG4gIHN2Zy5hcHBlbmRDaGlsZChlbChcImxpbmVcIix7eDE6U3RyaW5nKG1nLmwpLHgyOlN0cmluZyhtZy5sKSx5MTpTdHJpbmcobWcudCkseTI6U3RyaW5nKG1nLnQrY2gpLHN0cm9rZTpcIiM5NGEzYjhcIn0pKTtcbiAgY29uc3QgeUxibD1lbChcInRleHRcIix7XCJ0ZXh0LWFuY2hvclwiOlwibWlkZGxlXCIsZmlsbDpcIiM2NDc0OGJcIixcImZvbnQtc2l6ZVwiOlwiMTJcIix4OlwiMTRcIix5OlN0cmluZyhtZy50K2NoLzIpLHRyYW5zZm9ybTpgcm90YXRlKC05MCwxNCwke21nLnQrY2gvMn0pYH0pO1xuICB5TGJsLnRleHRDb250ZW50PVwiUChYID0geClcIjtzdmcuYXBwZW5kQ2hpbGQoeUxibCk7XG5cbiAgLy8gQW5ub3RhdGlvbnNcbiAgY29uc3QgYW5uUj1lbChcInRleHRcIix7ZmlsbDpcIiNkYzI2MjZcIixcImZvbnQtc2l6ZVwiOlwiMTJcIixcImZvbnQtd2VpZ2h0XCI6XCI3MDBcIixcImZvbnQtZmFtaWx5XCI6XCInU0YgTW9ubycsbW9ub3NwYWNlXCJ9KTtcbiAgY29uc3QgYW5uUnM9ZWwoXCJ0ZXh0XCIse2ZpbGw6XCIjZGMyNjI2XCIsXCJmb250LXNpemVcIjpcIjEwXCIsb3BhY2l0eTpcIjAuNlwiLFwiZm9udC1mYW1pbHlcIjpcIidTRiBNb25vJyxtb25vc3BhY2VcIn0pO1xuICBjb25zdCBhbm5MPWVsKFwidGV4dFwiLHtmaWxsOlwiIzA4OTFiMlwiLFwiZm9udC1zaXplXCI6XCIxMlwiLFwiZm9udC13ZWlnaHRcIjpcIjcwMFwiLFwiZm9udC1mYW1pbHlcIjpcIidTRiBNb25vJyxtb25vc3BhY2VcIn0pO1xuICBjb25zdCBhbm5Mcz1lbChcInRleHRcIix7ZmlsbDpcIiMwODkxYjJcIixcImZvbnQtc2l6ZVwiOlwiMTBcIixvcGFjaXR5OlwiMC42XCIsXCJmb250LWZhbWlseVwiOlwiJ1NGIE1vbm8nLG1vbm9zcGFjZVwifSk7XG4gIHN2Zy5hcHBlbmRDaGlsZChhbm5SKTtzdmcuYXBwZW5kQ2hpbGQoYW5uUnMpO3N2Zy5hcHBlbmRDaGlsZChhbm5MKTtzdmcuYXBwZW5kQ2hpbGQoYW5uTHMpO1xuXG4gIHdyYXBwZXIuYXBwZW5kQ2hpbGQoc3ZnKTtcblxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbiAgLy8gNC4gUkVOREVSXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxuICBsZXQgcmFmSWQ9MDtcbiAgY29uc3QgQzE9XCIjZGMyNjI2XCIsQzI9XCIjOTRhM2I4XCIsQzM9XCIjMDg5MWIyXCI7XG5cbiAgZnVuY3Rpb24gcmVuZGVyKCl7XG4gICAgY29uc3QgblY9K1Mubi5pbnB1dC52YWx1ZTtcbiAgICBjb25zdCBrVj1NYXRoLm1pbigrUy5rLmlucHV0LnZhbHVlLG5WKTtcbiAgICBjb25zdCBwTFY9K1MucEwuaW5wdXQudmFsdWU7XG4gICAgY29uc3QgcEhWPStTLnBILmlucHV0LnZhbHVlO1xuICAgIGNvbnN0IHBIPW5WPjA/a1YvblY6MDtcblxuICAgIFMuay51cGRhdGUoa1YsMCxuVik7XG4gICAgUy5uLnVwZGF0ZShuVik7XG4gICAgUy5wTC51cGRhdGUocExWLDAuMDAxLE1hdGgubWluKHBILDAuOTk4KSk7XG4gICAgUy5wSC51cGRhdGUocEhWLE1hdGgubWF4KHBILDAuMDAyKSwwLjk5OSk7XG5cbiAgICBjb25zdCBwcz1bcExWLHBILHBIVl0uZmlsdGVyKHA9PnA+MCYmcDwxKTtcbiAgICBsZXQgbG9YPWtWLGhpWD1rVjtcbiAgICBmb3IoY29uc3QgcCBvZiBwcyl7Y29uc3QgbXU9blYqcCxzZD1NYXRoLnNxcnQoblYqcCooMS1wKSk7bG9YPU1hdGgubWluKGxvWCxtdS0zLjgqc2QpO2hpWD1NYXRoLm1heChoaVgsbXUrMy44KnNkKTt9XG4gICAgbG9YPU1hdGgubWF4KDAsTWF0aC5mbG9vcihsb1gpKTtoaVg9TWF0aC5taW4oblYsTWF0aC5jZWlsKGhpWCkpO1xuICAgIGNvbnN0IGNudD1oaVgtbG9YKzE7XG5cbiAgICBsZXQgbWF4WT0wO1xuICAgIGNvbnN0IHkxPW5ldyBGbG9hdDY0QXJyYXkoY250KSx5Mj1uZXcgRmxvYXQ2NEFycmF5KGNudCkseTM9bmV3IEZsb2F0NjRBcnJheShjbnQpO1xuICAgIGZvcihsZXQgaT0wO2k8Y250O2krKyl7XG4gICAgICBjb25zdCB4PWxvWCtpO1xuICAgICAgeTFbaV09cG1mKHgsblYscExWKTt5MltpXT1wbWYoeCxuVixwSCk7eTNbaV09cG1mKHgsblYscEhWKTtcbiAgICAgIGNvbnN0IG09TWF0aC5tYXgoeTFbaV0seTJbaV0seTNbaV0pO2lmKG0+bWF4WSltYXhZPW07XG4gICAgfVxuICAgIG1heFkqPTEuMTU7aWYobWF4WTwxZS05KW1heFk9MC4wMTtcblxuICAgIGNvbnN0IHN4PXg9Pm1nLmwrKCh4LWxvWCkvKGhpWC1sb1gpKSpjdztcbiAgICBjb25zdCBzeT15PT5tZy50K2NoLSh5L21heFkpKmNoO1xuICAgIGNvbnN0IGJ3PU1hdGgubWF4KDEuNSxjdy9jbnQqMC41KTtcbiAgICBjb25zdCBiYXNlPXN5KDApO1xuXG4gICAgZm9yKGxldCBpPTA7aTw9NDtpKyspe1xuICAgICAgY29uc3Qgdj0obWF4WS80KSppLHl5PXN5KHYpO1xuICAgICAgZ3JpZExpbmVzW2ldLnNldEF0dHJpYnV0ZShcIngxXCIsbWcubCk7Z3JpZExpbmVzW2ldLnNldEF0dHJpYnV0ZShcIngyXCIsVy1tZy5yKTtcbiAgICAgIGdyaWRMaW5lc1tpXS5zZXRBdHRyaWJ1dGUoXCJ5MVwiLHl5KTtncmlkTGluZXNbaV0uc2V0QXR0cmlidXRlKFwieTJcIix5eSk7XG4gICAgICB5TGFiZWxzW2ldLnNldEF0dHJpYnV0ZShcInhcIixtZy5sLTgpO3lMYWJlbHNbaV0uc2V0QXR0cmlidXRlKFwieVwiLHl5KzQpO1xuICAgICAgeUxhYmVsc1tpXS50ZXh0Q29udGVudD12LnRvRml4ZWQoMyk7XG4gICAgfVxuXG4gICAgbGV0IGJpPTA7XG4gICAgZm9yKGxldCBpPTA7aTxjbnQ7aSsrKXtjb25zdCB4PWxvWCtpO2lmKHg+PWtWJiZiaTxQT09MKXtcbiAgICAgIGNvbnN0IGI9YmFyc1JbYmkrK107Y29uc3QgaD1NYXRoLm1heCgwLGJhc2Utc3koeTFbaV0pKTtcbiAgICAgIGIuc2V0QXR0cmlidXRlKFwieFwiLHN4KHgpLWJ3LzIpO2Iuc2V0QXR0cmlidXRlKFwieVwiLHN5KHkxW2ldKSk7XG4gICAgICBiLnNldEF0dHJpYnV0ZShcIndpZHRoXCIsYncpO2Iuc2V0QXR0cmlidXRlKFwiaGVpZ2h0XCIsaCk7XG4gICAgICBiLnNldEF0dHJpYnV0ZShcImZpbGxcIixcInJnYmEoMjIwLDM4LDM4LDAuMTgpXCIpO2Iuc2V0QXR0cmlidXRlKFwic3Ryb2tlXCIsQzEpO2Iuc2V0QXR0cmlidXRlKFwic3Ryb2tlLXdpZHRoXCIsXCIwLjZcIik7XG4gICAgICBiLnN0eWxlLmRpc3BsYXk9XCJcIjtcbiAgICB9fVxuICAgIGZvcig7Ymk8UE9PTDtiaSsrKWJhcnNSW2JpXS5zdHlsZS5kaXNwbGF5PVwibm9uZVwiO1xuXG4gICAgYmk9MDtcbiAgICBmb3IobGV0IGk9MDtpPGNudDtpKyspe2NvbnN0IHg9bG9YK2k7aWYoeDw9a1YmJmJpPFBPT0wpe1xuICAgICAgY29uc3QgYj1iYXJzTFtiaSsrXTtjb25zdCBoPU1hdGgubWF4KDAsYmFzZS1zeSh5M1tpXSkpO1xuICAgICAgYi5zZXRBdHRyaWJ1dGUoXCJ4XCIsc3goeCktYncvMik7Yi5zZXRBdHRyaWJ1dGUoXCJ5XCIsc3koeTNbaV0pKTtcbiAgICAgIGIuc2V0QXR0cmlidXRlKFwid2lkdGhcIixidyk7Yi5zZXRBdHRyaWJ1dGUoXCJoZWlnaHRcIixoKTtcbiAgICAgIGIuc2V0QXR0cmlidXRlKFwiZmlsbFwiLFwicmdiYSg4LDE0NSwxNzgsMC4xNSlcIik7Yi5zZXRBdHRyaWJ1dGUoXCJzdHJva2VcIixDMyk7Yi5zZXRBdHRyaWJ1dGUoXCJzdHJva2Utd2lkdGhcIixcIjAuNlwiKTtcbiAgICAgIGIuc3R5bGUuZGlzcGxheT1cIlwiO1xuICAgIH19XG4gICAgZm9yKDtiaTxQT09MO2JpKyspYmFyc0xbYmldLnN0eWxlLmRpc3BsYXk9XCJub25lXCI7XG5cbiAgICBsZXQgZDE9XCJcIixkMj1cIlwiLGQzPVwiXCI7XG4gICAgZm9yKGxldCBpPTA7aTxjbnQ7aSsrKXtcbiAgICAgIGNvbnN0IHg9bG9YK2ksY21kPWk/XCJMXCI6XCJNXCIscHg9c3goeCkudG9GaXhlZCgxKTtcbiAgICAgIGQxKz1jbWQrcHgrXCIsXCIrc3koeTFbaV0pLnRvRml4ZWQoMSk7XG4gICAgICBkMis9Y21kK3B4K1wiLFwiK3N5KHkyW2ldKS50b0ZpeGVkKDEpO1xuICAgICAgZDMrPWNtZCtweCtcIixcIitzeSh5M1tpXSkudG9GaXhlZCgxKTtcbiAgICB9XG4gICAgcGF0aDEuc2V0QXR0cmlidXRlKFwiZFwiLGQxKTtwYXRoMS5zZXRBdHRyaWJ1dGUoXCJzdHJva2VcIixDMSk7XG4gICAgcGF0aDIuc2V0QXR0cmlidXRlKFwiZFwiLGQyKTtwYXRoMi5zZXRBdHRyaWJ1dGUoXCJzdHJva2VcIixDMik7XG4gICAgcGF0aDMuc2V0QXR0cmlidXRlKFwiZFwiLGQzKTtwYXRoMy5zZXRBdHRyaWJ1dGUoXCJzdHJva2VcIixDMyk7XG5cbiAgICBjb25zdCBreD1zeChrVik7XG4gICAga0xpbmUuc2V0QXR0cmlidXRlKFwieDFcIixreCk7a0xpbmUuc2V0QXR0cmlidXRlKFwieDJcIixreCk7XG4gICAga0xpbmUuc2V0QXR0cmlidXRlKFwieTFcIixtZy50KTtrTGluZS5zZXRBdHRyaWJ1dGUoXCJ5MlwiLGJhc2UpO1xuICAgIGtMYmwuc2V0QXR0cmlidXRlKFwieFwiLGt4KTtrTGJsLnNldEF0dHJpYnV0ZShcInlcIixtZy50LTgpO2tMYmwudGV4dENvbnRlbnQ9XCJrID0gXCIra1Y7XG5cbiAgICB4QXguc2V0QXR0cmlidXRlKFwieDFcIixtZy5sKTt4QXguc2V0QXR0cmlidXRlKFwieDJcIixXLW1nLnIpO1xuICAgIHhBeC5zZXRBdHRyaWJ1dGUoXCJ5MVwiLGJhc2UpO3hBeC5zZXRBdHRyaWJ1dGUoXCJ5MlwiLGJhc2UpO1xuICAgIHhMYmwuc2V0QXR0cmlidXRlKFwieFwiLG1nLmwrY3cvMik7XG5cbiAgICBjb25zdCBzcGFuPWhpWC1sb1g7XG4gICAgY29uc3QgdHM9c3Bhbj44MD8xMDpzcGFuPjQwPzU6c3Bhbj4yMD8yOjE7XG4gICAgbGV0IHRpPTA7XG4gICAgZm9yKGxldCB4PU1hdGguY2VpbChsb1gvdHMpKnRzO3g8PWhpWCYmdGk8MzA7eCs9dHMpe1xuICAgICAgY29uc3QgeHg9c3goeCk7XG4gICAgICB4VGlja3NbdGldLmxuLnNldEF0dHJpYnV0ZShcIngxXCIseHgpO3hUaWNrc1t0aV0ubG4uc2V0QXR0cmlidXRlKFwieDJcIix4eCk7XG4gICAgICB4VGlja3NbdGldLmxuLnNldEF0dHJpYnV0ZShcInkxXCIsYmFzZSk7eFRpY2tzW3RpXS5sbi5zZXRBdHRyaWJ1dGUoXCJ5MlwiLGJhc2UrNSk7XG4gICAgICB4VGlja3NbdGldLmxuLnN0eWxlLmRpc3BsYXk9XCJcIjtcbiAgICAgIHhUaWNrc1t0aV0udC5zZXRBdHRyaWJ1dGUoXCJ4XCIseHgpO3hUaWNrc1t0aV0udC5zZXRBdHRyaWJ1dGUoXCJ5XCIsYmFzZSs1KTtcbiAgICAgIHhUaWNrc1t0aV0udC50ZXh0Q29udGVudD14O3hUaWNrc1t0aV0udC5zdHlsZS5kaXNwbGF5PVwiXCI7XG4gICAgICB0aSsrO1xuICAgIH1cbiAgICBmb3IoO3RpPDMwO3RpKyspe3hUaWNrc1t0aV0ubG4uc3R5bGUuZGlzcGxheT1cIm5vbmVcIjt4VGlja3NbdGldLnQuc3R5bGUuZGlzcGxheT1cIm5vbmVcIjt9XG5cbiAgICBjb25zdCBydD1yVGFpbChrVixuVixwTFYpO1xuICAgIGNvbnN0IGx0PWxUYWlsKGtWLG5WLHBIVik7XG4gICAgY29uc3QgcnRPaz1NYXRoLmFicyhydC0wLjAyNSk8MC4wMDM7XG4gICAgY29uc3QgbHRPaz1NYXRoLmFicyhsdC0wLjAyNSk8MC4wMDM7XG5cbiAgICBjb25zdCBvaz1cIlxcdTI3MTMgXFx1MjI0OCAyLjUlXCIsbm89XCJcXHUyMTkwIGPhuqduIFxcdTIyNDggMi41JVwiO1xuICAgIGJveEwuaW5uZXJIVE1MPSc8YiBzdHlsZT1cImNvbG9yOicrQzErJ1wiPkdp4bubaSBo4bqhbiBkxrDhu5tpPC9iPjxicj4nK1xuICAgICAgXCJQKFggXFx1MjI2NSBcIitrVitcIiB8IHA9XCIrcExWLnRvRml4ZWQoMykrXCIpID0gXCIrXG4gICAgICAnPGIgc3R5bGU9XCJjb2xvcjonKyhydE9rP1wiIzE2YTM0YVwiOlwiI2Q5NzcwNlwiKSsnXCI+JysocnQqMTAwKS50b0ZpeGVkKDIpK1wiJTwvYj4gXCIrXG4gICAgICAnPHNwYW4gc3R5bGU9XCJjb2xvcjonKyhydE9rP1wiIzE2YTM0YVwiOlwiI2Q5NzcwNlwiKSsnXCI+JysocnRPaz9vazpubykrXCI8L3NwYW4+XCI7XG5cbiAgICBib3hSLmlubmVySFRNTD0nPGIgc3R5bGU9XCJjb2xvcjonK0MzKydcIj5HaeG7m2kgaOG6oW4gdHLDqm48L2I+PGJyPicrXG4gICAgICBcIlAoWCBcXHUyMjY0IFwiK2tWK1wiIHwgcD1cIitwSFYudG9GaXhlZCgzKStcIikgPSBcIitcbiAgICAgICc8YiBzdHlsZT1cImNvbG9yOicrKGx0T2s/XCIjMTZhMzRhXCI6XCIjZDk3NzA2XCIpKydcIj4nKyhsdCoxMDApLnRvRml4ZWQoMikrXCIlPC9iPiBcIitcbiAgICAgICc8c3BhbiBzdHlsZT1cImNvbG9yOicrKGx0T2s/XCIjMTZhMzRhXCI6XCIjZDk3NzA2XCIpKydcIj4nKyhsdE9rP29rOm5vKStcIjwvc3Bhbj5cIjtcblxuICAgIHdyYXBwZXIudmFsdWU9e246blYsazprVixwTDpwTFYscEg6cEhWLHBIYXQ6cEgscnQsbHR9O1xuICAgIHdyYXBwZXIuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoXCJpbnB1dFwiLHtidWJibGVzOnRydWV9KSk7XG4gIH1cblxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcbiAgLy8gNS4gRVZFTlRTXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxuICBmdW5jdGlvbiBzY2hlZHVsZSgpe2NhbmNlbEFuaW1hdGlvbkZyYW1lKHJhZklkKTtyYWZJZD1yZXF1ZXN0QW5pbWF0aW9uRnJhbWUocmVuZGVyKTt9XG4gIGZvcihjb25zdCBzIG9mIE9iamVjdC52YWx1ZXMoUykpcy5pbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIixzY2hlZHVsZSk7XG4gIHJlbmRlcigpO1xuXG4gIHdyYXBwZXIuZGlzcG9zZT0oKT0+e1xuICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKHJhZklkKTtcbiAgICBmb3IoY29uc3QgcyBvZiBPYmplY3QudmFsdWVzKFMpKXMuaW5wdXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsc2NoZWR1bGUpO1xuICAgIGxjQ2FjaGUuY2xlYXIoKTtcbiAgfTtcblxuICByZXR1cm4gd3JhcHBlcjtcbn0pKClcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnYmlub21pYWxfZGlzdCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdnYWx0b25fYm9hcmQnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnYmlub21pYWxfY2knKSJ9XX0=
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../..";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "thinhong/s4bvn";
    script.dataset.repoId = "R_kgDOQtVYcQ";
    script.dataset.category = "General";
    script.dataset.categoryId = "DIC_kwDOQtVYcc4C00o0";
    script.dataset.mapping = "title";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./distr-d.html" class="pagination-link" aria-label="Phân phối rời rạc">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Phân phối rời rạc</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./distr-pois.html" class="pagination-link" aria-label="Phân phối Poisson">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Phân phối Poisson</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>