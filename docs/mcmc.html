<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>11&nbsp; MCMC – Statistics for babies</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./unc.html" rel="next">
<link href="./bayes.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-832c273f0af7a47d06e59912ec7b3523.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-N2T5TFNFY7"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-N2T5TFNFY7', { 'anonymize_ip': true});
</script>
<script type="module" src="site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./mcmc.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">MCMC</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Statistics for babies</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prob.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Xác suất</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Phân phối xác suất</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./distr-d.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Phân phối rời rạc</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-bin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Phân phối nhị thức</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-pois.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Phân phối Poisson</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./distr-c.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Phân phối liên tục</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-norm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Phân phối bình thường</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-lnorm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Phân phối log-normal</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-exp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Phân phối mũ</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-pl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Phân phối quy tắc lũy thừa</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lik.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hàm hợp lý</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Bayesian</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mcmc.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">MCMC</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./unc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Sự không chắc chắn</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./thanks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lời cảm ơn</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tài liệu tham khảo</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#thuật-toán-metropolis---hastings" id="toc-thuật-toán-metropolis---hastings" class="nav-link active" data-scroll-target="#thuật-toán-metropolis---hastings"><span class="header-section-number">11.1</span> Thuật toán Metropolis - Hastings</a></li>
  <li><a href="#fit-mô-hình" id="toc-fit-mô-hình" class="nav-link" data-scroll-target="#fit-mô-hình"><span class="header-section-number">11.2</span> Fit mô hình</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">MCMC</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb1" data-startfrom="9" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 8;"><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { createSlider<span class="op">,</span> injectStyle } <span class="im">from</span> <span class="st">"./_slider.js"</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3@7"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<section id="thuật-toán-metropolis---hastings" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="thuật-toán-metropolis---hastings"><span class="header-section-number">11.1</span> Thuật toán Metropolis - Hastings</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb2" data-startfrom="15" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 14;"><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>viewof mh <span class="op">=</span> {</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ MATH ═══════════════════</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">normalPDF</span>(x<span class="op">,</span>mu<span class="op">,</span>s){<span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="op">-</span><span class="fl">0.5</span><span class="op">*</span>((x<span class="op">-</span>mu)<span class="op">/</span>s)<span class="op">**</span><span class="dv">2</span>)<span class="op">/</span>(s<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="dv">2</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>))<span class="op">;</span>}</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">lnGamma</span>(z){</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(z<span class="op">&lt;</span><span class="fl">0.5</span>)<span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">/</span><span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">*</span>z))<span class="op">-</span><span class="fu">lnGamma</span>(<span class="dv">1</span><span class="op">-</span>z)<span class="op">;</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    z<span class="op">--;</span><span class="kw">const</span> c<span class="op">=</span>[<span class="fl">0.99999999999980993</span><span class="op">,</span><span class="fl">676.5203681218851</span><span class="op">,-</span><span class="fl">1259.1392167224028</span><span class="op">,</span><span class="fl">771.32342877765313</span><span class="op">,</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span><span class="fl">176.61502916214059</span><span class="op">,</span><span class="fl">12.507343278686905</span><span class="op">,-</span><span class="fl">0.13857109526572012</span><span class="op">,</span><span class="fl">9.9843695780195716e-6</span><span class="op">,</span><span class="fl">1.5056327351493116e-7</span>]<span class="op">;</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> x<span class="op">=</span>c[<span class="dv">0</span>]<span class="op">;</span><span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">1</span><span class="op">;</span>i<span class="op">&lt;</span><span class="dv">9</span><span class="op">;</span>i<span class="op">++</span>)x<span class="op">+=</span>c[i]<span class="op">/</span>(z<span class="op">+</span>i)<span class="op">;</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> t<span class="op">=</span>z<span class="op">+</span><span class="fl">7.5</span><span class="op">;</span><span class="cf">return</span> <span class="fl">0.5</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="dv">2</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>)<span class="op">+</span>(z<span class="op">+</span><span class="fl">0.5</span>)<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(t)<span class="op">-</span>t<span class="op">+</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(x)<span class="op">;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">lnBeta</span>(a<span class="op">,</span>b){<span class="cf">return</span> <span class="fu">lnGamma</span>(a)<span class="op">+</span><span class="fu">lnGamma</span>(b)<span class="op">-</span><span class="fu">lnGamma</span>(a<span class="op">+</span>b)<span class="op">;</span>}</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">betaPDF</span>(x<span class="op">,</span>a<span class="op">,</span>b){<span class="cf">return</span>(x<span class="op">&lt;=</span><span class="dv">0</span><span class="op">||</span>x<span class="op">&gt;=</span><span class="dv">1</span>)<span class="op">?</span><span class="dv">0</span><span class="op">:</span><span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>((a<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(x)<span class="op">+</span>(b<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="dv">1</span><span class="op">-</span>x)<span class="op">-</span><span class="fu">lnBeta</span>(a<span class="op">,</span>b))<span class="op">;</span>}</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">randn</span>(){<span class="kw">let</span> u<span class="op">=</span><span class="dv">0</span><span class="op">,</span>v<span class="op">=</span><span class="dv">0</span><span class="op">;</span><span class="cf">while</span>(<span class="op">!</span>u)u<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>()<span class="op">;</span><span class="cf">while</span>(<span class="op">!</span>v)v<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>()<span class="op">;</span><span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="op">-</span><span class="dv">2</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(u))<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="dv">2</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">*</span>v)<span class="op">;</span>}</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ DYNAMIC MODEL ═══════════════════</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> priorA<span class="op">=</span><span class="dv">2</span><span class="op">,</span>priorB<span class="op">=</span><span class="dv">5</span><span class="op">,</span>dataK<span class="op">=</span><span class="dv">7</span><span class="op">,</span>dataN<span class="op">=</span><span class="dv">20</span><span class="op">;</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> rawLikMax<span class="op">=</span><span class="dv">1</span><span class="op">,</span>postA_<span class="op">=</span><span class="dv">9</span><span class="op">,</span>postB_<span class="op">=</span><span class="dv">18</span><span class="op">;</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">recompute</span>(){</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> mle<span class="op">=</span>dataK<span class="op">/</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(dataN<span class="op">,</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    rawLikMax<span class="op">=</span>(mle<span class="op">&gt;</span><span class="dv">0</span><span class="op">&amp;&amp;</span>mle<span class="op">&lt;</span><span class="dv">1</span>)<span class="op">?</span><span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(mle<span class="op">,</span>dataK)<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(<span class="dv">1</span><span class="op">-</span>mle<span class="op">,</span>dataN<span class="op">-</span>dataK)<span class="op">:</span><span class="fl">1e-20</span><span class="op">;</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    postA_<span class="op">=</span>priorA<span class="op">+</span>dataK<span class="op">;</span> postB_<span class="op">=</span>priorB<span class="op">+</span>dataN<span class="op">-</span>dataK<span class="op">;</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recompute</span>()<span class="op">;</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">prior</span>(t){<span class="cf">return</span> <span class="fu">betaPDF</span>(t<span class="op">,</span>priorA<span class="op">,</span>priorB)<span class="op">;</span>}</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">likRaw</span>(t){<span class="cf">if</span>(t<span class="op">&lt;=</span><span class="dv">0</span><span class="op">||</span>t<span class="op">&gt;=</span><span class="dv">1</span>)<span class="cf">return</span> <span class="dv">0</span><span class="op">;</span><span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(t<span class="op">,</span>dataK)<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(<span class="dv">1</span><span class="op">-</span>t<span class="op">,</span>dataN<span class="op">-</span>dataK)<span class="op">;</span>}</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">likNorm</span>(t){<span class="cf">return</span> rawLikMax<span class="op">&gt;</span><span class="dv">0</span><span class="op">?</span><span class="fu">likRaw</span>(t)<span class="op">/</span>rawLikMax<span class="op">:</span><span class="dv">0</span><span class="op">;</span>}</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">target</span>(t){<span class="cf">return</span> <span class="fu">prior</span>(t)<span class="op">*</span><span class="fu">likRaw</span>(t)<span class="op">;</span>}</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">truePosterior</span>(t){<span class="cf">return</span> <span class="fu">betaPDF</span>(t<span class="op">,</span>postA_<span class="op">,</span>postB_)<span class="op">;</span>}</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ PALETTE ═══════════════════</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> C<span class="op">=</span>{<span class="dt">current</span><span class="op">:</span><span class="st">"#1565C0"</span><span class="op">,</span><span class="dt">propose</span><span class="op">:</span><span class="st">"#E65100"</span><span class="op">,</span><span class="dt">accept</span><span class="op">:</span><span class="st">"#2E7D32"</span><span class="op">,</span><span class="dt">reject</span><span class="op">:</span><span class="st">"#C62828"</span><span class="op">,</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    <span class="dt">prior</span><span class="op">:</span><span class="st">"#7B1FA2"</span><span class="op">,</span><span class="dt">lik</span><span class="op">:</span><span class="st">"#00897B"</span><span class="op">,</span><span class="dt">post</span><span class="op">:</span><span class="st">"#E65100"</span><span class="op">,</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    <span class="dt">hist</span><span class="op">:</span><span class="st">"#1565C0"</span><span class="op">,</span><span class="dt">histStroke</span><span class="op">:</span><span class="st">"#0D47A1"</span><span class="op">,</span><span class="dt">histTop</span><span class="op">:</span><span class="st">"#64B5F6"</span><span class="op">,</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="dt">histNew</span><span class="op">:</span><span class="st">"#E65100"</span><span class="op">,</span><span class="dt">histNewStroke</span><span class="op">:</span><span class="st">"#BF360C"</span><span class="op">,</span><span class="dt">histNewTop</span><span class="op">:</span><span class="st">"#FF8A65"</span><span class="op">,</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    <span class="dt">burned</span><span class="op">:</span><span class="st">"#EF9A9A"</span><span class="op">,</span><span class="dt">burnLine</span><span class="op">:</span><span class="st">"#E53935"</span><span class="op">,</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="dt">filt</span><span class="op">:</span><span class="st">"#43A047"</span><span class="op">,</span><span class="dt">filtStroke</span><span class="op">:</span><span class="st">"#2E7D32"</span><span class="op">,</span><span class="dt">filtTop</span><span class="op">:</span><span class="st">"#81C784"</span><span class="op">,</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ghost</span><span class="op">:</span><span class="st">"#CFD8DC"</span><span class="op">,</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    <span class="dt">trace</span><span class="op">:</span><span class="st">"#1565C0"</span><span class="op">,</span><span class="dt">traceLight</span><span class="op">:</span><span class="st">"#90CAF9"</span><span class="op">,</span><span class="dt">proposal</span><span class="op">:</span><span class="st">"#FF6F00"</span><span class="op">,</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    <span class="dt">txt</span><span class="op">:</span><span class="st">"#212121"</span><span class="op">,</span><span class="dt">sub</span><span class="op">:</span><span class="st">"#9E9E9E"</span><span class="op">,</span><span class="dt">border</span><span class="op">:</span><span class="st">"#E0E0E0"</span>}<span class="op">;</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mono<span class="op">=</span><span class="st">"'SF Mono',SFMono-Regular,Menlo,monospace"</span><span class="op">;</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ STATE ═══════════════════</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> chain<span class="op">=</span>[<span class="fl">0.3</span>]<span class="op">,</span>proposed<span class="op">=</span><span class="kw">null</span><span class="op">,</span>stepPhase<span class="op">=</span><span class="st">"idle"</span><span class="op">,</span>accepted<span class="op">=</span><span class="kw">null</span><span class="op">;</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> acceptRatio<span class="op">=</span><span class="dv">0</span><span class="op">,</span>uRand<span class="op">=</span><span class="dv">0</span><span class="op">,</span>samples<span class="op">=</span>[]<span class="op">,</span>proposalSigma<span class="op">=</span><span class="fl">0.08</span><span class="op">,</span>stepCount<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> autoRunning<span class="op">=</span><span class="kw">false</span><span class="op">,</span>autoTimer<span class="op">=</span><span class="kw">null</span><span class="op">;</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> propStepIdx<span class="op">=</span><span class="dv">0</span><span class="op">,</span>lastAcceptedBin<span class="op">=-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ WRAPPER ═══════════════════</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> outer<span class="op">=</span><span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>  outer<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span><span class="op">=</span><span class="vs">`display:flex;flex-direction:column;align-items:center;gap:12px;</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-family:'Inter',-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a><span class="vs">    width:100%;max-width:900px;margin:0 auto;`</span><span class="op">;</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="op">!</span><span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'link[href*="Inter"]'</span>)){</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> lk<span class="op">=</span><span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">'link'</span>)<span class="op">;</span>lk<span class="op">.</span><span class="at">rel</span><span class="op">=</span><span class="st">'stylesheet'</span><span class="op">;</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>    lk<span class="op">.</span><span class="at">href</span><span class="op">=</span><span class="st">'https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&amp;display=swap'</span><span class="op">;</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="at">head</span><span class="op">.</span><span class="fu">appendChild</span>(lk)<span class="op">;</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>  outer<span class="op">.</span><span class="fu">appendChild</span>(<span class="fu">injectStyle</span>())<span class="op">;</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ── BUTTONS ──</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ctrlRow<span class="op">=</span><span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>  ctrlRow<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span><span class="op">=</span><span class="st">"display:flex;gap:10px;width:100%;align-items:center;flex-wrap:wrap;"</span><span class="op">;</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">mkBtn</span>(text<span class="op">,</span>color<span class="op">,</span>big){</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> b<span class="op">=</span><span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"button"</span>)<span class="op">;</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>    b<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span><span class="op">=</span><span class="vs">`padding:</span><span class="sc">${</span>big<span class="op">?</span><span class="st">"10px 28px"</span><span class="op">:</span><span class="st">"7px 16px"</span><span class="sc">}</span><span class="vs">;border-radius:</span><span class="sc">${</span>big<span class="op">?</span><span class="dv">12</span><span class="op">:</span><span class="dv">10</span><span class="sc">}</span><span class="vs">px;border:none;</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a><span class="vs">      background:linear-gradient(135deg,</span><span class="sc">${</span>color<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>color<span class="sc">}</span><span class="vs">dd);color:#fff;font-size:</span><span class="sc">${</span>big<span class="op">?</span><span class="dv">15</span><span class="op">:</span><span class="dv">13</span><span class="sc">}</span><span class="vs">px;font-weight:700;cursor:pointer;</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a><span class="vs">      font-family:inherit;transition:all 0.2s ease;letter-spacing:0.3px;</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span><span class="sc">${</span>big<span class="op">?</span><span class="st">"box-shadow:0 4px 14px "</span><span class="op">+</span>color<span class="op">+</span><span class="st">"44;"</span><span class="op">:</span><span class="st">"box-shadow:0 2px 8px rgba(0,0,0,0.12);"</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>    b<span class="op">.</span><span class="at">textContent</span><span class="op">=</span>text<span class="op">;</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>    b<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'mouseenter'</span><span class="op">,</span>()<span class="kw">=&gt;</span>{b<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">transform</span><span class="op">=</span><span class="st">'translateY(-1px)'</span><span class="op">;</span>b<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">boxShadow</span><span class="op">=</span><span class="vs">`0 6px 20px </span><span class="sc">${</span>color<span class="sc">}</span><span class="vs">55`</span><span class="op">;</span>})<span class="op">;</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>    b<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'mouseleave'</span><span class="op">,</span>()<span class="kw">=&gt;</span>{b<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">transform</span><span class="op">=</span><span class="st">'translateY(0)'</span><span class="op">;</span>b<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">boxShadow</span><span class="op">=</span>big<span class="op">?</span><span class="vs">`0 4px 14px </span><span class="sc">${</span>color<span class="sc">}</span><span class="vs">44`</span><span class="op">:</span><span class="st">'0 2px 8px rgba(0,0,0,0.12)'</span><span class="op">;</span>})<span class="op">;</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> b<span class="op">;</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> btnStep<span class="op">=</span><span class="fu">mkBtn</span>(<span class="st">"▶  Bước tiếp theo"</span><span class="op">,</span>C<span class="op">.</span><span class="at">current</span><span class="op">,</span><span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> btnAuto<span class="op">=</span><span class="fu">mkBtn</span>(<span class="st">"⏩ Chạy tự động"</span><span class="op">,</span><span class="st">"#6A1B9A"</span><span class="op">,</span><span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> btnReset<span class="op">=</span><span class="fu">mkBtn</span>(<span class="st">"↺ Đặt lại"</span><span class="op">,</span><span class="st">"#78909C"</span><span class="op">,</span><span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> stepLabel<span class="op">=</span><span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"span"</span>)<span class="op">;</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>  stepLabel<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span><span class="op">=</span><span class="vs">`font-size:13px;font-weight:700;color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">sub</span><span class="sc">}</span><span class="vs">;font-family:</span><span class="sc">${</span>mono<span class="sc">}</span><span class="vs">;margin-left:auto;`</span><span class="op">;</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>  ctrlRow<span class="op">.</span><span class="fu">append</span>(btnStep<span class="op">,</span>btnAuto<span class="op">,</span>btnReset<span class="op">,</span>stepLabel)<span class="op">;</span></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>  outer<span class="op">.</span><span class="fu">appendChild</span>(ctrlRow)<span class="op">;</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ── MODEL SLIDERS ──</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> SL<span class="op">=</span>{}<span class="op">;</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">sigma</span><span class="op">=</span><span class="fu">createSlider</span>(<span class="st">"Proposal σ"</span><span class="op">,</span><span class="fl">0.01</span><span class="op">,</span><span class="fl">0.30</span><span class="op">,</span><span class="fl">0.01</span><span class="op">,</span><span class="fl">0.08</span><span class="op">,</span>C<span class="op">.</span><span class="at">proposal</span><span class="op">,</span><span class="st">"amber"</span>)<span class="op">;</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">pA</span><span class="op">=</span><span class="fu">createSlider</span>(<span class="st">"Prior α"</span><span class="op">,</span><span class="fl">0.5</span><span class="op">,</span><span class="dv">10</span><span class="op">,</span><span class="fl">0.5</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span>C<span class="op">.</span><span class="at">prior</span><span class="op">,</span><span class="st">"purple"</span>)<span class="op">;</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">pB</span><span class="op">=</span><span class="fu">createSlider</span>(<span class="st">"Prior β"</span><span class="op">,</span><span class="fl">0.5</span><span class="op">,</span><span class="dv">10</span><span class="op">,</span><span class="fl">0.5</span><span class="op">,</span><span class="dv">5</span><span class="op">,</span>C<span class="op">.</span><span class="at">prior</span><span class="op">,</span><span class="st">"purple"</span>)<span class="op">;</span></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">dK</span><span class="op">=</span><span class="fu">createSlider</span>(<span class="st">"Quan sát k"</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">50</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">7</span><span class="op">,</span>C<span class="op">.</span><span class="at">lik</span><span class="op">,</span><span class="st">"green"</span>)<span class="op">;</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">dN</span><span class="op">=</span><span class="fu">createSlider</span>(<span class="st">"Số thử n"</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">50</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">20</span><span class="op">,</span>C<span class="op">.</span><span class="at">lik</span><span class="op">,</span><span class="st">"green"</span>)<span class="op">;</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sr1<span class="op">=</span><span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span>sr1<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span><span class="op">=</span><span class="st">"display:flex;gap:14px;width:100%;"</span><span class="op">;</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>  sr1<span class="op">.</span><span class="fu">append</span>(SL<span class="op">.</span><span class="at">sigma</span><span class="op">.</span><span class="at">el</span><span class="op">,</span>SL<span class="op">.</span><span class="at">pA</span><span class="op">.</span><span class="at">el</span><span class="op">,</span>SL<span class="op">.</span><span class="at">pB</span><span class="op">.</span><span class="at">el</span>)<span class="op">;</span></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sr2<span class="op">=</span><span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span>sr2<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span><span class="op">=</span><span class="st">"display:flex;gap:14px;width:100%;"</span><span class="op">;</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>  sr2<span class="op">.</span><span class="fu">append</span>(SL<span class="op">.</span><span class="at">dK</span><span class="op">.</span><span class="at">el</span><span class="op">,</span>SL<span class="op">.</span><span class="at">dN</span><span class="op">.</span><span class="at">el</span>)<span class="op">;</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>  outer<span class="op">.</span><span class="fu">append</span>(sr1<span class="op">,</span>sr2)<span class="op">;</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ── MCMC DIAGNOSTICS ──</span></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">burnin</span><span class="op">=</span><span class="fu">createSlider</span>(<span class="st">"Burn-in"</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">300</span><span class="op">,</span><span class="dv">5</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span>C<span class="op">.</span><span class="at">burnLine</span><span class="op">,</span><span class="st">"red"</span>)<span class="op">;</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">thin</span><span class="op">=</span><span class="fu">createSlider</span>(<span class="st">"Thinning (every k-th)"</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">20</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span>C<span class="op">.</span><span class="at">filt</span><span class="op">,</span><span class="st">"green"</span>)<span class="op">;</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">mkToggle</span>(label<span class="op">,</span>color){</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> w<span class="op">=</span><span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"label"</span>)<span class="op">;</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>    w<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span><span class="op">=</span><span class="vs">`display:inline-flex;align-items:center;gap:6px;cursor:pointer;</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a><span class="vs">      padding:6px 14px;border-radius:10px;background:#f5f5f5;</span></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a><span class="vs">      border:1.5px solid #E0E0E0;transition:all 0.2s;font-size:12px;font-weight:600;</span></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a><span class="vs">      color:#9E9E9E;white-space:nowrap;user-select:none;`</span><span class="op">;</span></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cb<span class="op">=</span><span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"input"</span>)<span class="op">;</span>cb<span class="op">.</span><span class="at">type</span><span class="op">=</span><span class="st">"checkbox"</span><span class="op">;</span></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>    cb<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span><span class="op">=</span><span class="vs">`accent-color:</span><span class="sc">${</span>color<span class="sc">}</span><span class="vs">;width:15px;height:15px;cursor:pointer;`</span><span class="op">;</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>    w<span class="op">.</span><span class="fu">append</span>(cb<span class="op">,</span><span class="bu">document</span><span class="op">.</span><span class="fu">createTextNode</span>(label))<span class="op">;</span></span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">s_</span>(){w<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">background</span><span class="op">=</span>cb<span class="op">.</span><span class="at">checked</span><span class="op">?</span>color<span class="op">+</span><span class="st">'15'</span><span class="op">:</span><span class="st">'#f5f5f5'</span><span class="op">;</span>w<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">borderColor</span><span class="op">=</span>cb<span class="op">.</span><span class="at">checked</span><span class="op">?</span>color<span class="op">:</span><span class="st">'#E0E0E0'</span><span class="op">;</span>w<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">color</span><span class="op">=</span>cb<span class="op">.</span><span class="at">checked</span><span class="op">?</span>color<span class="op">:</span><span class="st">'#9E9E9E'</span><span class="op">;</span>}</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>    cb<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"change"</span><span class="op">,</span>s_)<span class="op">;</span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>{<span class="dt">el</span><span class="op">:</span>w<span class="op">,</span>cb}<span class="op">;</span></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> togBurn<span class="op">=</span><span class="fu">mkToggle</span>(<span class="st">"Burn-in"</span><span class="op">,</span>C<span class="op">.</span><span class="at">burnLine</span>)<span class="op">;</span></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> togThin<span class="op">=</span><span class="fu">mkToggle</span>(<span class="st">"Thinning"</span><span class="op">,</span>C<span class="op">.</span><span class="at">filt</span>)<span class="op">;</span></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> diagRow<span class="op">=</span><span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>  diagRow<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span><span class="op">=</span><span class="st">"display:flex;gap:12px;width:100%;align-items:end;"</span><span class="op">;</span></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>  diagRow<span class="op">.</span><span class="fu">append</span>(SL<span class="op">.</span><span class="at">burnin</span><span class="op">.</span><span class="at">el</span><span class="op">,</span>SL<span class="op">.</span><span class="at">thin</span><span class="op">.</span><span class="at">el</span><span class="op">,</span>togBurn<span class="op">.</span><span class="at">el</span><span class="op">,</span>togThin<span class="op">.</span><span class="at">el</span>)<span class="op">;</span></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>  outer<span class="op">.</span><span class="fu">appendChild</span>(diagRow)<span class="op">;</span></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ── STATUS BOX ──</span></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> statusBox<span class="op">=</span><span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>  statusBox<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span><span class="op">=</span><span class="vs">`width:100%;padding:14px 20px;border-radius:14px;</span></span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a><span class="vs">    background:linear-gradient(135deg,#FAFAFA,#F5F5F5);backdrop-filter:blur(8px);</span></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a><span class="vs">    border:2px solid </span><span class="sc">${</span>C<span class="op">.</span><span class="at">border</span><span class="sc">}</span><span class="vs">;font-size:13px;font-family:</span><span class="sc">${</span>mono<span class="sc">}</span><span class="vs">;color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">txt</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a><span class="vs">    line-height:1.7;min-height:44px;transition:all 0.3s ease;</span></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a><span class="vs">    box-shadow:0 2px 12px rgba(0,0,0,0.04);`</span><span class="op">;</span></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ MAIN SVG ═══════════════════</span></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> W<span class="op">=</span><span class="dv">900</span><span class="op">,</span>totalH<span class="op">=</span><span class="dv">260</span><span class="op">;</span></span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> traceW<span class="op">=</span><span class="dv">640</span><span class="op">,</span>histW_<span class="op">=</span>W<span class="op">-</span>traceW<span class="op">;</span></span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mg<span class="op">=</span>{<span class="dt">l</span><span class="op">:</span><span class="dv">50</span><span class="op">,</span><span class="dt">r</span><span class="op">:</span><span class="dv">8</span><span class="op">,</span><span class="dt">t</span><span class="op">:</span><span class="dv">28</span><span class="op">,</span><span class="dt">b</span><span class="op">:</span><span class="dv">30</span>}<span class="op">;</span></span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tIW<span class="op">=</span>traceW<span class="op">-</span>mg<span class="op">.</span><span class="at">l</span><span class="op">-</span>mg<span class="op">.</span><span class="at">r</span><span class="op">,</span>tIH<span class="op">=</span>totalH<span class="op">-</span>mg<span class="op">.</span><span class="at">t</span><span class="op">-</span>mg<span class="op">.</span><span class="at">b</span><span class="op">;</span></span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hMg<span class="op">=</span>{<span class="dt">l</span><span class="op">:</span><span class="dv">4</span><span class="op">,</span><span class="dt">r</span><span class="op">:</span><span class="dv">24</span><span class="op">,</span><span class="dt">t</span><span class="op">:</span><span class="dv">28</span><span class="op">,</span><span class="dt">b</span><span class="op">:</span><span class="dv">30</span>}<span class="op">;</span></span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hIW<span class="op">=</span>histW_<span class="op">-</span>hMg<span class="op">.</span><span class="at">l</span><span class="op">-</span>hMg<span class="op">.</span><span class="at">r</span><span class="op">,</span>hIH<span class="op">=</span>totalH<span class="op">-</span>hMg<span class="op">.</span><span class="at">t</span><span class="op">-</span>hMg<span class="op">.</span><span class="at">b</span><span class="op">;</span></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg<span class="op">=</span>d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span>[<span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span>W<span class="op">,</span>totalH])</span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span><span class="st">"100%"</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span>W<span class="op">+</span><span class="st">"px"</span>)</span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"border-radius"</span><span class="op">,</span><span class="st">"14px"</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"border"</span><span class="op">,</span><span class="vs">`1px solid </span><span class="sc">${</span>C<span class="op">.</span><span class="at">border</span><span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"background"</span><span class="op">,</span><span class="st">"#fff"</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"box-shadow"</span><span class="op">,</span><span class="st">"0 2px 16px rgba(0,0,0,0.06)"</span>)<span class="op">;</span></span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>  outer<span class="op">.</span><span class="fu">appendChild</span>(svg<span class="op">.</span><span class="fu">node</span>())<span class="op">;</span></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Trace panel</span></span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> traceG<span class="op">=</span>svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span><span class="vs">`translate(</span><span class="sc">${</span>mg<span class="op">.</span><span class="at">l</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>mg<span class="op">.</span><span class="at">t</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>  traceG<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,-</span>mg<span class="op">.</span><span class="at">l</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,-</span>mg<span class="op">.</span><span class="at">t</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span>traceW)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span>totalH)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"#FAFAFA"</span>)<span class="op">;</span></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>  traceG<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span>tIW)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span>tIH)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span>tIH)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"#E0E0E0"</span>)<span class="op">;</span></span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>  traceG<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span>tIH)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"#E0E0E0"</span>)<span class="op">;</span></span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span>mg<span class="op">.</span><span class="at">l</span><span class="op">+</span>tIW<span class="op">/</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span><span class="dv">14</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)</span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">13</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span><span class="dv">700</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">txt</span>)<span class="op">.</span><span class="fu">text</span>(<span class="st">"Biểu đồ vết"</span>)<span class="op">;</span></span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span><span class="dv">14</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span>mg<span class="op">.</span><span class="at">t</span><span class="op">+</span>tIH<span class="op">/</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">11</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span><span class="dv">600</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">sub</span>)</span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span><span class="vs">`rotate(-90,14,</span><span class="sc">${</span>mg<span class="op">.</span><span class="at">t</span><span class="op">+</span>tIH<span class="op">/</span><span class="dv">2</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">.</span><span class="fu">text</span>(<span class="st">"θ"</span>)<span class="op">;</span></span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span>mg<span class="op">.</span><span class="at">l</span><span class="op">+</span>tIW<span class="op">/</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span>totalH<span class="op">-</span><span class="dv">6</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)</span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">10</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">sub</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span><span class="dv">600</span>)<span class="op">.</span><span class="fu">text</span>(<span class="st">"bước"</span>)<span class="op">;</span></span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> traceBurnG<span class="op">=</span>traceG<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> traceLineG<span class="op">=</span>traceG<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> traceProposalG<span class="op">=</span>traceG<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tracePointsG<span class="op">=</span>traceG<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Histogram panel</span></span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> histG<span class="op">=</span>svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span><span class="vs">`translate(</span><span class="sc">${</span>traceW<span class="op">+</span>hMg<span class="op">.</span><span class="at">l</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>hMg<span class="op">.</span><span class="at">t</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>  histG<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span>hIH)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"#E0E0E0"</span>)<span class="op">;</span></span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> histTitle<span class="op">=</span>svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span>traceW<span class="op">+</span>histW_<span class="op">/</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span><span class="dv">14</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)</span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">13</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span><span class="dv">700</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">txt</span>)<span class="op">;</span></span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span>traceW)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span>traceW)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span>totalH)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"#CFD8DC"</span>)<span class="op">;</span></span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> histGhostG<span class="op">=</span>histG<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> histBarsG<span class="op">=</span>histG<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> histCurveG<span class="op">=</span>histG<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ── MERGED Prior+Likelihood ──</span></span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> BH<span class="op">=</span><span class="dv">200</span><span class="op">;</span></span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bsvg<span class="op">=</span>d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span>[<span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span>W<span class="op">,</span>BH])</span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span><span class="st">"100%"</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span>W<span class="op">+</span><span class="st">"px"</span>)</span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"border-radius"</span><span class="op">,</span><span class="st">"14px"</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"border"</span><span class="op">,</span><span class="vs">`1px solid </span><span class="sc">${</span>C<span class="op">.</span><span class="at">border</span><span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"background"</span><span class="op">,</span><span class="st">"#fff"</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"box-shadow"</span><span class="op">,</span><span class="st">"0 2px 16px rgba(0,0,0,0.06)"</span>)<span class="op">;</span></span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>  outer<span class="op">.</span><span class="fu">appendChild</span>(bsvg<span class="op">.</span><span class="fu">node</span>())<span class="op">;</span></span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>  outer<span class="op">.</span><span class="fu">appendChild</span>(statusBox)<span class="op">;</span></span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bMg<span class="op">=</span>{<span class="dt">t</span><span class="op">:</span><span class="dv">26</span><span class="op">,</span><span class="dt">b</span><span class="op">:</span><span class="dv">28</span><span class="op">,</span><span class="dt">l</span><span class="op">:</span><span class="dv">44</span><span class="op">,</span><span class="dt">r</span><span class="op">:</span><span class="dv">16</span>}<span class="op">;</span></span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bw<span class="op">=</span>W<span class="op">-</span>bMg<span class="op">.</span><span class="at">l</span><span class="op">-</span>bMg<span class="op">.</span><span class="at">r</span><span class="op">,</span>halfBH<span class="op">=</span>(BH<span class="op">-</span>bMg<span class="op">.</span><span class="at">t</span><span class="op">-</span>bMg<span class="op">.</span><span class="at">b</span>)<span class="op">/</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bxS<span class="op">=</span>d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span><span class="dv">1</span>])<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span>bw])<span class="op">;</span></span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> midY<span class="op">=</span>bMg<span class="op">.</span><span class="at">t</span><span class="op">+</span>halfBH<span class="op">;</span></span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mergedTitleEl<span class="op">=</span>bsvg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span>bMg<span class="op">.</span><span class="at">l</span><span class="op">+</span>bw<span class="op">/</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span><span class="dv">14</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)</span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">12</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span><span class="dv">700</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">txt</span>)<span class="op">;</span></span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mergedG<span class="op">=</span>bsvg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span><span class="vs">`translate(</span><span class="sc">${</span>bMg<span class="op">.</span><span class="at">l</span><span class="sc">}</span><span class="vs">,0)`</span>)<span class="op">;</span></span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>  mergedG<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span>bw)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span>midY)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span>midY)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"#BDBDBD"</span>)<span class="op">;</span></span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a>  mergedG<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span>bMg<span class="op">.</span><span class="at">t</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span>BH<span class="op">-</span>bMg<span class="op">.</span><span class="at">b</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"#E0E0E0"</span>)<span class="op">;</span></span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a>  bsvg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span>bMg<span class="op">.</span><span class="at">l</span><span class="op">+</span>bw<span class="op">/</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span>BH<span class="op">-</span><span class="dv">6</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)</span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">10</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">sub</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span><span class="dv">600</span>)<span class="op">.</span><span class="fu">text</span>(<span class="st">"θ"</span>)<span class="op">;</span></span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">0</span><span class="op">,</span><span class="fl">0.25</span><span class="op">,</span><span class="fl">0.5</span><span class="op">,</span><span class="fl">0.75</span><span class="op">,</span><span class="dv">1</span>]<span class="op">.</span><span class="fu">forEach</span>(v<span class="kw">=&gt;</span>{</span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a>    mergedG<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span><span class="fu">bxS</span>(v))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span>BH<span class="op">-</span>bMg<span class="op">.</span><span class="at">b</span><span class="op">+</span><span class="dv">14</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)</span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">9</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">sub</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span>mono)<span class="op">.</span><span class="fu">text</span>(v<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a>  bsvg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span><span class="dv">12</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span>midY<span class="op">-</span>halfBH<span class="op">/</span><span class="dv">2</span><span class="op">+</span><span class="dv">4</span>)</span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">9</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span><span class="dv">600</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">prior</span>)<span class="op">.</span><span class="fu">text</span>(<span class="st">"Prior"</span>)<span class="op">;</span></span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>  bsvg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span><span class="dv">12</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span>midY<span class="op">+</span>halfBH<span class="op">/</span><span class="dv">2</span><span class="op">+</span><span class="dv">4</span>)</span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">9</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span><span class="dv">600</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">lik</span>)<span class="op">.</span><span class="fu">text</span>(<span class="st">"Lik."</span>)<span class="op">;</span></span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> staticG<span class="op">=</span>mergedG<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mergedMarkers<span class="op">=</span>mergedG<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> pyS<span class="op">,</span>lyS<span class="op">;</span></span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> curvePts<span class="op">=</span>d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span><span class="fl">1.005</span><span class="op">,</span><span class="fl">0.005</span>)<span class="op">;</span></span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">drawStatic</span>(){</span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a>    staticG<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"*"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pV<span class="op">=</span>curvePts<span class="op">.</span><span class="fu">map</span>(t<span class="kw">=&gt;</span>({<span class="dt">x</span><span class="op">:</span>t<span class="op">,</span><span class="dt">y</span><span class="op">:</span><span class="fu">prior</span>(t)}))<span class="op">;</span></span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> lV<span class="op">=</span>curvePts<span class="op">.</span><span class="fu">map</span>(t<span class="kw">=&gt;</span>({<span class="dt">x</span><span class="op">:</span>t<span class="op">,</span><span class="dt">y</span><span class="op">:</span><span class="fu">likNorm</span>(t)}))<span class="op">;</span></span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> mxP<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>pV<span class="op">.</span><span class="fu">map</span>(d<span class="kw">=&gt;</span>d<span class="op">.</span><span class="at">y</span>))<span class="op">||</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a>    pyS<span class="op">=</span>d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span>mxP<span class="op">*</span><span class="fl">1.1</span>])<span class="op">.</span><span class="fu">range</span>([midY<span class="op">,</span>bMg<span class="op">.</span><span class="at">t</span>])<span class="op">;</span></span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a>    lyS<span class="op">=</span>d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span><span class="fl">1.1</span>])<span class="op">.</span><span class="fu">range</span>([midY<span class="op">,</span>BH<span class="op">-</span>bMg<span class="op">.</span><span class="at">b</span>])<span class="op">;</span></span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pArea<span class="op">=</span>d3<span class="op">.</span><span class="fu">area</span>()<span class="op">.</span><span class="fu">x</span>(d<span class="kw">=&gt;</span><span class="fu">bxS</span>(d<span class="op">.</span><span class="at">x</span>))<span class="op">.</span><span class="fu">y0</span>(midY)<span class="op">.</span><span class="fu">y1</span>(d<span class="kw">=&gt;</span><span class="fu">pyS</span>(d<span class="op">.</span><span class="at">y</span>))<span class="op">.</span><span class="fu">curve</span>(d3<span class="op">.</span><span class="at">curveBasis</span>)<span class="op">;</span></span>
<span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pLine<span class="op">=</span>d3<span class="op">.</span><span class="fu">line</span>()<span class="op">.</span><span class="fu">x</span>(d<span class="kw">=&gt;</span><span class="fu">bxS</span>(d<span class="op">.</span><span class="at">x</span>))<span class="op">.</span><span class="fu">y</span>(d<span class="kw">=&gt;</span><span class="fu">pyS</span>(d<span class="op">.</span><span class="at">y</span>))<span class="op">.</span><span class="fu">curve</span>(d3<span class="op">.</span><span class="at">curveBasis</span>)<span class="op">;</span></span>
<span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a>    staticG<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span><span class="fu">pArea</span>(pV))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">prior</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="fl">0.13</span>)<span class="op">;</span></span>
<span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a>    staticG<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span><span class="fu">pLine</span>(pV))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"none"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">prior</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> lArea<span class="op">=</span>d3<span class="op">.</span><span class="fu">area</span>()<span class="op">.</span><span class="fu">x</span>(d<span class="kw">=&gt;</span><span class="fu">bxS</span>(d<span class="op">.</span><span class="at">x</span>))<span class="op">.</span><span class="fu">y0</span>(midY)<span class="op">.</span><span class="fu">y1</span>(d<span class="kw">=&gt;</span><span class="fu">lyS</span>(d<span class="op">.</span><span class="at">y</span>))<span class="op">.</span><span class="fu">curve</span>(d3<span class="op">.</span><span class="at">curveBasis</span>)<span class="op">;</span></span>
<span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> lLine<span class="op">=</span>d3<span class="op">.</span><span class="fu">line</span>()<span class="op">.</span><span class="fu">x</span>(d<span class="kw">=&gt;</span><span class="fu">bxS</span>(d<span class="op">.</span><span class="at">x</span>))<span class="op">.</span><span class="fu">y</span>(d<span class="kw">=&gt;</span><span class="fu">lyS</span>(d<span class="op">.</span><span class="at">y</span>))<span class="op">.</span><span class="fu">curve</span>(d3<span class="op">.</span><span class="at">curveBasis</span>)<span class="op">;</span></span>
<span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a>    staticG<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span><span class="fu">lArea</span>(lV))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">lik</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="fl">0.13</span>)<span class="op">;</span></span>
<span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a>    staticG<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span><span class="fu">lLine</span>(lV))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"none"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">lik</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a>    mergedTitleEl<span class="op">.</span><span class="fu">text</span>(<span class="vs">`Prior: Beta(</span><span class="sc">${</span>priorA<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>priorB<span class="sc">}</span><span class="vs">)  ·  Lik: Bin(</span><span class="sc">${</span>dataK<span class="sc">}</span><span class="vs">/</span><span class="sc">${</span>dataN<span class="sc">}</span><span class="vs">,θ)  ·  Post: Beta(</span><span class="sc">${</span>postA_<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>postB_<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drawStatic</span>()<span class="op">;</span></span>
<span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ RENDER ═══════════════════</span></span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">render</span>(){</span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a>    proposalSigma<span class="op">=</span>SL<span class="op">.</span><span class="at">sigma</span><span class="op">.</span><span class="fu">val</span>()<span class="op">;</span></span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> useBurn<span class="op">=</span>togBurn<span class="op">.</span><span class="at">cb</span><span class="op">.</span><span class="at">checked</span><span class="op">,</span>useThin<span class="op">=</span>togThin<span class="op">.</span><span class="at">cb</span><span class="op">.</span><span class="at">checked</span><span class="op">;</span></span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> burnin<span class="op">=</span>SL<span class="op">.</span><span class="at">burnin</span><span class="op">.</span><span class="fu">val</span>()<span class="op">,</span>thin<span class="op">=</span>SL<span class="op">.</span><span class="at">thin</span><span class="op">.</span><span class="fu">val</span>()<span class="op">;</span></span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Only actually filter when the toggle is on AND the value changes something</span></span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> burnActive<span class="op">=</span>useBurn<span class="op">&amp;&amp;</span>burnin<span class="op">&gt;</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> thinActive<span class="op">=</span>useThin<span class="op">&amp;&amp;</span>thin<span class="op">&gt;</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> useFilter<span class="op">=</span>burnActive<span class="op">||</span>thinActive<span class="op">;</span></span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> effBurn<span class="op">=</span>burnActive<span class="op">?</span>burnin<span class="op">:</span><span class="dv">0</span><span class="op">,</span>effThin<span class="op">=</span>thinActive<span class="op">?</span>thin<span class="op">:</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> curVal<span class="op">=</span>chain[chain<span class="op">.</span><span class="at">length</span><span class="op">-</span><span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> thetaS<span class="op">=</span>d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span><span class="dv">1</span>])<span class="op">.</span><span class="fu">range</span>([tIH<span class="op">,</span><span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> histThetaS<span class="op">=</span>d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span><span class="dv">1</span>])<span class="op">.</span><span class="fu">range</span>([hIH<span class="op">,</span><span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> maxVis<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(chain<span class="op">.</span><span class="at">length</span><span class="op">+</span><span class="dv">5</span><span class="op">,</span><span class="dv">60</span>)<span class="op">;</span></span>
<span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> stepS<span class="op">=</span>d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([<span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span>chain<span class="op">.</span><span class="at">length</span><span class="op">-</span>maxVis)<span class="op">,</span>chain<span class="op">.</span><span class="at">length</span><span class="op">+</span><span class="dv">2</span>])<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span>tIW])<span class="op">;</span></span>
<span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ── TRACE ──</span></span>
<span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a>    traceLineG<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"*"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a>    traceProposalG<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"*"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a>    tracePointsG<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"*"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a>    traceBurnG<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"*"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a>    traceG<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".yt"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span><span class="op">,</span><span class="fl">0.25</span><span class="op">,</span><span class="fl">0.5</span><span class="op">,</span><span class="fl">0.75</span><span class="op">,</span><span class="dv">1</span>]<span class="op">.</span><span class="fu">forEach</span>(v<span class="kw">=&gt;</span>{</span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a>      traceG<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span><span class="st">"yt"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,-</span><span class="dv">8</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span><span class="fu">thetaS</span>(v)<span class="op">+</span><span class="dv">3</span>)</span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"end"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">9</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">sub</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span>mono)<span class="op">.</span><span class="fu">text</span>(v<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a>      traceG<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span><span class="st">"yt"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span><span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span>tIW)</span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span><span class="fu">thetaS</span>(v))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span><span class="fu">thetaS</span>(v))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"#F0F0F0"</span>)<span class="op">;</span></span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Burn-in overlay</span></span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(burnActive<span class="op">&amp;&amp;</span>burnin<span class="op">&lt;</span>chain<span class="op">.</span><span class="at">length</span>){</span>
<span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> bx<span class="op">=</span><span class="fu">stepS</span>(burnin)<span class="op">;</span></span>
<span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a>      traceBurnG<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span><span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span><span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span>bx))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span>tIH)</span>
<span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">burnLine</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="fl">0.06</span>)<span class="op">;</span></span>
<span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a>      traceBurnG<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span>bx)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span>bx)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span><span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span>tIH)</span>
<span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">burnLine</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span><span class="st">"6,4"</span>)<span class="op">;</span></span>
<span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a>      traceBurnG<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span>bx<span class="op">+</span><span class="dv">4</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span><span class="dv">12</span>)</span>
<span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">10</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span><span class="dv">700</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">burnLine</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span>mono)<span class="op">.</span><span class="fu">text</span>(<span class="vs">`burn-in = </span><span class="sc">${</span>burnin<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Trace line</span></span>
<span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(chain<span class="op">.</span><span class="at">length</span><span class="op">&gt;</span><span class="dv">1</span>){</span>
<span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(burnActive<span class="op">&amp;&amp;</span>burnin<span class="op">&lt;</span>chain<span class="op">.</span><span class="at">length</span>){</span>
<span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Burned portion faded</span></span>
<span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> bp<span class="op">=</span>chain<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(burnin<span class="op">+</span><span class="dv">1</span><span class="op">,</span>chain<span class="op">.</span><span class="at">length</span>))<span class="op">;</span></span>
<span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(bp<span class="op">.</span><span class="at">length</span><span class="op">&gt;</span><span class="dv">1</span>) traceLineG<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span>bp<span class="op">.</span><span class="fu">map</span>((v<span class="op">,</span>i)<span class="kw">=&gt;</span><span class="vs">`</span><span class="sc">${</span>i<span class="op">?</span><span class="st">'L'</span><span class="op">:</span><span class="st">'M'</span><span class="sc">}${</span><span class="fu">stepS</span>(i)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span><span class="fu">thetaS</span>(v)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">`</span>)<span class="op">.</span><span class="fu">join</span>(<span class="st">""</span>))</span>
<span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"none"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">burned</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="fl">1.5</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="fl">0.4</span>)<span class="op">;</span></span>
<span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> pp<span class="op">=</span>chain<span class="op">.</span><span class="fu">slice</span>(burnin)<span class="op">;</span></span>
<span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(pp<span class="op">.</span><span class="at">length</span><span class="op">&gt;</span><span class="dv">1</span>) traceLineG<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb2-288"><a href="#cb2-288" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span>pp<span class="op">.</span><span class="fu">map</span>((v<span class="op">,</span>i)<span class="kw">=&gt;</span><span class="vs">`</span><span class="sc">${</span>i<span class="op">?</span><span class="st">'L'</span><span class="op">:</span><span class="st">'M'</span><span class="sc">}${</span><span class="fu">stepS</span>(burnin<span class="op">+</span>i)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span><span class="fu">thetaS</span>(v)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">`</span>)<span class="op">.</span><span class="fu">join</span>(<span class="st">""</span>))</span>
<span id="cb2-289"><a href="#cb2-289" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"none"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">trace</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="fl">1.3</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="fl">0.7</span>)<span class="op">;</span></span>
<span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a>        traceLineG<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span>chain<span class="op">.</span><span class="fu">map</span>((v<span class="op">,</span>i)<span class="kw">=&gt;</span><span class="vs">`</span><span class="sc">${</span>i<span class="op">?</span><span class="st">'L'</span><span class="op">:</span><span class="st">'M'</span><span class="sc">}${</span><span class="fu">stepS</span>(i)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span><span class="fu">thetaS</span>(v)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">`</span>)<span class="op">.</span><span class="fu">join</span>(<span class="st">""</span>))</span>
<span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"none"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">trace</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="fl">1.2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="fl">0.6</span>)<span class="op">;</span></span>
<span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-295"><a href="#cb2-295" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-296"><a href="#cb2-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-297"><a href="#cb2-297" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Points</span></span>
<span id="cb2-298"><a href="#cb2-298" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> visStart<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span>chain<span class="op">.</span><span class="at">length</span><span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(maxVis))<span class="op">;</span></span>
<span id="cb2-299"><a href="#cb2-299" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span>visStart<span class="op">;</span>i<span class="op">&lt;</span>chain<span class="op">.</span><span class="at">length</span><span class="op">;</span>i<span class="op">++</span>){</span>
<span id="cb2-300"><a href="#cb2-300" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> isLast<span class="op">=</span>i<span class="op">===</span>chain<span class="op">.</span><span class="at">length</span><span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-301"><a href="#cb2-301" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> isBurned<span class="op">=</span>burnActive<span class="op">&amp;&amp;</span>i<span class="op">&lt;</span>burnin<span class="op">;</span></span>
<span id="cb2-302"><a href="#cb2-302" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> isKept<span class="op">=!</span>isBurned<span class="op">&amp;&amp;</span>(effThin<span class="op">&lt;=</span><span class="dv">1</span><span class="op">||</span>(i<span class="op">-</span>effBurn)<span class="op">%</span>effThin<span class="op">===</span><span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb2-303"><a href="#cb2-303" aria-hidden="true" tabindex="-1"></a>      tracePointsG<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb2-304"><a href="#cb2-304" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span><span class="fu">stepS</span>(i))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span><span class="fu">thetaS</span>(chain[i]))</span>
<span id="cb2-305"><a href="#cb2-305" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span>isLast<span class="op">?</span><span class="dv">5</span><span class="op">:</span> (thinActive<span class="op">&amp;&amp;!</span>isBurned<span class="op">&amp;&amp;</span>isKept)<span class="op">?</span><span class="dv">3</span><span class="op">:</span><span class="fl">1.5</span>)</span>
<span id="cb2-306"><a href="#cb2-306" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>isLast<span class="op">?</span>C<span class="op">.</span><span class="at">current</span><span class="op">:</span> isBurned<span class="op">?</span>C<span class="op">.</span><span class="at">burned</span><span class="op">:</span> isKept<span class="op">?</span>C<span class="op">.</span><span class="at">trace</span><span class="op">:</span>C<span class="op">.</span><span class="at">traceLight</span>)</span>
<span id="cb2-307"><a href="#cb2-307" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span>isBurned<span class="op">?</span><span class="fl">0.25</span><span class="op">:</span> isKept<span class="op">?</span><span class="dv">1</span><span class="op">:</span><span class="fl">0.2</span>)</span>
<span id="cb2-308"><a href="#cb2-308" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>isLast<span class="op">?</span><span class="st">"#fff"</span><span class="op">:</span><span class="st">"none"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span>isLast<span class="op">?</span><span class="dv">2</span><span class="op">:</span><span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb2-309"><a href="#cb2-309" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-310"><a href="#cb2-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-311"><a href="#cb2-311" aria-hidden="true" tabindex="-1"></a>    tracePointsG<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span><span class="fu">stepS</span>(chain<span class="op">.</span><span class="at">length</span><span class="op">-</span><span class="dv">1</span>))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span><span class="fu">thetaS</span>(curVal)<span class="op">-</span><span class="dv">10</span>)</span>
<span id="cb2-312"><a href="#cb2-312" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">11</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span><span class="dv">700</span>)</span>
<span id="cb2-313"><a href="#cb2-313" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">current</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span>mono)<span class="op">.</span><span class="fu">text</span>(<span class="vs">`θ = </span><span class="sc">${</span>curVal<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb2-314"><a href="#cb2-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-315"><a href="#cb2-315" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Proposal</span></span>
<span id="cb2-316"><a href="#cb2-316" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(stepPhase<span class="op">===</span><span class="st">"proposed"</span><span class="op">||</span>stepPhase<span class="op">===</span><span class="st">"decided"</span>){</span>
<span id="cb2-317"><a href="#cb2-317" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> pc<span class="op">=</span>stepPhase<span class="op">===</span><span class="st">"decided"</span><span class="op">?</span>(accepted<span class="op">?</span>C<span class="op">.</span><span class="at">accept</span><span class="op">:</span>C<span class="op">.</span><span class="at">reject</span>)<span class="op">:</span>C<span class="op">.</span><span class="at">propose</span><span class="op">;</span></span>
<span id="cb2-318"><a href="#cb2-318" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> cIdx<span class="op">=</span>propStepIdx<span class="op">-</span><span class="dv">1</span><span class="op">,</span>cT<span class="op">=</span>chain[cIdx]<span class="op">,</span>cx<span class="op">=</span><span class="fu">stepS</span>(cIdx)<span class="op">,</span>px<span class="op">=</span><span class="fu">stepS</span>(propStepIdx)<span class="op">;</span></span>
<span id="cb2-319"><a href="#cb2-319" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> nP<span class="op">=</span><span class="dv">60</span><span class="op">,</span>pp<span class="op">=</span>[]<span class="op">;</span></span>
<span id="cb2-320"><a href="#cb2-320" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;=</span>nP<span class="op">;</span>i<span class="op">++</span>){<span class="kw">const</span> z<span class="op">=-</span><span class="dv">3</span><span class="op">+</span><span class="dv">6</span><span class="op">*</span>i<span class="op">/</span>nP<span class="op">;</span></span>
<span id="cb2-321"><a href="#cb2-321" aria-hidden="true" tabindex="-1"></a>        pp<span class="op">.</span><span class="fu">push</span>({<span class="dt">theta</span><span class="op">:</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">1</span><span class="op">,</span>cT<span class="op">+</span>z<span class="op">*</span>proposalSigma))<span class="op">,</span><span class="dt">density</span><span class="op">:</span><span class="fu">normalPDF</span>(z<span class="op">*</span>proposalSigma<span class="op">,</span><span class="dv">0</span><span class="op">,</span>proposalSigma)})<span class="op">;</span>}</span>
<span id="cb2-322"><a href="#cb2-322" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> mD<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>pp<span class="op">.</span><span class="fu">map</span>(d<span class="kw">=&gt;</span>d<span class="op">.</span><span class="at">density</span>))<span class="op">;</span></span>
<span id="cb2-323"><a href="#cb2-323" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> pD<span class="op">=</span><span class="vs">`M</span><span class="sc">${</span>cx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span><span class="fu">thetaS</span>(pp[<span class="dv">0</span>]<span class="op">.</span><span class="at">theta</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb2-324"><a href="#cb2-324" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(<span class="kw">const</span> d <span class="kw">of</span> pp) pD<span class="op">+=</span><span class="vs">`L</span><span class="sc">${</span>(cx<span class="op">+</span>(d<span class="op">.</span><span class="at">density</span><span class="op">/</span>mD)<span class="op">*</span><span class="dv">40</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span><span class="fu">thetaS</span>(d<span class="op">.</span><span class="at">theta</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb2-325"><a href="#cb2-325" aria-hidden="true" tabindex="-1"></a>      pD<span class="op">+=</span><span class="vs">`L</span><span class="sc">${</span>cx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span><span class="fu">thetaS</span>(pp[pp<span class="op">.</span><span class="at">length</span><span class="op">-</span><span class="dv">1</span>]<span class="op">.</span><span class="at">theta</span>)<span class="sc">}</span><span class="vs">Z`</span><span class="op">;</span></span>
<span id="cb2-326"><a href="#cb2-326" aria-hidden="true" tabindex="-1"></a>      traceProposalG<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span>pD)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">proposal</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="fl">0.18</span>)</span>
<span id="cb2-327"><a href="#cb2-327" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">proposal</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="dv">1</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span><span class="fl">0.3</span>)<span class="op">;</span></span>
<span id="cb2-328"><a href="#cb2-328" aria-hidden="true" tabindex="-1"></a>      traceProposalG<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span>cx)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span><span class="fu">thetaS</span>(cT))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span>px)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span><span class="fu">thetaS</span>(proposed))</span>
<span id="cb2-329"><a href="#cb2-329" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>pc)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="fl">1.5</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span><span class="st">"4,3"</span>)<span class="op">;</span></span>
<span id="cb2-330"><a href="#cb2-330" aria-hidden="true" tabindex="-1"></a>      traceProposalG<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span>px)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span><span class="fu">thetaS</span>(proposed))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span><span class="dv">5</span>)</span>
<span id="cb2-331"><a href="#cb2-331" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>pc)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"#fff"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb2-332"><a href="#cb2-332" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> sym<span class="op">=</span>stepPhase<span class="op">===</span><span class="st">"decided"</span><span class="op">?</span>(accepted<span class="op">?</span><span class="st">"✓"</span><span class="op">:</span><span class="st">"✗"</span>)<span class="op">:</span><span class="st">"?"</span><span class="op">;</span></span>
<span id="cb2-333"><a href="#cb2-333" aria-hidden="true" tabindex="-1"></a>      traceProposalG<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span>px)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span><span class="fu">thetaS</span>(proposed)<span class="op">+</span>(proposed<span class="op">&gt;</span>cT<span class="op">?-</span><span class="dv">10</span><span class="op">:</span><span class="dv">14</span>))</span>
<span id="cb2-334"><a href="#cb2-334" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">11</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span><span class="dv">700</span>)</span>
<span id="cb2-335"><a href="#cb2-335" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>pc)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span>mono)<span class="op">.</span><span class="fu">text</span>(<span class="vs">`</span><span class="sc">${</span>sym<span class="sc">}</span><span class="vs"> θ*=</span><span class="sc">${</span>proposed<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb2-336"><a href="#cb2-336" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-337"><a href="#cb2-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-338"><a href="#cb2-338" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ── HISTOGRAM ──</span></span>
<span id="cb2-339"><a href="#cb2-339" aria-hidden="true" tabindex="-1"></a>    histGhostG<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"*"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb2-340"><a href="#cb2-340" aria-hidden="true" tabindex="-1"></a>    histBarsG<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"*"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb2-341"><a href="#cb2-341" aria-hidden="true" tabindex="-1"></a>    histCurveG<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"*"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb2-342"><a href="#cb2-342" aria-hidden="true" tabindex="-1"></a>    histG<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".yt"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb2-343"><a href="#cb2-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-344"><a href="#cb2-344" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> nBins<span class="op">=</span><span class="dv">30</span><span class="op">,</span>binH_<span class="op">=</span><span class="dv">1</span><span class="op">/</span>nBins<span class="op">,</span>barH_<span class="op">=</span>hIH<span class="op">/</span>nBins<span class="op">;</span></span>
<span id="cb2-345"><a href="#cb2-345" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> binsRaw<span class="op">=</span><span class="bu">Array</span>(nBins)<span class="op">.</span><span class="fu">fill</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb2-346"><a href="#cb2-346" aria-hidden="true" tabindex="-1"></a>    samples<span class="op">.</span><span class="fu">forEach</span>(s<span class="kw">=&gt;</span>{binsRaw[<span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(s<span class="op">/</span>binH_)<span class="op">,</span>nBins<span class="op">-</span><span class="dv">1</span>)]<span class="op">++;</span>})<span class="op">;</span></span>
<span id="cb2-347"><a href="#cb2-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-348"><a href="#cb2-348" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Filtered samples from full chain</span></span>
<span id="cb2-349"><a href="#cb2-349" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> filtSamp<span class="op">=</span>[]<span class="op">;</span></span>
<span id="cb2-350"><a href="#cb2-350" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span>effBurn<span class="op">;</span>i<span class="op">&lt;</span>chain<span class="op">.</span><span class="at">length</span><span class="op">;</span>i<span class="op">++</span>) <span class="cf">if</span>(effThin<span class="op">&lt;=</span><span class="dv">1</span><span class="op">||</span>(i<span class="op">-</span>effBurn)<span class="op">%</span>effThin<span class="op">===</span><span class="dv">0</span>) filtSamp<span class="op">.</span><span class="fu">push</span>(chain[i])<span class="op">;</span></span>
<span id="cb2-351"><a href="#cb2-351" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> binsFilt<span class="op">=</span><span class="bu">Array</span>(nBins)<span class="op">.</span><span class="fu">fill</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb2-352"><a href="#cb2-352" aria-hidden="true" tabindex="-1"></a>    filtSamp<span class="op">.</span><span class="fu">forEach</span>(s<span class="kw">=&gt;</span>{binsFilt[<span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(s<span class="op">/</span>binH_)<span class="op">,</span>nBins<span class="op">-</span><span class="dv">1</span>)]<span class="op">++;</span>})<span class="op">;</span></span>
<span id="cb2-353"><a href="#cb2-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-354"><a href="#cb2-354" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> binsShow<span class="op">=</span>useFilter<span class="op">?</span>binsFilt<span class="op">:</span>binsRaw<span class="op">;</span></span>
<span id="cb2-355"><a href="#cb2-355" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> maxBin<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>binsShow<span class="op">,</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb2-356"><a href="#cb2-356" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> barSc<span class="op">=</span>d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span>maxBin])<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span>hIW<span class="op">-</span><span class="dv">8</span>])<span class="op">;</span></span>
<span id="cb2-357"><a href="#cb2-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-358"><a href="#cb2-358" aria-hidden="true" tabindex="-1"></a>    histTitle<span class="op">.</span><span class="fu">text</span>(useFilter<span class="op">?</span><span class="vs">`Đã lọc (</span><span class="sc">${</span>filtSamp<span class="op">.</span><span class="at">length</span><span class="sc">}</span><span class="vs">)`</span><span class="op">:</span><span class="st">"Biểu đồ tần suất"</span>)<span class="op">;</span></span>
<span id="cb2-359"><a href="#cb2-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-360"><a href="#cb2-360" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span><span class="op">,</span><span class="fl">0.25</span><span class="op">,</span><span class="fl">0.5</span><span class="op">,</span><span class="fl">0.75</span><span class="op">,</span><span class="dv">1</span>]<span class="op">.</span><span class="fu">forEach</span>(v<span class="kw">=&gt;</span>{</span>
<span id="cb2-361"><a href="#cb2-361" aria-hidden="true" tabindex="-1"></a>      histG<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span><span class="st">"yt"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span>hIW<span class="op">+</span><span class="dv">6</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span><span class="fu">histThetaS</span>(v)<span class="op">+</span><span class="dv">3</span>)</span>
<span id="cb2-362"><a href="#cb2-362" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"start"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">9</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">sub</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span>mono)<span class="op">.</span><span class="fu">text</span>(v<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb2-363"><a href="#cb2-363" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb2-364"><a href="#cb2-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-365"><a href="#cb2-365" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Ghost bars (raw) if filtering active</span></span>
<span id="cb2-366"><a href="#cb2-366" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(useFilter){</span>
<span id="cb2-367"><a href="#cb2-367" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> mxR<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>binsRaw<span class="op">,</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb2-368"><a href="#cb2-368" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> gSc<span class="op">=</span>d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span>mxR])<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span>hIW<span class="op">-</span><span class="dv">8</span>])<span class="op">;</span></span>
<span id="cb2-369"><a href="#cb2-369" aria-hidden="true" tabindex="-1"></a>      binsRaw<span class="op">.</span><span class="fu">forEach</span>((c<span class="op">,</span>bi)<span class="kw">=&gt;</span>{<span class="cf">if</span>(<span class="op">!</span>c)<span class="cf">return</span><span class="op">;</span></span>
<span id="cb2-370"><a href="#cb2-370" aria-hidden="true" tabindex="-1"></a>        histGhostG<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span><span class="dv">1</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span><span class="fu">histThetaS</span>((bi<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>binH_)<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb2-371"><a href="#cb2-371" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span><span class="fu">gSc</span>(c))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span>barH_<span class="op">-</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">ghost</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="fl">0.4</span>)<span class="op">;</span></span>
<span id="cb2-372"><a href="#cb2-372" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb2-373"><a href="#cb2-373" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-374"><a href="#cb2-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-375"><a href="#cb2-375" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Active bars</span></span>
<span id="cb2-376"><a href="#cb2-376" aria-hidden="true" tabindex="-1"></a>    binsShow<span class="op">.</span><span class="fu">forEach</span>((count<span class="op">,</span>bi)<span class="kw">=&gt;</span>{</span>
<span id="cb2-377"><a href="#cb2-377" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="op">!</span>count)<span class="cf">return</span><span class="op">;</span></span>
<span id="cb2-378"><a href="#cb2-378" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> by<span class="op">=</span><span class="fu">histThetaS</span>((bi<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>binH_)<span class="op">,</span>bHt<span class="op">=</span>barH_<span class="op">-</span><span class="dv">2</span><span class="op">,</span>tw<span class="op">=</span><span class="fu">barSc</span>(count)<span class="op">;</span></span>
<span id="cb2-379"><a href="#cb2-379" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> isNew<span class="op">=</span>bi<span class="op">===</span>lastAcceptedBin<span class="op">&amp;&amp;!</span>useFilter<span class="op">;</span></span>
<span id="cb2-380"><a href="#cb2-380" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> fc<span class="op">=</span>useFilter<span class="op">?</span>C<span class="op">.</span><span class="at">filt</span><span class="op">:</span>isNew<span class="op">?</span>C<span class="op">.</span><span class="at">histNew</span><span class="op">:</span>C<span class="op">.</span><span class="at">hist</span><span class="op">;</span></span>
<span id="cb2-381"><a href="#cb2-381" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> sc<span class="op">=</span>useFilter<span class="op">?</span>C<span class="op">.</span><span class="at">filtStroke</span><span class="op">:</span>isNew<span class="op">?</span>C<span class="op">.</span><span class="at">histNewStroke</span><span class="op">:</span>C<span class="op">.</span><span class="at">histStroke</span><span class="op">;</span></span>
<span id="cb2-382"><a href="#cb2-382" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> tc<span class="op">=</span>useFilter<span class="op">?</span>C<span class="op">.</span><span class="at">filtTop</span><span class="op">:</span>isNew<span class="op">?</span>C<span class="op">.</span><span class="at">histNewTop</span><span class="op">:</span>C<span class="op">.</span><span class="at">histTop</span><span class="op">;</span></span>
<span id="cb2-383"><a href="#cb2-383" aria-hidden="true" tabindex="-1"></a>      histBarsG<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span><span class="dv">1</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span>by<span class="op">+</span><span class="dv">1</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span>tw)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span>bHt)</span>
<span id="cb2-384"><a href="#cb2-384" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>fc)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>sc)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="fl">0.6</span>)<span class="op">;</span></span>
<span id="cb2-385"><a href="#cb2-385" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(bHt<span class="op">&gt;</span><span class="dv">3</span>) histBarsG<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span><span class="dv">1</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span>by<span class="op">+</span><span class="dv">1</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span>tw)</span>
<span id="cb2-386"><a href="#cb2-386" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">2</span><span class="op">,</span>bHt<span class="op">*</span><span class="fl">0.25</span>))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>tc)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="fl">0.5</span>)<span class="op">;</span></span>
<span id="cb2-387"><a href="#cb2-387" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> cw<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">10</span><span class="op">,</span>tw<span class="op">/</span>count)<span class="op">;</span></span>
<span id="cb2-388"><a href="#cb2-388" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(cw<span class="op">&gt;</span><span class="dv">3</span>) <span class="cf">for</span>(<span class="kw">let</span> j<span class="op">=</span><span class="dv">1</span><span class="op">;</span>j<span class="op">&lt;</span>count<span class="op">;</span>j<span class="op">++</span>){<span class="kw">const</span> lx<span class="op">=</span>j<span class="op">*</span>cw<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-389"><a href="#cb2-389" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(lx<span class="op">&lt;</span>tw) histBarsG<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span>lx)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span>lx)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span>by<span class="op">+</span><span class="dv">1</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span>by<span class="op">+</span><span class="dv">1</span><span class="op">+</span>bHt)</span>
<span id="cb2-390"><a href="#cb2-390" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>sc)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="fl">0.4</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="fl">0.5</span>)<span class="op">;</span>}</span>
<span id="cb2-391"><a href="#cb2-391" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb2-392"><a href="#cb2-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-393"><a href="#cb2-393" aria-hidden="true" tabindex="-1"></a>    <span class="co">// True posterior curve</span></span>
<span id="cb2-394"><a href="#cb2-394" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> trueV<span class="op">=</span>curvePts<span class="op">.</span><span class="fu">map</span>(t<span class="kw">=&gt;</span>({<span class="dt">theta</span><span class="op">:</span>t<span class="op">,</span><span class="dt">density</span><span class="op">:</span><span class="fu">truePosterior</span>(t)}))<span class="op">;</span></span>
<span id="cb2-395"><a href="#cb2-395" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> mxT<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>trueV<span class="op">.</span><span class="fu">map</span>(d<span class="kw">=&gt;</span>d<span class="op">.</span><span class="at">density</span>))<span class="op">;</span></span>
<span id="cb2-396"><a href="#cb2-396" aria-hidden="true" tabindex="-1"></a>    histCurveG<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb2-397"><a href="#cb2-397" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span>d3<span class="op">.</span><span class="fu">line</span>()<span class="op">.</span><span class="fu">x</span>(d<span class="kw">=&gt;</span>d<span class="op">.</span><span class="at">density</span><span class="op">*</span>((hIW<span class="op">-</span><span class="dv">8</span>)<span class="op">/</span>mxT<span class="op">*</span><span class="fl">0.85</span>))<span class="op">.</span><span class="fu">y</span>(d<span class="kw">=&gt;</span><span class="fu">histThetaS</span>(d<span class="op">.</span><span class="at">theta</span>))<span class="op">.</span><span class="fu">curve</span>(d3<span class="op">.</span><span class="at">curveBasis</span>)(trueV))</span>
<span id="cb2-398"><a href="#cb2-398" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"none"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">post</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span><span class="st">"5,3"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="fl">0.6</span>)<span class="op">;</span></span>
<span id="cb2-399"><a href="#cb2-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-400"><a href="#cb2-400" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ── MERGED MARKERS ──</span></span>
<span id="cb2-401"><a href="#cb2-401" aria-hidden="true" tabindex="-1"></a>    mergedMarkers<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"*"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb2-402"><a href="#cb2-402" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">drawMM</span>(val<span class="op">,</span>color<span class="op">,</span>label){</span>
<span id="cb2-403"><a href="#cb2-403" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> px<span class="op">=</span><span class="fu">bxS</span>(val)<span class="op">,</span>pP<span class="op">=</span><span class="fu">pyS</span>(<span class="fu">prior</span>(val))<span class="op">,</span>pL<span class="op">=</span><span class="fu">lyS</span>(<span class="fu">likNorm</span>(val))<span class="op">;</span></span>
<span id="cb2-404"><a href="#cb2-404" aria-hidden="true" tabindex="-1"></a>      mergedMarkers<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span>px)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span>px)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span>pP)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span>pL)</span>
<span id="cb2-405"><a href="#cb2-405" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>color)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="fl">1.5</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span><span class="st">"3,2"</span>)<span class="op">;</span></span>
<span id="cb2-406"><a href="#cb2-406" aria-hidden="true" tabindex="-1"></a>      mergedMarkers<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span>px)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span>pP)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span><span class="dv">4</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>color)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"#fff"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="fl">1.5</span>)<span class="op">;</span></span>
<span id="cb2-407"><a href="#cb2-407" aria-hidden="true" tabindex="-1"></a>      mergedMarkers<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span>px)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span>pL)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span><span class="dv">4</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>color)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"#fff"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="fl">1.5</span>)<span class="op">;</span></span>
<span id="cb2-408"><a href="#cb2-408" aria-hidden="true" tabindex="-1"></a>      mergedMarkers<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span>px)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(bMg<span class="op">.</span><span class="at">t</span><span class="op">+</span><span class="dv">6</span><span class="op">,</span>pP<span class="op">-</span><span class="dv">8</span>))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)</span>
<span id="cb2-409"><a href="#cb2-409" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">9</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span><span class="dv">700</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>color)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span>mono)<span class="op">.</span><span class="fu">text</span>(<span class="vs">`π=</span><span class="sc">${</span><span class="fu">prior</span>(val)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb2-410"><a href="#cb2-410" aria-hidden="true" tabindex="-1"></a>      mergedMarkers<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span>px)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(BH<span class="op">-</span>bMg<span class="op">.</span><span class="at">b</span><span class="op">-</span><span class="dv">2</span><span class="op">,</span>pL<span class="op">+</span><span class="dv">14</span>))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)</span>
<span id="cb2-411"><a href="#cb2-411" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">9</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span><span class="dv">700</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>color)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span>mono)<span class="op">.</span><span class="fu">text</span>(<span class="vs">`L=</span><span class="sc">${</span><span class="fu">likNorm</span>(val)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb2-412"><a href="#cb2-412" aria-hidden="true" tabindex="-1"></a>      mergedMarkers<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span>px)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(bMg<span class="op">.</span><span class="at">t</span><span class="op">+</span><span class="dv">6</span><span class="op">,</span>pP<span class="op">-</span><span class="dv">18</span>))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)</span>
<span id="cb2-413"><a href="#cb2-413" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">8</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span><span class="dv">600</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>color)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span>mono)<span class="op">.</span><span class="fu">text</span>(label)<span class="op">;</span></span>
<span id="cb2-414"><a href="#cb2-414" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-415"><a href="#cb2-415" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drawMM</span>(curVal<span class="op">,</span>C<span class="op">.</span><span class="at">current</span><span class="op">,</span><span class="vs">`θ=</span><span class="sc">${</span>curVal<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb2-416"><a href="#cb2-416" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(proposed<span class="op">!==</span><span class="kw">null</span><span class="op">&amp;&amp;</span>(stepPhase<span class="op">===</span><span class="st">"proposed"</span><span class="op">||</span>stepPhase<span class="op">===</span><span class="st">"decided"</span>))</span>
<span id="cb2-417"><a href="#cb2-417" aria-hidden="true" tabindex="-1"></a>      <span class="fu">drawMM</span>(proposed<span class="op">,</span>stepPhase<span class="op">===</span><span class="st">"decided"</span><span class="op">?</span>(accepted<span class="op">?</span>C<span class="op">.</span><span class="at">accept</span><span class="op">:</span>C<span class="op">.</span><span class="at">reject</span>)<span class="op">:</span>C<span class="op">.</span><span class="at">propose</span><span class="op">,</span><span class="vs">`θ*=</span><span class="sc">${</span>proposed<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb2-418"><a href="#cb2-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-419"><a href="#cb2-419" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ── STATUS ──</span></span>
<span id="cb2-420"><a href="#cb2-420" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> nAcc<span class="op">=</span>samples<span class="op">.</span><span class="at">length</span><span class="op">,</span>rate<span class="op">=</span>stepCount<span class="op">&gt;</span><span class="dv">0</span><span class="op">?</span>(nAcc<span class="op">/</span>stepCount<span class="op">*</span><span class="dv">100</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>)<span class="op">:</span><span class="st">"—"</span><span class="op">;</span></span>
<span id="cb2-421"><a href="#cb2-421" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pill<span class="op">=</span>(t<span class="op">,</span>bg)<span class="kw">=&gt;</span><span class="vs">`&lt;span style="display:inline-block;padding:2px 10px;border-radius:20px;background:</span><span class="sc">${</span>bg<span class="sc">}</span><span class="vs">;color:#fff;font-weight:700;font-size:12px;letter-spacing:0.3px;"&gt;</span><span class="sc">${</span>t<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">;</span></span>
<span id="cb2-422"><a href="#cb2-422" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> vl<span class="op">=</span>(v<span class="op">,</span>c<span class="op">,</span>big)<span class="kw">=&gt;</span><span class="vs">`&lt;span style="color:</span><span class="sc">${</span>c<span class="sc">}</span><span class="vs">;font-weight:</span><span class="sc">${</span>big<span class="op">?</span><span class="dv">800</span><span class="op">:</span><span class="dv">700</span><span class="sc">}</span><span class="vs">;font-size:</span><span class="sc">${</span>big<span class="op">?</span><span class="dv">16</span><span class="op">:</span><span class="dv">13</span><span class="sc">}</span><span class="vs">px;"&gt;</span><span class="sc">${</span>v<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">;</span></span>
<span id="cb2-423"><a href="#cb2-423" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> lb<span class="op">=</span>(t<span class="op">,</span>c)<span class="kw">=&gt;</span><span class="vs">`&lt;span style="color:</span><span class="sc">${</span>c<span class="op">||</span>C<span class="op">.</span><span class="at">sub</span><span class="sc">}</span><span class="vs">;font-size:11px;font-weight:600;"&gt;</span><span class="sc">${</span>t<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">;</span></span>
<span id="cb2-424"><a href="#cb2-424" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> stats<span class="op">=</span><span class="vs">`&lt;div style="display:flex;gap:16px;align-items:center;margin-top:6px;font-size:11px;color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">sub</span><span class="sc">}</span><span class="vs">;"&gt;`</span><span class="op">+</span></span>
<span id="cb2-425"><a href="#cb2-425" aria-hidden="true" tabindex="-1"></a>      <span class="vs">`</span><span class="sc">${</span><span class="fu">lb</span>(<span class="st">'Bước'</span>)<span class="sc">}</span><span class="vs"> &lt;b&gt;</span><span class="sc">${</span>stepCount<span class="sc">}</span><span class="vs">&lt;/b&gt; &amp;nbsp;</span><span class="sc">${</span><span class="fu">lb</span>(<span class="st">'Đã nhận'</span>)<span class="sc">}</span><span class="vs"> &lt;b&gt;</span><span class="sc">${</span>nAcc<span class="sc">}</span><span class="vs">&lt;/b&gt; &amp;nbsp;</span><span class="sc">${</span><span class="fu">lb</span>(<span class="st">'Tỷ lệ'</span>)<span class="sc">}</span><span class="vs"> &lt;b&gt;</span><span class="sc">${</span>rate<span class="sc">}</span><span class="vs">%&lt;/b&gt;`</span><span class="op">+</span></span>
<span id="cb2-426"><a href="#cb2-426" aria-hidden="true" tabindex="-1"></a>      (useFilter<span class="op">?</span><span class="vs">` &amp;nbsp;</span><span class="sc">${</span><span class="fu">lb</span>(<span class="st">'Đã lọc'</span><span class="op">,</span>C<span class="op">.</span><span class="at">filt</span>)<span class="sc">}</span><span class="vs"> &lt;b style="color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">filt</span><span class="sc">}</span><span class="vs">"&gt;</span><span class="sc">${</span>filtSamp<span class="op">.</span><span class="at">length</span><span class="sc">}</span><span class="vs">&lt;/b&gt;`</span><span class="op">:</span><span class="st">""</span>)<span class="op">+</span><span class="vs">`&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb2-427"><a href="#cb2-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-428"><a href="#cb2-428" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(stepPhase<span class="op">===</span><span class="st">"idle"</span>){</span>
<span id="cb2-429"><a href="#cb2-429" aria-hidden="true" tabindex="-1"></a>      statusBox<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">borderColor</span><span class="op">=</span>C<span class="op">.</span><span class="at">border</span><span class="op">;</span>statusBox<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">background</span><span class="op">=</span><span class="st">'linear-gradient(135deg,#FAFAFA,#F5F5F5)'</span><span class="op">;</span></span>
<span id="cb2-430"><a href="#cb2-430" aria-hidden="true" tabindex="-1"></a>      statusBox<span class="op">.</span><span class="at">innerHTML</span><span class="op">=</span><span class="vs">`&lt;div style="display:flex;align-items:center;gap:12px;"&gt;`</span><span class="op">+</span><span class="fu">pill</span>(<span class="st">'SẴN SÀNG'</span><span class="op">,</span><span class="st">'#546E7A'</span>)<span class="op">+</span></span>
<span id="cb2-431"><a href="#cb2-431" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;span style="font-size:14px;"&gt;Vị trí hiện tại: </span><span class="sc">${</span><span class="fu">vl</span>(<span class="st">'θ = '</span><span class="op">+</span>curVal<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span>C<span class="op">.</span><span class="at">current</span><span class="op">,</span><span class="kw">true</span>)<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">+</span></span>
<span id="cb2-432"><a href="#cb2-432" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;span style="margin-left:auto;color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">sub</span><span class="sc">}</span><span class="vs">;font-size:12px;"&gt;Nhấn &lt;b style="color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">current</span><span class="sc">}</span><span class="vs">"&gt;Bước tiếp theo&lt;/b&gt; ▶&lt;/span&gt;&lt;/div&gt;`</span><span class="op">+</span>stats<span class="op">;</span></span>
<span id="cb2-433"><a href="#cb2-433" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(stepPhase<span class="op">===</span><span class="st">"proposed"</span>){</span>
<span id="cb2-434"><a href="#cb2-434" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> pC<span class="op">=</span><span class="fu">prior</span>(curVal)<span class="op">,</span>pP<span class="op">=</span><span class="fu">prior</span>(proposed)<span class="op">,</span>lC<span class="op">=</span><span class="fu">likNorm</span>(curVal)<span class="op">,</span>lP<span class="op">=</span><span class="fu">likNorm</span>(proposed)<span class="op">;</span></span>
<span id="cb2-435"><a href="#cb2-435" aria-hidden="true" tabindex="-1"></a>      statusBox<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">borderColor</span><span class="op">=</span>C<span class="op">.</span><span class="at">propose</span><span class="op">;</span>statusBox<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">background</span><span class="op">=</span><span class="st">'linear-gradient(135deg,#FFF8E1,#FFF3E0)'</span><span class="op">;</span></span>
<span id="cb2-436"><a href="#cb2-436" aria-hidden="true" tabindex="-1"></a>      statusBox<span class="op">.</span><span class="at">innerHTML</span><span class="op">=</span><span class="vs">`&lt;div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;"&gt;`</span><span class="op">+</span></span>
<span id="cb2-437"><a href="#cb2-437" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pill</span>(<span class="st">'ĐỀ XUẤT'</span><span class="op">,</span>C<span class="op">.</span><span class="at">propose</span>)<span class="op">+</span><span class="vs">`&lt;span style="font-size:13px;"&gt;θ* = </span><span class="sc">${</span><span class="fu">vl</span>(proposed<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span>C<span class="op">.</span><span class="at">propose</span><span class="op">,</span><span class="kw">true</span>)<span class="sc">}</span><span class="vs"> từ N(</span><span class="sc">${</span>curVal<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>proposalSigma<span class="sc">}</span><span class="vs">²)&lt;/span&gt;&lt;/div&gt;`</span><span class="op">+</span></span>
<span id="cb2-438"><a href="#cb2-438" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;table style="width:100%;border-collapse:separate;border-spacing:0;border-radius:10px;overflow:hidden;border:1px solid #E0E0E0;font-size:12px;"&gt;`</span><span class="op">+</span></span>
<span id="cb2-439"><a href="#cb2-439" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;thead&gt;&lt;tr style="background:#F5F5F5;"&gt;&lt;th style="padding:6px 12px;text-align:left;font-weight:600;color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">sub</span><span class="sc">}</span><span class="vs">;border-bottom:1px solid #E0E0E0;"&gt;&lt;/th&gt;`</span><span class="op">+</span></span>
<span id="cb2-440"><a href="#cb2-440" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;th style="padding:6px 12px;text-align:center;font-weight:700;color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">current</span><span class="sc">}</span><span class="vs">;border-bottom:1px solid #E0E0E0;"&gt;Hiện tại θ = </span><span class="sc">${</span>curVal<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="sc">}</span><span class="vs">&lt;/th&gt;`</span><span class="op">+</span></span>
<span id="cb2-441"><a href="#cb2-441" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;th style="padding:6px 12px;text-align:center;font-weight:700;color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">propose</span><span class="sc">}</span><span class="vs">;border-bottom:1px solid #E0E0E0;"&gt;Đề xuất θ* = </span><span class="sc">${</span>proposed<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="sc">}</span><span class="vs">&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;`</span><span class="op">+</span></span>
<span id="cb2-442"><a href="#cb2-442" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;tr style="background:#fff;"&gt;&lt;td style="padding:5px 12px;font-weight:600;color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">prior</span><span class="sc">}</span><span class="vs">;border-bottom:1px solid #F0F0F0;"&gt;π(·) Prior&lt;/td&gt;`</span><span class="op">+</span></span>
<span id="cb2-443"><a href="#cb2-443" aria-hidden="true" tabindex="-1"></a>          <span class="vs">`&lt;td style="padding:5px 12px;text-align:center;border-bottom:1px solid #F0F0F0;"&gt;</span><span class="sc">${</span><span class="fu">vl</span>(pC<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span>C<span class="op">.</span><span class="at">prior</span>)<span class="sc">}</span><span class="vs">&lt;/td&gt;`</span><span class="op">+</span></span>
<span id="cb2-444"><a href="#cb2-444" aria-hidden="true" tabindex="-1"></a>          <span class="vs">`&lt;td style="padding:5px 12px;text-align:center;border-bottom:1px solid #F0F0F0;"&gt;</span><span class="sc">${</span><span class="fu">vl</span>(pP<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span>C<span class="op">.</span><span class="at">prior</span>)<span class="sc">}</span><span class="vs">&lt;/td&gt;&lt;/tr&gt;`</span><span class="op">+</span></span>
<span id="cb2-445"><a href="#cb2-445" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;tr style="background:#FAFAFA;"&gt;&lt;td style="padding:5px 12px;font-weight:600;color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">lik</span><span class="sc">}</span><span class="vs">;border-bottom:1px solid #F0F0F0;"&gt;L(·) Likelihood&lt;/td&gt;`</span><span class="op">+</span></span>
<span id="cb2-446"><a href="#cb2-446" aria-hidden="true" tabindex="-1"></a>          <span class="vs">`&lt;td style="padding:5px 12px;text-align:center;border-bottom:1px solid #F0F0F0;"&gt;</span><span class="sc">${</span><span class="fu">vl</span>(lC<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span>C<span class="op">.</span><span class="at">lik</span>)<span class="sc">}</span><span class="vs">&lt;/td&gt;`</span><span class="op">+</span></span>
<span id="cb2-447"><a href="#cb2-447" aria-hidden="true" tabindex="-1"></a>          <span class="vs">`&lt;td style="padding:5px 12px;text-align:center;border-bottom:1px solid #F0F0F0;"&gt;</span><span class="sc">${</span><span class="fu">vl</span>(lP<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span>C<span class="op">.</span><span class="at">lik</span>)<span class="sc">}</span><span class="vs">&lt;/td&gt;&lt;/tr&gt;`</span><span class="op">+</span></span>
<span id="cb2-448"><a href="#cb2-448" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;tr style="background:#fff;"&gt;&lt;td style="padding:5px 12px;font-weight:600;color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">txt</span><span class="sc">}</span><span class="vs">;"&gt;π·L Mục tiêu&lt;/td&gt;`</span><span class="op">+</span></span>
<span id="cb2-449"><a href="#cb2-449" aria-hidden="true" tabindex="-1"></a>          <span class="vs">`&lt;td style="padding:5px 12px;text-align:center;"&gt;</span><span class="sc">${</span><span class="fu">vl</span>((pC<span class="op">*</span>lC)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">6</span>)<span class="op">,</span>C<span class="op">.</span><span class="at">txt</span>)<span class="sc">}</span><span class="vs">&lt;/td&gt;`</span><span class="op">+</span></span>
<span id="cb2-450"><a href="#cb2-450" aria-hidden="true" tabindex="-1"></a>          <span class="vs">`&lt;td style="padding:5px 12px;text-align:center;"&gt;</span><span class="sc">${</span><span class="fu">vl</span>((pP<span class="op">*</span>lP)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">6</span>)<span class="op">,</span>C<span class="op">.</span><span class="at">txt</span>)<span class="sc">}</span><span class="vs">&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;`</span><span class="op">+</span></span>
<span id="cb2-451"><a href="#cb2-451" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;div style="display:flex;align-items:center;gap:20px;margin-top:8px;padding:8px 12px;background:#fff;border-radius:8px;border:1px solid #E0E0E0;"&gt;`</span><span class="op">+</span></span>
<span id="cb2-452"><a href="#cb2-452" aria-hidden="true" tabindex="-1"></a>          <span class="vs">`&lt;span&gt;</span><span class="sc">${</span><span class="fu">lb</span>(<span class="st">'Tỷ lệ chấp nhận'</span><span class="op">,</span><span class="st">'#333'</span>)<span class="sc">}</span><span class="vs"> &amp;nbsp;α = </span><span class="sc">${</span><span class="fu">vl</span>(acceptRatio<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span><span class="st">'#333'</span><span class="op">,</span><span class="kw">true</span>)<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">+</span></span>
<span id="cb2-453"><a href="#cb2-453" aria-hidden="true" tabindex="-1"></a>          <span class="vs">`&lt;span style="color:#BDBDBD;"&gt;│&lt;/span&gt;`</span><span class="op">+</span></span>
<span id="cb2-454"><a href="#cb2-454" aria-hidden="true" tabindex="-1"></a>          <span class="vs">`&lt;span&gt;</span><span class="sc">${</span><span class="fu">lb</span>(<span class="st">'Rút ngẫu nhiên'</span><span class="op">,</span><span class="st">'#333'</span>)<span class="sc">}</span><span class="vs"> &amp;nbsp;u = </span><span class="sc">${</span><span class="fu">vl</span>(uRand<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span><span class="st">'#E65100'</span><span class="op">,</span><span class="kw">true</span>)<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">+</span></span>
<span id="cb2-455"><a href="#cb2-455" aria-hidden="true" tabindex="-1"></a>          <span class="vs">`&lt;span style="margin-left:auto;font-size:12px;color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">sub</span><span class="sc">}</span><span class="vs">;"&gt;Nhấn &lt;b&gt;Bước tiếp theo&lt;/b&gt; để quyết định&lt;/span&gt;&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb2-456"><a href="#cb2-456" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-457"><a href="#cb2-457" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> dc<span class="op">=</span>accepted<span class="op">?</span>C<span class="op">.</span><span class="at">accept</span><span class="op">:</span>C<span class="op">.</span><span class="at">reject</span><span class="op">;</span></span>
<span id="cb2-458"><a href="#cb2-458" aria-hidden="true" tabindex="-1"></a>      statusBox<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">borderColor</span><span class="op">=</span>dc<span class="op">;</span></span>
<span id="cb2-459"><a href="#cb2-459" aria-hidden="true" tabindex="-1"></a>      statusBox<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">background</span><span class="op">=</span>accepted<span class="op">?</span><span class="st">'linear-gradient(135deg,#E8F5E9,#F1F8E9)'</span><span class="op">:</span><span class="st">'linear-gradient(135deg,#FFEBEE,#FBE9E7)'</span><span class="op">;</span></span>
<span id="cb2-460"><a href="#cb2-460" aria-hidden="true" tabindex="-1"></a>      statusBox<span class="op">.</span><span class="at">innerHTML</span><span class="op">=</span><span class="vs">`&lt;div style="display:flex;align-items:center;gap:12px;"&gt;`</span><span class="op">+</span></span>
<span id="cb2-461"><a href="#cb2-461" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pill</span>(accepted<span class="op">?</span><span class="st">'✓ CHẤP NHẬN'</span><span class="op">:</span><span class="st">'✗ TỪ CHỐI'</span><span class="op">,</span>dc)<span class="op">+</span></span>
<span id="cb2-462"><a href="#cb2-462" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;span style="font-size:14px;font-weight:600;"&gt;α = </span><span class="sc">${</span><span class="fu">vl</span>(acceptRatio<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span>C<span class="op">.</span><span class="at">txt</span>)<span class="sc">}</span><span class="vs"> `</span><span class="op">+</span></span>
<span id="cb2-463"><a href="#cb2-463" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;span style="color:</span><span class="sc">${</span>dc<span class="sc">}</span><span class="vs">;font-weight:800;font-size:15px;"&gt;</span><span class="sc">${</span>accepted<span class="op">?</span><span class="st">'≥'</span><span class="op">:</span><span class="st">'&lt;'</span><span class="sc">}</span><span class="vs">&lt;/span&gt; `</span><span class="op">+</span></span>
<span id="cb2-464"><a href="#cb2-464" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`u = </span><span class="sc">${</span><span class="fu">vl</span>(uRand<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span>C<span class="op">.</span><span class="at">propose</span>)<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">+</span></span>
<span id="cb2-465"><a href="#cb2-465" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;span style="margin-left:auto;font-size:13px;color:</span><span class="sc">${</span>dc<span class="sc">}</span><span class="vs">;font-weight:600;"&gt;`</span><span class="op">+</span></span>
<span id="cb2-466"><a href="#cb2-466" aria-hidden="true" tabindex="-1"></a>        (accepted<span class="op">?</span><span class="vs">`→ Di chuyển đến θ* = </span><span class="sc">${</span>proposed<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">:</span><span class="vs">`→ Giữ tại θ = </span><span class="sc">${</span>curVal<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="sc">}</span><span class="vs">`</span>)<span class="op">+</span><span class="vs">`&lt;/span&gt;&lt;/div&gt;`</span><span class="op">+</span>stats<span class="op">;</span></span>
<span id="cb2-467"><a href="#cb2-467" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-468"><a href="#cb2-468" aria-hidden="true" tabindex="-1"></a>    stepLabel<span class="op">.</span><span class="at">textContent</span><span class="op">=</span><span class="vs">`Bước </span><span class="sc">${</span>stepCount<span class="sc">}</span><span class="vs"> · </span><span class="sc">${</span>nAcc<span class="sc">}</span><span class="vs"> mẫu`</span><span class="op">;</span></span>
<span id="cb2-469"><a href="#cb2-469" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-470"><a href="#cb2-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-471"><a href="#cb2-471" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ STEP LOGIC ═══════════════════</span></span>
<span id="cb2-472"><a href="#cb2-472" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">resetChain</span>(){chain<span class="op">=</span>[<span class="fl">0.3</span>]<span class="op">;</span>proposed<span class="op">=</span><span class="kw">null</span><span class="op">;</span>stepPhase<span class="op">=</span><span class="st">"idle"</span><span class="op">;</span>accepted<span class="op">=</span><span class="kw">null</span><span class="op">;</span>samples<span class="op">=</span>[]<span class="op">;</span>stepCount<span class="op">=</span><span class="dv">0</span><span class="op">;</span>propStepIdx<span class="op">=</span><span class="dv">0</span><span class="op">;</span>lastAcceptedBin<span class="op">=-</span><span class="dv">1</span><span class="op">;</span>}</span>
<span id="cb2-473"><a href="#cb2-473" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">doStep</span>(){</span>
<span id="cb2-474"><a href="#cb2-474" aria-hidden="true" tabindex="-1"></a>    proposalSigma<span class="op">=</span>SL<span class="op">.</span><span class="at">sigma</span><span class="op">.</span><span class="fu">val</span>()<span class="op">;</span></span>
<span id="cb2-475"><a href="#cb2-475" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(stepPhase<span class="op">===</span><span class="st">"idle"</span>){</span>
<span id="cb2-476"><a href="#cb2-476" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> cur<span class="op">=</span>chain[chain<span class="op">.</span><span class="at">length</span><span class="op">-</span><span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb2-477"><a href="#cb2-477" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> prop<span class="op">=</span>cur<span class="op">+</span><span class="fu">randn</span>()<span class="op">*</span>proposalSigma<span class="op">;</span></span>
<span id="cb2-478"><a href="#cb2-478" aria-hidden="true" tabindex="-1"></a>      prop<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="fl">0.001</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="fl">0.999</span><span class="op">,</span>prop))<span class="op">;</span></span>
<span id="cb2-479"><a href="#cb2-479" aria-hidden="true" tabindex="-1"></a>      proposed<span class="op">=</span>prop<span class="op">;</span>propStepIdx<span class="op">=</span>chain<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb2-480"><a href="#cb2-480" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> tC<span class="op">=</span><span class="fu">target</span>(cur)<span class="op">,</span>tP<span class="op">=</span><span class="fu">target</span>(prop)<span class="op">;</span></span>
<span id="cb2-481"><a href="#cb2-481" aria-hidden="true" tabindex="-1"></a>      acceptRatio<span class="op">=</span>tC<span class="op">&gt;</span><span class="dv">0</span><span class="op">?</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">1</span><span class="op">,</span>tP<span class="op">/</span>tC)<span class="op">:</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-482"><a href="#cb2-482" aria-hidden="true" tabindex="-1"></a>      uRand<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>()<span class="op">;</span>stepPhase<span class="op">=</span><span class="st">"proposed"</span><span class="op">;</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb2-483"><a href="#cb2-483" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(stepPhase<span class="op">===</span><span class="st">"proposed"</span>){</span>
<span id="cb2-484"><a href="#cb2-484" aria-hidden="true" tabindex="-1"></a>      accepted<span class="op">=</span>uRand<span class="op">&lt;=</span>acceptRatio<span class="op">;</span>stepCount<span class="op">++;</span></span>
<span id="cb2-485"><a href="#cb2-485" aria-hidden="true" tabindex="-1"></a>      stepPhase<span class="op">=</span><span class="st">"decided"</span><span class="op">;</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb2-486"><a href="#cb2-486" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-487"><a href="#cb2-487" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(accepted){chain<span class="op">.</span><span class="fu">push</span>(proposed)<span class="op">;</span>samples<span class="op">.</span><span class="fu">push</span>(proposed)<span class="op">;</span>lastAcceptedBin<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(proposed<span class="op">/</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">30</span>))<span class="op">,</span><span class="dv">29</span>)<span class="op">;</span>}</span>
<span id="cb2-488"><a href="#cb2-488" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span>{chain<span class="op">.</span><span class="fu">push</span>(chain[chain<span class="op">.</span><span class="at">length</span><span class="op">-</span><span class="dv">1</span>])<span class="op">;</span>lastAcceptedBin<span class="op">=-</span><span class="dv">1</span><span class="op">;</span>}</span>
<span id="cb2-489"><a href="#cb2-489" aria-hidden="true" tabindex="-1"></a>      proposed<span class="op">=</span><span class="kw">null</span><span class="op">;</span>stepPhase<span class="op">=</span><span class="st">"idle"</span><span class="op">;</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb2-490"><a href="#cb2-490" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(autoRunning)<span class="pp">setTimeout</span>(doStep<span class="op">,</span><span class="dv">50</span>)<span class="op">;</span></span>
<span id="cb2-491"><a href="#cb2-491" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-492"><a href="#cb2-492" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-493"><a href="#cb2-493" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">fullStep</span>(){</span>
<span id="cb2-494"><a href="#cb2-494" aria-hidden="true" tabindex="-1"></a>    proposalSigma<span class="op">=</span>SL<span class="op">.</span><span class="at">sigma</span><span class="op">.</span><span class="fu">val</span>()<span class="op">;</span></span>
<span id="cb2-495"><a href="#cb2-495" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cur<span class="op">=</span>chain[chain<span class="op">.</span><span class="at">length</span><span class="op">-</span><span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb2-496"><a href="#cb2-496" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> prop<span class="op">=</span>cur<span class="op">+</span><span class="fu">randn</span>()<span class="op">*</span>proposalSigma<span class="op">;</span></span>
<span id="cb2-497"><a href="#cb2-497" aria-hidden="true" tabindex="-1"></a>    prop<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="fl">0.001</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="fl">0.999</span><span class="op">,</span>prop))<span class="op">;</span></span>
<span id="cb2-498"><a href="#cb2-498" aria-hidden="true" tabindex="-1"></a>    propStepIdx<span class="op">=</span>chain<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb2-499"><a href="#cb2-499" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> tC<span class="op">=</span><span class="fu">target</span>(cur)<span class="op">,</span>tP<span class="op">=</span><span class="fu">target</span>(prop)<span class="op">;</span></span>
<span id="cb2-500"><a href="#cb2-500" aria-hidden="true" tabindex="-1"></a>    acceptRatio<span class="op">=</span>tC<span class="op">&gt;</span><span class="dv">0</span><span class="op">?</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">1</span><span class="op">,</span>tP<span class="op">/</span>tC)<span class="op">:</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-501"><a href="#cb2-501" aria-hidden="true" tabindex="-1"></a>    uRand<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>()<span class="op">;</span>accepted<span class="op">=</span>uRand<span class="op">&lt;=</span>acceptRatio<span class="op">;</span>stepCount<span class="op">++;</span></span>
<span id="cb2-502"><a href="#cb2-502" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(accepted){chain<span class="op">.</span><span class="fu">push</span>(prop)<span class="op">;</span>samples<span class="op">.</span><span class="fu">push</span>(prop)<span class="op">;</span>lastAcceptedBin<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(prop<span class="op">/</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">30</span>))<span class="op">,</span><span class="dv">29</span>)<span class="op">;</span>}</span>
<span id="cb2-503"><a href="#cb2-503" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{chain<span class="op">.</span><span class="fu">push</span>(cur)<span class="op">;</span>lastAcceptedBin<span class="op">=-</span><span class="dv">1</span><span class="op">;</span>}</span>
<span id="cb2-504"><a href="#cb2-504" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(chain<span class="op">.</span><span class="at">length</span><span class="op">&gt;</span><span class="dv">500</span>)chain<span class="op">=</span>chain<span class="op">.</span><span class="fu">slice</span>(<span class="op">-</span><span class="dv">400</span>)<span class="op">;</span></span>
<span id="cb2-505"><a href="#cb2-505" aria-hidden="true" tabindex="-1"></a>    proposed<span class="op">=</span>prop<span class="op">;</span>stepPhase<span class="op">=</span><span class="st">"decided"</span><span class="op">;</span><span class="fu">render</span>()<span class="op">;</span>stepPhase<span class="op">=</span><span class="st">"idle"</span><span class="op">;</span></span>
<span id="cb2-506"><a href="#cb2-506" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-507"><a href="#cb2-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-508"><a href="#cb2-508" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ EVENTS ═══════════════════</span></span>
<span id="cb2-509"><a href="#cb2-509" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">stopAuto</span>(){autoRunning<span class="op">=</span><span class="kw">false</span><span class="op">;</span><span class="pp">clearInterval</span>(autoTimer)<span class="op">;</span>btnAuto<span class="op">.</span><span class="at">textContent</span><span class="op">=</span><span class="st">"⏩ Chạy tự động"</span><span class="op">;</span>btnAuto<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">background</span><span class="op">=</span><span class="st">"linear-gradient(135deg,#6A1B9A,#6A1B9Add)"</span><span class="op">;</span>}</span>
<span id="cb2-510"><a href="#cb2-510" aria-hidden="true" tabindex="-1"></a>  btnStep<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"click"</span><span class="op">,</span>()<span class="kw">=&gt;</span>{<span class="cf">if</span>(autoRunning)<span class="fu">stopAuto</span>()<span class="op">;</span><span class="fu">doStep</span>()<span class="op">;</span>})<span class="op">;</span></span>
<span id="cb2-511"><a href="#cb2-511" aria-hidden="true" tabindex="-1"></a>  btnAuto<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"click"</span><span class="op">,</span>()<span class="kw">=&gt;</span>{</span>
<span id="cb2-512"><a href="#cb2-512" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(autoRunning)<span class="fu">stopAuto</span>()<span class="op">;</span></span>
<span id="cb2-513"><a href="#cb2-513" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{autoRunning<span class="op">=</span><span class="kw">true</span><span class="op">;</span>btnAuto<span class="op">.</span><span class="at">textContent</span><span class="op">=</span><span class="st">"⏸ Tạm dừng"</span><span class="op">;</span>btnAuto<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">background</span><span class="op">=</span><span class="vs">`linear-gradient(135deg,</span><span class="sc">${</span>C<span class="op">.</span><span class="at">reject</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>C<span class="op">.</span><span class="at">reject</span><span class="sc">}</span><span class="vs">dd)`</span><span class="op">;</span></span>
<span id="cb2-514"><a href="#cb2-514" aria-hidden="true" tabindex="-1"></a>      stepPhase<span class="op">=</span><span class="st">"idle"</span><span class="op">;</span>autoTimer<span class="op">=</span><span class="pp">setInterval</span>(()<span class="kw">=&gt;</span>{<span class="cf">if</span>(autoRunning)<span class="fu">fullStep</span>()<span class="op">;</span><span class="cf">else</span> <span class="pp">clearInterval</span>(autoTimer)<span class="op">;</span>}<span class="op">,</span><span class="dv">80</span>)<span class="op">;</span>}</span>
<span id="cb2-515"><a href="#cb2-515" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb2-516"><a href="#cb2-516" aria-hidden="true" tabindex="-1"></a>  btnReset<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"click"</span><span class="op">,</span>()<span class="kw">=&gt;</span>{<span class="fu">stopAuto</span>()<span class="op">;</span><span class="fu">resetChain</span>()<span class="op">;</span><span class="fu">render</span>()<span class="op">;</span>})<span class="op">;</span></span>
<span id="cb2-517"><a href="#cb2-517" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">sigma</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span>()<span class="kw">=&gt;</span>SL<span class="op">.</span><span class="at">sigma</span><span class="op">.</span><span class="fu">sync</span>())<span class="op">;</span></span>
<span id="cb2-518"><a href="#cb2-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-519"><a href="#cb2-519" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Model changes → rebuild curves + reset chain</span></span>
<span id="cb2-520"><a href="#cb2-520" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">onModel</span>(){</span>
<span id="cb2-521"><a href="#cb2-521" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">const</span> s <span class="kw">of</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(SL))s<span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span></span>
<span id="cb2-522"><a href="#cb2-522" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> nA<span class="op">=</span>SL<span class="op">.</span><span class="at">pA</span><span class="op">.</span><span class="fu">val</span>()<span class="op">,</span>nB<span class="op">=</span>SL<span class="op">.</span><span class="at">pB</span><span class="op">.</span><span class="fu">val</span>()<span class="op">,</span>nK<span class="op">=</span>SL<span class="op">.</span><span class="at">dK</span><span class="op">.</span><span class="fu">val</span>()<span class="op">,</span>nN<span class="op">=</span>SL<span class="op">.</span><span class="at">dN</span><span class="op">.</span><span class="fu">val</span>()<span class="op">;</span></span>
<span id="cb2-523"><a href="#cb2-523" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(nK<span class="op">&gt;</span>nN){SL<span class="op">.</span><span class="at">dK</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="at">value</span><span class="op">=</span>nN<span class="op">;</span>SL<span class="op">.</span><span class="at">dK</span><span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span>}</span>
<span id="cb2-524"><a href="#cb2-524" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> dk<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(SL<span class="op">.</span><span class="at">dK</span><span class="op">.</span><span class="fu">val</span>()<span class="op">,</span>nN)<span class="op">;</span></span>
<span id="cb2-525"><a href="#cb2-525" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(nA<span class="op">!==</span>priorA<span class="op">||</span>nB<span class="op">!==</span>priorB<span class="op">||</span>dk<span class="op">!==</span>dataK<span class="op">||</span>nN<span class="op">!==</span>dataN){</span>
<span id="cb2-526"><a href="#cb2-526" aria-hidden="true" tabindex="-1"></a>      priorA<span class="op">=</span>nA<span class="op">;</span>priorB<span class="op">=</span>nB<span class="op">;</span>dataK<span class="op">=</span>dk<span class="op">;</span>dataN<span class="op">=</span>nN<span class="op">;</span></span>
<span id="cb2-527"><a href="#cb2-527" aria-hidden="true" tabindex="-1"></a>      <span class="fu">recompute</span>()<span class="op">;</span><span class="fu">drawStatic</span>()<span class="op">;</span><span class="fu">resetChain</span>()<span class="op">;</span></span>
<span id="cb2-528"><a href="#cb2-528" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-529"><a href="#cb2-529" aria-hidden="true" tabindex="-1"></a>    <span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb2-530"><a href="#cb2-530" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-531"><a href="#cb2-531" aria-hidden="true" tabindex="-1"></a>  [SL<span class="op">.</span><span class="at">pA</span><span class="op">,</span>SL<span class="op">.</span><span class="at">pB</span><span class="op">,</span>SL<span class="op">.</span><span class="at">dK</span><span class="op">,</span>SL<span class="op">.</span><span class="at">dN</span>]<span class="op">.</span><span class="fu">forEach</span>(s<span class="kw">=&gt;</span>s<span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span>onModel))<span class="op">;</span></span>
<span id="cb2-532"><a href="#cb2-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-533"><a href="#cb2-533" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Diagnostics → just re-render (no reset)</span></span>
<span id="cb2-534"><a href="#cb2-534" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">burnin</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span>()<span class="kw">=&gt;</span>{SL<span class="op">.</span><span class="at">burnin</span><span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span><span class="fu">render</span>()<span class="op">;</span>})<span class="op">;</span></span>
<span id="cb2-535"><a href="#cb2-535" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">thin</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span>()<span class="kw">=&gt;</span>{SL<span class="op">.</span><span class="at">thin</span><span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span><span class="fu">render</span>()<span class="op">;</span>})<span class="op">;</span></span>
<span id="cb2-536"><a href="#cb2-536" aria-hidden="true" tabindex="-1"></a>  togBurn<span class="op">.</span><span class="at">cb</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"change"</span><span class="op">,</span>render)<span class="op">;</span></span>
<span id="cb2-537"><a href="#cb2-537" aria-hidden="true" tabindex="-1"></a>  togThin<span class="op">.</span><span class="at">cb</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"change"</span><span class="op">,</span>render)<span class="op">;</span></span>
<span id="cb2-538"><a href="#cb2-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-539"><a href="#cb2-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb2-540"><a href="#cb2-540" aria-hidden="true" tabindex="-1"></a>  invalidation<span class="op">.</span><span class="fu">then</span>(()<span class="kw">=&gt;</span>{autoRunning<span class="op">=</span><span class="kw">false</span><span class="op">;</span><span class="pp">clearInterval</span>(autoTimer)<span class="op">;</span>})<span class="op">;</span></span>
<span id="cb2-541"><a href="#cb2-541" aria-hidden="true" tabindex="-1"></a>  outer<span class="op">.</span><span class="at">value</span><span class="op">=</span>{}<span class="op">;</span><span class="cf">return</span> outer<span class="op">;</span></span>
<span id="cb2-542"><a href="#cb2-542" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
</div>
</div>
</section>
<section id="fit-mô-hình" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="fit-mô-hình"><span class="header-section-number">11.2</span> Fit mô hình</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb3" data-startfrom="548" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 547;"><span id="cb3-548"><a href="#cb3-548" aria-hidden="true" tabindex="-1"></a>viewof sir <span class="op">=</span> {</span>
<span id="cb3-549"><a href="#cb3-549" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ MATH UTILITIES ═══════════════════</span></span>
<span id="cb3-550"><a href="#cb3-550" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">lnGamma</span>(z){</span>
<span id="cb3-551"><a href="#cb3-551" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(z<span class="op">&lt;</span><span class="fl">0.5</span>)<span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">/</span><span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">*</span>z))<span class="op">-</span><span class="fu">lnGamma</span>(<span class="dv">1</span><span class="op">-</span>z)<span class="op">;</span></span>
<span id="cb3-552"><a href="#cb3-552" aria-hidden="true" tabindex="-1"></a>    z<span class="op">--;</span><span class="kw">const</span> c<span class="op">=</span>[<span class="fl">0.99999999999980993</span><span class="op">,</span><span class="fl">676.5203681218851</span><span class="op">,-</span><span class="fl">1259.1392167224028</span><span class="op">,</span><span class="fl">771.32342877765313</span><span class="op">,</span></span>
<span id="cb3-553"><a href="#cb3-553" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span><span class="fl">176.61502916214059</span><span class="op">,</span><span class="fl">12.507343278686905</span><span class="op">,-</span><span class="fl">0.13857109526572012</span><span class="op">,</span><span class="fl">9.9843695780195716e-6</span><span class="op">,</span><span class="fl">1.5056327351493116e-7</span>]<span class="op">;</span></span>
<span id="cb3-554"><a href="#cb3-554" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> x<span class="op">=</span>c[<span class="dv">0</span>]<span class="op">;</span><span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">1</span><span class="op">;</span>i<span class="op">&lt;</span><span class="dv">9</span><span class="op">;</span>i<span class="op">++</span>)x<span class="op">+=</span>c[i]<span class="op">/</span>(z<span class="op">+</span>i)<span class="op">;</span></span>
<span id="cb3-555"><a href="#cb3-555" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> t<span class="op">=</span>z<span class="op">+</span><span class="fl">7.5</span><span class="op">;</span><span class="cf">return</span> <span class="fl">0.5</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="dv">2</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>)<span class="op">+</span>(z<span class="op">+</span><span class="fl">0.5</span>)<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(t)<span class="op">-</span>t<span class="op">+</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(x)<span class="op">;</span></span>
<span id="cb3-556"><a href="#cb3-556" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-557"><a href="#cb3-557" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">randn</span>(){<span class="kw">let</span> u<span class="op">=</span><span class="dv">0</span><span class="op">,</span>v<span class="op">=</span><span class="dv">0</span><span class="op">;</span><span class="cf">while</span>(<span class="op">!</span>u)u<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>()<span class="op">;</span><span class="cf">while</span>(<span class="op">!</span>v)v<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>()<span class="op">;</span><span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="op">-</span><span class="dv">2</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(u))<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="dv">2</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">*</span>v)<span class="op">;</span>}</span>
<span id="cb3-558"><a href="#cb3-558" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">mulberry32</span>(seed){<span class="cf">return</span> <span class="kw">function</span>(){seed<span class="op">|=</span><span class="dv">0</span><span class="op">;</span>seed<span class="op">=</span>seed<span class="op">+</span><span class="bn">0x6D2B79F5</span><span class="op">|</span><span class="dv">0</span><span class="op">;</span><span class="kw">let</span> t<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">imul</span>(seed<span class="op">^</span>seed<span class="op">&gt;&gt;&gt;</span><span class="dv">15</span><span class="op">,</span><span class="dv">1</span><span class="op">|</span>seed)<span class="op">;</span>t<span class="op">=</span>t<span class="op">+</span><span class="bu">Math</span><span class="op">.</span><span class="fu">imul</span>(t<span class="op">^</span>t<span class="op">&gt;&gt;&gt;</span><span class="dv">7</span><span class="op">,</span><span class="dv">61</span><span class="op">|</span>t)<span class="op">^</span>t<span class="op">;</span><span class="cf">return</span>((t<span class="op">^</span>t<span class="op">&gt;&gt;&gt;</span><span class="dv">14</span>)<span class="op">&gt;&gt;&gt;</span><span class="dv">0</span>)<span class="op">/</span><span class="dv">4294967296</span><span class="op">;</span>}<span class="op">;</span>}</span>
<span id="cb3-559"><a href="#cb3-559" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">randnSeeded</span>(rng){<span class="kw">let</span> u<span class="op">=</span><span class="dv">0</span><span class="op">,</span>v<span class="op">=</span><span class="dv">0</span><span class="op">;</span><span class="cf">while</span>(<span class="op">!</span>u)u<span class="op">=</span><span class="fu">rng</span>()<span class="op">;</span><span class="cf">while</span>(<span class="op">!</span>v)v<span class="op">=</span><span class="fu">rng</span>()<span class="op">;</span><span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="op">-</span><span class="dv">2</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(u))<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="dv">2</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">*</span>v)<span class="op">;</span>}</span>
<span id="cb3-560"><a href="#cb3-560" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">poissonRng</span>(lam<span class="op">,</span>rng){</span>
<span id="cb3-561"><a href="#cb3-561" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(lam<span class="op">&lt;=</span><span class="dv">0</span>)<span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-562"><a href="#cb3-562" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(lam<span class="op">&lt;</span><span class="dv">30</span>){<span class="kw">const</span> L<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="op">-</span>lam)<span class="op">;</span><span class="kw">let</span> k<span class="op">=</span><span class="dv">0</span><span class="op">,</span>p<span class="op">=</span><span class="dv">1</span><span class="op">;</span><span class="cf">do</span>{k<span class="op">++;</span>p<span class="op">*=</span><span class="fu">rng</span>()<span class="op">;</span>}<span class="cf">while</span>(p<span class="op">&gt;</span>L)<span class="op">;</span><span class="cf">return</span> k<span class="op">-</span><span class="dv">1</span><span class="op">;</span>}</span>
<span id="cb3-563"><a href="#cb3-563" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(lam<span class="op">+</span><span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(lam)<span class="op">*</span><span class="fu">randnSeeded</span>(rng)))<span class="op">;</span></span>
<span id="cb3-564"><a href="#cb3-564" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-565"><a href="#cb3-565" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">normalPDF</span>(x<span class="op">,</span>mu<span class="op">,</span>s){<span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="op">-</span><span class="fl">0.5</span><span class="op">*</span>((x<span class="op">-</span>mu)<span class="op">/</span>s)<span class="op">**</span><span class="dv">2</span>)<span class="op">/</span>(s<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="dv">2</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>))<span class="op">;</span>}</span>
<span id="cb3-566"><a href="#cb3-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-567"><a href="#cb3-567" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ SIR MODEL ═══════════════════</span></span>
<span id="cb3-568"><a href="#cb3-568" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">solveSIR</span>(R0v<span class="op">,</span>gam<span class="op">,</span>s0<span class="op">,</span>i0<span class="op">,</span>r0){</span>
<span id="cb3-569"><a href="#cb3-569" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> N<span class="op">=</span>s0<span class="op">+</span>i0<span class="op">+</span>r0<span class="op">,</span>beta<span class="op">=</span>R0v<span class="op">*</span>gam<span class="op">/</span>N<span class="op">,</span>dt<span class="op">=</span><span class="dv">1</span><span class="op">,</span>tMax<span class="op">=</span><span class="dv">364</span><span class="op">;</span></span>
<span id="cb3-570"><a href="#cb3-570" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sol<span class="op">=</span>[{<span class="dt">t</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span><span class="dt">S</span><span class="op">:</span>s0<span class="op">,</span><span class="dt">I</span><span class="op">:</span>i0<span class="op">,</span><span class="dt">R</span><span class="op">:</span>r0}]<span class="op">;</span></span>
<span id="cb3-571"><a href="#cb3-571" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> S<span class="op">=</span>s0<span class="op">,</span>I<span class="op">=</span>i0<span class="op">,</span>R<span class="op">=</span>r0<span class="op">;</span></span>
<span id="cb3-572"><a href="#cb3-572" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> t<span class="op">=</span><span class="dv">0</span><span class="op">;</span>t<span class="op">&lt;</span>tMax<span class="op">;</span>t<span class="op">++</span>){</span>
<span id="cb3-573"><a href="#cb3-573" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> fS<span class="op">=</span>(s<span class="op">,</span>i)<span class="kw">=&gt;</span><span class="op">-</span>beta<span class="op">*</span>s<span class="op">*</span>i<span class="op">,</span> fI<span class="op">=</span>(s<span class="op">,</span>i)<span class="kw">=&gt;</span>beta<span class="op">*</span>s<span class="op">*</span>i<span class="op">-</span>gam<span class="op">*</span>i<span class="op">;</span></span>
<span id="cb3-574"><a href="#cb3-574" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> k1s<span class="op">=</span><span class="fu">fS</span>(S<span class="op">,</span>I)<span class="op">,</span>k1i<span class="op">=</span><span class="fu">fI</span>(S<span class="op">,</span>I)<span class="op">;</span></span>
<span id="cb3-575"><a href="#cb3-575" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> k2s<span class="op">=</span><span class="fu">fS</span>(S<span class="op">+.</span><span class="dv">5</span><span class="op">*</span>k1s<span class="op">,</span>I<span class="op">+.</span><span class="dv">5</span><span class="op">*</span>k1i)<span class="op">,</span>k2i<span class="op">=</span><span class="fu">fI</span>(S<span class="op">+.</span><span class="dv">5</span><span class="op">*</span>k1s<span class="op">,</span>I<span class="op">+.</span><span class="dv">5</span><span class="op">*</span>k1i)<span class="op">;</span></span>
<span id="cb3-576"><a href="#cb3-576" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> k3s<span class="op">=</span><span class="fu">fS</span>(S<span class="op">+.</span><span class="dv">5</span><span class="op">*</span>k2s<span class="op">,</span>I<span class="op">+.</span><span class="dv">5</span><span class="op">*</span>k2i)<span class="op">,</span>k3i<span class="op">=</span><span class="fu">fI</span>(S<span class="op">+.</span><span class="dv">5</span><span class="op">*</span>k2s<span class="op">,</span>I<span class="op">+.</span><span class="dv">5</span><span class="op">*</span>k2i)<span class="op">;</span></span>
<span id="cb3-577"><a href="#cb3-577" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> k4s<span class="op">=</span><span class="fu">fS</span>(S<span class="op">+</span>k3s<span class="op">,</span>I<span class="op">+</span>k3i)<span class="op">,</span>k4i<span class="op">=</span><span class="fu">fI</span>(S<span class="op">+</span>k3s<span class="op">,</span>I<span class="op">+</span>k3i)<span class="op">;</span></span>
<span id="cb3-578"><a href="#cb3-578" aria-hidden="true" tabindex="-1"></a>      S<span class="op">+=</span>(k1s<span class="op">+</span><span class="dv">2</span><span class="op">*</span>k2s<span class="op">+</span><span class="dv">2</span><span class="op">*</span>k3s<span class="op">+</span>k4s)<span class="op">/</span><span class="dv">6</span><span class="op">;</span> I<span class="op">+=</span>(k1i<span class="op">+</span><span class="dv">2</span><span class="op">*</span>k2i<span class="op">+</span><span class="dv">2</span><span class="op">*</span>k3i<span class="op">+</span>k4i)<span class="op">/</span><span class="dv">6</span><span class="op">;</span></span>
<span id="cb3-579"><a href="#cb3-579" aria-hidden="true" tabindex="-1"></a>      S<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(N<span class="op">,</span>S))<span class="op">;</span> I<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(N<span class="op">,</span>I))<span class="op">;</span> R<span class="op">=</span>N<span class="op">-</span>S<span class="op">-</span>I<span class="op">;</span></span>
<span id="cb3-580"><a href="#cb3-580" aria-hidden="true" tabindex="-1"></a>      sol<span class="op">.</span><span class="fu">push</span>({<span class="dt">t</span><span class="op">:</span>t<span class="op">+</span><span class="dv">1</span><span class="op">,</span>S<span class="op">,</span>I<span class="op">,</span>R})<span class="op">;</span></span>
<span id="cb3-581"><a href="#cb3-581" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-582"><a href="#cb3-582" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sol<span class="op">;</span></span>
<span id="cb3-583"><a href="#cb3-583" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-584"><a href="#cb3-584" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">weeklyInc</span>(sol){</span>
<span id="cb3-585"><a href="#cb3-585" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> w<span class="op">=</span>[]<span class="op">;</span><span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span><span class="dv">52</span><span class="op">;</span>i<span class="op">++</span>){<span class="kw">let</span> s<span class="op">=</span><span class="dv">0</span><span class="op">;</span><span class="cf">for</span>(<span class="kw">let</span> d<span class="op">=</span><span class="dv">0</span><span class="op">;</span>d<span class="op">&lt;</span><span class="dv">7</span><span class="op">;</span>d<span class="op">++</span>){<span class="kw">const</span> j<span class="op">=</span>i<span class="op">*</span><span class="dv">7</span><span class="op">+</span>d<span class="op">;</span>s<span class="op">+=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span>sol[j]<span class="op">.</span><span class="at">S</span><span class="op">-</span>sol[j<span class="op">+</span><span class="dv">1</span>]<span class="op">.</span><span class="at">S</span>)<span class="op">;</span>}w<span class="op">.</span><span class="fu">push</span>(s)<span class="op">;</span>}<span class="cf">return</span> w<span class="op">;</span></span>
<span id="cb3-586"><a href="#cb3-586" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-587"><a href="#cb3-587" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">logLik</span>(obs<span class="op">,</span>pred){</span>
<span id="cb3-588"><a href="#cb3-588" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> ll<span class="op">=</span><span class="dv">0</span><span class="op">;</span><span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>obs<span class="op">.</span><span class="at">length</span><span class="op">;</span>i<span class="op">++</span>){<span class="kw">const</span> lam<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(pred[i]<span class="op">,</span><span class="fl">1e-10</span>)<span class="op">;</span>ll<span class="op">+=</span>obs[i]<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(lam)<span class="op">-</span>lam<span class="op">-</span><span class="fu">lnGamma</span>(obs[i]<span class="op">+</span><span class="dv">1</span>)<span class="op">;</span>}<span class="cf">return</span> ll<span class="op">;</span></span>
<span id="cb3-589"><a href="#cb3-589" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-590"><a href="#cb3-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-591"><a href="#cb3-591" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ DATA GENERATION ═══════════════════</span></span>
<span id="cb3-592"><a href="#cb3-592" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> TRUE_R0<span class="op">=</span><span class="fl">1.5</span><span class="op">,</span> TRUE_GAM<span class="op">=</span><span class="fl">0.2</span><span class="op">,</span> S0<span class="op">=</span><span class="dv">999</span><span class="op">,</span> I0<span class="op">=</span><span class="dv">1</span><span class="op">,</span> R0P<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-593"><a href="#cb3-593" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> R0_LO<span class="op">=</span><span class="dv">1</span><span class="op">,</span>R0_HI<span class="op">=</span><span class="dv">5</span><span class="op">,</span> GAM_LO<span class="op">=</span><span class="fl">0.05</span><span class="op">,</span>GAM_HI<span class="op">=</span><span class="fl">0.8</span><span class="op">;</span></span>
<span id="cb3-594"><a href="#cb3-594" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> trueSol<span class="op">=</span><span class="fu">solveSIR</span>(TRUE_R0<span class="op">,</span>TRUE_GAM<span class="op">,</span>S0<span class="op">,</span>I0<span class="op">,</span>R0P)<span class="op">;</span></span>
<span id="cb3-595"><a href="#cb3-595" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> trueWeekly<span class="op">=</span><span class="fu">weeklyInc</span>(trueSol)<span class="op">;</span></span>
<span id="cb3-596"><a href="#cb3-596" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> rng<span class="op">=</span><span class="fu">mulberry32</span>(<span class="dv">42</span>)<span class="op">;</span></span>
<span id="cb3-597"><a href="#cb3-597" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> obsData<span class="op">=</span>trueWeekly<span class="op">.</span><span class="fu">map</span>(l<span class="kw">=&gt;</span><span class="fu">poissonRng</span>(l<span class="op">,</span>rng))<span class="op">;</span></span>
<span id="cb3-598"><a href="#cb3-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-599"><a href="#cb3-599" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">targetLL</span>(r0<span class="op">,</span>gam){</span>
<span id="cb3-600"><a href="#cb3-600" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(r0<span class="op">&lt;</span>R0_LO<span class="op">||</span>r0<span class="op">&gt;</span>R0_HI<span class="op">||</span>gam<span class="op">&lt;</span>GAM_LO<span class="op">||</span>gam<span class="op">&gt;</span>GAM_HI)<span class="cf">return</span><span class="op">-</span><span class="kw">Infinity</span><span class="op">;</span></span>
<span id="cb3-601"><a href="#cb3-601" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>{<span class="kw">const</span> s<span class="op">=</span><span class="fu">solveSIR</span>(r0<span class="op">,</span>gam<span class="op">,</span>S0<span class="op">,</span>I0<span class="op">,</span>R0P)<span class="op">;</span><span class="kw">const</span> p<span class="op">=</span><span class="fu">weeklyInc</span>(s)<span class="op">;</span><span class="kw">const</span> ll<span class="op">=</span><span class="fu">logLik</span>(obsData<span class="op">,</span>p)<span class="op">;</span><span class="cf">return</span> <span class="pp">isFinite</span>(ll)<span class="op">?</span>ll<span class="op">:-</span><span class="kw">Infinity</span><span class="op">;</span>}</span>
<span id="cb3-602"><a href="#cb3-602" aria-hidden="true" tabindex="-1"></a>    <span class="cf">catch</span>(e){<span class="cf">return</span><span class="op">-</span><span class="kw">Infinity</span><span class="op">;</span>}</span>
<span id="cb3-603"><a href="#cb3-603" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-604"><a href="#cb3-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-605"><a href="#cb3-605" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ PALETTE ═══════════════════</span></span>
<span id="cb3-606"><a href="#cb3-606" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> C<span class="op">=</span>{<span class="dt">current</span><span class="op">:</span><span class="st">"#1565C0"</span><span class="op">,</span><span class="dt">propose</span><span class="op">:</span><span class="st">"#E65100"</span><span class="op">,</span><span class="dt">accept</span><span class="op">:</span><span class="st">"#2E7D32"</span><span class="op">,</span><span class="dt">reject</span><span class="op">:</span><span class="st">"#C62828"</span><span class="op">,</span></span>
<span id="cb3-607"><a href="#cb3-607" aria-hidden="true" tabindex="-1"></a>    <span class="dt">data</span><span class="op">:</span><span class="st">"#FF9800"</span><span class="op">,</span><span class="dt">dataStroke</span><span class="op">:</span><span class="st">"#F57C00"</span><span class="op">,</span><span class="dt">model</span><span class="op">:</span><span class="st">"#1565C0"</span><span class="op">,</span><span class="dt">modelLight</span><span class="op">:</span><span class="st">"#90CAF9"</span><span class="op">,</span></span>
<span id="cb3-608"><a href="#cb3-608" aria-hidden="true" tabindex="-1"></a>    <span class="dt">traceR0</span><span class="op">:</span><span class="st">"#1565C0"</span><span class="op">,</span><span class="dt">traceGam</span><span class="op">:</span><span class="st">"#00897B"</span><span class="op">,</span><span class="dt">trueLine</span><span class="op">:</span><span class="st">"#E53935"</span><span class="op">,</span></span>
<span id="cb3-609"><a href="#cb3-609" aria-hidden="true" tabindex="-1"></a>    <span class="dt">hist</span><span class="op">:</span><span class="st">"#1565C0"</span><span class="op">,</span><span class="dt">histStroke</span><span class="op">:</span><span class="st">"#0D47A1"</span><span class="op">,</span><span class="dt">histGam</span><span class="op">:</span><span class="st">"#00897B"</span><span class="op">,</span><span class="dt">histGamStroke</span><span class="op">:</span><span class="st">"#00695C"</span><span class="op">,</span></span>
<span id="cb3-610"><a href="#cb3-610" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scatter</span><span class="op">:</span><span class="st">"#42A5F5"</span><span class="op">,</span><span class="dt">scatterAccept</span><span class="op">:</span><span class="st">"#66BB6A"</span><span class="op">,</span></span>
<span id="cb3-611"><a href="#cb3-611" aria-hidden="true" tabindex="-1"></a>    <span class="dt">txt</span><span class="op">:</span><span class="st">"#212121"</span><span class="op">,</span><span class="dt">sub</span><span class="op">:</span><span class="st">"#9E9E9E"</span><span class="op">,</span><span class="dt">border</span><span class="op">:</span><span class="st">"#E0E0E0"</span><span class="op">,</span><span class="dt">bg</span><span class="op">:</span><span class="st">"#FAFAFA"</span>}<span class="op">;</span></span>
<span id="cb3-612"><a href="#cb3-612" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mono<span class="op">=</span><span class="st">"'SF Mono',SFMono-Regular,Menlo,monospace"</span><span class="op">;</span></span>
<span id="cb3-613"><a href="#cb3-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-614"><a href="#cb3-614" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ STATE ═══════════════════</span></span>
<span id="cb3-615"><a href="#cb3-615" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> chain<span class="op">=</span>[{<span class="dt">R0</span><span class="op">:</span><span class="fl">2.5</span><span class="op">,</span><span class="dt">gamma</span><span class="op">:</span><span class="fl">0.15</span>}]<span class="op">,</span> stepPhase<span class="op">=</span><span class="st">"idle"</span><span class="op">,</span> stepCount<span class="op">=</span><span class="dv">0</span><span class="op">,</span> nAcc<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-616"><a href="#cb3-616" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> proposedR0<span class="op">=</span><span class="kw">null</span><span class="op">,</span> proposedGam<span class="op">=</span><span class="kw">null</span><span class="op">,</span> curLL<span class="op">=</span><span class="kw">null</span><span class="op">,</span> propLL<span class="op">=</span><span class="kw">null</span><span class="op">;</span></span>
<span id="cb3-617"><a href="#cb3-617" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> logAlpha<span class="op">=</span><span class="dv">0</span><span class="op">,</span> uRand<span class="op">=</span><span class="dv">0</span><span class="op">,</span> accepted<span class="op">=</span><span class="kw">false</span><span class="op">;</span></span>
<span id="cb3-618"><a href="#cb3-618" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> autoRunning<span class="op">=</span><span class="kw">false</span><span class="op">,</span> autoTimer<span class="op">=</span><span class="kw">null</span><span class="op">;</span></span>
<span id="cb3-619"><a href="#cb3-619" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> sigR0<span class="op">=</span><span class="fl">0.15</span><span class="op">,</span> sigGam<span class="op">=</span><span class="fl">0.03</span><span class="op">,</span> autoSpeed<span class="op">=</span><span class="dv">200</span><span class="op">;</span></span>
<span id="cb3-620"><a href="#cb3-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-621"><a href="#cb3-621" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ WRAPPER ═══════════════════</span></span>
<span id="cb3-622"><a href="#cb3-622" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> outer<span class="op">=</span><span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb3-623"><a href="#cb3-623" aria-hidden="true" tabindex="-1"></a>  outer<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span><span class="op">=</span><span class="vs">`display:flex;flex-direction:column;align-items:center;gap:12px;</span></span>
<span id="cb3-624"><a href="#cb3-624" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-family:'Inter',-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;</span></span>
<span id="cb3-625"><a href="#cb3-625" aria-hidden="true" tabindex="-1"></a><span class="vs">    width:100%;max-width:920px;margin:0 auto;`</span><span class="op">;</span></span>
<span id="cb3-626"><a href="#cb3-626" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="op">!</span><span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'link[href*="Inter"]'</span>)){</span>
<span id="cb3-627"><a href="#cb3-627" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> lk<span class="op">=</span><span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">'link'</span>)<span class="op">;</span>lk<span class="op">.</span><span class="at">rel</span><span class="op">=</span><span class="st">'stylesheet'</span><span class="op">;</span></span>
<span id="cb3-628"><a href="#cb3-628" aria-hidden="true" tabindex="-1"></a>    lk<span class="op">.</span><span class="at">href</span><span class="op">=</span><span class="st">'https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&amp;display=swap'</span><span class="op">;</span></span>
<span id="cb3-629"><a href="#cb3-629" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="at">head</span><span class="op">.</span><span class="fu">appendChild</span>(lk)<span class="op">;</span></span>
<span id="cb3-630"><a href="#cb3-630" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-631"><a href="#cb3-631" aria-hidden="true" tabindex="-1"></a>  outer<span class="op">.</span><span class="fu">appendChild</span>(<span class="fu">injectStyle</span>())<span class="op">;</span></span>
<span id="cb3-632"><a href="#cb3-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-633"><a href="#cb3-633" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ CONTROLS ═══════════════════</span></span>
<span id="cb3-634"><a href="#cb3-634" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ctrlRow<span class="op">=</span><span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb3-635"><a href="#cb3-635" aria-hidden="true" tabindex="-1"></a>  ctrlRow<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span><span class="op">=</span><span class="st">"display:flex;gap:10px;width:100%;align-items:center;flex-wrap:wrap;"</span><span class="op">;</span></span>
<span id="cb3-636"><a href="#cb3-636" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">mkBtn</span>(text<span class="op">,</span>color<span class="op">,</span>big){</span>
<span id="cb3-637"><a href="#cb3-637" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> b<span class="op">=</span><span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"button"</span>)<span class="op">;</span></span>
<span id="cb3-638"><a href="#cb3-638" aria-hidden="true" tabindex="-1"></a>    b<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span><span class="op">=</span><span class="vs">`padding:</span><span class="sc">${</span>big<span class="op">?</span><span class="st">"10px 28px"</span><span class="op">:</span><span class="st">"7px 16px"</span><span class="sc">}</span><span class="vs">;border-radius:</span><span class="sc">${</span>big<span class="op">?</span><span class="dv">12</span><span class="op">:</span><span class="dv">10</span><span class="sc">}</span><span class="vs">px;border:none;</span></span>
<span id="cb3-639"><a href="#cb3-639" aria-hidden="true" tabindex="-1"></a><span class="vs">      background:linear-gradient(135deg,</span><span class="sc">${</span>color<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>color<span class="sc">}</span><span class="vs">dd);color:#fff;font-size:</span><span class="sc">${</span>big<span class="op">?</span><span class="dv">15</span><span class="op">:</span><span class="dv">13</span><span class="sc">}</span><span class="vs">px;font-weight:700;cursor:pointer;</span></span>
<span id="cb3-640"><a href="#cb3-640" aria-hidden="true" tabindex="-1"></a><span class="vs">      font-family:inherit;transition:all 0.2s ease;letter-spacing:0.3px;</span></span>
<span id="cb3-641"><a href="#cb3-641" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span><span class="sc">${</span>big<span class="op">?</span><span class="st">"box-shadow:0 4px 14px "</span><span class="op">+</span>color<span class="op">+</span><span class="st">"44;"</span><span class="op">:</span><span class="st">"box-shadow:0 2px 8px rgba(0,0,0,0.12);"</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb3-642"><a href="#cb3-642" aria-hidden="true" tabindex="-1"></a>    b<span class="op">.</span><span class="at">textContent</span><span class="op">=</span>text<span class="op">;</span></span>
<span id="cb3-643"><a href="#cb3-643" aria-hidden="true" tabindex="-1"></a>    b<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'mouseenter'</span><span class="op">,</span>()<span class="kw">=&gt;</span>{b<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">transform</span><span class="op">=</span><span class="st">'translateY(-1px)'</span><span class="op">;</span>b<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">boxShadow</span><span class="op">=</span><span class="vs">`0 6px 20px </span><span class="sc">${</span>color<span class="sc">}</span><span class="vs">55`</span><span class="op">;</span>})<span class="op">;</span></span>
<span id="cb3-644"><a href="#cb3-644" aria-hidden="true" tabindex="-1"></a>    b<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'mouseleave'</span><span class="op">,</span>()<span class="kw">=&gt;</span>{b<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">transform</span><span class="op">=</span><span class="st">'translateY(0)'</span><span class="op">;</span>b<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">boxShadow</span><span class="op">=</span>big<span class="op">?</span><span class="vs">`0 4px 14px </span><span class="sc">${</span>color<span class="sc">}</span><span class="vs">44`</span><span class="op">:</span><span class="st">'0 2px 8px rgba(0,0,0,0.12)'</span><span class="op">;</span>})<span class="op">;</span></span>
<span id="cb3-645"><a href="#cb3-645" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> b<span class="op">;</span></span>
<span id="cb3-646"><a href="#cb3-646" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-647"><a href="#cb3-647" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> btnStep<span class="op">=</span><span class="fu">mkBtn</span>(<span class="st">"▶  Bước tiếp theo"</span><span class="op">,</span>C<span class="op">.</span><span class="at">current</span><span class="op">,</span><span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb3-648"><a href="#cb3-648" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> btnAuto<span class="op">=</span><span class="fu">mkBtn</span>(<span class="st">"⏩ Chạy tự động"</span><span class="op">,</span><span class="st">"#6A1B9A"</span><span class="op">,</span><span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb3-649"><a href="#cb3-649" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> btnReset<span class="op">=</span><span class="fu">mkBtn</span>(<span class="st">"↺ Đặt lại"</span><span class="op">,</span><span class="st">"#78909C"</span><span class="op">,</span><span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb3-650"><a href="#cb3-650" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> stepLabel<span class="op">=</span><span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"span"</span>)<span class="op">;</span></span>
<span id="cb3-651"><a href="#cb3-651" aria-hidden="true" tabindex="-1"></a>  stepLabel<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span><span class="op">=</span><span class="vs">`font-size:13px;font-weight:700;color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">sub</span><span class="sc">}</span><span class="vs">;font-family:</span><span class="sc">${</span>mono<span class="sc">}</span><span class="vs">;margin-left:auto;`</span><span class="op">;</span></span>
<span id="cb3-652"><a href="#cb3-652" aria-hidden="true" tabindex="-1"></a>  ctrlRow<span class="op">.</span><span class="fu">append</span>(btnStep<span class="op">,</span>btnAuto<span class="op">,</span>btnReset<span class="op">,</span>stepLabel)<span class="op">;</span></span>
<span id="cb3-653"><a href="#cb3-653" aria-hidden="true" tabindex="-1"></a>  outer<span class="op">.</span><span class="fu">appendChild</span>(ctrlRow)<span class="op">;</span></span>
<span id="cb3-654"><a href="#cb3-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-655"><a href="#cb3-655" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ── SLIDERS ──</span></span>
<span id="cb3-656"><a href="#cb3-656" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> SL<span class="op">=</span>{}<span class="op">;</span></span>
<span id="cb3-657"><a href="#cb3-657" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">sigR0</span><span class="op">=</span><span class="fu">createSlider</span>(<span class="st">"Proposal σ(R₀)"</span><span class="op">,</span><span class="fl">0.01</span><span class="op">,</span><span class="fl">0.50</span><span class="op">,</span><span class="fl">0.01</span><span class="op">,</span><span class="fl">0.15</span><span class="op">,</span>C<span class="op">.</span><span class="at">propose</span><span class="op">,</span><span class="st">"amber"</span>)<span class="op">;</span></span>
<span id="cb3-658"><a href="#cb3-658" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">sigGam</span><span class="op">=</span><span class="fu">createSlider</span>(<span class="st">"Proposal σ(γ)"</span><span class="op">,</span><span class="fl">0.005</span><span class="op">,</span><span class="fl">0.10</span><span class="op">,</span><span class="fl">0.005</span><span class="op">,</span><span class="fl">0.030</span><span class="op">,</span>C<span class="op">.</span><span class="at">propose</span><span class="op">,</span><span class="st">"amber"</span>)<span class="op">;</span></span>
<span id="cb3-659"><a href="#cb3-659" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">speed</span><span class="op">=</span><span class="fu">createSlider</span>(<span class="st">"Tốc độ (ms/bước)"</span><span class="op">,</span><span class="dv">50</span><span class="op">,</span><span class="dv">500</span><span class="op">,</span><span class="dv">10</span><span class="op">,</span><span class="dv">200</span><span class="op">,</span><span class="st">"#6A1B9A"</span><span class="op">,</span><span class="st">"purple"</span>)<span class="op">;</span></span>
<span id="cb3-660"><a href="#cb3-660" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sr1<span class="op">=</span><span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span>sr1<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span><span class="op">=</span><span class="st">"display:flex;gap:14px;width:100%;"</span><span class="op">;</span></span>
<span id="cb3-661"><a href="#cb3-661" aria-hidden="true" tabindex="-1"></a>  sr1<span class="op">.</span><span class="fu">append</span>(SL<span class="op">.</span><span class="at">sigR0</span><span class="op">.</span><span class="at">el</span><span class="op">,</span>SL<span class="op">.</span><span class="at">sigGam</span><span class="op">.</span><span class="at">el</span><span class="op">,</span>SL<span class="op">.</span><span class="at">speed</span><span class="op">.</span><span class="at">el</span>)<span class="op">;</span></span>
<span id="cb3-662"><a href="#cb3-662" aria-hidden="true" tabindex="-1"></a>  outer<span class="op">.</span><span class="fu">appendChild</span>(sr1)<span class="op">;</span></span>
<span id="cb3-663"><a href="#cb3-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-664"><a href="#cb3-664" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ MAIN SVG ═══════════════════</span></span>
<span id="cb3-665"><a href="#cb3-665" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> W<span class="op">=</span><span class="dv">920</span><span class="op">,</span>mainH<span class="op">=</span><span class="dv">360</span><span class="op">,</span>gap<span class="op">=</span><span class="dv">40</span><span class="op">;</span></span>
<span id="cb3-666"><a href="#cb3-666" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pW<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((W<span class="op">-</span>gap)<span class="op">/</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-667"><a href="#cb3-667" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> M<span class="op">=</span>{<span class="dt">t</span><span class="op">:</span><span class="dv">30</span><span class="op">,</span><span class="dt">b</span><span class="op">:</span><span class="dv">38</span><span class="op">,</span><span class="dt">l</span><span class="op">:</span><span class="dv">50</span><span class="op">,</span><span class="dt">r</span><span class="op">:</span><span class="dv">15</span>}<span class="op">;</span></span>
<span id="cb3-668"><a href="#cb3-668" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> iW<span class="op">=</span>pW<span class="op">-</span>M<span class="op">.</span><span class="at">l</span><span class="op">-</span>M<span class="op">.</span><span class="at">r</span><span class="op">,</span> iH<span class="op">=</span>mainH<span class="op">-</span>M<span class="op">.</span><span class="at">t</span><span class="op">-</span>M<span class="op">.</span><span class="at">b</span><span class="op">;</span></span>
<span id="cb3-669"><a href="#cb3-669" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Trace area: left part = trace line, right part = density histogram</span></span>
<span id="cb3-670"><a href="#cb3-670" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> densW<span class="op">=</span><span class="dv">60</span><span class="op">;</span> <span class="co">// width reserved for density</span></span>
<span id="cb3-671"><a href="#cb3-671" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tGap<span class="op">=</span><span class="dv">42</span><span class="op">,</span>tH<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((mainH<span class="op">-</span>tGap)<span class="op">/</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-672"><a href="#cb3-672" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tM<span class="op">=</span>{<span class="dt">t</span><span class="op">:</span><span class="dv">24</span><span class="op">,</span><span class="dt">b</span><span class="op">:</span><span class="dv">8</span>}<span class="op">,</span>tMb<span class="op">=</span>{<span class="dt">t</span><span class="op">:</span><span class="dv">8</span><span class="op">,</span><span class="dt">b</span><span class="op">:</span><span class="dv">30</span>}<span class="op">;</span></span>
<span id="cb3-673"><a href="#cb3-673" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tIH<span class="op">=</span>tH<span class="op">-</span>tM<span class="op">.</span><span class="at">t</span><span class="op">-</span>tM<span class="op">.</span><span class="at">b</span><span class="op">,</span> tIHb<span class="op">=</span>tH<span class="op">-</span>tMb<span class="op">.</span><span class="at">t</span><span class="op">-</span>tMb<span class="op">.</span><span class="at">b</span><span class="op">;</span></span>
<span id="cb3-674"><a href="#cb3-674" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tIW<span class="op">=</span>pW<span class="op">-</span>M<span class="op">.</span><span class="at">l</span><span class="op">-</span>M<span class="op">.</span><span class="at">r</span><span class="op">-</span>densW<span class="op">-</span><span class="dv">8</span><span class="op">;</span> <span class="co">// trace inner width (leave room for density)</span></span>
<span id="cb3-675"><a href="#cb3-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-676"><a href="#cb3-676" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mainSvg<span class="op">=</span>d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span><span class="vs">`0 0 </span><span class="sc">${</span>W<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>mainH<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb3-677"><a href="#cb3-677" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span><span class="st">"100%"</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span>W<span class="op">+</span><span class="st">"px"</span>)<span class="op">;</span></span>
<span id="cb3-678"><a href="#cb3-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-679"><a href="#cb3-679" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ── Clip path for incidence plot ──</span></span>
<span id="cb3-680"><a href="#cb3-680" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> clipId<span class="op">=</span><span class="st">"inc-clip-"</span><span class="op">+</span><span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>()<span class="op">.</span><span class="fu">toString</span>(<span class="dv">36</span>)<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span><span class="dv">8</span>)<span class="op">;</span></span>
<span id="cb3-681"><a href="#cb3-681" aria-hidden="true" tabindex="-1"></a>  mainSvg<span class="op">.</span><span class="fu">append</span>(<span class="st">"defs"</span>)<span class="op">.</span><span class="fu">append</span>(<span class="st">"clipPath"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span>clipId)</span>
<span id="cb3-682"><a href="#cb3-682" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span><span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span><span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span>iW)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span>iH)<span class="op">;</span></span>
<span id="cb3-683"><a href="#cb3-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-684"><a href="#cb3-684" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ── LEFT: Incidence plot ──</span></span>
<span id="cb3-685"><a href="#cb3-685" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> gInc<span class="op">=</span>mainSvg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span><span class="vs">`translate(</span><span class="sc">${</span>M<span class="op">.</span><span class="at">l</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>M<span class="op">.</span><span class="at">t</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb3-686"><a href="#cb3-686" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xInc<span class="op">=</span>d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([<span class="dv">1</span><span class="op">,</span><span class="dv">52</span>])<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span>iW])<span class="op">;</span></span>
<span id="cb3-687"><a href="#cb3-687" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> yMax<span class="op">=</span>d3<span class="op">.</span><span class="fu">max</span>(obsData)<span class="op">*</span><span class="fl">1.3</span><span class="op">;</span></span>
<span id="cb3-688"><a href="#cb3-688" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> yInc<span class="op">=</span>d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span>yMax])<span class="op">.</span><span class="fu">range</span>([iH<span class="op">,</span><span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb3-689"><a href="#cb3-689" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> incAxisX<span class="op">=</span>gInc<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span><span class="vs">`translate(0,</span><span class="sc">${</span>iH<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb3-690"><a href="#cb3-690" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> incAxisY<span class="op">=</span>gInc<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb3-691"><a href="#cb3-691" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">drawIncAxes</span>(){</span>
<span id="cb3-692"><a href="#cb3-692" aria-hidden="true" tabindex="-1"></a>    incAxisX<span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">axisBottom</span>(xInc)<span class="op">.</span><span class="fu">ticks</span>(<span class="dv">8</span>)<span class="op">.</span><span class="fu">tickSize</span>(<span class="op">-</span>iH)<span class="op">.</span><span class="fu">tickFormat</span>(d3<span class="op">.</span><span class="fu">format</span>(<span class="st">"d"</span>)))</span>
<span id="cb3-693"><a href="#cb3-693" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">call</span>(g<span class="kw">=&gt;</span>{g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"#eee"</span>)<span class="op">;</span>g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">border</span>)<span class="op">;</span>})<span class="op">;</span></span>
<span id="cb3-694"><a href="#cb3-694" aria-hidden="true" tabindex="-1"></a>    incAxisY<span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">axisLeft</span>(yInc)<span class="op">.</span><span class="fu">ticks</span>(<span class="dv">6</span>)<span class="op">.</span><span class="fu">tickSize</span>(<span class="op">-</span>iW))</span>
<span id="cb3-695"><a href="#cb3-695" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">call</span>(g<span class="kw">=&gt;</span>{g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"#eee"</span>)<span class="op">;</span>g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">border</span>)<span class="op">;</span>})<span class="op">;</span></span>
<span id="cb3-696"><a href="#cb3-696" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-697"><a href="#cb3-697" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drawIncAxes</span>()<span class="op">;</span></span>
<span id="cb3-698"><a href="#cb3-698" aria-hidden="true" tabindex="-1"></a>  gInc<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span>iW<span class="op">/</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,-</span><span class="dv">12</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)</span>
<span id="cb3-699"><a href="#cb3-699" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">13</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span><span class="dv">700</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">txt</span>)<span class="op">.</span><span class="fu">text</span>(<span class="st">"Dữ liệu &amp; Dự đoán mô hình"</span>)<span class="op">;</span></span>
<span id="cb3-700"><a href="#cb3-700" aria-hidden="true" tabindex="-1"></a>  gInc<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span>iW<span class="op">/</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span>iH<span class="op">+</span><span class="dv">32</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)</span>
<span id="cb3-701"><a href="#cb3-701" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">10</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">sub</span>)<span class="op">.</span><span class="fu">text</span>(<span class="st">"Tuần"</span>)<span class="op">;</span></span>
<span id="cb3-702"><a href="#cb3-702" aria-hidden="true" tabindex="-1"></a>  gInc<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span><span class="st">"rotate(-90)"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,-</span>iH<span class="op">/</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,-</span><span class="dv">38</span>)</span>
<span id="cb3-703"><a href="#cb3-703" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">10</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">sub</span>)<span class="op">.</span><span class="fu">text</span>(<span class="st">"Số ca mới / tuần"</span>)<span class="op">;</span></span>
<span id="cb3-704"><a href="#cb3-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-705"><a href="#cb3-705" aria-hidden="true" tabindex="-1"></a>  <span class="co">// clipped content group</span></span>
<span id="cb3-706"><a href="#cb3-706" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> gIncClip<span class="op">=</span>gInc<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"clip-path"</span><span class="op">,</span><span class="vs">`url(#</span><span class="sc">${</span>clipId<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb3-707"><a href="#cb3-707" aria-hidden="true" tabindex="-1"></a>  gIncClip<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".obs-dot"</span>)<span class="op">.</span><span class="fu">data</span>(obsData)<span class="op">.</span><span class="fu">join</span>(<span class="st">"circle"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span><span class="st">"obs-dot"</span>)</span>
<span id="cb3-708"><a href="#cb3-708" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span>(d<span class="op">,</span>i)<span class="kw">=&gt;</span><span class="fu">xInc</span>(i<span class="op">+</span><span class="dv">1</span>))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span>d<span class="kw">=&gt;</span><span class="fu">yInc</span>(d))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span><span class="fl">3.5</span>)</span>
<span id="cb3-709"><a href="#cb3-709" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">data</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">dataStroke</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="dv">1</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="fl">0.9</span>)<span class="op">;</span></span>
<span id="cb3-710"><a href="#cb3-710" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> modelLine<span class="op">=</span>gIncClip<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"none"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">model</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="fl">2.5</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="fl">0.85</span>)<span class="op">;</span></span>
<span id="cb3-711"><a href="#cb3-711" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> propLine<span class="op">=</span>gIncClip<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"none"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">propose</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="dv">2</span>)</span>
<span id="cb3-712"><a href="#cb3-712" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span><span class="st">"6,4"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb3-713"><a href="#cb3-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-714"><a href="#cb3-714" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ── RIGHT: Trace plots + density ──</span></span>
<span id="cb3-715"><a href="#cb3-715" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">makeTracePanel</span>(g<span class="op">,</span>color<span class="op">,</span>histColor<span class="op">,</span>histStroke<span class="op">,</span>label<span class="op">,</span>trueVal<span class="op">,</span>innerH<span class="op">,</span>margins){</span>
<span id="cb3-716"><a href="#cb3-716" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> xTr<span class="op">=</span>d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span><span class="dv">10</span>])<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span>tIW])<span class="op">;</span></span>
<span id="cb3-717"><a href="#cb3-717" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yTr<span class="op">=</span>d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([trueVal<span class="op">-</span><span class="fl">0.5</span><span class="op">,</span>trueVal<span class="op">+</span><span class="fl">0.5</span>])<span class="op">.</span><span class="fu">range</span>([innerH<span class="op">,</span><span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb3-718"><a href="#cb3-718" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> axX<span class="op">=</span>g<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span><span class="vs">`translate(0,</span><span class="sc">${</span>innerH<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb3-719"><a href="#cb3-719" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> axY<span class="op">=</span>g<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb3-720"><a href="#cb3-720" aria-hidden="true" tabindex="-1"></a>    g<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span>tIW<span class="op">/</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,-</span><span class="dv">8</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)</span>
<span id="cb3-721"><a href="#cb3-721" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">11</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span><span class="dv">700</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">txt</span>)<span class="op">.</span><span class="fu">text</span>(label)<span class="op">;</span></span>
<span id="cb3-722"><a href="#cb3-722" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> trueLn<span class="op">=</span>g<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span><span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span>tIW)</span>
<span id="cb3-723"><a href="#cb3-723" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">trueLine</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="fl">1.5</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span><span class="st">"4,3"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="fl">0.7</span>)<span class="op">;</span></span>
<span id="cb3-724"><a href="#cb3-724" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> tracePath<span class="op">=</span>g<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"none"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>color)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="fl">1.5</span>)<span class="op">;</span></span>
<span id="cb3-725"><a href="#cb3-725" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> curDot<span class="op">=</span>g<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span><span class="dv">4</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>color)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"#fff"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-726"><a href="#cb3-726" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> propDot<span class="op">=</span>g<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span><span class="dv">4</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"none"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">propose</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb3-727"><a href="#cb3-727" aria-hidden="true" tabindex="-1"></a>    <span class="co">// density histogram group (to the right of trace)</span></span>
<span id="cb3-728"><a href="#cb3-728" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> gDens<span class="op">=</span>g<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span><span class="vs">`translate(</span><span class="sc">${</span>tIW<span class="op">+</span><span class="dv">8</span><span class="sc">}</span><span class="vs">,0)`</span>)<span class="op">;</span></span>
<span id="cb3-729"><a href="#cb3-729" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> densPath<span class="op">=</span>gDens<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>histColor)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill-opacity"</span><span class="op">,</span><span class="fl">0.35</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>histStroke)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="fl">1.2</span>)<span class="op">;</span></span>
<span id="cb3-730"><a href="#cb3-730" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> densTrueLn<span class="op">=</span>gDens<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">trueLine</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="fl">1.5</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span><span class="st">"4,3"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="fl">0.7</span>)<span class="op">;</span></span>
<span id="cb3-731"><a href="#cb3-731" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {xTr<span class="op">,</span>yTr<span class="op">,</span>axX<span class="op">,</span>axY<span class="op">,</span>trueLn<span class="op">,</span>tracePath<span class="op">,</span>curDot<span class="op">,</span>propDot<span class="op">,</span>innerH<span class="op">,</span>margins<span class="op">,</span>trueVal<span class="op">,</span>densPath<span class="op">,</span>densTrueLn<span class="op">,</span>gDens}<span class="op">;</span></span>
<span id="cb3-732"><a href="#cb3-732" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-733"><a href="#cb3-733" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> gTrR0<span class="op">=</span>mainSvg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span><span class="vs">`translate(</span><span class="sc">${</span>pW<span class="op">+</span>gap<span class="op">+</span>M<span class="op">.</span><span class="at">l</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>tM<span class="op">.</span><span class="at">t</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb3-734"><a href="#cb3-734" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> gTrGam<span class="op">=</span>mainSvg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span><span class="vs">`translate(</span><span class="sc">${</span>pW<span class="op">+</span>gap<span class="op">+</span>M<span class="op">.</span><span class="at">l</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>tH<span class="op">+</span>tGap<span class="op">+</span>tMb<span class="op">.</span><span class="at">t</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb3-735"><a href="#cb3-735" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> trR0<span class="op">=</span><span class="fu">makeTracePanel</span>(gTrR0<span class="op">,</span>C<span class="op">.</span><span class="at">traceR0</span><span class="op">,</span>C<span class="op">.</span><span class="at">hist</span><span class="op">,</span>C<span class="op">.</span><span class="at">histStroke</span><span class="op">,</span><span class="st">"Chuỗi R₀"</span><span class="op">,</span>TRUE_R0<span class="op">,</span>tIH<span class="op">,</span>tM)<span class="op">;</span></span>
<span id="cb3-736"><a href="#cb3-736" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> trGam<span class="op">=</span><span class="fu">makeTracePanel</span>(gTrGam<span class="op">,</span>C<span class="op">.</span><span class="at">traceGam</span><span class="op">,</span>C<span class="op">.</span><span class="at">histGam</span><span class="op">,</span>C<span class="op">.</span><span class="at">histGamStroke</span><span class="op">,</span><span class="st">"Chuỗi γ"</span><span class="op">,</span>TRUE_GAM<span class="op">,</span>tIHb<span class="op">,</span>tMb)<span class="op">;</span></span>
<span id="cb3-737"><a href="#cb3-737" aria-hidden="true" tabindex="-1"></a>  gTrGam<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span>tIW<span class="op">/</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span>tIHb<span class="op">+</span><span class="dv">25</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)</span>
<span id="cb3-738"><a href="#cb3-738" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">10</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">sub</span>)<span class="op">.</span><span class="fu">text</span>(<span class="st">"Bước"</span>)<span class="op">;</span></span>
<span id="cb3-739"><a href="#cb3-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-740"><a href="#cb3-740" aria-hidden="true" tabindex="-1"></a>  outer<span class="op">.</span><span class="fu">appendChild</span>(mainSvg<span class="op">.</span><span class="fu">node</span>())<span class="op">;</span></span>
<span id="cb3-741"><a href="#cb3-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-742"><a href="#cb3-742" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ STATUS BOX ═══════════════════</span></span>
<span id="cb3-743"><a href="#cb3-743" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> statusBox<span class="op">=</span><span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb3-744"><a href="#cb3-744" aria-hidden="true" tabindex="-1"></a>  statusBox<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span><span class="op">=</span><span class="vs">`width:100%;padding:14px 18px;border-radius:14px;border:1.5px solid </span><span class="sc">${</span>C<span class="op">.</span><span class="at">border</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb3-745"><a href="#cb3-745" aria-hidden="true" tabindex="-1"></a><span class="vs">    background:#fff;font-family:</span><span class="sc">${</span>mono<span class="sc">}</span><span class="vs">;font-size:13px;color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">txt</span><span class="sc">}</span><span class="vs">;min-height:40px;</span></span>
<span id="cb3-746"><a href="#cb3-746" aria-hidden="true" tabindex="-1"></a><span class="vs">    box-shadow:0 2px 10px rgba(0,0,0,0.04);transition:border-color 0.3s;`</span><span class="op">;</span></span>
<span id="cb3-747"><a href="#cb3-747" aria-hidden="true" tabindex="-1"></a>  outer<span class="op">.</span><span class="fu">appendChild</span>(statusBox)<span class="op">;</span></span>
<span id="cb3-748"><a href="#cb3-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-749"><a href="#cb3-749" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ SCATTER SVG ═══════════════════</span></span>
<span id="cb3-750"><a href="#cb3-750" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scW<span class="op">=</span><span class="dv">420</span><span class="op">,</span>scH<span class="op">=</span><span class="dv">280</span><span class="op">,</span>scM<span class="op">=</span>{<span class="dt">t</span><span class="op">:</span><span class="dv">20</span><span class="op">,</span><span class="dt">b</span><span class="op">:</span><span class="dv">35</span><span class="op">,</span><span class="dt">l</span><span class="op">:</span><span class="dv">50</span><span class="op">,</span><span class="dt">r</span><span class="op">:</span><span class="dv">15</span>}<span class="op">;</span></span>
<span id="cb3-751"><a href="#cb3-751" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scIW<span class="op">=</span>scW<span class="op">-</span>scM<span class="op">.</span><span class="at">l</span><span class="op">-</span>scM<span class="op">.</span><span class="at">r</span><span class="op">,</span>scIH<span class="op">=</span>scH<span class="op">-</span>scM<span class="op">.</span><span class="at">t</span><span class="op">-</span>scM<span class="op">.</span><span class="at">b</span><span class="op">;</span></span>
<span id="cb3-752"><a href="#cb3-752" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scatSvg<span class="op">=</span>d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span><span class="vs">`0 0 </span><span class="sc">${</span>scW<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>scH<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb3-753"><a href="#cb3-753" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span><span class="st">"100%"</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span>scW<span class="op">+</span><span class="st">"px"</span>)<span class="op">;</span></span>
<span id="cb3-754"><a href="#cb3-754" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> gScat<span class="op">=</span>scatSvg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span><span class="vs">`translate(</span><span class="sc">${</span>scM<span class="op">.</span><span class="at">l</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>scM<span class="op">.</span><span class="at">t</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb3-755"><a href="#cb3-755" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xSc<span class="op">=</span>d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([GAM_LO<span class="op">,</span>GAM_HI])<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span>scIW])<span class="op">;</span></span>
<span id="cb3-756"><a href="#cb3-756" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ySc<span class="op">=</span>d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([R0_LO<span class="op">,</span>R0_HI])<span class="op">.</span><span class="fu">range</span>([scIH<span class="op">,</span><span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb3-757"><a href="#cb3-757" aria-hidden="true" tabindex="-1"></a>  gScat<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span><span class="vs">`translate(0,</span><span class="sc">${</span>scIH<span class="sc">}</span><span class="vs">)`</span>)<span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">axisBottom</span>(xSc)<span class="op">.</span><span class="fu">ticks</span>(<span class="dv">6</span>)<span class="op">.</span><span class="fu">tickSize</span>(<span class="op">-</span>scIH))</span>
<span id="cb3-758"><a href="#cb3-758" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(g<span class="kw">=&gt;</span>{g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"#eee"</span>)<span class="op">;</span>g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">border</span>)<span class="op">;</span>})<span class="op">;</span></span>
<span id="cb3-759"><a href="#cb3-759" aria-hidden="true" tabindex="-1"></a>  gScat<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">axisLeft</span>(ySc)<span class="op">.</span><span class="fu">ticks</span>(<span class="dv">6</span>)<span class="op">.</span><span class="fu">tickSize</span>(<span class="op">-</span>scIW))</span>
<span id="cb3-760"><a href="#cb3-760" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(g<span class="kw">=&gt;</span>{g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"#eee"</span>)<span class="op">;</span>g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">border</span>)<span class="op">;</span>})<span class="op">;</span></span>
<span id="cb3-761"><a href="#cb3-761" aria-hidden="true" tabindex="-1"></a>  gScat<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span>scIW<span class="op">/</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,-</span><span class="dv">6</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)</span>
<span id="cb3-762"><a href="#cb3-762" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">12</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span><span class="dv">700</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">txt</span>)<span class="op">.</span><span class="fu">text</span>(<span class="st">"Không gian tham số"</span>)<span class="op">;</span></span>
<span id="cb3-763"><a href="#cb3-763" aria-hidden="true" tabindex="-1"></a>  gScat<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span>scIW<span class="op">/</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span>scIH<span class="op">+</span><span class="dv">30</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)</span>
<span id="cb3-764"><a href="#cb3-764" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">10</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">sub</span>)<span class="op">.</span><span class="fu">text</span>(<span class="st">"γ"</span>)<span class="op">;</span></span>
<span id="cb3-765"><a href="#cb3-765" aria-hidden="true" tabindex="-1"></a>  gScat<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span><span class="st">"rotate(-90)"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,-</span>scIH<span class="op">/</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,-</span><span class="dv">38</span>)</span>
<span id="cb3-766"><a href="#cb3-766" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span><span class="st">"middle"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">10</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">sub</span>)<span class="op">.</span><span class="fu">text</span>(<span class="st">"R₀"</span>)<span class="op">;</span></span>
<span id="cb3-767"><a href="#cb3-767" aria-hidden="true" tabindex="-1"></a>  gScat<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span><span class="fu">xSc</span>(TRUE_GAM)<span class="op">-</span><span class="dv">8</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span><span class="fu">xSc</span>(TRUE_GAM)<span class="op">+</span><span class="dv">8</span>)</span>
<span id="cb3-768"><a href="#cb3-768" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span><span class="fu">ySc</span>(TRUE_R0))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span><span class="fu">ySc</span>(TRUE_R0))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">trueLine</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="fl">2.5</span>)<span class="op">;</span></span>
<span id="cb3-769"><a href="#cb3-769" aria-hidden="true" tabindex="-1"></a>  gScat<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span><span class="fu">xSc</span>(TRUE_GAM))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span><span class="fu">xSc</span>(TRUE_GAM))</span>
<span id="cb3-770"><a href="#cb3-770" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span><span class="fu">ySc</span>(TRUE_R0)<span class="op">-</span><span class="dv">8</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span><span class="fu">ySc</span>(TRUE_R0)<span class="op">+</span><span class="dv">8</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">trueLine</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="fl">2.5</span>)<span class="op">;</span></span>
<span id="cb3-771"><a href="#cb3-771" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scatDots<span class="op">=</span>gScat<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb3-772"><a href="#cb3-772" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scatCur<span class="op">=</span>gScat<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span><span class="dv">5</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">current</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"#fff"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-773"><a href="#cb3-773" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scatProp<span class="op">=</span>gScat<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span><span class="dv">5</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"none"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">propose</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb3-774"><a href="#cb3-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-775"><a href="#cb3-775" aria-hidden="true" tabindex="-1"></a>  outer<span class="op">.</span><span class="fu">appendChild</span>(scatSvg<span class="op">.</span><span class="fu">node</span>())<span class="op">;</span></span>
<span id="cb3-776"><a href="#cb3-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-777"><a href="#cb3-777" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ RENDER FUNCTIONS ═══════════════════</span></span>
<span id="cb3-778"><a href="#cb3-778" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lineGen<span class="op">=</span>d3<span class="op">.</span><span class="fu">line</span>()<span class="op">.</span><span class="fu">x</span>((_<span class="op">,</span>i)<span class="kw">=&gt;</span><span class="fu">xInc</span>(i<span class="op">+</span><span class="dv">1</span>))<span class="op">.</span><span class="fu">curve</span>(d3<span class="op">.</span><span class="at">curveMonotoneX</span>)<span class="op">;</span></span>
<span id="cb3-779"><a href="#cb3-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-780"><a href="#cb3-780" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">renderIncidence</span>(){</span>
<span id="cb3-781"><a href="#cb3-781" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cur<span class="op">=</span>chain[chain<span class="op">.</span><span class="at">length</span><span class="op">-</span><span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb3-782"><a href="#cb3-782" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sol<span class="op">=</span><span class="fu">solveSIR</span>(cur<span class="op">.</span><span class="at">R0</span><span class="op">,</span>cur<span class="op">.</span><span class="at">gamma</span><span class="op">,</span>S0<span class="op">,</span>I0<span class="op">,</span>R0P)<span class="op">;</span></span>
<span id="cb3-783"><a href="#cb3-783" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pred<span class="op">=</span><span class="fu">weeklyInc</span>(sol)<span class="op">;</span></span>
<span id="cb3-784"><a href="#cb3-784" aria-hidden="true" tabindex="-1"></a>    <span class="co">// dynamically adjust y-axis to fit both data and model</span></span>
<span id="cb3-785"><a href="#cb3-785" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> allVals<span class="op">=</span>[<span class="op">...</span>obsData<span class="op">,...</span>pred]<span class="op">;</span></span>
<span id="cb3-786"><a href="#cb3-786" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> propPred<span class="op">=</span><span class="kw">null</span><span class="op">;</span></span>
<span id="cb3-787"><a href="#cb3-787" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(stepPhase<span class="op">===</span><span class="st">"proposed"</span><span class="op">&amp;&amp;</span>proposedR0<span class="op">!=</span><span class="kw">null</span>){</span>
<span id="cb3-788"><a href="#cb3-788" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> pSol<span class="op">=</span><span class="fu">solveSIR</span>(proposedR0<span class="op">,</span>proposedGam<span class="op">,</span>S0<span class="op">,</span>I0<span class="op">,</span>R0P)<span class="op">;</span></span>
<span id="cb3-789"><a href="#cb3-789" aria-hidden="true" tabindex="-1"></a>      propPred<span class="op">=</span><span class="fu">weeklyInc</span>(pSol)<span class="op">;</span></span>
<span id="cb3-790"><a href="#cb3-790" aria-hidden="true" tabindex="-1"></a>      allVals<span class="op">.</span><span class="fu">push</span>(<span class="op">...</span>propPred)<span class="op">;</span></span>
<span id="cb3-791"><a href="#cb3-791" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-792"><a href="#cb3-792" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> newYMax<span class="op">=</span>d3<span class="op">.</span><span class="fu">max</span>(allVals)<span class="op">*</span><span class="fl">1.2</span><span class="op">;</span></span>
<span id="cb3-793"><a href="#cb3-793" aria-hidden="true" tabindex="-1"></a>    yInc<span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(newYMax<span class="op">,</span><span class="dv">10</span>)])<span class="op">;</span></span>
<span id="cb3-794"><a href="#cb3-794" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drawIncAxes</span>()<span class="op">;</span></span>
<span id="cb3-795"><a href="#cb3-795" aria-hidden="true" tabindex="-1"></a>    <span class="co">// re-position data dots with new scale</span></span>
<span id="cb3-796"><a href="#cb3-796" aria-hidden="true" tabindex="-1"></a>    gIncClip<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".obs-dot"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span>d<span class="kw">=&gt;</span><span class="fu">yInc</span>(d))<span class="op">;</span></span>
<span id="cb3-797"><a href="#cb3-797" aria-hidden="true" tabindex="-1"></a>    modelLine<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span>lineGen<span class="op">.</span><span class="fu">y</span>(d<span class="kw">=&gt;</span><span class="fu">yInc</span>(d))(pred))<span class="op">;</span></span>
<span id="cb3-798"><a href="#cb3-798" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(propPred){</span>
<span id="cb3-799"><a href="#cb3-799" aria-hidden="true" tabindex="-1"></a>      propLine<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span>lineGen<span class="op">.</span><span class="fu">y</span>(d<span class="kw">=&gt;</span><span class="fu">yInc</span>(d))(propPred))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="fl">0.8</span>)<span class="op">;</span></span>
<span id="cb3-800"><a href="#cb3-800" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> propLine<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb3-801"><a href="#cb3-801" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-802"><a href="#cb3-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-803"><a href="#cb3-803" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateTrace</span>(tr<span class="op">,</span>vals<span class="op">,</span>propVal<span class="op">,</span>key){</span>
<span id="cb3-804"><a href="#cb3-804" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> n<span class="op">=</span>vals<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb3-805"><a href="#cb3-805" aria-hidden="true" tabindex="-1"></a>    tr<span class="op">.</span><span class="at">xTr</span><span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">10</span><span class="op">,</span>n)])<span class="op">;</span></span>
<span id="cb3-806"><a href="#cb3-806" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> ext<span class="op">=</span>d3<span class="op">.</span><span class="fu">extent</span>(vals<span class="op">.</span><span class="fu">map</span>(v<span class="kw">=&gt;</span>v[key]))<span class="op">;</span></span>
<span id="cb3-807"><a href="#cb3-807" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pad<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>((ext[<span class="dv">1</span>]<span class="op">-</span>ext[<span class="dv">0</span>])<span class="op">*</span><span class="fl">0.2</span><span class="op">,</span><span class="fl">0.05</span>)<span class="op">;</span></span>
<span id="cb3-808"><a href="#cb3-808" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> lo<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(ext[<span class="dv">0</span>]<span class="op">,</span>tr<span class="op">.</span><span class="at">trueVal</span>)<span class="op">-</span>pad<span class="op">,</span> hi<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(ext[<span class="dv">1</span>]<span class="op">,</span>tr<span class="op">.</span><span class="at">trueVal</span>)<span class="op">+</span>pad<span class="op">;</span></span>
<span id="cb3-809"><a href="#cb3-809" aria-hidden="true" tabindex="-1"></a>    tr<span class="op">.</span><span class="at">yTr</span><span class="op">.</span><span class="fu">domain</span>([lo<span class="op">,</span>hi])<span class="op">;</span></span>
<span id="cb3-810"><a href="#cb3-810" aria-hidden="true" tabindex="-1"></a>    tr<span class="op">.</span><span class="at">axX</span><span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">axisBottom</span>(tr<span class="op">.</span><span class="at">xTr</span>)<span class="op">.</span><span class="fu">ticks</span>(<span class="dv">5</span>)<span class="op">.</span><span class="fu">tickFormat</span>(d3<span class="op">.</span><span class="fu">format</span>(<span class="st">"d"</span>))<span class="op">.</span><span class="fu">tickSize</span>(<span class="op">-</span>tr<span class="op">.</span><span class="at">innerH</span>))</span>
<span id="cb3-811"><a href="#cb3-811" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">call</span>(g<span class="kw">=&gt;</span>{g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"#eee"</span>)<span class="op">;</span>g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">border</span>)<span class="op">;</span>})<span class="op">;</span></span>
<span id="cb3-812"><a href="#cb3-812" aria-hidden="true" tabindex="-1"></a>    tr<span class="op">.</span><span class="at">axY</span><span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">axisLeft</span>(tr<span class="op">.</span><span class="at">yTr</span>)<span class="op">.</span><span class="fu">ticks</span>(<span class="dv">4</span>)<span class="op">.</span><span class="fu">tickSize</span>(<span class="op">-</span>tIW))</span>
<span id="cb3-813"><a href="#cb3-813" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">call</span>(g<span class="kw">=&gt;</span>{g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"#eee"</span>)<span class="op">;</span>g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span>C<span class="op">.</span><span class="at">border</span>)<span class="op">;</span>})<span class="op">;</span></span>
<span id="cb3-814"><a href="#cb3-814" aria-hidden="true" tabindex="-1"></a>    tr<span class="op">.</span><span class="at">trueLn</span><span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span>tr<span class="op">.</span><span class="fu">yTr</span>(tr<span class="op">.</span><span class="at">trueVal</span>))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span>tr<span class="op">.</span><span class="fu">yTr</span>(tr<span class="op">.</span><span class="at">trueVal</span>))<span class="op">;</span></span>
<span id="cb3-815"><a href="#cb3-815" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> line<span class="op">=</span>d3<span class="op">.</span><span class="fu">line</span>()<span class="op">.</span><span class="fu">x</span>((_<span class="op">,</span>i)<span class="kw">=&gt;</span>tr<span class="op">.</span><span class="fu">xTr</span>(i))<span class="op">.</span><span class="fu">y</span>(d<span class="kw">=&gt;</span>tr<span class="op">.</span><span class="fu">yTr</span>(d[key]))<span class="op">;</span></span>
<span id="cb3-816"><a href="#cb3-816" aria-hidden="true" tabindex="-1"></a>    tr<span class="op">.</span><span class="at">tracePath</span><span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span><span class="fu">line</span>(vals))<span class="op">;</span></span>
<span id="cb3-817"><a href="#cb3-817" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> last<span class="op">=</span>vals[vals<span class="op">.</span><span class="at">length</span><span class="op">-</span><span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb3-818"><a href="#cb3-818" aria-hidden="true" tabindex="-1"></a>    tr<span class="op">.</span><span class="at">curDot</span><span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span>tr<span class="op">.</span><span class="fu">xTr</span>(n<span class="op">-</span><span class="dv">1</span>))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span>tr<span class="op">.</span><span class="fu">yTr</span>(last[key]))<span class="op">;</span></span>
<span id="cb3-819"><a href="#cb3-819" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(stepPhase<span class="op">===</span><span class="st">"proposed"</span><span class="op">&amp;&amp;</span>propVal<span class="op">!=</span><span class="kw">null</span>){</span>
<span id="cb3-820"><a href="#cb3-820" aria-hidden="true" tabindex="-1"></a>      tr<span class="op">.</span><span class="at">propDot</span><span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span>tr<span class="op">.</span><span class="fu">xTr</span>(n))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span>tr<span class="op">.</span><span class="fu">yTr</span>(propVal))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-821"><a href="#cb3-821" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> tr<span class="op">.</span><span class="at">propDot</span><span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb3-822"><a href="#cb3-822" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ── Density histogram (rotated 90°, drawn to the right of trace) ──</span></span>
<span id="cb3-823"><a href="#cb3-823" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(n<span class="op">&gt;=</span><span class="dv">3</span>){</span>
<span id="cb3-824"><a href="#cb3-824" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> data<span class="op">=</span>vals<span class="op">.</span><span class="fu">map</span>(v<span class="kw">=&gt;</span>v[key])<span class="op">;</span></span>
<span id="cb3-825"><a href="#cb3-825" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> mean<span class="op">=</span>d3<span class="op">.</span><span class="fu">mean</span>(data)<span class="op">,</span> sd<span class="op">=</span>d3<span class="op">.</span><span class="fu">deviation</span>(data)<span class="op">||</span><span class="fl">0.01</span><span class="op">;</span></span>
<span id="cb3-826"><a href="#cb3-826" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> nBins<span class="op">=</span><span class="dv">30</span><span class="op">;</span></span>
<span id="cb3-827"><a href="#cb3-827" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> yLo<span class="op">=</span>tr<span class="op">.</span><span class="at">yTr</span><span class="op">.</span><span class="fu">domain</span>()[<span class="dv">0</span>]<span class="op">,</span> yHi<span class="op">=</span>tr<span class="op">.</span><span class="at">yTr</span><span class="op">.</span><span class="fu">domain</span>()[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb3-828"><a href="#cb3-828" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> step<span class="op">=</span>(yHi<span class="op">-</span>yLo)<span class="op">/</span>nBins<span class="op">;</span></span>
<span id="cb3-829"><a href="#cb3-829" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> pts<span class="op">=</span>[]<span class="op">;</span></span>
<span id="cb3-830"><a href="#cb3-830" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;=</span>nBins<span class="op">;</span>i<span class="op">++</span>){</span>
<span id="cb3-831"><a href="#cb3-831" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> v<span class="op">=</span>yLo<span class="op">+</span>i<span class="op">*</span>step<span class="op">;</span></span>
<span id="cb3-832"><a href="#cb3-832" aria-hidden="true" tabindex="-1"></a>        pts<span class="op">.</span><span class="fu">push</span>({v<span class="op">,</span><span class="dt">d</span><span class="op">:</span><span class="fu">normalPDF</span>(v<span class="op">,</span>mean<span class="op">,</span>sd)})<span class="op">;</span></span>
<span id="cb3-833"><a href="#cb3-833" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-834"><a href="#cb3-834" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> xDens<span class="op">=</span>d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span>d3<span class="op">.</span><span class="fu">max</span>(pts<span class="op">,</span>p<span class="kw">=&gt;</span>p<span class="op">.</span><span class="at">d</span>)])<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span>densW])<span class="op">;</span></span>
<span id="cb3-835"><a href="#cb3-835" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> area<span class="op">=</span>d3<span class="op">.</span><span class="fu">area</span>()<span class="op">.</span><span class="fu">x0</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">x1</span>(p<span class="kw">=&gt;</span><span class="fu">xDens</span>(p<span class="op">.</span><span class="at">d</span>))<span class="op">.</span><span class="fu">y</span>(p<span class="kw">=&gt;</span>tr<span class="op">.</span><span class="fu">yTr</span>(p<span class="op">.</span><span class="at">v</span>))<span class="op">.</span><span class="fu">curve</span>(d3<span class="op">.</span><span class="at">curveBasis</span>)<span class="op">;</span></span>
<span id="cb3-836"><a href="#cb3-836" aria-hidden="true" tabindex="-1"></a>      tr<span class="op">.</span><span class="at">densPath</span><span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span><span class="fu">area</span>(pts))<span class="op">;</span></span>
<span id="cb3-837"><a href="#cb3-837" aria-hidden="true" tabindex="-1"></a>      tr<span class="op">.</span><span class="at">densTrueLn</span><span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span><span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span>densW)</span>
<span id="cb3-838"><a href="#cb3-838" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span>tr<span class="op">.</span><span class="fu">yTr</span>(tr<span class="op">.</span><span class="at">trueVal</span>))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span>tr<span class="op">.</span><span class="fu">yTr</span>(tr<span class="op">.</span><span class="at">trueVal</span>))<span class="op">;</span></span>
<span id="cb3-839"><a href="#cb3-839" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb3-840"><a href="#cb3-840" aria-hidden="true" tabindex="-1"></a>      tr<span class="op">.</span><span class="at">densPath</span><span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span><span class="st">""</span>)<span class="op">;</span></span>
<span id="cb3-841"><a href="#cb3-841" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-842"><a href="#cb3-842" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-843"><a href="#cb3-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-844"><a href="#cb3-844" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">renderTraces</span>(){</span>
<span id="cb3-845"><a href="#cb3-845" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateTrace</span>(trR0<span class="op">,</span>chain<span class="op">,</span>proposedR0<span class="op">,</span><span class="st">"R0"</span>)<span class="op">;</span></span>
<span id="cb3-846"><a href="#cb3-846" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateTrace</span>(trGam<span class="op">,</span>chain<span class="op">,</span>proposedGam<span class="op">,</span><span class="st">"gamma"</span>)<span class="op">;</span></span>
<span id="cb3-847"><a href="#cb3-847" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-848"><a href="#cb3-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-849"><a href="#cb3-849" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">renderScatter</span>(){</span>
<span id="cb3-850"><a href="#cb3-850" aria-hidden="true" tabindex="-1"></a>    scatDots<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"circle"</span>)<span class="op">.</span><span class="fu">data</span>(chain)<span class="op">.</span><span class="fu">join</span>(<span class="st">"circle"</span>)</span>
<span id="cb3-851"><a href="#cb3-851" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span>d<span class="kw">=&gt;</span><span class="fu">xSc</span>(d<span class="op">.</span><span class="at">gamma</span>))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span>d<span class="kw">=&gt;</span><span class="fu">ySc</span>(d<span class="op">.</span><span class="at">R0</span>))</span>
<span id="cb3-852"><a href="#cb3-852" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span><span class="fl">2.5</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>C<span class="op">.</span><span class="at">scatter</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="fl">0.4</span>)<span class="op">;</span></span>
<span id="cb3-853"><a href="#cb3-853" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> last<span class="op">=</span>chain[chain<span class="op">.</span><span class="at">length</span><span class="op">-</span><span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb3-854"><a href="#cb3-854" aria-hidden="true" tabindex="-1"></a>    scatCur<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span><span class="fu">xSc</span>(last<span class="op">.</span><span class="at">gamma</span>))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span><span class="fu">ySc</span>(last<span class="op">.</span><span class="at">R0</span>))<span class="op">;</span></span>
<span id="cb3-855"><a href="#cb3-855" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(stepPhase<span class="op">===</span><span class="st">"proposed"</span><span class="op">&amp;&amp;</span>proposedR0<span class="op">!=</span><span class="kw">null</span>){</span>
<span id="cb3-856"><a href="#cb3-856" aria-hidden="true" tabindex="-1"></a>      scatProp<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span><span class="fu">xSc</span>(proposedGam))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span><span class="fu">ySc</span>(proposedR0))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-857"><a href="#cb3-857" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> scatProp<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb3-858"><a href="#cb3-858" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-859"><a href="#cb3-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-860"><a href="#cb3-860" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">pill</span>(label<span class="op">,</span>color){<span class="cf">return</span> <span class="vs">`&lt;span style="display:inline-block;padding:3px 12px;border-radius:6px;background:</span><span class="sc">${</span>color<span class="sc">}</span><span class="vs">;color:#fff;font-weight:700;font-size:12px;letter-spacing:0.5px;"&gt;</span><span class="sc">${</span>label<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">;</span>}</span>
<span id="cb3-861"><a href="#cb3-861" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">vl</span>(t<span class="op">,</span>c<span class="op">,</span>b){<span class="cf">return</span> <span class="vs">`&lt;span style="color:</span><span class="sc">${</span>c<span class="sc">}</span><span class="vs">;font-weight:</span><span class="sc">${</span>b<span class="op">?</span><span class="dv">800</span><span class="op">:</span><span class="dv">600</span><span class="sc">}</span><span class="vs">;"&gt;</span><span class="sc">${</span>t<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">;</span>}</span>
<span id="cb3-862"><a href="#cb3-862" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">lb</span>(t<span class="op">,</span>c){<span class="cf">return</span> <span class="vs">`&lt;span style="color:</span><span class="sc">${</span>c<span class="sc">}</span><span class="vs">;font-size:11px;font-weight:600;opacity:0.7;"&gt;</span><span class="sc">${</span>t<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">;</span>}</span>
<span id="cb3-863"><a href="#cb3-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-864"><a href="#cb3-864" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateStatus</span>(){</span>
<span id="cb3-865"><a href="#cb3-865" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cur<span class="op">=</span>chain[chain<span class="op">.</span><span class="at">length</span><span class="op">-</span><span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb3-866"><a href="#cb3-866" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> stats<span class="op">=</span><span class="vs">`&lt;div style="margin-top:6px;font-size:11px;color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">sub</span><span class="sc">}</span><span class="vs">;"&gt;Bước </span><span class="sc">${</span>stepCount<span class="sc">}</span><span class="vs"> · </span><span class="sc">${</span>nAcc<span class="sc">}</span><span class="vs"> chấp nhận&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb3-867"><a href="#cb3-867" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(stepPhase<span class="op">===</span><span class="st">"idle"</span>){</span>
<span id="cb3-868"><a href="#cb3-868" aria-hidden="true" tabindex="-1"></a>      statusBox<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">borderColor</span><span class="op">=</span>C<span class="op">.</span><span class="at">border</span><span class="op">;</span></span>
<span id="cb3-869"><a href="#cb3-869" aria-hidden="true" tabindex="-1"></a>      statusBox<span class="op">.</span><span class="at">innerHTML</span><span class="op">=</span><span class="vs">`&lt;div style="display:flex;align-items:center;gap:12px;"&gt;`</span><span class="op">+</span><span class="fu">pill</span>(<span class="st">'SẴN SÀNG'</span><span class="op">,</span><span class="st">'#546E7A'</span>)<span class="op">+</span></span>
<span id="cb3-870"><a href="#cb3-870" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;span style="font-size:14px;"&gt;Vị trí hiện tại: </span><span class="sc">${</span><span class="fu">vl</span>(<span class="st">'R₀ = '</span><span class="op">+</span>cur<span class="op">.</span><span class="at">R0</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="op">,</span>C<span class="op">.</span><span class="at">current</span><span class="op">,</span><span class="kw">true</span>)<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span><span class="fu">vl</span>(<span class="st">'γ = '</span><span class="op">+</span>cur<span class="op">.</span><span class="at">gamma</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span>C<span class="op">.</span><span class="at">traceGam</span><span class="op">,</span><span class="kw">true</span>)<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">+</span></span>
<span id="cb3-871"><a href="#cb3-871" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;span style="margin-left:auto;color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">sub</span><span class="sc">}</span><span class="vs">;font-size:12px;"&gt;Nhấn &lt;b style="color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">current</span><span class="sc">}</span><span class="vs">"&gt;Bước tiếp theo&lt;/b&gt; ▶&lt;/span&gt;&lt;/div&gt;`</span><span class="op">+</span>stats<span class="op">;</span></span>
<span id="cb3-872"><a href="#cb3-872" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(stepPhase<span class="op">===</span><span class="st">"proposed"</span>){</span>
<span id="cb3-873"><a href="#cb3-873" aria-hidden="true" tabindex="-1"></a>      statusBox<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">borderColor</span><span class="op">=</span>C<span class="op">.</span><span class="at">propose</span><span class="op">;</span></span>
<span id="cb3-874"><a href="#cb3-874" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> clampedAlpha<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">1</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(logAlpha))<span class="op">;</span></span>
<span id="cb3-875"><a href="#cb3-875" aria-hidden="true" tabindex="-1"></a>      statusBox<span class="op">.</span><span class="at">innerHTML</span><span class="op">=</span><span class="vs">`&lt;div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;"&gt;`</span><span class="op">+</span></span>
<span id="cb3-876"><a href="#cb3-876" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pill</span>(<span class="st">'ĐỀ XUẤT'</span><span class="op">,</span>C<span class="op">.</span><span class="at">propose</span>)<span class="op">+</span><span class="vs">`&lt;span style="font-size:13px;"&gt;R₀* = </span><span class="sc">${</span><span class="fu">vl</span>(proposedR0<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="op">,</span>C<span class="op">.</span><span class="at">propose</span><span class="op">,</span><span class="kw">true</span>)<span class="sc">}</span><span class="vs">, γ* = </span><span class="sc">${</span><span class="fu">vl</span>(proposedGam<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span>C<span class="op">.</span><span class="at">propose</span><span class="op">,</span><span class="kw">true</span>)<span class="sc">}</span><span class="vs">&lt;/span&gt;&lt;/div&gt;`</span><span class="op">+</span></span>
<span id="cb3-877"><a href="#cb3-877" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;table style="width:100%;border-collapse:separate;border-spacing:0;border-radius:10px;overflow:hidden;border:1px solid #E0E0E0;font-size:12px;"&gt;`</span><span class="op">+</span></span>
<span id="cb3-878"><a href="#cb3-878" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;thead&gt;&lt;tr style="background:#F5F5F5;"&gt;&lt;th style="padding:6px 12px;text-align:left;border-bottom:1px solid #E0E0E0;"&gt;&lt;/th&gt;`</span><span class="op">+</span></span>
<span id="cb3-879"><a href="#cb3-879" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;th style="padding:6px 12px;text-align:center;font-weight:700;color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">current</span><span class="sc">}</span><span class="vs">;border-bottom:1px solid #E0E0E0;"&gt;Hiện tại&lt;/th&gt;`</span><span class="op">+</span></span>
<span id="cb3-880"><a href="#cb3-880" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;th style="padding:6px 12px;text-align:center;font-weight:700;color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">propose</span><span class="sc">}</span><span class="vs">;border-bottom:1px solid #E0E0E0;"&gt;Đề xuất&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;`</span><span class="op">+</span></span>
<span id="cb3-881"><a href="#cb3-881" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;tr&gt;&lt;td style="padding:5px 12px;font-weight:600;"&gt;Log-Likelihood&lt;/td&gt;`</span><span class="op">+</span></span>
<span id="cb3-882"><a href="#cb3-882" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;td style="padding:5px 12px;text-align:center;color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">current</span><span class="sc">}</span><span class="vs">;"&gt;</span><span class="sc">${</span>curLL<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">&lt;/td&gt;`</span><span class="op">+</span></span>
<span id="cb3-883"><a href="#cb3-883" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;td style="padding:5px 12px;text-align:center;color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">propose</span><span class="sc">}</span><span class="vs">;"&gt;</span><span class="sc">${</span>(propLL<span class="op">===-</span><span class="kw">Infinity</span><span class="op">?</span><span class="st">"-∞"</span><span class="op">:</span>propLL<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>))<span class="sc">}</span><span class="vs">&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;`</span><span class="op">+</span></span>
<span id="cb3-884"><a href="#cb3-884" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;div style="display:flex;align-items:center;gap:20px;margin-top:8px;padding:8px 12px;background:#fff;border-radius:8px;border:1px solid #E0E0E0;"&gt;`</span><span class="op">+</span></span>
<span id="cb3-885"><a href="#cb3-885" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;span&gt;</span><span class="sc">${</span><span class="fu">lb</span>(<span class="st">'Tỷ lệ chấp nhận'</span><span class="op">,</span><span class="st">'#333'</span>)<span class="sc">}</span><span class="vs"> α = </span><span class="sc">${</span><span class="fu">vl</span>(clampedAlpha<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span><span class="st">'#333'</span><span class="op">,</span><span class="kw">true</span>)<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">+</span></span>
<span id="cb3-886"><a href="#cb3-886" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;span style="color:#BDBDBD;"&gt;│&lt;/span&gt;`</span><span class="op">+</span></span>
<span id="cb3-887"><a href="#cb3-887" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;span&gt;</span><span class="sc">${</span><span class="fu">lb</span>(<span class="st">'Rút ngẫu nhiên'</span><span class="op">,</span><span class="st">'#333'</span>)<span class="sc">}</span><span class="vs"> u = </span><span class="sc">${</span><span class="fu">vl</span>(uRand<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span><span class="st">'#E65100'</span><span class="op">,</span><span class="kw">true</span>)<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">+</span></span>
<span id="cb3-888"><a href="#cb3-888" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;span style="margin-left:auto;font-size:12px;color:</span><span class="sc">${</span>C<span class="op">.</span><span class="at">sub</span><span class="sc">}</span><span class="vs">;"&gt;Nhấn &lt;b&gt;Bước tiếp theo&lt;/b&gt; để quyết định&lt;/span&gt;&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb3-889"><a href="#cb3-889" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb3-890"><a href="#cb3-890" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> dc<span class="op">=</span>accepted<span class="op">?</span>C<span class="op">.</span><span class="at">accept</span><span class="op">:</span>C<span class="op">.</span><span class="at">reject</span><span class="op">;</span></span>
<span id="cb3-891"><a href="#cb3-891" aria-hidden="true" tabindex="-1"></a>      statusBox<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">borderColor</span><span class="op">=</span>dc<span class="op">;</span></span>
<span id="cb3-892"><a href="#cb3-892" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> clampedAlpha<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">1</span><span class="op">,</span><span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(logAlpha))<span class="op">;</span></span>
<span id="cb3-893"><a href="#cb3-893" aria-hidden="true" tabindex="-1"></a>      statusBox<span class="op">.</span><span class="at">innerHTML</span><span class="op">=</span><span class="vs">`&lt;div style="display:flex;align-items:center;gap:12px;"&gt;`</span><span class="op">+</span></span>
<span id="cb3-894"><a href="#cb3-894" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pill</span>(accepted<span class="op">?</span><span class="st">'✓ CHẤP NHẬN'</span><span class="op">:</span><span class="st">'✗ TỪ CHỐI'</span><span class="op">,</span>dc)<span class="op">+</span></span>
<span id="cb3-895"><a href="#cb3-895" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;span style="font-size:14px;font-weight:600;"&gt;α = </span><span class="sc">${</span><span class="fu">vl</span>(clampedAlpha<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span>C<span class="op">.</span><span class="at">txt</span>)<span class="sc">}</span><span class="vs"> `</span><span class="op">+</span></span>
<span id="cb3-896"><a href="#cb3-896" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;span style="color:</span><span class="sc">${</span>dc<span class="sc">}</span><span class="vs">;font-weight:800;font-size:15px;"&gt;</span><span class="sc">${</span>accepted<span class="op">?</span><span class="st">'≥'</span><span class="op">:</span><span class="st">'&lt;'</span><span class="sc">}</span><span class="vs">&lt;/span&gt; `</span><span class="op">+</span></span>
<span id="cb3-897"><a href="#cb3-897" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`u = </span><span class="sc">${</span><span class="fu">vl</span>(uRand<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span>C<span class="op">.</span><span class="at">propose</span>)<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">+</span></span>
<span id="cb3-898"><a href="#cb3-898" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`&lt;span style="margin-left:auto;font-size:13px;color:</span><span class="sc">${</span>dc<span class="sc">}</span><span class="vs">;font-weight:600;"&gt;`</span><span class="op">+</span></span>
<span id="cb3-899"><a href="#cb3-899" aria-hidden="true" tabindex="-1"></a>        (accepted<span class="op">?</span><span class="vs">`→ Di chuyển đến R₀*=</span><span class="sc">${</span>proposedR0<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="sc">}</span><span class="vs">, γ*=</span><span class="sc">${</span>proposedGam<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb3-900"><a href="#cb3-900" aria-hidden="true" tabindex="-1"></a>                 <span class="op">:</span><span class="vs">`→ Ở lại R₀=</span><span class="sc">${</span>cur<span class="op">.</span><span class="at">R0</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="sc">}</span><span class="vs">, γ=</span><span class="sc">${</span>cur<span class="op">.</span><span class="at">gamma</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="sc">}</span><span class="vs">`</span>)<span class="op">+</span><span class="vs">`&lt;/span&gt;&lt;/div&gt;`</span><span class="op">+</span>stats<span class="op">;</span></span>
<span id="cb3-901"><a href="#cb3-901" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-902"><a href="#cb3-902" aria-hidden="true" tabindex="-1"></a>    stepLabel<span class="op">.</span><span class="at">textContent</span><span class="op">=</span><span class="vs">`Bước </span><span class="sc">${</span>stepCount<span class="sc">}</span><span class="vs"> · </span><span class="sc">${</span>nAcc<span class="sc">}</span><span class="vs"> mẫu`</span><span class="op">;</span></span>
<span id="cb3-903"><a href="#cb3-903" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-904"><a href="#cb3-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-905"><a href="#cb3-905" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">renderAll</span>(){<span class="fu">renderIncidence</span>()<span class="op">;</span><span class="fu">renderTraces</span>()<span class="op">;</span><span class="fu">renderScatter</span>()<span class="op">;</span><span class="fu">updateStatus</span>()<span class="op">;</span>}</span>
<span id="cb3-906"><a href="#cb3-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-907"><a href="#cb3-907" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ MCMC LOGIC ═══════════════════</span></span>
<span id="cb3-908"><a href="#cb3-908" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">doStep</span>(){</span>
<span id="cb3-909"><a href="#cb3-909" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(stepPhase<span class="op">===</span><span class="st">"idle"</span>){</span>
<span id="cb3-910"><a href="#cb3-910" aria-hidden="true" tabindex="-1"></a>      sigR0<span class="op">=</span>SL<span class="op">.</span><span class="at">sigR0</span><span class="op">.</span><span class="fu">val</span>()<span class="op">;</span> sigGam<span class="op">=</span>SL<span class="op">.</span><span class="at">sigGam</span><span class="op">.</span><span class="fu">val</span>()<span class="op">;</span></span>
<span id="cb3-911"><a href="#cb3-911" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> cur<span class="op">=</span>chain[chain<span class="op">.</span><span class="at">length</span><span class="op">-</span><span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb3-912"><a href="#cb3-912" aria-hidden="true" tabindex="-1"></a>      proposedR0<span class="op">=</span>cur<span class="op">.</span><span class="at">R0</span><span class="op">+</span>sigR0<span class="op">*</span><span class="fu">randn</span>()<span class="op">;</span></span>
<span id="cb3-913"><a href="#cb3-913" aria-hidden="true" tabindex="-1"></a>      proposedGam<span class="op">=</span>cur<span class="op">.</span><span class="at">gamma</span><span class="op">+</span>sigGam<span class="op">*</span><span class="fu">randn</span>()<span class="op">;</span></span>
<span id="cb3-914"><a href="#cb3-914" aria-hidden="true" tabindex="-1"></a>      curLL<span class="op">=</span><span class="fu">targetLL</span>(cur<span class="op">.</span><span class="at">R0</span><span class="op">,</span>cur<span class="op">.</span><span class="at">gamma</span>)<span class="op">;</span></span>
<span id="cb3-915"><a href="#cb3-915" aria-hidden="true" tabindex="-1"></a>      propLL<span class="op">=</span><span class="fu">targetLL</span>(proposedR0<span class="op">,</span>proposedGam)<span class="op">;</span></span>
<span id="cb3-916"><a href="#cb3-916" aria-hidden="true" tabindex="-1"></a>      logAlpha<span class="op">=</span>propLL<span class="op">-</span>curLL<span class="op">;</span></span>
<span id="cb3-917"><a href="#cb3-917" aria-hidden="true" tabindex="-1"></a>      uRand<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>()<span class="op">;</span></span>
<span id="cb3-918"><a href="#cb3-918" aria-hidden="true" tabindex="-1"></a>      stepPhase<span class="op">=</span><span class="st">"proposed"</span><span class="op">;</span></span>
<span id="cb3-919"><a href="#cb3-919" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(stepPhase<span class="op">===</span><span class="st">"proposed"</span>){</span>
<span id="cb3-920"><a href="#cb3-920" aria-hidden="true" tabindex="-1"></a>      accepted<span class="op">=</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(uRand)<span class="op">&lt;</span>logAlpha<span class="op">;</span></span>
<span id="cb3-921"><a href="#cb3-921" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(accepted) chain<span class="op">.</span><span class="fu">push</span>({<span class="dt">R0</span><span class="op">:</span>proposedR0<span class="op">,</span><span class="dt">gamma</span><span class="op">:</span>proposedGam})<span class="op">;</span></span>
<span id="cb3-922"><a href="#cb3-922" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> chain<span class="op">.</span><span class="fu">push</span>({<span class="dt">R0</span><span class="op">:</span>chain[chain<span class="op">.</span><span class="at">length</span><span class="op">-</span><span class="dv">1</span>]<span class="op">.</span><span class="at">R0</span><span class="op">,</span><span class="dt">gamma</span><span class="op">:</span>chain[chain<span class="op">.</span><span class="at">length</span><span class="op">-</span><span class="dv">1</span>]<span class="op">.</span><span class="at">gamma</span>})<span class="op">;</span></span>
<span id="cb3-923"><a href="#cb3-923" aria-hidden="true" tabindex="-1"></a>      stepCount<span class="op">++;</span> <span class="cf">if</span>(accepted)nAcc<span class="op">++;</span></span>
<span id="cb3-924"><a href="#cb3-924" aria-hidden="true" tabindex="-1"></a>      stepPhase<span class="op">=</span><span class="st">"decided"</span><span class="op">;</span></span>
<span id="cb3-925"><a href="#cb3-925" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb3-926"><a href="#cb3-926" aria-hidden="true" tabindex="-1"></a>      stepPhase<span class="op">=</span><span class="st">"idle"</span><span class="op">;</span></span>
<span id="cb3-927"><a href="#cb3-927" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-928"><a href="#cb3-928" aria-hidden="true" tabindex="-1"></a>    <span class="fu">renderAll</span>()<span class="op">;</span></span>
<span id="cb3-929"><a href="#cb3-929" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-930"><a href="#cb3-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-931"><a href="#cb3-931" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">resetAll</span>(){</span>
<span id="cb3-932"><a href="#cb3-932" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopAuto</span>()<span class="op">;</span></span>
<span id="cb3-933"><a href="#cb3-933" aria-hidden="true" tabindex="-1"></a>    chain<span class="op">=</span>[{<span class="dt">R0</span><span class="op">:</span><span class="fl">2.5</span><span class="op">,</span><span class="dt">gamma</span><span class="op">:</span><span class="fl">0.15</span>}]<span class="op">;</span> stepPhase<span class="op">=</span><span class="st">"idle"</span><span class="op">;</span> stepCount<span class="op">=</span><span class="dv">0</span><span class="op">;</span> nAcc<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-934"><a href="#cb3-934" aria-hidden="true" tabindex="-1"></a>    proposedR0<span class="op">=</span><span class="kw">null</span><span class="op">;</span> proposedGam<span class="op">=</span><span class="kw">null</span><span class="op">;</span> curLL<span class="op">=</span><span class="kw">null</span><span class="op">;</span> propLL<span class="op">=</span><span class="kw">null</span><span class="op">;</span></span>
<span id="cb3-935"><a href="#cb3-935" aria-hidden="true" tabindex="-1"></a>    <span class="fu">renderAll</span>()<span class="op">;</span></span>
<span id="cb3-936"><a href="#cb3-936" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-937"><a href="#cb3-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-938"><a href="#cb3-938" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">stopAuto</span>(){autoRunning<span class="op">=</span><span class="kw">false</span><span class="op">;</span><span class="pp">clearInterval</span>(autoTimer)<span class="op">;</span>btnAuto<span class="op">.</span><span class="at">textContent</span><span class="op">=</span><span class="st">"⏩ Chạy tự động"</span><span class="op">;</span>btnAuto<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">background</span><span class="op">=</span><span class="st">"linear-gradient(135deg,#6A1B9A,#6A1B9Add)"</span><span class="op">;</span>}</span>
<span id="cb3-939"><a href="#cb3-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-940"><a href="#cb3-940" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ EVENT HANDLERS ═══════════════════</span></span>
<span id="cb3-941"><a href="#cb3-941" aria-hidden="true" tabindex="-1"></a>  btnStep<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"click"</span><span class="op">,</span>()<span class="kw">=&gt;</span>{<span class="cf">if</span>(autoRunning)<span class="fu">stopAuto</span>()<span class="op">;</span><span class="fu">doStep</span>()<span class="op">;</span>})<span class="op">;</span></span>
<span id="cb3-942"><a href="#cb3-942" aria-hidden="true" tabindex="-1"></a>  btnReset<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"click"</span><span class="op">,</span>resetAll)<span class="op">;</span></span>
<span id="cb3-943"><a href="#cb3-943" aria-hidden="true" tabindex="-1"></a>  btnAuto<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"click"</span><span class="op">,</span>()<span class="kw">=&gt;</span>{</span>
<span id="cb3-944"><a href="#cb3-944" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(autoRunning){<span class="fu">stopAuto</span>()<span class="op">;</span><span class="cf">return</span><span class="op">;</span>}</span>
<span id="cb3-945"><a href="#cb3-945" aria-hidden="true" tabindex="-1"></a>    autoRunning<span class="op">=</span><span class="kw">true</span><span class="op">;</span>btnAuto<span class="op">.</span><span class="at">textContent</span><span class="op">=</span><span class="st">"⏸ Tạm dừng"</span><span class="op">;</span>btnAuto<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">background</span><span class="op">=</span><span class="vs">`linear-gradient(135deg,</span><span class="sc">${</span>C<span class="op">.</span><span class="at">reject</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>C<span class="op">.</span><span class="at">reject</span><span class="sc">}</span><span class="vs">dd)`</span><span class="op">;</span></span>
<span id="cb3-946"><a href="#cb3-946" aria-hidden="true" tabindex="-1"></a>    autoSpeed<span class="op">=</span>SL<span class="op">.</span><span class="at">speed</span><span class="op">.</span><span class="fu">val</span>()<span class="op">;</span></span>
<span id="cb3-947"><a href="#cb3-947" aria-hidden="true" tabindex="-1"></a>    autoTimer<span class="op">=</span><span class="pp">setInterval</span>(doStep<span class="op">,</span>autoSpeed)<span class="op">;</span></span>
<span id="cb3-948"><a href="#cb3-948" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb3-949"><a href="#cb3-949" aria-hidden="true" tabindex="-1"></a>  <span class="co">// When speed slider changes during auto-run, restart timer with new speed</span></span>
<span id="cb3-950"><a href="#cb3-950" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">speed</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span>()<span class="kw">=&gt;</span>{</span>
<span id="cb3-951"><a href="#cb3-951" aria-hidden="true" tabindex="-1"></a>    SL<span class="op">.</span><span class="at">speed</span><span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span></span>
<span id="cb3-952"><a href="#cb3-952" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(autoRunning){<span class="pp">clearInterval</span>(autoTimer)<span class="op">;</span>autoSpeed<span class="op">=</span>SL<span class="op">.</span><span class="at">speed</span><span class="op">.</span><span class="fu">val</span>()<span class="op">;</span>autoTimer<span class="op">=</span><span class="pp">setInterval</span>(doStep<span class="op">,</span>autoSpeed)<span class="op">;</span>}</span>
<span id="cb3-953"><a href="#cb3-953" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb3-954"><a href="#cb3-954" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">const</span> k <span class="kw">of</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(SL)){<span class="cf">if</span>(k<span class="op">!==</span><span class="st">"speed"</span>)SL[k]<span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span>()<span class="kw">=&gt;</span>SL[k]<span class="op">.</span><span class="fu">sync</span>())<span class="op">;</span>}</span>
<span id="cb3-955"><a href="#cb3-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-956"><a href="#cb3-956" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ═══════════════════ INITIAL RENDER ═══════════════════</span></span>
<span id="cb3-957"><a href="#cb3-957" aria-hidden="true" tabindex="-1"></a>  <span class="fu">renderAll</span>()<span class="op">;</span></span>
<span id="cb3-958"><a href="#cb3-958" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> outer<span class="op">;</span></span>
<span id="cb3-959"><a href="#cb3-959" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="declaration">

</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImltcG9ydCB7IGNyZWF0ZVNsaWRlciwgaW5qZWN0U3R5bGUgfSBmcm9tIFwiLi9fc2xpZGVyLmpzXCJcclxuZDMgPSByZXF1aXJlKFwiZDNAN1wiKVxyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgbWggPSB7XHJcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQIE1BVEgg4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgZnVuY3Rpb24gbm9ybWFsUERGKHgsbXUscyl7cmV0dXJuIE1hdGguZXhwKC0wLjUqKCh4LW11KS9zKSoqMikvKHMqTWF0aC5zcXJ0KDIqTWF0aC5QSSkpO31cclxuICBmdW5jdGlvbiBsbkdhbW1hKHope1xyXG4gICAgaWYoejwwLjUpcmV0dXJuIE1hdGgubG9nKE1hdGguUEkvTWF0aC5zaW4oTWF0aC5QSSp6KSktbG5HYW1tYSgxLXopO1xyXG4gICAgei0tO2NvbnN0IGM9WzAuOTk5OTk5OTk5OTk5ODA5OTMsNjc2LjUyMDM2ODEyMTg4NTEsLTEyNTkuMTM5MjE2NzIyNDAyOCw3NzEuMzIzNDI4Nzc3NjUzMTMsXHJcbiAgICAgIC0xNzYuNjE1MDI5MTYyMTQwNTksMTIuNTA3MzQzMjc4Njg2OTA1LC0wLjEzODU3MTA5NTI2NTcyMDEyLDkuOTg0MzY5NTc4MDE5NTcxNmUtNiwxLjUwNTYzMjczNTE0OTMxMTZlLTddO1xyXG4gICAgbGV0IHg9Y1swXTtmb3IobGV0IGk9MTtpPDk7aSsrKXgrPWNbaV0vKHoraSk7XHJcbiAgICBjb25zdCB0PXorNy41O3JldHVybiAwLjUqTWF0aC5sb2coMipNYXRoLlBJKSsoeiswLjUpKk1hdGgubG9nKHQpLXQrTWF0aC5sb2coeCk7XHJcbiAgfVxyXG4gIGZ1bmN0aW9uIGxuQmV0YShhLGIpe3JldHVybiBsbkdhbW1hKGEpK2xuR2FtbWEoYiktbG5HYW1tYShhK2IpO31cclxuICBmdW5jdGlvbiBiZXRhUERGKHgsYSxiKXtyZXR1cm4oeDw9MHx8eD49MSk/MDpNYXRoLmV4cCgoYS0xKSpNYXRoLmxvZyh4KSsoYi0xKSpNYXRoLmxvZygxLXgpLWxuQmV0YShhLGIpKTt9XHJcbiAgZnVuY3Rpb24gcmFuZG4oKXtsZXQgdT0wLHY9MDt3aGlsZSghdSl1PU1hdGgucmFuZG9tKCk7d2hpbGUoIXYpdj1NYXRoLnJhbmRvbSgpO3JldHVybiBNYXRoLnNxcnQoLTIqTWF0aC5sb2codSkpKk1hdGguY29zKDIqTWF0aC5QSSp2KTt9XHJcblxyXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkCBEWU5BTUlDIE1PREVMIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gIGxldCBwcmlvckE9MixwcmlvckI9NSxkYXRhSz03LGRhdGFOPTIwO1xyXG4gIGxldCByYXdMaWtNYXg9MSxwb3N0QV89OSxwb3N0Ql89MTg7XHJcbiAgZnVuY3Rpb24gcmVjb21wdXRlKCl7XHJcbiAgICBjb25zdCBtbGU9ZGF0YUsvTWF0aC5tYXgoZGF0YU4sMSk7XHJcbiAgICByYXdMaWtNYXg9KG1sZT4wJiZtbGU8MSk/TWF0aC5wb3cobWxlLGRhdGFLKSpNYXRoLnBvdygxLW1sZSxkYXRhTi1kYXRhSyk6MWUtMjA7XHJcbiAgICBwb3N0QV89cHJpb3JBK2RhdGFLOyBwb3N0Ql89cHJpb3JCK2RhdGFOLWRhdGFLO1xyXG4gIH1cclxuICByZWNvbXB1dGUoKTtcclxuICBmdW5jdGlvbiBwcmlvcih0KXtyZXR1cm4gYmV0YVBERih0LHByaW9yQSxwcmlvckIpO31cclxuICBmdW5jdGlvbiBsaWtSYXcodCl7aWYodDw9MHx8dD49MSlyZXR1cm4gMDtyZXR1cm4gTWF0aC5wb3codCxkYXRhSykqTWF0aC5wb3coMS10LGRhdGFOLWRhdGFLKTt9XHJcbiAgZnVuY3Rpb24gbGlrTm9ybSh0KXtyZXR1cm4gcmF3TGlrTWF4PjA/bGlrUmF3KHQpL3Jhd0xpa01heDowO31cclxuICBmdW5jdGlvbiB0YXJnZXQodCl7cmV0dXJuIHByaW9yKHQpKmxpa1Jhdyh0KTt9XHJcbiAgZnVuY3Rpb24gdHJ1ZVBvc3Rlcmlvcih0KXtyZXR1cm4gYmV0YVBERih0LHBvc3RBXyxwb3N0Ql8pO31cclxuXHJcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQIFBBTEVUVEUg4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgY29uc3QgQz17Y3VycmVudDpcIiMxNTY1QzBcIixwcm9wb3NlOlwiI0U2NTEwMFwiLGFjY2VwdDpcIiMyRTdEMzJcIixyZWplY3Q6XCIjQzYyODI4XCIsXHJcbiAgICBwcmlvcjpcIiM3QjFGQTJcIixsaWs6XCIjMDA4OTdCXCIscG9zdDpcIiNFNjUxMDBcIixcclxuICAgIGhpc3Q6XCIjMTU2NUMwXCIsaGlzdFN0cm9rZTpcIiMwRDQ3QTFcIixoaXN0VG9wOlwiIzY0QjVGNlwiLFxyXG4gICAgaGlzdE5ldzpcIiNFNjUxMDBcIixoaXN0TmV3U3Ryb2tlOlwiI0JGMzYwQ1wiLGhpc3ROZXdUb3A6XCIjRkY4QTY1XCIsXHJcbiAgICBidXJuZWQ6XCIjRUY5QTlBXCIsYnVybkxpbmU6XCIjRTUzOTM1XCIsXHJcbiAgICBmaWx0OlwiIzQzQTA0N1wiLGZpbHRTdHJva2U6XCIjMkU3RDMyXCIsZmlsdFRvcDpcIiM4MUM3ODRcIixcclxuICAgIGdob3N0OlwiI0NGRDhEQ1wiLFxyXG4gICAgdHJhY2U6XCIjMTU2NUMwXCIsdHJhY2VMaWdodDpcIiM5MENBRjlcIixwcm9wb3NhbDpcIiNGRjZGMDBcIixcclxuICAgIHR4dDpcIiMyMTIxMjFcIixzdWI6XCIjOUU5RTlFXCIsYm9yZGVyOlwiI0UwRTBFMFwifTtcclxuICBjb25zdCBtb25vPVwiJ1NGIE1vbm8nLFNGTW9uby1SZWd1bGFyLE1lbmxvLG1vbm9zcGFjZVwiO1xyXG5cclxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAgU1RBVEUg4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgbGV0IGNoYWluPVswLjNdLHByb3Bvc2VkPW51bGwsc3RlcFBoYXNlPVwiaWRsZVwiLGFjY2VwdGVkPW51bGw7XHJcbiAgbGV0IGFjY2VwdFJhdGlvPTAsdVJhbmQ9MCxzYW1wbGVzPVtdLHByb3Bvc2FsU2lnbWE9MC4wOCxzdGVwQ291bnQ9MDtcclxuICBsZXQgYXV0b1J1bm5pbmc9ZmFsc2UsYXV0b1RpbWVyPW51bGw7XHJcbiAgbGV0IHByb3BTdGVwSWR4PTAsbGFzdEFjY2VwdGVkQmluPS0xO1xyXG5cclxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAgV1JBUFBFUiDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcclxuICBjb25zdCBvdXRlcj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gIG91dGVyLnN0eWxlLmNzc1RleHQ9YGRpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47YWxpZ24taXRlbXM6Y2VudGVyO2dhcDoxMnB4O1xyXG4gICAgZm9udC1mYW1pbHk6J0ludGVyJywtYXBwbGUtc3lzdGVtLEJsaW5rTWFjU3lzdGVtRm9udCxcIlNlZ29lIFVJXCIsUm9ib3RvLHNhbnMtc2VyaWY7XHJcbiAgICB3aWR0aDoxMDAlO21heC13aWR0aDo5MDBweDttYXJnaW46MCBhdXRvO2A7XHJcbiAgaWYoIWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2xpbmtbaHJlZio9XCJJbnRlclwiXScpKXtcclxuICAgIGNvbnN0IGxrPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpbmsnKTtsay5yZWw9J3N0eWxlc2hlZXQnO1xyXG4gICAgbGsuaHJlZj0naHR0cHM6Ly9mb250cy5nb29nbGVhcGlzLmNvbS9jc3MyP2ZhbWlseT1JbnRlcjp3Z2h0QDQwMDs1MDA7NjAwOzcwMDs4MDAmZGlzcGxheT1zd2FwJztcclxuICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQobGspO1xyXG4gIH1cclxuICBvdXRlci5hcHBlbmRDaGlsZChpbmplY3RTdHlsZSgpKTtcclxuXHJcbiAgLy8g4pSA4pSAIEJVVFRPTlMg4pSA4pSAXHJcbiAgY29uc3QgY3RybFJvdz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gIGN0cmxSb3cuc3R5bGUuY3NzVGV4dD1cImRpc3BsYXk6ZmxleDtnYXA6MTBweDt3aWR0aDoxMDAlO2FsaWduLWl0ZW1zOmNlbnRlcjtmbGV4LXdyYXA6d3JhcDtcIjtcclxuICBmdW5jdGlvbiBta0J0bih0ZXh0LGNvbG9yLGJpZyl7XHJcbiAgICBjb25zdCBiPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XHJcbiAgICBiLnN0eWxlLmNzc1RleHQ9YHBhZGRpbmc6JHtiaWc/XCIxMHB4IDI4cHhcIjpcIjdweCAxNnB4XCJ9O2JvcmRlci1yYWRpdXM6JHtiaWc/MTI6MTB9cHg7Ym9yZGVyOm5vbmU7XHJcbiAgICAgIGJhY2tncm91bmQ6bGluZWFyLWdyYWRpZW50KDEzNWRlZywke2NvbG9yfSwke2NvbG9yfWRkKTtjb2xvcjojZmZmO2ZvbnQtc2l6ZToke2JpZz8xNToxM31weDtmb250LXdlaWdodDo3MDA7Y3Vyc29yOnBvaW50ZXI7XHJcbiAgICAgIGZvbnQtZmFtaWx5OmluaGVyaXQ7dHJhbnNpdGlvbjphbGwgMC4ycyBlYXNlO2xldHRlci1zcGFjaW5nOjAuM3B4O1xyXG4gICAgICAke2JpZz9cImJveC1zaGFkb3c6MCA0cHggMTRweCBcIitjb2xvcitcIjQ0O1wiOlwiYm94LXNoYWRvdzowIDJweCA4cHggcmdiYSgwLDAsMCwwLjEyKTtcIn1gO1xyXG4gICAgYi50ZXh0Q29udGVudD10ZXh0O1xyXG4gICAgYi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywoKT0+e2Iuc3R5bGUudHJhbnNmb3JtPSd0cmFuc2xhdGVZKC0xcHgpJztiLnN0eWxlLmJveFNoYWRvdz1gMCA2cHggMjBweCAke2NvbG9yfTU1YDt9KTtcclxuICAgIGIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsKCk9PntiLnN0eWxlLnRyYW5zZm9ybT0ndHJhbnNsYXRlWSgwKSc7Yi5zdHlsZS5ib3hTaGFkb3c9YmlnP2AwIDRweCAxNHB4ICR7Y29sb3J9NDRgOicwIDJweCA4cHggcmdiYSgwLDAsMCwwLjEyKSc7fSk7XHJcbiAgICByZXR1cm4gYjtcclxuICB9XHJcbiAgY29uc3QgYnRuU3RlcD1ta0J0bihcIuKWtiAgQsaw4bubYyB0aeG6v3AgdGhlb1wiLEMuY3VycmVudCx0cnVlKTtcclxuICBjb25zdCBidG5BdXRvPW1rQnRuKFwi4o+pIENo4bqheSB04buxIMSR4buZbmdcIixcIiM2QTFCOUFcIixmYWxzZSk7XHJcbiAgY29uc3QgYnRuUmVzZXQ9bWtCdG4oXCLihrogxJDhurd0IGzhuqFpXCIsXCIjNzg5MDlDXCIsZmFsc2UpO1xyXG4gIGNvbnN0IHN0ZXBMYWJlbD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICBzdGVwTGFiZWwuc3R5bGUuY3NzVGV4dD1gZm9udC1zaXplOjEzcHg7Zm9udC13ZWlnaHQ6NzAwO2NvbG9yOiR7Qy5zdWJ9O2ZvbnQtZmFtaWx5OiR7bW9ub307bWFyZ2luLWxlZnQ6YXV0bztgO1xyXG4gIGN0cmxSb3cuYXBwZW5kKGJ0blN0ZXAsYnRuQXV0byxidG5SZXNldCxzdGVwTGFiZWwpO1xyXG4gIG91dGVyLmFwcGVuZENoaWxkKGN0cmxSb3cpO1xyXG5cclxuICAvLyDilIDilIAgTU9ERUwgU0xJREVSUyDilIDilIBcclxuICBjb25zdCBTTD17fTtcclxuICBTTC5zaWdtYT1jcmVhdGVTbGlkZXIoXCJQcm9wb3NhbCDPg1wiLDAuMDEsMC4zMCwwLjAxLDAuMDgsQy5wcm9wb3NhbCxcImFtYmVyXCIpO1xyXG4gIFNMLnBBPWNyZWF0ZVNsaWRlcihcIlByaW9yIM6xXCIsMC41LDEwLDAuNSwyLEMucHJpb3IsXCJwdXJwbGVcIik7XHJcbiAgU0wucEI9Y3JlYXRlU2xpZGVyKFwiUHJpb3IgzrJcIiwwLjUsMTAsMC41LDUsQy5wcmlvcixcInB1cnBsZVwiKTtcclxuICBTTC5kSz1jcmVhdGVTbGlkZXIoXCJRdWFuIHPDoXQga1wiLDAsNTAsMSw3LEMubGlrLFwiZ3JlZW5cIik7XHJcbiAgU0wuZE49Y3JlYXRlU2xpZGVyKFwiU+G7kSB0aOG7rSBuXCIsMSw1MCwxLDIwLEMubGlrLFwiZ3JlZW5cIik7XHJcblxyXG4gIGNvbnN0IHNyMT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO3NyMS5zdHlsZS5jc3NUZXh0PVwiZGlzcGxheTpmbGV4O2dhcDoxNHB4O3dpZHRoOjEwMCU7XCI7XHJcbiAgc3IxLmFwcGVuZChTTC5zaWdtYS5lbCxTTC5wQS5lbCxTTC5wQi5lbCk7XHJcbiAgY29uc3Qgc3IyPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7c3IyLnN0eWxlLmNzc1RleHQ9XCJkaXNwbGF5OmZsZXg7Z2FwOjE0cHg7d2lkdGg6MTAwJTtcIjtcclxuICBzcjIuYXBwZW5kKFNMLmRLLmVsLFNMLmROLmVsKTtcclxuICBvdXRlci5hcHBlbmQoc3IxLHNyMik7XHJcblxyXG4gIC8vIOKUgOKUgCBNQ01DIERJQUdOT1NUSUNTIOKUgOKUgFxyXG4gIFNMLmJ1cm5pbj1jcmVhdGVTbGlkZXIoXCJCdXJuLWluXCIsMCwzMDAsNSwwLEMuYnVybkxpbmUsXCJyZWRcIik7XHJcbiAgU0wudGhpbj1jcmVhdGVTbGlkZXIoXCJUaGlubmluZyAoZXZlcnkgay10aClcIiwxLDIwLDEsMSxDLmZpbHQsXCJncmVlblwiKTtcclxuICBmdW5jdGlvbiBta1RvZ2dsZShsYWJlbCxjb2xvcil7XHJcbiAgICBjb25zdCB3PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsYWJlbFwiKTtcclxuICAgIHcuc3R5bGUuY3NzVGV4dD1gZGlzcGxheTppbmxpbmUtZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjZweDtjdXJzb3I6cG9pbnRlcjtcclxuICAgICAgcGFkZGluZzo2cHggMTRweDtib3JkZXItcmFkaXVzOjEwcHg7YmFja2dyb3VuZDojZjVmNWY1O1xyXG4gICAgICBib3JkZXI6MS41cHggc29saWQgI0UwRTBFMDt0cmFuc2l0aW9uOmFsbCAwLjJzO2ZvbnQtc2l6ZToxMnB4O2ZvbnQtd2VpZ2h0OjYwMDtcclxuICAgICAgY29sb3I6IzlFOUU5RTt3aGl0ZS1zcGFjZTpub3dyYXA7dXNlci1zZWxlY3Q6bm9uZTtgO1xyXG4gICAgY29uc3QgY2I9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO2NiLnR5cGU9XCJjaGVja2JveFwiO1xyXG4gICAgY2Iuc3R5bGUuY3NzVGV4dD1gYWNjZW50LWNvbG9yOiR7Y29sb3J9O3dpZHRoOjE1cHg7aGVpZ2h0OjE1cHg7Y3Vyc29yOnBvaW50ZXI7YDtcclxuICAgIHcuYXBwZW5kKGNiLGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGxhYmVsKSk7XHJcbiAgICBmdW5jdGlvbiBzXygpe3cuc3R5bGUuYmFja2dyb3VuZD1jYi5jaGVja2VkP2NvbG9yKycxNSc6JyNmNWY1ZjUnO3cuc3R5bGUuYm9yZGVyQ29sb3I9Y2IuY2hlY2tlZD9jb2xvcjonI0UwRTBFMCc7dy5zdHlsZS5jb2xvcj1jYi5jaGVja2VkP2NvbG9yOicjOUU5RTlFJzt9XHJcbiAgICBjYi5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsc18pO1xyXG4gICAgcmV0dXJue2VsOncsY2J9O1xyXG4gIH1cclxuICBjb25zdCB0b2dCdXJuPW1rVG9nZ2xlKFwiQnVybi1pblwiLEMuYnVybkxpbmUpO1xyXG4gIGNvbnN0IHRvZ1RoaW49bWtUb2dnbGUoXCJUaGlubmluZ1wiLEMuZmlsdCk7XHJcbiAgY29uc3QgZGlhZ1Jvdz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gIGRpYWdSb3cuc3R5bGUuY3NzVGV4dD1cImRpc3BsYXk6ZmxleDtnYXA6MTJweDt3aWR0aDoxMDAlO2FsaWduLWl0ZW1zOmVuZDtcIjtcclxuICBkaWFnUm93LmFwcGVuZChTTC5idXJuaW4uZWwsU0wudGhpbi5lbCx0b2dCdXJuLmVsLHRvZ1RoaW4uZWwpO1xyXG4gIG91dGVyLmFwcGVuZENoaWxkKGRpYWdSb3cpO1xyXG5cclxuICAvLyDilIDilIAgU1RBVFVTIEJPWCDilIDilIBcclxuICBjb25zdCBzdGF0dXNCb3g9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICBzdGF0dXNCb3guc3R5bGUuY3NzVGV4dD1gd2lkdGg6MTAwJTtwYWRkaW5nOjE0cHggMjBweDtib3JkZXItcmFkaXVzOjE0cHg7XHJcbiAgICBiYWNrZ3JvdW5kOmxpbmVhci1ncmFkaWVudCgxMzVkZWcsI0ZBRkFGQSwjRjVGNUY1KTtiYWNrZHJvcC1maWx0ZXI6Ymx1cig4cHgpO1xyXG4gICAgYm9yZGVyOjJweCBzb2xpZCAke0MuYm9yZGVyfTtmb250LXNpemU6MTNweDtmb250LWZhbWlseToke21vbm99O2NvbG9yOiR7Qy50eHR9O1xyXG4gICAgbGluZS1oZWlnaHQ6MS43O21pbi1oZWlnaHQ6NDRweDt0cmFuc2l0aW9uOmFsbCAwLjNzIGVhc2U7XHJcbiAgICBib3gtc2hhZG93OjAgMnB4IDEycHggcmdiYSgwLDAsMCwwLjA0KTtgO1xyXG5cclxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAgTUFJTiBTVkcg4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgY29uc3QgVz05MDAsdG90YWxIPTI2MDtcclxuICBjb25zdCB0cmFjZVc9NjQwLGhpc3RXXz1XLXRyYWNlVztcclxuICBjb25zdCBtZz17bDo1MCxyOjgsdDoyOCxiOjMwfTtcclxuICBjb25zdCB0SVc9dHJhY2VXLW1nLmwtbWcucix0SUg9dG90YWxILW1nLnQtbWcuYjtcclxuICBjb25zdCBoTWc9e2w6NCxyOjI0LHQ6MjgsYjozMH07XHJcbiAgY29uc3QgaElXPWhpc3RXXy1oTWcubC1oTWcucixoSUg9dG90YWxILWhNZy50LWhNZy5iO1xyXG5cclxuICBjb25zdCBzdmc9ZDMuY3JlYXRlKFwic3ZnXCIpLmF0dHIoXCJ2aWV3Qm94XCIsWzAsMCxXLHRvdGFsSF0pXHJcbiAgICAuc3R5bGUoXCJ3aWR0aFwiLFwiMTAwJVwiKS5zdHlsZShcIm1heC13aWR0aFwiLFcrXCJweFwiKVxyXG4gICAgLnN0eWxlKFwiYm9yZGVyLXJhZGl1c1wiLFwiMTRweFwiKS5zdHlsZShcImJvcmRlclwiLGAxcHggc29saWQgJHtDLmJvcmRlcn1gKVxyXG4gICAgLnN0eWxlKFwiYmFja2dyb3VuZFwiLFwiI2ZmZlwiKS5zdHlsZShcImJveC1zaGFkb3dcIixcIjAgMnB4IDE2cHggcmdiYSgwLDAsMCwwLjA2KVwiKTtcclxuICBvdXRlci5hcHBlbmRDaGlsZChzdmcubm9kZSgpKTtcclxuXHJcbiAgLy8gVHJhY2UgcGFuZWxcclxuICBjb25zdCB0cmFjZUc9c3ZnLmFwcGVuZChcImdcIikuYXR0cihcInRyYW5zZm9ybVwiLGB0cmFuc2xhdGUoJHttZy5sfSwke21nLnR9KWApO1xyXG4gIHRyYWNlRy5hcHBlbmQoXCJyZWN0XCIpLmF0dHIoXCJ4XCIsLW1nLmwpLmF0dHIoXCJ5XCIsLW1nLnQpLmF0dHIoXCJ3aWR0aFwiLHRyYWNlVykuYXR0cihcImhlaWdodFwiLHRvdGFsSCkuYXR0cihcImZpbGxcIixcIiNGQUZBRkFcIik7XHJcbiAgdHJhY2VHLmFwcGVuZChcImxpbmVcIikuYXR0cihcIngyXCIsdElXKS5hdHRyKFwieTFcIix0SUgpLmF0dHIoXCJ5MlwiLHRJSCkuYXR0cihcInN0cm9rZVwiLFwiI0UwRTBFMFwiKTtcclxuICB0cmFjZUcuYXBwZW5kKFwibGluZVwiKS5hdHRyKFwieTJcIix0SUgpLmF0dHIoXCJzdHJva2VcIixcIiNFMEUwRTBcIik7XHJcbiAgc3ZnLmFwcGVuZChcInRleHRcIikuYXR0cihcInhcIixtZy5sK3RJVy8yKS5hdHRyKFwieVwiLDE0KS5hdHRyKFwidGV4dC1hbmNob3JcIixcIm1pZGRsZVwiKVxyXG4gICAgLmF0dHIoXCJmb250LXNpemVcIiwxMykuYXR0cihcImZvbnQtd2VpZ2h0XCIsNzAwKS5hdHRyKFwiZmlsbFwiLEMudHh0KS50ZXh0KFwiQmnhu4N1IMSR4buTIHbhur90XCIpO1xyXG4gIHN2Zy5hcHBlbmQoXCJ0ZXh0XCIpLmF0dHIoXCJ4XCIsMTQpLmF0dHIoXCJ5XCIsbWcudCt0SUgvMikuYXR0cihcInRleHQtYW5jaG9yXCIsXCJtaWRkbGVcIilcclxuICAgIC5hdHRyKFwiZm9udC1zaXplXCIsMTEpLmF0dHIoXCJmb250LXdlaWdodFwiLDYwMCkuYXR0cihcImZpbGxcIixDLnN1YilcclxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsYHJvdGF0ZSgtOTAsMTQsJHttZy50K3RJSC8yfSlgKS50ZXh0KFwizrhcIik7XHJcbiAgc3ZnLmFwcGVuZChcInRleHRcIikuYXR0cihcInhcIixtZy5sK3RJVy8yKS5hdHRyKFwieVwiLHRvdGFsSC02KS5hdHRyKFwidGV4dC1hbmNob3JcIixcIm1pZGRsZVwiKVxyXG4gICAgLmF0dHIoXCJmb250LXNpemVcIiwxMCkuYXR0cihcImZpbGxcIixDLnN1YikuYXR0cihcImZvbnQtd2VpZ2h0XCIsNjAwKS50ZXh0KFwiYsaw4bubY1wiKTtcclxuICBjb25zdCB0cmFjZUJ1cm5HPXRyYWNlRy5hcHBlbmQoXCJnXCIpO1xyXG4gIGNvbnN0IHRyYWNlTGluZUc9dHJhY2VHLmFwcGVuZChcImdcIik7XHJcbiAgY29uc3QgdHJhY2VQcm9wb3NhbEc9dHJhY2VHLmFwcGVuZChcImdcIik7XHJcbiAgY29uc3QgdHJhY2VQb2ludHNHPXRyYWNlRy5hcHBlbmQoXCJnXCIpO1xyXG5cclxuICAvLyBIaXN0b2dyYW0gcGFuZWxcclxuICBjb25zdCBoaXN0Rz1zdmcuYXBwZW5kKFwiZ1wiKS5hdHRyKFwidHJhbnNmb3JtXCIsYHRyYW5zbGF0ZSgke3RyYWNlVytoTWcubH0sJHtoTWcudH0pYCk7XHJcbiAgaGlzdEcuYXBwZW5kKFwibGluZVwiKS5hdHRyKFwieTJcIixoSUgpLmF0dHIoXCJzdHJva2VcIixcIiNFMEUwRTBcIik7XHJcbiAgY29uc3QgaGlzdFRpdGxlPXN2Zy5hcHBlbmQoXCJ0ZXh0XCIpLmF0dHIoXCJ4XCIsdHJhY2VXK2hpc3RXXy8yKS5hdHRyKFwieVwiLDE0KS5hdHRyKFwidGV4dC1hbmNob3JcIixcIm1pZGRsZVwiKVxyXG4gICAgLmF0dHIoXCJmb250LXNpemVcIiwxMykuYXR0cihcImZvbnQtd2VpZ2h0XCIsNzAwKS5hdHRyKFwiZmlsbFwiLEMudHh0KTtcclxuICBzdmcuYXBwZW5kKFwibGluZVwiKS5hdHRyKFwieDFcIix0cmFjZVcpLmF0dHIoXCJ4MlwiLHRyYWNlVykuYXR0cihcInkyXCIsdG90YWxIKS5hdHRyKFwic3Ryb2tlXCIsXCIjQ0ZEOERDXCIpO1xyXG4gIGNvbnN0IGhpc3RHaG9zdEc9aGlzdEcuYXBwZW5kKFwiZ1wiKTtcclxuICBjb25zdCBoaXN0QmFyc0c9aGlzdEcuYXBwZW5kKFwiZ1wiKTtcclxuICBjb25zdCBoaXN0Q3VydmVHPWhpc3RHLmFwcGVuZChcImdcIik7XHJcblxyXG4gIC8vIOKUgOKUgCBNRVJHRUQgUHJpb3IrTGlrZWxpaG9vZCDilIDilIBcclxuICBjb25zdCBCSD0yMDA7XHJcbiAgY29uc3QgYnN2Zz1kMy5jcmVhdGUoXCJzdmdcIikuYXR0cihcInZpZXdCb3hcIixbMCwwLFcsQkhdKVxyXG4gICAgLnN0eWxlKFwid2lkdGhcIixcIjEwMCVcIikuc3R5bGUoXCJtYXgtd2lkdGhcIixXK1wicHhcIilcclxuICAgIC5zdHlsZShcImJvcmRlci1yYWRpdXNcIixcIjE0cHhcIikuc3R5bGUoXCJib3JkZXJcIixgMXB4IHNvbGlkICR7Qy5ib3JkZXJ9YClcclxuICAgIC5zdHlsZShcImJhY2tncm91bmRcIixcIiNmZmZcIikuc3R5bGUoXCJib3gtc2hhZG93XCIsXCIwIDJweCAxNnB4IHJnYmEoMCwwLDAsMC4wNilcIik7XHJcbiAgb3V0ZXIuYXBwZW5kQ2hpbGQoYnN2Zy5ub2RlKCkpO1xyXG4gIG91dGVyLmFwcGVuZENoaWxkKHN0YXR1c0JveCk7XHJcblxyXG4gIGNvbnN0IGJNZz17dDoyNixiOjI4LGw6NDQscjoxNn07XHJcbiAgY29uc3QgYnc9Vy1iTWcubC1iTWcucixoYWxmQkg9KEJILWJNZy50LWJNZy5iKS8yO1xyXG4gIGNvbnN0IGJ4Uz1kMy5zY2FsZUxpbmVhcigpLmRvbWFpbihbMCwxXSkucmFuZ2UoWzAsYnddKTtcclxuICBjb25zdCBtaWRZPWJNZy50K2hhbGZCSDtcclxuXHJcbiAgY29uc3QgbWVyZ2VkVGl0bGVFbD1ic3ZnLmFwcGVuZChcInRleHRcIikuYXR0cihcInhcIixiTWcubCtidy8yKS5hdHRyKFwieVwiLDE0KS5hdHRyKFwidGV4dC1hbmNob3JcIixcIm1pZGRsZVwiKVxyXG4gICAgLmF0dHIoXCJmb250LXNpemVcIiwxMikuYXR0cihcImZvbnQtd2VpZ2h0XCIsNzAwKS5hdHRyKFwiZmlsbFwiLEMudHh0KTtcclxuICBjb25zdCBtZXJnZWRHPWJzdmcuYXBwZW5kKFwiZ1wiKS5hdHRyKFwidHJhbnNmb3JtXCIsYHRyYW5zbGF0ZSgke2JNZy5sfSwwKWApO1xyXG4gIG1lcmdlZEcuYXBwZW5kKFwibGluZVwiKS5hdHRyKFwieDJcIixidykuYXR0cihcInkxXCIsbWlkWSkuYXR0cihcInkyXCIsbWlkWSkuYXR0cihcInN0cm9rZVwiLFwiI0JEQkRCRFwiKTtcclxuICBtZXJnZWRHLmFwcGVuZChcImxpbmVcIikuYXR0cihcInkxXCIsYk1nLnQpLmF0dHIoXCJ5MlwiLEJILWJNZy5iKS5hdHRyKFwic3Ryb2tlXCIsXCIjRTBFMEUwXCIpO1xyXG4gIGJzdmcuYXBwZW5kKFwidGV4dFwiKS5hdHRyKFwieFwiLGJNZy5sK2J3LzIpLmF0dHIoXCJ5XCIsQkgtNikuYXR0cihcInRleHQtYW5jaG9yXCIsXCJtaWRkbGVcIilcclxuICAgIC5hdHRyKFwiZm9udC1zaXplXCIsMTApLmF0dHIoXCJmaWxsXCIsQy5zdWIpLmF0dHIoXCJmb250LXdlaWdodFwiLDYwMCkudGV4dChcIs64XCIpO1xyXG4gIFswLDAuMjUsMC41LDAuNzUsMV0uZm9yRWFjaCh2PT57XHJcbiAgICBtZXJnZWRHLmFwcGVuZChcInRleHRcIikuYXR0cihcInhcIixieFModikpLmF0dHIoXCJ5XCIsQkgtYk1nLmIrMTQpLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLFwibWlkZGxlXCIpXHJcbiAgICAgIC5hdHRyKFwiZm9udC1zaXplXCIsOSkuYXR0cihcImZpbGxcIixDLnN1YikuYXR0cihcImZvbnQtZmFtaWx5XCIsbW9ubykudGV4dCh2LnRvRml4ZWQoMikpO1xyXG4gIH0pO1xyXG4gIGJzdmcuYXBwZW5kKFwidGV4dFwiKS5hdHRyKFwieFwiLDEyKS5hdHRyKFwieVwiLG1pZFktaGFsZkJILzIrNClcclxuICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIixcIm1pZGRsZVwiKS5hdHRyKFwiZm9udC1zaXplXCIsOSkuYXR0cihcImZvbnQtd2VpZ2h0XCIsNjAwKS5hdHRyKFwiZmlsbFwiLEMucHJpb3IpLnRleHQoXCJQcmlvclwiKTtcclxuICBic3ZnLmFwcGVuZChcInRleHRcIikuYXR0cihcInhcIiwxMikuYXR0cihcInlcIixtaWRZK2hhbGZCSC8yKzQpXHJcbiAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsXCJtaWRkbGVcIikuYXR0cihcImZvbnQtc2l6ZVwiLDkpLmF0dHIoXCJmb250LXdlaWdodFwiLDYwMCkuYXR0cihcImZpbGxcIixDLmxpaykudGV4dChcIkxpay5cIik7XHJcblxyXG4gIGNvbnN0IHN0YXRpY0c9bWVyZ2VkRy5hcHBlbmQoXCJnXCIpO1xyXG4gIGNvbnN0IG1lcmdlZE1hcmtlcnM9bWVyZ2VkRy5hcHBlbmQoXCJnXCIpO1xyXG5cclxuICBsZXQgcHlTLGx5UztcclxuICBjb25zdCBjdXJ2ZVB0cz1kMy5yYW5nZSgwLDEuMDA1LDAuMDA1KTtcclxuXHJcbiAgZnVuY3Rpb24gZHJhd1N0YXRpYygpe1xyXG4gICAgc3RhdGljRy5zZWxlY3RBbGwoXCIqXCIpLnJlbW92ZSgpO1xyXG4gICAgY29uc3QgcFY9Y3VydmVQdHMubWFwKHQ9Pih7eDp0LHk6cHJpb3IodCl9KSk7XHJcbiAgICBjb25zdCBsVj1jdXJ2ZVB0cy5tYXAodD0+KHt4OnQseTpsaWtOb3JtKHQpfSkpO1xyXG4gICAgY29uc3QgbXhQPU1hdGgubWF4KC4uLnBWLm1hcChkPT5kLnkpKXx8MTtcclxuICAgIHB5Uz1kMy5zY2FsZUxpbmVhcigpLmRvbWFpbihbMCxteFAqMS4xXSkucmFuZ2UoW21pZFksYk1nLnRdKTtcclxuICAgIGx5Uz1kMy5zY2FsZUxpbmVhcigpLmRvbWFpbihbMCwxLjFdKS5yYW5nZShbbWlkWSxCSC1iTWcuYl0pO1xyXG4gICAgY29uc3QgcEFyZWE9ZDMuYXJlYSgpLngoZD0+YnhTKGQueCkpLnkwKG1pZFkpLnkxKGQ9PnB5UyhkLnkpKS5jdXJ2ZShkMy5jdXJ2ZUJhc2lzKTtcclxuICAgIGNvbnN0IHBMaW5lPWQzLmxpbmUoKS54KGQ9PmJ4UyhkLngpKS55KGQ9PnB5UyhkLnkpKS5jdXJ2ZShkMy5jdXJ2ZUJhc2lzKTtcclxuICAgIHN0YXRpY0cuYXBwZW5kKFwicGF0aFwiKS5hdHRyKFwiZFwiLHBBcmVhKHBWKSkuYXR0cihcImZpbGxcIixDLnByaW9yKS5hdHRyKFwib3BhY2l0eVwiLDAuMTMpO1xyXG4gICAgc3RhdGljRy5hcHBlbmQoXCJwYXRoXCIpLmF0dHIoXCJkXCIscExpbmUocFYpKS5hdHRyKFwiZmlsbFwiLFwibm9uZVwiKS5hdHRyKFwic3Ryb2tlXCIsQy5wcmlvcikuYXR0cihcInN0cm9rZS13aWR0aFwiLDIpO1xyXG4gICAgY29uc3QgbEFyZWE9ZDMuYXJlYSgpLngoZD0+YnhTKGQueCkpLnkwKG1pZFkpLnkxKGQ9Pmx5UyhkLnkpKS5jdXJ2ZShkMy5jdXJ2ZUJhc2lzKTtcclxuICAgIGNvbnN0IGxMaW5lPWQzLmxpbmUoKS54KGQ9PmJ4UyhkLngpKS55KGQ9Pmx5UyhkLnkpKS5jdXJ2ZShkMy5jdXJ2ZUJhc2lzKTtcclxuICAgIHN0YXRpY0cuYXBwZW5kKFwicGF0aFwiKS5hdHRyKFwiZFwiLGxBcmVhKGxWKSkuYXR0cihcImZpbGxcIixDLmxpaykuYXR0cihcIm9wYWNpdHlcIiwwLjEzKTtcclxuICAgIHN0YXRpY0cuYXBwZW5kKFwicGF0aFwiKS5hdHRyKFwiZFwiLGxMaW5lKGxWKSkuYXR0cihcImZpbGxcIixcIm5vbmVcIikuYXR0cihcInN0cm9rZVwiLEMubGlrKS5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsMik7XHJcbiAgICBtZXJnZWRUaXRsZUVsLnRleHQoYFByaW9yOiBCZXRhKCR7cHJpb3JBfSwke3ByaW9yQn0pICDCtyAgTGlrOiBCaW4oJHtkYXRhS30vJHtkYXRhTn0szrgpICDCtyAgUG9zdDogQmV0YSgke3Bvc3RBX30sJHtwb3N0Ql99KWApO1xyXG4gIH1cclxuICBkcmF3U3RhdGljKCk7XHJcblxyXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkCBSRU5ERVIg4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgZnVuY3Rpb24gcmVuZGVyKCl7XHJcbiAgICBwcm9wb3NhbFNpZ21hPVNMLnNpZ21hLnZhbCgpO1xyXG4gICAgY29uc3QgdXNlQnVybj10b2dCdXJuLmNiLmNoZWNrZWQsdXNlVGhpbj10b2dUaGluLmNiLmNoZWNrZWQ7XHJcbiAgICBjb25zdCBidXJuaW49U0wuYnVybmluLnZhbCgpLHRoaW49U0wudGhpbi52YWwoKTtcclxuICAgIC8vIE9ubHkgYWN0dWFsbHkgZmlsdGVyIHdoZW4gdGhlIHRvZ2dsZSBpcyBvbiBBTkQgdGhlIHZhbHVlIGNoYW5nZXMgc29tZXRoaW5nXHJcbiAgICBjb25zdCBidXJuQWN0aXZlPXVzZUJ1cm4mJmJ1cm5pbj4wO1xyXG4gICAgY29uc3QgdGhpbkFjdGl2ZT11c2VUaGluJiZ0aGluPjE7XHJcbiAgICBjb25zdCB1c2VGaWx0ZXI9YnVybkFjdGl2ZXx8dGhpbkFjdGl2ZTtcclxuICAgIGNvbnN0IGVmZkJ1cm49YnVybkFjdGl2ZT9idXJuaW46MCxlZmZUaGluPXRoaW5BY3RpdmU/dGhpbjoxO1xyXG4gICAgY29uc3QgY3VyVmFsPWNoYWluW2NoYWluLmxlbmd0aC0xXTtcclxuICAgIGNvbnN0IHRoZXRhUz1kMy5zY2FsZUxpbmVhcigpLmRvbWFpbihbMCwxXSkucmFuZ2UoW3RJSCwwXSk7XHJcbiAgICBjb25zdCBoaXN0VGhldGFTPWQzLnNjYWxlTGluZWFyKCkuZG9tYWluKFswLDFdKS5yYW5nZShbaElILDBdKTtcclxuICAgIGNvbnN0IG1heFZpcz1NYXRoLm1heChjaGFpbi5sZW5ndGgrNSw2MCk7XHJcbiAgICBjb25zdCBzdGVwUz1kMy5zY2FsZUxpbmVhcigpLmRvbWFpbihbTWF0aC5tYXgoMCxjaGFpbi5sZW5ndGgtbWF4VmlzKSxjaGFpbi5sZW5ndGgrMl0pLnJhbmdlKFswLHRJV10pO1xyXG5cclxuICAgIC8vIOKUgOKUgCBUUkFDRSDilIDilIBcclxuICAgIHRyYWNlTGluZUcuc2VsZWN0QWxsKFwiKlwiKS5yZW1vdmUoKTtcclxuICAgIHRyYWNlUHJvcG9zYWxHLnNlbGVjdEFsbChcIipcIikucmVtb3ZlKCk7XHJcbiAgICB0cmFjZVBvaW50c0cuc2VsZWN0QWxsKFwiKlwiKS5yZW1vdmUoKTtcclxuICAgIHRyYWNlQnVybkcuc2VsZWN0QWxsKFwiKlwiKS5yZW1vdmUoKTtcclxuICAgIHRyYWNlRy5zZWxlY3RBbGwoXCIueXRcIikucmVtb3ZlKCk7XHJcblxyXG4gICAgWzAsMC4yNSwwLjUsMC43NSwxXS5mb3JFYWNoKHY9PntcclxuICAgICAgdHJhY2VHLmFwcGVuZChcInRleHRcIikuYXR0cihcImNsYXNzXCIsXCJ5dFwiKS5hdHRyKFwieFwiLC04KS5hdHRyKFwieVwiLHRoZXRhUyh2KSszKVxyXG4gICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIixcImVuZFwiKS5hdHRyKFwiZm9udC1zaXplXCIsOSkuYXR0cihcImZpbGxcIixDLnN1YikuYXR0cihcImZvbnQtZmFtaWx5XCIsbW9ubykudGV4dCh2LnRvRml4ZWQoMikpO1xyXG4gICAgICB0cmFjZUcuYXBwZW5kKFwibGluZVwiKS5hdHRyKFwiY2xhc3NcIixcInl0XCIpLmF0dHIoXCJ4MVwiLDApLmF0dHIoXCJ4MlwiLHRJVylcclxuICAgICAgICAuYXR0cihcInkxXCIsdGhldGFTKHYpKS5hdHRyKFwieTJcIix0aGV0YVModikpLmF0dHIoXCJzdHJva2VcIixcIiNGMEYwRjBcIik7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBCdXJuLWluIG92ZXJsYXlcclxuICAgIGlmKGJ1cm5BY3RpdmUmJmJ1cm5pbjxjaGFpbi5sZW5ndGgpe1xyXG4gICAgICBjb25zdCBieD1zdGVwUyhidXJuaW4pO1xyXG4gICAgICB0cmFjZUJ1cm5HLmFwcGVuZChcInJlY3RcIikuYXR0cihcInhcIiwwKS5hdHRyKFwieVwiLDApLmF0dHIoXCJ3aWR0aFwiLE1hdGgubWF4KDAsYngpKS5hdHRyKFwiaGVpZ2h0XCIsdElIKVxyXG4gICAgICAgIC5hdHRyKFwiZmlsbFwiLEMuYnVybkxpbmUpLmF0dHIoXCJvcGFjaXR5XCIsMC4wNik7XHJcbiAgICAgIHRyYWNlQnVybkcuYXBwZW5kKFwibGluZVwiKS5hdHRyKFwieDFcIixieCkuYXR0cihcIngyXCIsYngpLmF0dHIoXCJ5MVwiLDApLmF0dHIoXCJ5MlwiLHRJSClcclxuICAgICAgICAuYXR0cihcInN0cm9rZVwiLEMuYnVybkxpbmUpLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwyKS5hdHRyKFwic3Ryb2tlLWRhc2hhcnJheVwiLFwiNiw0XCIpO1xyXG4gICAgICB0cmFjZUJ1cm5HLmFwcGVuZChcInRleHRcIikuYXR0cihcInhcIixieCs0KS5hdHRyKFwieVwiLDEyKVxyXG4gICAgICAgIC5hdHRyKFwiZm9udC1zaXplXCIsMTApLmF0dHIoXCJmb250LXdlaWdodFwiLDcwMCkuYXR0cihcImZpbGxcIixDLmJ1cm5MaW5lKS5hdHRyKFwiZm9udC1mYW1pbHlcIixtb25vKS50ZXh0KGBidXJuLWluID0gJHtidXJuaW59YCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVHJhY2UgbGluZVxyXG4gICAgaWYoY2hhaW4ubGVuZ3RoPjEpe1xyXG4gICAgICBpZihidXJuQWN0aXZlJiZidXJuaW48Y2hhaW4ubGVuZ3RoKXtcclxuICAgICAgICAvLyBCdXJuZWQgcG9ydGlvbiBmYWRlZFxyXG4gICAgICAgIGNvbnN0IGJwPWNoYWluLnNsaWNlKDAsTWF0aC5taW4oYnVybmluKzEsY2hhaW4ubGVuZ3RoKSk7XHJcbiAgICAgICAgaWYoYnAubGVuZ3RoPjEpIHRyYWNlTGluZUcuYXBwZW5kKFwicGF0aFwiKVxyXG4gICAgICAgICAgLmF0dHIoXCJkXCIsYnAubWFwKCh2LGkpPT5gJHtpPydMJzonTSd9JHtzdGVwUyhpKS50b0ZpeGVkKDEpfSwke3RoZXRhUyh2KS50b0ZpeGVkKDEpfWApLmpvaW4oXCJcIikpXHJcbiAgICAgICAgICAuYXR0cihcImZpbGxcIixcIm5vbmVcIikuYXR0cihcInN0cm9rZVwiLEMuYnVybmVkKS5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsMS41KS5hdHRyKFwib3BhY2l0eVwiLDAuNCk7XHJcbiAgICAgICAgY29uc3QgcHA9Y2hhaW4uc2xpY2UoYnVybmluKTtcclxuICAgICAgICBpZihwcC5sZW5ndGg+MSkgdHJhY2VMaW5lRy5hcHBlbmQoXCJwYXRoXCIpXHJcbiAgICAgICAgICAuYXR0cihcImRcIixwcC5tYXAoKHYsaSk9PmAke2k/J0wnOidNJ30ke3N0ZXBTKGJ1cm5pbitpKS50b0ZpeGVkKDEpfSwke3RoZXRhUyh2KS50b0ZpeGVkKDEpfWApLmpvaW4oXCJcIikpXHJcbiAgICAgICAgICAuYXR0cihcImZpbGxcIixcIm5vbmVcIikuYXR0cihcInN0cm9rZVwiLEMudHJhY2UpLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwxLjMpLmF0dHIoXCJvcGFjaXR5XCIsMC43KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0cmFjZUxpbmVHLmFwcGVuZChcInBhdGhcIilcclxuICAgICAgICAgIC5hdHRyKFwiZFwiLGNoYWluLm1hcCgodixpKT0+YCR7aT8nTCc6J00nfSR7c3RlcFMoaSkudG9GaXhlZCgxKX0sJHt0aGV0YVModikudG9GaXhlZCgxKX1gKS5qb2luKFwiXCIpKVxyXG4gICAgICAgICAgLmF0dHIoXCJmaWxsXCIsXCJub25lXCIpLmF0dHIoXCJzdHJva2VcIixDLnRyYWNlKS5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsMS4yKS5hdHRyKFwib3BhY2l0eVwiLDAuNik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBQb2ludHNcclxuICAgIGNvbnN0IHZpc1N0YXJ0PU1hdGgubWF4KDAsY2hhaW4ubGVuZ3RoLU1hdGguZmxvb3IobWF4VmlzKSk7XHJcbiAgICBmb3IobGV0IGk9dmlzU3RhcnQ7aTxjaGFpbi5sZW5ndGg7aSsrKXtcclxuICAgICAgY29uc3QgaXNMYXN0PWk9PT1jaGFpbi5sZW5ndGgtMTtcclxuICAgICAgY29uc3QgaXNCdXJuZWQ9YnVybkFjdGl2ZSYmaTxidXJuaW47XHJcbiAgICAgIGNvbnN0IGlzS2VwdD0haXNCdXJuZWQmJihlZmZUaGluPD0xfHwoaS1lZmZCdXJuKSVlZmZUaGluPT09MCk7XHJcbiAgICAgIHRyYWNlUG9pbnRzRy5hcHBlbmQoXCJjaXJjbGVcIilcclxuICAgICAgICAuYXR0cihcImN4XCIsc3RlcFMoaSkpLmF0dHIoXCJjeVwiLHRoZXRhUyhjaGFpbltpXSkpXHJcbiAgICAgICAgLmF0dHIoXCJyXCIsaXNMYXN0PzU6ICh0aGluQWN0aXZlJiYhaXNCdXJuZWQmJmlzS2VwdCk/MzoxLjUpXHJcbiAgICAgICAgLmF0dHIoXCJmaWxsXCIsaXNMYXN0P0MuY3VycmVudDogaXNCdXJuZWQ/Qy5idXJuZWQ6IGlzS2VwdD9DLnRyYWNlOkMudHJhY2VMaWdodClcclxuICAgICAgICAuYXR0cihcIm9wYWNpdHlcIixpc0J1cm5lZD8wLjI1OiBpc0tlcHQ/MTowLjIpXHJcbiAgICAgICAgLmF0dHIoXCJzdHJva2VcIixpc0xhc3Q/XCIjZmZmXCI6XCJub25lXCIpLmF0dHIoXCJzdHJva2Utd2lkdGhcIixpc0xhc3Q/MjowKTtcclxuICAgIH1cclxuXHJcbiAgICB0cmFjZVBvaW50c0cuYXBwZW5kKFwidGV4dFwiKS5hdHRyKFwieFwiLHN0ZXBTKGNoYWluLmxlbmd0aC0xKSkuYXR0cihcInlcIix0aGV0YVMoY3VyVmFsKS0xMClcclxuICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLFwibWlkZGxlXCIpLmF0dHIoXCJmb250LXNpemVcIiwxMSkuYXR0cihcImZvbnQtd2VpZ2h0XCIsNzAwKVxyXG4gICAgICAuYXR0cihcImZpbGxcIixDLmN1cnJlbnQpLmF0dHIoXCJmb250LWZhbWlseVwiLG1vbm8pLnRleHQoYM64ID0gJHtjdXJWYWwudG9GaXhlZCgzKX1gKTtcclxuXHJcbiAgICAvLyBQcm9wb3NhbFxyXG4gICAgaWYoc3RlcFBoYXNlPT09XCJwcm9wb3NlZFwifHxzdGVwUGhhc2U9PT1cImRlY2lkZWRcIil7XHJcbiAgICAgIGNvbnN0IHBjPXN0ZXBQaGFzZT09PVwiZGVjaWRlZFwiPyhhY2NlcHRlZD9DLmFjY2VwdDpDLnJlamVjdCk6Qy5wcm9wb3NlO1xyXG4gICAgICBjb25zdCBjSWR4PXByb3BTdGVwSWR4LTEsY1Q9Y2hhaW5bY0lkeF0sY3g9c3RlcFMoY0lkeCkscHg9c3RlcFMocHJvcFN0ZXBJZHgpO1xyXG4gICAgICBjb25zdCBuUD02MCxwcD1bXTtcclxuICAgICAgZm9yKGxldCBpPTA7aTw9blA7aSsrKXtjb25zdCB6PS0zKzYqaS9uUDtcclxuICAgICAgICBwcC5wdXNoKHt0aGV0YTpNYXRoLm1heCgwLE1hdGgubWluKDEsY1Qreipwcm9wb3NhbFNpZ21hKSksZGVuc2l0eTpub3JtYWxQREYoeipwcm9wb3NhbFNpZ21hLDAscHJvcG9zYWxTaWdtYSl9KTt9XHJcbiAgICAgIGNvbnN0IG1EPU1hdGgubWF4KC4uLnBwLm1hcChkPT5kLmRlbnNpdHkpKTtcclxuICAgICAgbGV0IHBEPWBNJHtjeH0sJHt0aGV0YVMocHBbMF0udGhldGEpfWA7XHJcbiAgICAgIGZvcihjb25zdCBkIG9mIHBwKSBwRCs9YEwkeyhjeCsoZC5kZW5zaXR5L21EKSo0MCkudG9GaXhlZCgxKX0sJHt0aGV0YVMoZC50aGV0YSkudG9GaXhlZCgxKX1gO1xyXG4gICAgICBwRCs9YEwke2N4fSwke3RoZXRhUyhwcFtwcC5sZW5ndGgtMV0udGhldGEpfVpgO1xyXG4gICAgICB0cmFjZVByb3Bvc2FsRy5hcHBlbmQoXCJwYXRoXCIpLmF0dHIoXCJkXCIscEQpLmF0dHIoXCJmaWxsXCIsQy5wcm9wb3NhbCkuYXR0cihcIm9wYWNpdHlcIiwwLjE4KVxyXG4gICAgICAgIC5hdHRyKFwic3Ryb2tlXCIsQy5wcm9wb3NhbCkuYXR0cihcInN0cm9rZS13aWR0aFwiLDEpLmF0dHIoXCJzdHJva2Utb3BhY2l0eVwiLDAuMyk7XHJcbiAgICAgIHRyYWNlUHJvcG9zYWxHLmFwcGVuZChcImxpbmVcIikuYXR0cihcIngxXCIsY3gpLmF0dHIoXCJ5MVwiLHRoZXRhUyhjVCkpLmF0dHIoXCJ4MlwiLHB4KS5hdHRyKFwieTJcIix0aGV0YVMocHJvcG9zZWQpKVxyXG4gICAgICAgIC5hdHRyKFwic3Ryb2tlXCIscGMpLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwxLjUpLmF0dHIoXCJzdHJva2UtZGFzaGFycmF5XCIsXCI0LDNcIik7XHJcbiAgICAgIHRyYWNlUHJvcG9zYWxHLmFwcGVuZChcImNpcmNsZVwiKS5hdHRyKFwiY3hcIixweCkuYXR0cihcImN5XCIsdGhldGFTKHByb3Bvc2VkKSkuYXR0cihcInJcIiw1KVxyXG4gICAgICAgIC5hdHRyKFwiZmlsbFwiLHBjKS5hdHRyKFwic3Ryb2tlXCIsXCIjZmZmXCIpLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwyKTtcclxuICAgICAgY29uc3Qgc3ltPXN0ZXBQaGFzZT09PVwiZGVjaWRlZFwiPyhhY2NlcHRlZD9cIuKck1wiOlwi4pyXXCIpOlwiP1wiO1xyXG4gICAgICB0cmFjZVByb3Bvc2FsRy5hcHBlbmQoXCJ0ZXh0XCIpLmF0dHIoXCJ4XCIscHgpLmF0dHIoXCJ5XCIsdGhldGFTKHByb3Bvc2VkKSsocHJvcG9zZWQ+Y1Q/LTEwOjE0KSlcclxuICAgICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsXCJtaWRkbGVcIikuYXR0cihcImZvbnQtc2l6ZVwiLDExKS5hdHRyKFwiZm9udC13ZWlnaHRcIiw3MDApXHJcbiAgICAgICAgLmF0dHIoXCJmaWxsXCIscGMpLmF0dHIoXCJmb250LWZhbWlseVwiLG1vbm8pLnRleHQoYCR7c3ltfSDOuCo9JHtwcm9wb3NlZC50b0ZpeGVkKDMpfWApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOKUgOKUgCBISVNUT0dSQU0g4pSA4pSAXHJcbiAgICBoaXN0R2hvc3RHLnNlbGVjdEFsbChcIipcIikucmVtb3ZlKCk7XHJcbiAgICBoaXN0QmFyc0cuc2VsZWN0QWxsKFwiKlwiKS5yZW1vdmUoKTtcclxuICAgIGhpc3RDdXJ2ZUcuc2VsZWN0QWxsKFwiKlwiKS5yZW1vdmUoKTtcclxuICAgIGhpc3RHLnNlbGVjdEFsbChcIi55dFwiKS5yZW1vdmUoKTtcclxuXHJcbiAgICBjb25zdCBuQmlucz0zMCxiaW5IXz0xL25CaW5zLGJhckhfPWhJSC9uQmlucztcclxuICAgIGNvbnN0IGJpbnNSYXc9QXJyYXkobkJpbnMpLmZpbGwoMCk7XHJcbiAgICBzYW1wbGVzLmZvckVhY2gocz0+e2JpbnNSYXdbTWF0aC5taW4oTWF0aC5mbG9vcihzL2JpbkhfKSxuQmlucy0xKV0rKzt9KTtcclxuXHJcbiAgICAvLyBGaWx0ZXJlZCBzYW1wbGVzIGZyb20gZnVsbCBjaGFpblxyXG4gICAgY29uc3QgZmlsdFNhbXA9W107XHJcbiAgICBmb3IobGV0IGk9ZWZmQnVybjtpPGNoYWluLmxlbmd0aDtpKyspIGlmKGVmZlRoaW48PTF8fChpLWVmZkJ1cm4pJWVmZlRoaW49PT0wKSBmaWx0U2FtcC5wdXNoKGNoYWluW2ldKTtcclxuICAgIGNvbnN0IGJpbnNGaWx0PUFycmF5KG5CaW5zKS5maWxsKDApO1xyXG4gICAgZmlsdFNhbXAuZm9yRWFjaChzPT57Ymluc0ZpbHRbTWF0aC5taW4oTWF0aC5mbG9vcihzL2JpbkhfKSxuQmlucy0xKV0rKzt9KTtcclxuXHJcbiAgICBjb25zdCBiaW5zU2hvdz11c2VGaWx0ZXI/Ymluc0ZpbHQ6Ymluc1JhdztcclxuICAgIGNvbnN0IG1heEJpbj1NYXRoLm1heCguLi5iaW5zU2hvdywxKTtcclxuICAgIGNvbnN0IGJhclNjPWQzLnNjYWxlTGluZWFyKCkuZG9tYWluKFswLG1heEJpbl0pLnJhbmdlKFswLGhJVy04XSk7XHJcblxyXG4gICAgaGlzdFRpdGxlLnRleHQodXNlRmlsdGVyP2DEkMOjIGzhu41jICgke2ZpbHRTYW1wLmxlbmd0aH0pYDpcIkJp4buDdSDEkeG7kyB04bqnbiBzdeG6pXRcIik7XHJcblxyXG4gICAgWzAsMC4yNSwwLjUsMC43NSwxXS5mb3JFYWNoKHY9PntcclxuICAgICAgaGlzdEcuYXBwZW5kKFwidGV4dFwiKS5hdHRyKFwiY2xhc3NcIixcInl0XCIpLmF0dHIoXCJ4XCIsaElXKzYpLmF0dHIoXCJ5XCIsaGlzdFRoZXRhUyh2KSszKVxyXG4gICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIixcInN0YXJ0XCIpLmF0dHIoXCJmb250LXNpemVcIiw5KS5hdHRyKFwiZmlsbFwiLEMuc3ViKS5hdHRyKFwiZm9udC1mYW1pbHlcIixtb25vKS50ZXh0KHYudG9GaXhlZCgyKSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBHaG9zdCBiYXJzIChyYXcpIGlmIGZpbHRlcmluZyBhY3RpdmVcclxuICAgIGlmKHVzZUZpbHRlcil7XHJcbiAgICAgIGNvbnN0IG14Uj1NYXRoLm1heCguLi5iaW5zUmF3LDEpO1xyXG4gICAgICBjb25zdCBnU2M9ZDMuc2NhbGVMaW5lYXIoKS5kb21haW4oWzAsbXhSXSkucmFuZ2UoWzAsaElXLThdKTtcclxuICAgICAgYmluc1Jhdy5mb3JFYWNoKChjLGJpKT0+e2lmKCFjKXJldHVybjtcclxuICAgICAgICBoaXN0R2hvc3RHLmFwcGVuZChcInJlY3RcIikuYXR0cihcInhcIiwxKS5hdHRyKFwieVwiLGhpc3RUaGV0YVMoKGJpKzEpKmJpbkhfKSsxKVxyXG4gICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLGdTYyhjKSkuYXR0cihcImhlaWdodFwiLGJhckhfLTIpLmF0dHIoXCJyeFwiLDIpLmF0dHIoXCJmaWxsXCIsQy5naG9zdCkuYXR0cihcIm9wYWNpdHlcIiwwLjQpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBBY3RpdmUgYmFyc1xyXG4gICAgYmluc1Nob3cuZm9yRWFjaCgoY291bnQsYmkpPT57XHJcbiAgICAgIGlmKCFjb3VudClyZXR1cm47XHJcbiAgICAgIGNvbnN0IGJ5PWhpc3RUaGV0YVMoKGJpKzEpKmJpbkhfKSxiSHQ9YmFySF8tMix0dz1iYXJTYyhjb3VudCk7XHJcbiAgICAgIGNvbnN0IGlzTmV3PWJpPT09bGFzdEFjY2VwdGVkQmluJiYhdXNlRmlsdGVyO1xyXG4gICAgICBjb25zdCBmYz11c2VGaWx0ZXI/Qy5maWx0OmlzTmV3P0MuaGlzdE5ldzpDLmhpc3Q7XHJcbiAgICAgIGNvbnN0IHNjPXVzZUZpbHRlcj9DLmZpbHRTdHJva2U6aXNOZXc/Qy5oaXN0TmV3U3Ryb2tlOkMuaGlzdFN0cm9rZTtcclxuICAgICAgY29uc3QgdGM9dXNlRmlsdGVyP0MuZmlsdFRvcDppc05ldz9DLmhpc3ROZXdUb3A6Qy5oaXN0VG9wO1xyXG4gICAgICBoaXN0QmFyc0cuYXBwZW5kKFwicmVjdFwiKS5hdHRyKFwieFwiLDEpLmF0dHIoXCJ5XCIsYnkrMSkuYXR0cihcIndpZHRoXCIsdHcpLmF0dHIoXCJoZWlnaHRcIixiSHQpXHJcbiAgICAgICAgLmF0dHIoXCJyeFwiLDIpLmF0dHIoXCJmaWxsXCIsZmMpLmF0dHIoXCJzdHJva2VcIixzYykuYXR0cihcInN0cm9rZS13aWR0aFwiLDAuNik7XHJcbiAgICAgIGlmKGJIdD4zKSBoaXN0QmFyc0cuYXBwZW5kKFwicmVjdFwiKS5hdHRyKFwieFwiLDEpLmF0dHIoXCJ5XCIsYnkrMSkuYXR0cihcIndpZHRoXCIsdHcpXHJcbiAgICAgICAgLmF0dHIoXCJoZWlnaHRcIixNYXRoLm1pbigyLGJIdCowLjI1KSkuYXR0cihcInJ4XCIsMikuYXR0cihcImZpbGxcIix0YykuYXR0cihcIm9wYWNpdHlcIiwwLjUpO1xyXG4gICAgICBjb25zdCBjdz1NYXRoLm1pbigxMCx0dy9jb3VudCk7XHJcbiAgICAgIGlmKGN3PjMpIGZvcihsZXQgaj0xO2o8Y291bnQ7aisrKXtjb25zdCBseD1qKmN3KzE7XHJcbiAgICAgICAgaWYobHg8dHcpIGhpc3RCYXJzRy5hcHBlbmQoXCJsaW5lXCIpLmF0dHIoXCJ4MVwiLGx4KS5hdHRyKFwieDJcIixseCkuYXR0cihcInkxXCIsYnkrMSkuYXR0cihcInkyXCIsYnkrMStiSHQpXHJcbiAgICAgICAgICAuYXR0cihcInN0cm9rZVwiLHNjKS5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsMC40KS5hdHRyKFwib3BhY2l0eVwiLDAuNSk7fVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gVHJ1ZSBwb3N0ZXJpb3IgY3VydmVcclxuICAgIGNvbnN0IHRydWVWPWN1cnZlUHRzLm1hcCh0PT4oe3RoZXRhOnQsZGVuc2l0eTp0cnVlUG9zdGVyaW9yKHQpfSkpO1xyXG4gICAgY29uc3QgbXhUPU1hdGgubWF4KC4uLnRydWVWLm1hcChkPT5kLmRlbnNpdHkpKTtcclxuICAgIGhpc3RDdXJ2ZUcuYXBwZW5kKFwicGF0aFwiKVxyXG4gICAgICAuYXR0cihcImRcIixkMy5saW5lKCkueChkPT5kLmRlbnNpdHkqKChoSVctOCkvbXhUKjAuODUpKS55KGQ9Pmhpc3RUaGV0YVMoZC50aGV0YSkpLmN1cnZlKGQzLmN1cnZlQmFzaXMpKHRydWVWKSlcclxuICAgICAgLmF0dHIoXCJmaWxsXCIsXCJub25lXCIpLmF0dHIoXCJzdHJva2VcIixDLnBvc3QpLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwyKS5hdHRyKFwic3Ryb2tlLWRhc2hhcnJheVwiLFwiNSwzXCIpLmF0dHIoXCJvcGFjaXR5XCIsMC42KTtcclxuXHJcbiAgICAvLyDilIDilIAgTUVSR0VEIE1BUktFUlMg4pSA4pSAXHJcbiAgICBtZXJnZWRNYXJrZXJzLnNlbGVjdEFsbChcIipcIikucmVtb3ZlKCk7XHJcbiAgICBmdW5jdGlvbiBkcmF3TU0odmFsLGNvbG9yLGxhYmVsKXtcclxuICAgICAgY29uc3QgcHg9YnhTKHZhbCkscFA9cHlTKHByaW9yKHZhbCkpLHBMPWx5UyhsaWtOb3JtKHZhbCkpO1xyXG4gICAgICBtZXJnZWRNYXJrZXJzLmFwcGVuZChcImxpbmVcIikuYXR0cihcIngxXCIscHgpLmF0dHIoXCJ4MlwiLHB4KS5hdHRyKFwieTFcIixwUCkuYXR0cihcInkyXCIscEwpXHJcbiAgICAgICAgLmF0dHIoXCJzdHJva2VcIixjb2xvcikuYXR0cihcInN0cm9rZS13aWR0aFwiLDEuNSkuYXR0cihcInN0cm9rZS1kYXNoYXJyYXlcIixcIjMsMlwiKTtcclxuICAgICAgbWVyZ2VkTWFya2Vycy5hcHBlbmQoXCJjaXJjbGVcIikuYXR0cihcImN4XCIscHgpLmF0dHIoXCJjeVwiLHBQKS5hdHRyKFwiclwiLDQpLmF0dHIoXCJmaWxsXCIsY29sb3IpLmF0dHIoXCJzdHJva2VcIixcIiNmZmZcIikuYXR0cihcInN0cm9rZS13aWR0aFwiLDEuNSk7XHJcbiAgICAgIG1lcmdlZE1hcmtlcnMuYXBwZW5kKFwiY2lyY2xlXCIpLmF0dHIoXCJjeFwiLHB4KS5hdHRyKFwiY3lcIixwTCkuYXR0cihcInJcIiw0KS5hdHRyKFwiZmlsbFwiLGNvbG9yKS5hdHRyKFwic3Ryb2tlXCIsXCIjZmZmXCIpLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwxLjUpO1xyXG4gICAgICBtZXJnZWRNYXJrZXJzLmFwcGVuZChcInRleHRcIikuYXR0cihcInhcIixweCkuYXR0cihcInlcIixNYXRoLm1heChiTWcudCs2LHBQLTgpKS5hdHRyKFwidGV4dC1hbmNob3JcIixcIm1pZGRsZVwiKVxyXG4gICAgICAgIC5hdHRyKFwiZm9udC1zaXplXCIsOSkuYXR0cihcImZvbnQtd2VpZ2h0XCIsNzAwKS5hdHRyKFwiZmlsbFwiLGNvbG9yKS5hdHRyKFwiZm9udC1mYW1pbHlcIixtb25vKS50ZXh0KGDPgD0ke3ByaW9yKHZhbCkudG9GaXhlZCgyKX1gKTtcclxuICAgICAgbWVyZ2VkTWFya2Vycy5hcHBlbmQoXCJ0ZXh0XCIpLmF0dHIoXCJ4XCIscHgpLmF0dHIoXCJ5XCIsTWF0aC5taW4oQkgtYk1nLmItMixwTCsxNCkpLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLFwibWlkZGxlXCIpXHJcbiAgICAgICAgLmF0dHIoXCJmb250LXNpemVcIiw5KS5hdHRyKFwiZm9udC13ZWlnaHRcIiw3MDApLmF0dHIoXCJmaWxsXCIsY29sb3IpLmF0dHIoXCJmb250LWZhbWlseVwiLG1vbm8pLnRleHQoYEw9JHtsaWtOb3JtKHZhbCkudG9GaXhlZCgzKX1gKTtcclxuICAgICAgbWVyZ2VkTWFya2Vycy5hcHBlbmQoXCJ0ZXh0XCIpLmF0dHIoXCJ4XCIscHgpLmF0dHIoXCJ5XCIsTWF0aC5tYXgoYk1nLnQrNixwUC0xOCkpLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLFwibWlkZGxlXCIpXHJcbiAgICAgICAgLmF0dHIoXCJmb250LXNpemVcIiw4KS5hdHRyKFwiZm9udC13ZWlnaHRcIiw2MDApLmF0dHIoXCJmaWxsXCIsY29sb3IpLmF0dHIoXCJmb250LWZhbWlseVwiLG1vbm8pLnRleHQobGFiZWwpO1xyXG4gICAgfVxyXG4gICAgZHJhd01NKGN1clZhbCxDLmN1cnJlbnQsYM64PSR7Y3VyVmFsLnRvRml4ZWQoMyl9YCk7XHJcbiAgICBpZihwcm9wb3NlZCE9PW51bGwmJihzdGVwUGhhc2U9PT1cInByb3Bvc2VkXCJ8fHN0ZXBQaGFzZT09PVwiZGVjaWRlZFwiKSlcclxuICAgICAgZHJhd01NKHByb3Bvc2VkLHN0ZXBQaGFzZT09PVwiZGVjaWRlZFwiPyhhY2NlcHRlZD9DLmFjY2VwdDpDLnJlamVjdCk6Qy5wcm9wb3NlLGDOuCo9JHtwcm9wb3NlZC50b0ZpeGVkKDMpfWApO1xyXG5cclxuICAgIC8vIOKUgOKUgCBTVEFUVVMg4pSA4pSAXHJcbiAgICBjb25zdCBuQWNjPXNhbXBsZXMubGVuZ3RoLHJhdGU9c3RlcENvdW50PjA/KG5BY2Mvc3RlcENvdW50KjEwMCkudG9GaXhlZCgwKTpcIuKAlFwiO1xyXG4gICAgY29uc3QgcGlsbD0odCxiZyk9PmA8c3BhbiBzdHlsZT1cImRpc3BsYXk6aW5saW5lLWJsb2NrO3BhZGRpbmc6MnB4IDEwcHg7Ym9yZGVyLXJhZGl1czoyMHB4O2JhY2tncm91bmQ6JHtiZ307Y29sb3I6I2ZmZjtmb250LXdlaWdodDo3MDA7Zm9udC1zaXplOjEycHg7bGV0dGVyLXNwYWNpbmc6MC4zcHg7XCI+JHt0fTwvc3Bhbj5gO1xyXG4gICAgY29uc3Qgdmw9KHYsYyxiaWcpPT5gPHNwYW4gc3R5bGU9XCJjb2xvcjoke2N9O2ZvbnQtd2VpZ2h0OiR7YmlnPzgwMDo3MDB9O2ZvbnQtc2l6ZToke2JpZz8xNjoxM31weDtcIj4ke3Z9PC9zcGFuPmA7XHJcbiAgICBjb25zdCBsYj0odCxjKT0+YDxzcGFuIHN0eWxlPVwiY29sb3I6JHtjfHxDLnN1Yn07Zm9udC1zaXplOjExcHg7Zm9udC13ZWlnaHQ6NjAwO1wiPiR7dH08L3NwYW4+YDtcclxuICAgIGNvbnN0IHN0YXRzPWA8ZGl2IHN0eWxlPVwiZGlzcGxheTpmbGV4O2dhcDoxNnB4O2FsaWduLWl0ZW1zOmNlbnRlcjttYXJnaW4tdG9wOjZweDtmb250LXNpemU6MTFweDtjb2xvcjoke0Muc3VifTtcIj5gK1xyXG4gICAgICBgJHtsYignQsaw4bubYycpfSA8Yj4ke3N0ZXBDb3VudH08L2I+ICZuYnNwOyR7bGIoJ8SQw6Mgbmjhuq1uJyl9IDxiPiR7bkFjY308L2I+ICZuYnNwOyR7bGIoJ1Thu7cgbOG7hycpfSA8Yj4ke3JhdGV9JTwvYj5gK1xyXG4gICAgICAodXNlRmlsdGVyP2AgJm5ic3A7JHtsYignxJDDoyBs4buNYycsQy5maWx0KX0gPGIgc3R5bGU9XCJjb2xvcjoke0MuZmlsdH1cIj4ke2ZpbHRTYW1wLmxlbmd0aH08L2I+YDpcIlwiKStgPC9kaXY+YDtcclxuXHJcbiAgICBpZihzdGVwUGhhc2U9PT1cImlkbGVcIil7XHJcbiAgICAgIHN0YXR1c0JveC5zdHlsZS5ib3JkZXJDb2xvcj1DLmJvcmRlcjtzdGF0dXNCb3guc3R5bGUuYmFja2dyb3VuZD0nbGluZWFyLWdyYWRpZW50KDEzNWRlZywjRkFGQUZBLCNGNUY1RjUpJztcclxuICAgICAgc3RhdHVzQm94LmlubmVySFRNTD1gPGRpdiBzdHlsZT1cImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjEycHg7XCI+YCtwaWxsKCdT4bq0TiBTw4BORycsJyM1NDZFN0EnKStcclxuICAgICAgICBgPHNwYW4gc3R5bGU9XCJmb250LXNpemU6MTRweDtcIj5W4buLIHRyw60gaGnhu4duIHThuqFpOiAke3ZsKCfOuCA9ICcrY3VyVmFsLnRvRml4ZWQoNCksQy5jdXJyZW50LHRydWUpfTwvc3Bhbj5gK1xyXG4gICAgICAgIGA8c3BhbiBzdHlsZT1cIm1hcmdpbi1sZWZ0OmF1dG87Y29sb3I6JHtDLnN1Yn07Zm9udC1zaXplOjEycHg7XCI+TmjhuqVuIDxiIHN0eWxlPVwiY29sb3I6JHtDLmN1cnJlbnR9XCI+Qsaw4bubYyB0aeG6v3AgdGhlbzwvYj4g4pa2PC9zcGFuPjwvZGl2PmArc3RhdHM7XHJcbiAgICB9IGVsc2UgaWYoc3RlcFBoYXNlPT09XCJwcm9wb3NlZFwiKXtcclxuICAgICAgY29uc3QgcEM9cHJpb3IoY3VyVmFsKSxwUD1wcmlvcihwcm9wb3NlZCksbEM9bGlrTm9ybShjdXJWYWwpLGxQPWxpa05vcm0ocHJvcG9zZWQpO1xyXG4gICAgICBzdGF0dXNCb3guc3R5bGUuYm9yZGVyQ29sb3I9Qy5wcm9wb3NlO3N0YXR1c0JveC5zdHlsZS5iYWNrZ3JvdW5kPSdsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCNGRkY4RTEsI0ZGRjNFMCknO1xyXG4gICAgICBzdGF0dXNCb3guaW5uZXJIVE1MPWA8ZGl2IHN0eWxlPVwiZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6MTBweDttYXJnaW4tYm90dG9tOjhweDtcIj5gK1xyXG4gICAgICAgIHBpbGwoJ8SQ4buAIFhV4bqkVCcsQy5wcm9wb3NlKStgPHNwYW4gc3R5bGU9XCJmb250LXNpemU6MTNweDtcIj7OuCogPSAke3ZsKHByb3Bvc2VkLnRvRml4ZWQoNCksQy5wcm9wb3NlLHRydWUpfSB04burIE4oJHtjdXJWYWwudG9GaXhlZCgzKX0sICR7cHJvcG9zYWxTaWdtYX3Csik8L3NwYW4+PC9kaXY+YCtcclxuICAgICAgICBgPHRhYmxlIHN0eWxlPVwid2lkdGg6MTAwJTtib3JkZXItY29sbGFwc2U6c2VwYXJhdGU7Ym9yZGVyLXNwYWNpbmc6MDtib3JkZXItcmFkaXVzOjEwcHg7b3ZlcmZsb3c6aGlkZGVuO2JvcmRlcjoxcHggc29saWQgI0UwRTBFMDtmb250LXNpemU6MTJweDtcIj5gK1xyXG4gICAgICAgIGA8dGhlYWQ+PHRyIHN0eWxlPVwiYmFja2dyb3VuZDojRjVGNUY1O1wiPjx0aCBzdHlsZT1cInBhZGRpbmc6NnB4IDEycHg7dGV4dC1hbGlnbjpsZWZ0O2ZvbnQtd2VpZ2h0OjYwMDtjb2xvcjoke0Muc3VifTtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjRTBFMEUwO1wiPjwvdGg+YCtcclxuICAgICAgICBgPHRoIHN0eWxlPVwicGFkZGluZzo2cHggMTJweDt0ZXh0LWFsaWduOmNlbnRlcjtmb250LXdlaWdodDo3MDA7Y29sb3I6JHtDLmN1cnJlbnR9O2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNFMEUwRTA7XCI+SGnhu4duIHThuqFpIM64ID0gJHtjdXJWYWwudG9GaXhlZCgzKX08L3RoPmArXHJcbiAgICAgICAgYDx0aCBzdHlsZT1cInBhZGRpbmc6NnB4IDEycHg7dGV4dC1hbGlnbjpjZW50ZXI7Zm9udC13ZWlnaHQ6NzAwO2NvbG9yOiR7Qy5wcm9wb3NlfTtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjRTBFMEUwO1wiPsSQ4buBIHh14bqldCDOuCogPSAke3Byb3Bvc2VkLnRvRml4ZWQoMyl9PC90aD48L3RyPjwvdGhlYWQ+PHRib2R5PmArXHJcbiAgICAgICAgYDx0ciBzdHlsZT1cImJhY2tncm91bmQ6I2ZmZjtcIj48dGQgc3R5bGU9XCJwYWRkaW5nOjVweCAxMnB4O2ZvbnQtd2VpZ2h0OjYwMDtjb2xvcjoke0MucHJpb3J9O2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNGMEYwRjA7XCI+z4AowrcpIFByaW9yPC90ZD5gK1xyXG4gICAgICAgICAgYDx0ZCBzdHlsZT1cInBhZGRpbmc6NXB4IDEycHg7dGV4dC1hbGlnbjpjZW50ZXI7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI0YwRjBGMDtcIj4ke3ZsKHBDLnRvRml4ZWQoNCksQy5wcmlvcil9PC90ZD5gK1xyXG4gICAgICAgICAgYDx0ZCBzdHlsZT1cInBhZGRpbmc6NXB4IDEycHg7dGV4dC1hbGlnbjpjZW50ZXI7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI0YwRjBGMDtcIj4ke3ZsKHBQLnRvRml4ZWQoNCksQy5wcmlvcil9PC90ZD48L3RyPmArXHJcbiAgICAgICAgYDx0ciBzdHlsZT1cImJhY2tncm91bmQ6I0ZBRkFGQTtcIj48dGQgc3R5bGU9XCJwYWRkaW5nOjVweCAxMnB4O2ZvbnQtd2VpZ2h0OjYwMDtjb2xvcjoke0MubGlrfTtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjRjBGMEYwO1wiPkwowrcpIExpa2VsaWhvb2Q8L3RkPmArXHJcbiAgICAgICAgICBgPHRkIHN0eWxlPVwicGFkZGluZzo1cHggMTJweDt0ZXh0LWFsaWduOmNlbnRlcjtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjRjBGMEYwO1wiPiR7dmwobEMudG9GaXhlZCg0KSxDLmxpayl9PC90ZD5gK1xyXG4gICAgICAgICAgYDx0ZCBzdHlsZT1cInBhZGRpbmc6NXB4IDEycHg7dGV4dC1hbGlnbjpjZW50ZXI7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI0YwRjBGMDtcIj4ke3ZsKGxQLnRvRml4ZWQoNCksQy5saWspfTwvdGQ+PC90cj5gK1xyXG4gICAgICAgIGA8dHIgc3R5bGU9XCJiYWNrZ3JvdW5kOiNmZmY7XCI+PHRkIHN0eWxlPVwicGFkZGluZzo1cHggMTJweDtmb250LXdlaWdodDo2MDA7Y29sb3I6JHtDLnR4dH07XCI+z4DCt0wgTeG7pWMgdGnDqnU8L3RkPmArXHJcbiAgICAgICAgICBgPHRkIHN0eWxlPVwicGFkZGluZzo1cHggMTJweDt0ZXh0LWFsaWduOmNlbnRlcjtcIj4ke3ZsKChwQypsQykudG9GaXhlZCg2KSxDLnR4dCl9PC90ZD5gK1xyXG4gICAgICAgICAgYDx0ZCBzdHlsZT1cInBhZGRpbmc6NXB4IDEycHg7dGV4dC1hbGlnbjpjZW50ZXI7XCI+JHt2bCgocFAqbFApLnRvRml4ZWQoNiksQy50eHQpfTwvdGQ+PC90cj48L3Rib2R5PjwvdGFibGU+YCtcclxuICAgICAgICBgPGRpdiBzdHlsZT1cImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjIwcHg7bWFyZ2luLXRvcDo4cHg7cGFkZGluZzo4cHggMTJweDtiYWNrZ3JvdW5kOiNmZmY7Ym9yZGVyLXJhZGl1czo4cHg7Ym9yZGVyOjFweCBzb2xpZCAjRTBFMEUwO1wiPmArXHJcbiAgICAgICAgICBgPHNwYW4+JHtsYignVOG7tyBs4buHIGNo4bqlcCBuaOG6rW4nLCcjMzMzJyl9ICZuYnNwO86xID0gJHt2bChhY2NlcHRSYXRpby50b0ZpeGVkKDQpLCcjMzMzJyx0cnVlKX08L3NwYW4+YCtcclxuICAgICAgICAgIGA8c3BhbiBzdHlsZT1cImNvbG9yOiNCREJEQkQ7XCI+4pSCPC9zcGFuPmArXHJcbiAgICAgICAgICBgPHNwYW4+JHtsYignUsO6dCBuZ+G6q3Ugbmhpw6puJywnIzMzMycpfSAmbmJzcDt1ID0gJHt2bCh1UmFuZC50b0ZpeGVkKDQpLCcjRTY1MTAwJyx0cnVlKX08L3NwYW4+YCtcclxuICAgICAgICAgIGA8c3BhbiBzdHlsZT1cIm1hcmdpbi1sZWZ0OmF1dG87Zm9udC1zaXplOjEycHg7Y29sb3I6JHtDLnN1Yn07XCI+TmjhuqVuIDxiPkLGsOG7m2MgdGnhur9wIHRoZW88L2I+IMSR4buDIHF1eeG6v3QgxJHhu4tuaDwvc3Bhbj48L2Rpdj5gO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgZGM9YWNjZXB0ZWQ/Qy5hY2NlcHQ6Qy5yZWplY3Q7XHJcbiAgICAgIHN0YXR1c0JveC5zdHlsZS5ib3JkZXJDb2xvcj1kYztcclxuICAgICAgc3RhdHVzQm94LnN0eWxlLmJhY2tncm91bmQ9YWNjZXB0ZWQ/J2xpbmVhci1ncmFkaWVudCgxMzVkZWcsI0U4RjVFOSwjRjFGOEU5KSc6J2xpbmVhci1ncmFkaWVudCgxMzVkZWcsI0ZGRUJFRSwjRkJFOUU3KSc7XHJcbiAgICAgIHN0YXR1c0JveC5pbm5lckhUTUw9YDxkaXYgc3R5bGU9XCJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDoxMnB4O1wiPmArXHJcbiAgICAgICAgcGlsbChhY2NlcHRlZD8n4pyTIENI4bqkUCBOSOG6rE4nOifinJcgVOG7qiBDSOG7kEknLGRjKStcclxuICAgICAgICBgPHNwYW4gc3R5bGU9XCJmb250LXNpemU6MTRweDtmb250LXdlaWdodDo2MDA7XCI+zrEgPSAke3ZsKGFjY2VwdFJhdGlvLnRvRml4ZWQoNCksQy50eHQpfSBgK1xyXG4gICAgICAgIGA8c3BhbiBzdHlsZT1cImNvbG9yOiR7ZGN9O2ZvbnQtd2VpZ2h0OjgwMDtmb250LXNpemU6MTVweDtcIj4ke2FjY2VwdGVkPyfiiaUnOic8J308L3NwYW4+IGArXHJcbiAgICAgICAgYHUgPSAke3ZsKHVSYW5kLnRvRml4ZWQoNCksQy5wcm9wb3NlKX08L3NwYW4+YCtcclxuICAgICAgICBgPHNwYW4gc3R5bGU9XCJtYXJnaW4tbGVmdDphdXRvO2ZvbnQtc2l6ZToxM3B4O2NvbG9yOiR7ZGN9O2ZvbnQtd2VpZ2h0OjYwMDtcIj5gK1xyXG4gICAgICAgIChhY2NlcHRlZD9g4oaSIERpIGNodXnhu4NuIMSR4bq/biDOuCogPSAke3Byb3Bvc2VkLnRvRml4ZWQoNCl9YDpg4oaSIEdp4buvIHThuqFpIM64ID0gJHtjdXJWYWwudG9GaXhlZCg0KX1gKStgPC9zcGFuPjwvZGl2PmArc3RhdHM7XHJcbiAgICB9XHJcbiAgICBzdGVwTGFiZWwudGV4dENvbnRlbnQ9YELGsOG7m2MgJHtzdGVwQ291bnR9IMK3ICR7bkFjY30gbeG6q3VgO1xyXG4gIH1cclxuXHJcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQIFNURVAgTE9HSUMg4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgZnVuY3Rpb24gcmVzZXRDaGFpbigpe2NoYWluPVswLjNdO3Byb3Bvc2VkPW51bGw7c3RlcFBoYXNlPVwiaWRsZVwiO2FjY2VwdGVkPW51bGw7c2FtcGxlcz1bXTtzdGVwQ291bnQ9MDtwcm9wU3RlcElkeD0wO2xhc3RBY2NlcHRlZEJpbj0tMTt9XHJcbiAgZnVuY3Rpb24gZG9TdGVwKCl7XHJcbiAgICBwcm9wb3NhbFNpZ21hPVNMLnNpZ21hLnZhbCgpO1xyXG4gICAgaWYoc3RlcFBoYXNlPT09XCJpZGxlXCIpe1xyXG4gICAgICBjb25zdCBjdXI9Y2hhaW5bY2hhaW4ubGVuZ3RoLTFdO1xyXG4gICAgICBsZXQgcHJvcD1jdXIrcmFuZG4oKSpwcm9wb3NhbFNpZ21hO1xyXG4gICAgICBwcm9wPU1hdGgubWF4KDAuMDAxLE1hdGgubWluKDAuOTk5LHByb3ApKTtcclxuICAgICAgcHJvcG9zZWQ9cHJvcDtwcm9wU3RlcElkeD1jaGFpbi5sZW5ndGg7XHJcbiAgICAgIGNvbnN0IHRDPXRhcmdldChjdXIpLHRQPXRhcmdldChwcm9wKTtcclxuICAgICAgYWNjZXB0UmF0aW89dEM+MD9NYXRoLm1pbigxLHRQL3RDKToxO1xyXG4gICAgICB1UmFuZD1NYXRoLnJhbmRvbSgpO3N0ZXBQaGFzZT1cInByb3Bvc2VkXCI7cmVuZGVyKCk7XHJcbiAgICB9IGVsc2UgaWYoc3RlcFBoYXNlPT09XCJwcm9wb3NlZFwiKXtcclxuICAgICAgYWNjZXB0ZWQ9dVJhbmQ8PWFjY2VwdFJhdGlvO3N0ZXBDb3VudCsrO1xyXG4gICAgICBzdGVwUGhhc2U9XCJkZWNpZGVkXCI7cmVuZGVyKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpZihhY2NlcHRlZCl7Y2hhaW4ucHVzaChwcm9wb3NlZCk7c2FtcGxlcy5wdXNoKHByb3Bvc2VkKTtsYXN0QWNjZXB0ZWRCaW49TWF0aC5taW4oTWF0aC5mbG9vcihwcm9wb3NlZC8oMS8zMCkpLDI5KTt9XHJcbiAgICAgIGVsc2V7Y2hhaW4ucHVzaChjaGFpbltjaGFpbi5sZW5ndGgtMV0pO2xhc3RBY2NlcHRlZEJpbj0tMTt9XHJcbiAgICAgIHByb3Bvc2VkPW51bGw7c3RlcFBoYXNlPVwiaWRsZVwiO3JlbmRlcigpO1xyXG4gICAgICBpZihhdXRvUnVubmluZylzZXRUaW1lb3V0KGRvU3RlcCw1MCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGZ1bmN0aW9uIGZ1bGxTdGVwKCl7XHJcbiAgICBwcm9wb3NhbFNpZ21hPVNMLnNpZ21hLnZhbCgpO1xyXG4gICAgY29uc3QgY3VyPWNoYWluW2NoYWluLmxlbmd0aC0xXTtcclxuICAgIGxldCBwcm9wPWN1cityYW5kbigpKnByb3Bvc2FsU2lnbWE7XHJcbiAgICBwcm9wPU1hdGgubWF4KDAuMDAxLE1hdGgubWluKDAuOTk5LHByb3ApKTtcclxuICAgIHByb3BTdGVwSWR4PWNoYWluLmxlbmd0aDtcclxuICAgIGNvbnN0IHRDPXRhcmdldChjdXIpLHRQPXRhcmdldChwcm9wKTtcclxuICAgIGFjY2VwdFJhdGlvPXRDPjA/TWF0aC5taW4oMSx0UC90Qyk6MTtcclxuICAgIHVSYW5kPU1hdGgucmFuZG9tKCk7YWNjZXB0ZWQ9dVJhbmQ8PWFjY2VwdFJhdGlvO3N0ZXBDb3VudCsrO1xyXG4gICAgaWYoYWNjZXB0ZWQpe2NoYWluLnB1c2gocHJvcCk7c2FtcGxlcy5wdXNoKHByb3ApO2xhc3RBY2NlcHRlZEJpbj1NYXRoLm1pbihNYXRoLmZsb29yKHByb3AvKDEvMzApKSwyOSk7fVxyXG4gICAgZWxzZXtjaGFpbi5wdXNoKGN1cik7bGFzdEFjY2VwdGVkQmluPS0xO31cclxuICAgIGlmKGNoYWluLmxlbmd0aD41MDApY2hhaW49Y2hhaW4uc2xpY2UoLTQwMCk7XHJcbiAgICBwcm9wb3NlZD1wcm9wO3N0ZXBQaGFzZT1cImRlY2lkZWRcIjtyZW5kZXIoKTtzdGVwUGhhc2U9XCJpZGxlXCI7XHJcbiAgfVxyXG5cclxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAgRVZFTlRTIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gIGZ1bmN0aW9uIHN0b3BBdXRvKCl7YXV0b1J1bm5pbmc9ZmFsc2U7Y2xlYXJJbnRlcnZhbChhdXRvVGltZXIpO2J0bkF1dG8udGV4dENvbnRlbnQ9XCLij6kgQ2jhuqF5IHThu7EgxJHhu5luZ1wiO2J0bkF1dG8uc3R5bGUuYmFja2dyb3VuZD1cImxpbmVhci1ncmFkaWVudCgxMzVkZWcsIzZBMUI5QSwjNkExQjlBZGQpXCI7fVxyXG4gIGJ0blN0ZXAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsKCk9PntpZihhdXRvUnVubmluZylzdG9wQXV0bygpO2RvU3RlcCgpO30pO1xyXG4gIGJ0bkF1dG8uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsKCk9PntcclxuICAgIGlmKGF1dG9SdW5uaW5nKXN0b3BBdXRvKCk7XHJcbiAgICBlbHNle2F1dG9SdW5uaW5nPXRydWU7YnRuQXV0by50ZXh0Q29udGVudD1cIuKPuCBU4bqhbSBk4burbmdcIjtidG5BdXRvLnN0eWxlLmJhY2tncm91bmQ9YGxpbmVhci1ncmFkaWVudCgxMzVkZWcsJHtDLnJlamVjdH0sJHtDLnJlamVjdH1kZClgO1xyXG4gICAgICBzdGVwUGhhc2U9XCJpZGxlXCI7YXV0b1RpbWVyPXNldEludGVydmFsKCgpPT57aWYoYXV0b1J1bm5pbmcpZnVsbFN0ZXAoKTtlbHNlIGNsZWFySW50ZXJ2YWwoYXV0b1RpbWVyKTt9LDgwKTt9XHJcbiAgfSk7XHJcbiAgYnRuUmVzZXQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsKCk9PntzdG9wQXV0bygpO3Jlc2V0Q2hhaW4oKTtyZW5kZXIoKTt9KTtcclxuICBTTC5zaWdtYS5pbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwoKT0+U0wuc2lnbWEuc3luYygpKTtcclxuXHJcbiAgLy8gTW9kZWwgY2hhbmdlcyDihpIgcmVidWlsZCBjdXJ2ZXMgKyByZXNldCBjaGFpblxyXG4gIGZ1bmN0aW9uIG9uTW9kZWwoKXtcclxuICAgIGZvcihjb25zdCBzIG9mIE9iamVjdC52YWx1ZXMoU0wpKXMuc3luYygpO1xyXG4gICAgY29uc3QgbkE9U0wucEEudmFsKCksbkI9U0wucEIudmFsKCksbks9U0wuZEsudmFsKCksbk49U0wuZE4udmFsKCk7XHJcbiAgICBpZihuSz5uTil7U0wuZEsuaW5wdXQudmFsdWU9bk47U0wuZEsuc3luYygpO31cclxuICAgIGNvbnN0IGRrPU1hdGgubWluKFNMLmRLLnZhbCgpLG5OKTtcclxuICAgIGlmKG5BIT09cHJpb3JBfHxuQiE9PXByaW9yQnx8ZGshPT1kYXRhS3x8bk4hPT1kYXRhTil7XHJcbiAgICAgIHByaW9yQT1uQTtwcmlvckI9bkI7ZGF0YUs9ZGs7ZGF0YU49bk47XHJcbiAgICAgIHJlY29tcHV0ZSgpO2RyYXdTdGF0aWMoKTtyZXNldENoYWluKCk7XHJcbiAgICB9XHJcbiAgICByZW5kZXIoKTtcclxuICB9XHJcbiAgW1NMLnBBLFNMLnBCLFNMLmRLLFNMLmROXS5mb3JFYWNoKHM9PnMuaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsb25Nb2RlbCkpO1xyXG5cclxuICAvLyBEaWFnbm9zdGljcyDihpIganVzdCByZS1yZW5kZXIgKG5vIHJlc2V0KVxyXG4gIFNMLmJ1cm5pbi5pbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwoKT0+e1NMLmJ1cm5pbi5zeW5jKCk7cmVuZGVyKCk7fSk7XHJcbiAgU0wudGhpbi5pbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwoKT0+e1NMLnRoaW4uc3luYygpO3JlbmRlcigpO30pO1xyXG4gIHRvZ0J1cm4uY2IuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLHJlbmRlcik7XHJcbiAgdG9nVGhpbi5jYi5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIscmVuZGVyKTtcclxuXHJcbiAgcmVuZGVyKCk7XHJcbiAgaW52YWxpZGF0aW9uLnRoZW4oKCk9PnthdXRvUnVubmluZz1mYWxzZTtjbGVhckludGVydmFsKGF1dG9UaW1lcik7fSk7XHJcbiAgb3V0ZXIudmFsdWU9e307cmV0dXJuIG91dGVyO1xyXG59XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBzaXIgPSB7XHJcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQIE1BVEggVVRJTElUSUVTIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gIGZ1bmN0aW9uIGxuR2FtbWEoeil7XHJcbiAgICBpZih6PDAuNSlyZXR1cm4gTWF0aC5sb2coTWF0aC5QSS9NYXRoLnNpbihNYXRoLlBJKnopKS1sbkdhbW1hKDEteik7XHJcbiAgICB6LS07Y29uc3QgYz1bMC45OTk5OTk5OTk5OTk4MDk5Myw2NzYuNTIwMzY4MTIxODg1MSwtMTI1OS4xMzkyMTY3MjI0MDI4LDc3MS4zMjM0Mjg3Nzc2NTMxMyxcclxuICAgICAgLTE3Ni42MTUwMjkxNjIxNDA1OSwxMi41MDczNDMyNzg2ODY5MDUsLTAuMTM4NTcxMDk1MjY1NzIwMTIsOS45ODQzNjk1NzgwMTk1NzE2ZS02LDEuNTA1NjMyNzM1MTQ5MzExNmUtN107XHJcbiAgICBsZXQgeD1jWzBdO2ZvcihsZXQgaT0xO2k8OTtpKyspeCs9Y1tpXS8oeitpKTtcclxuICAgIGNvbnN0IHQ9eis3LjU7cmV0dXJuIDAuNSpNYXRoLmxvZygyKk1hdGguUEkpKyh6KzAuNSkqTWF0aC5sb2codCktdCtNYXRoLmxvZyh4KTtcclxuICB9XHJcbiAgZnVuY3Rpb24gcmFuZG4oKXtsZXQgdT0wLHY9MDt3aGlsZSghdSl1PU1hdGgucmFuZG9tKCk7d2hpbGUoIXYpdj1NYXRoLnJhbmRvbSgpO3JldHVybiBNYXRoLnNxcnQoLTIqTWF0aC5sb2codSkpKk1hdGguY29zKDIqTWF0aC5QSSp2KTt9XHJcbiAgZnVuY3Rpb24gbXVsYmVycnkzMihzZWVkKXtyZXR1cm4gZnVuY3Rpb24oKXtzZWVkfD0wO3NlZWQ9c2VlZCsweDZEMkI3OUY1fDA7bGV0IHQ9TWF0aC5pbXVsKHNlZWRec2VlZD4+PjE1LDF8c2VlZCk7dD10K01hdGguaW11bCh0XnQ+Pj43LDYxfHQpXnQ7cmV0dXJuKCh0XnQ+Pj4xNCk+Pj4wKS80Mjk0OTY3Mjk2O307fVxyXG4gIGZ1bmN0aW9uIHJhbmRuU2VlZGVkKHJuZyl7bGV0IHU9MCx2PTA7d2hpbGUoIXUpdT1ybmcoKTt3aGlsZSghdil2PXJuZygpO3JldHVybiBNYXRoLnNxcnQoLTIqTWF0aC5sb2codSkpKk1hdGguY29zKDIqTWF0aC5QSSp2KTt9XHJcbiAgZnVuY3Rpb24gcG9pc3NvblJuZyhsYW0scm5nKXtcclxuICAgIGlmKGxhbTw9MClyZXR1cm4gMDtcclxuICAgIGlmKGxhbTwzMCl7Y29uc3QgTD1NYXRoLmV4cCgtbGFtKTtsZXQgaz0wLHA9MTtkb3trKys7cCo9cm5nKCk7fXdoaWxlKHA+TCk7cmV0dXJuIGstMTt9XHJcbiAgICByZXR1cm4gTWF0aC5tYXgoMCxNYXRoLnJvdW5kKGxhbStNYXRoLnNxcnQobGFtKSpyYW5kblNlZWRlZChybmcpKSk7XHJcbiAgfVxyXG4gIGZ1bmN0aW9uIG5vcm1hbFBERih4LG11LHMpe3JldHVybiBNYXRoLmV4cCgtMC41KigoeC1tdSkvcykqKjIpLyhzKk1hdGguc3FydCgyKk1hdGguUEkpKTt9XHJcblxyXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkCBTSVIgTU9ERUwg4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgZnVuY3Rpb24gc29sdmVTSVIoUjB2LGdhbSxzMCxpMCxyMCl7XHJcbiAgICBjb25zdCBOPXMwK2kwK3IwLGJldGE9UjB2KmdhbS9OLGR0PTEsdE1heD0zNjQ7XHJcbiAgICBjb25zdCBzb2w9W3t0OjAsUzpzMCxJOmkwLFI6cjB9XTtcclxuICAgIGxldCBTPXMwLEk9aTAsUj1yMDtcclxuICAgIGZvcihsZXQgdD0wO3Q8dE1heDt0Kyspe1xyXG4gICAgICBjb25zdCBmUz0ocyxpKT0+LWJldGEqcyppLCBmST0ocyxpKT0+YmV0YSpzKmktZ2FtKmk7XHJcbiAgICAgIGNvbnN0IGsxcz1mUyhTLEkpLGsxaT1mSShTLEkpO1xyXG4gICAgICBjb25zdCBrMnM9ZlMoUysuNSprMXMsSSsuNSprMWkpLGsyaT1mSShTKy41KmsxcyxJKy41KmsxaSk7XHJcbiAgICAgIGNvbnN0IGszcz1mUyhTKy41KmsycyxJKy41KmsyaSksazNpPWZJKFMrLjUqazJzLEkrLjUqazJpKTtcclxuICAgICAgY29uc3QgazRzPWZTKFMrazNzLEkrazNpKSxrNGk9ZkkoUytrM3MsSStrM2kpO1xyXG4gICAgICBTKz0oazFzKzIqazJzKzIqazNzK2s0cykvNjsgSSs9KGsxaSsyKmsyaSsyKmszaStrNGkpLzY7XHJcbiAgICAgIFM9TWF0aC5tYXgoMCxNYXRoLm1pbihOLFMpKTsgST1NYXRoLm1heCgwLE1hdGgubWluKE4sSSkpOyBSPU4tUy1JO1xyXG4gICAgICBzb2wucHVzaCh7dDp0KzEsUyxJLFJ9KTtcclxuICAgIH1cclxuICAgIHJldHVybiBzb2w7XHJcbiAgfVxyXG4gIGZ1bmN0aW9uIHdlZWtseUluYyhzb2wpe1xyXG4gICAgY29uc3Qgdz1bXTtmb3IobGV0IGk9MDtpPDUyO2krKyl7bGV0IHM9MDtmb3IobGV0IGQ9MDtkPDc7ZCsrKXtjb25zdCBqPWkqNytkO3MrPU1hdGgubWF4KDAsc29sW2pdLlMtc29sW2orMV0uUyk7fXcucHVzaChzKTt9cmV0dXJuIHc7XHJcbiAgfVxyXG4gIGZ1bmN0aW9uIGxvZ0xpayhvYnMscHJlZCl7XHJcbiAgICBsZXQgbGw9MDtmb3IobGV0IGk9MDtpPG9icy5sZW5ndGg7aSsrKXtjb25zdCBsYW09TWF0aC5tYXgocHJlZFtpXSwxZS0xMCk7bGwrPW9ic1tpXSpNYXRoLmxvZyhsYW0pLWxhbS1sbkdhbW1hKG9ic1tpXSsxKTt9cmV0dXJuIGxsO1xyXG4gIH1cclxuXHJcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQIERBVEEgR0VORVJBVElPTiDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcclxuICBjb25zdCBUUlVFX1IwPTEuNSwgVFJVRV9HQU09MC4yLCBTMD05OTksIEkwPTEsIFIwUD0wO1xyXG4gIGNvbnN0IFIwX0xPPTEsUjBfSEk9NSwgR0FNX0xPPTAuMDUsR0FNX0hJPTAuODtcclxuICBjb25zdCB0cnVlU29sPXNvbHZlU0lSKFRSVUVfUjAsVFJVRV9HQU0sUzAsSTAsUjBQKTtcclxuICBjb25zdCB0cnVlV2Vla2x5PXdlZWtseUluYyh0cnVlU29sKTtcclxuICBjb25zdCBybmc9bXVsYmVycnkzMig0Mik7XHJcbiAgY29uc3Qgb2JzRGF0YT10cnVlV2Vla2x5Lm1hcChsPT5wb2lzc29uUm5nKGwscm5nKSk7XHJcblxyXG4gIGZ1bmN0aW9uIHRhcmdldExMKHIwLGdhbSl7XHJcbiAgICBpZihyMDxSMF9MT3x8cjA+UjBfSEl8fGdhbTxHQU1fTE98fGdhbT5HQU1fSEkpcmV0dXJuLUluZmluaXR5O1xyXG4gICAgdHJ5e2NvbnN0IHM9c29sdmVTSVIocjAsZ2FtLFMwLEkwLFIwUCk7Y29uc3QgcD13ZWVrbHlJbmMocyk7Y29uc3QgbGw9bG9nTGlrKG9ic0RhdGEscCk7cmV0dXJuIGlzRmluaXRlKGxsKT9sbDotSW5maW5pdHk7fVxyXG4gICAgY2F0Y2goZSl7cmV0dXJuLUluZmluaXR5O31cclxuICB9XHJcblxyXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkCBQQUxFVFRFIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gIGNvbnN0IEM9e2N1cnJlbnQ6XCIjMTU2NUMwXCIscHJvcG9zZTpcIiNFNjUxMDBcIixhY2NlcHQ6XCIjMkU3RDMyXCIscmVqZWN0OlwiI0M2MjgyOFwiLFxyXG4gICAgZGF0YTpcIiNGRjk4MDBcIixkYXRhU3Ryb2tlOlwiI0Y1N0MwMFwiLG1vZGVsOlwiIzE1NjVDMFwiLG1vZGVsTGlnaHQ6XCIjOTBDQUY5XCIsXHJcbiAgICB0cmFjZVIwOlwiIzE1NjVDMFwiLHRyYWNlR2FtOlwiIzAwODk3QlwiLHRydWVMaW5lOlwiI0U1MzkzNVwiLFxyXG4gICAgaGlzdDpcIiMxNTY1QzBcIixoaXN0U3Ryb2tlOlwiIzBENDdBMVwiLGhpc3RHYW06XCIjMDA4OTdCXCIsaGlzdEdhbVN0cm9rZTpcIiMwMDY5NUNcIixcclxuICAgIHNjYXR0ZXI6XCIjNDJBNUY1XCIsc2NhdHRlckFjY2VwdDpcIiM2NkJCNkFcIixcclxuICAgIHR4dDpcIiMyMTIxMjFcIixzdWI6XCIjOUU5RTlFXCIsYm9yZGVyOlwiI0UwRTBFMFwiLGJnOlwiI0ZBRkFGQVwifTtcclxuICBjb25zdCBtb25vPVwiJ1NGIE1vbm8nLFNGTW9uby1SZWd1bGFyLE1lbmxvLG1vbm9zcGFjZVwiO1xyXG5cclxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAgU1RBVEUg4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgbGV0IGNoYWluPVt7UjA6Mi41LGdhbW1hOjAuMTV9XSwgc3RlcFBoYXNlPVwiaWRsZVwiLCBzdGVwQ291bnQ9MCwgbkFjYz0wO1xyXG4gIGxldCBwcm9wb3NlZFIwPW51bGwsIHByb3Bvc2VkR2FtPW51bGwsIGN1ckxMPW51bGwsIHByb3BMTD1udWxsO1xyXG4gIGxldCBsb2dBbHBoYT0wLCB1UmFuZD0wLCBhY2NlcHRlZD1mYWxzZTtcclxuICBsZXQgYXV0b1J1bm5pbmc9ZmFsc2UsIGF1dG9UaW1lcj1udWxsO1xyXG4gIGxldCBzaWdSMD0wLjE1LCBzaWdHYW09MC4wMywgYXV0b1NwZWVkPTIwMDtcclxuXHJcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQIFdSQVBQRVIg4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgY29uc3Qgb3V0ZXI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICBvdXRlci5zdHlsZS5jc3NUZXh0PWBkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1uO2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6MTJweDtcclxuICAgIGZvbnQtZmFtaWx5OidJbnRlcicsLWFwcGxlLXN5c3RlbSxCbGlua01hY1N5c3RlbUZvbnQsXCJTZWdvZSBVSVwiLFJvYm90byxzYW5zLXNlcmlmO1xyXG4gICAgd2lkdGg6MTAwJTttYXgtd2lkdGg6OTIwcHg7bWFyZ2luOjAgYXV0bztgO1xyXG4gIGlmKCFkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdsaW5rW2hyZWYqPVwiSW50ZXJcIl0nKSl7XHJcbiAgICBjb25zdCBsaz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaW5rJyk7bGsucmVsPSdzdHlsZXNoZWV0JztcclxuICAgIGxrLmhyZWY9J2h0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzMj9mYW1pbHk9SW50ZXI6d2dodEA0MDA7NTAwOzYwMDs3MDA7ODAwJmRpc3BsYXk9c3dhcCc7XHJcbiAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKGxrKTtcclxuICB9XHJcbiAgb3V0ZXIuYXBwZW5kQ2hpbGQoaW5qZWN0U3R5bGUoKSk7XHJcblxyXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkCBDT05UUk9MUyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcclxuICBjb25zdCBjdHJsUm93PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgY3RybFJvdy5zdHlsZS5jc3NUZXh0PVwiZGlzcGxheTpmbGV4O2dhcDoxMHB4O3dpZHRoOjEwMCU7YWxpZ24taXRlbXM6Y2VudGVyO2ZsZXgtd3JhcDp3cmFwO1wiO1xyXG4gIGZ1bmN0aW9uIG1rQnRuKHRleHQsY29sb3IsYmlnKXtcclxuICAgIGNvbnN0IGI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICAgIGIuc3R5bGUuY3NzVGV4dD1gcGFkZGluZzoke2JpZz9cIjEwcHggMjhweFwiOlwiN3B4IDE2cHhcIn07Ym9yZGVyLXJhZGl1czoke2JpZz8xMjoxMH1weDtib3JkZXI6bm9uZTtcclxuICAgICAgYmFja2dyb3VuZDpsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCR7Y29sb3J9LCR7Y29sb3J9ZGQpO2NvbG9yOiNmZmY7Zm9udC1zaXplOiR7YmlnPzE1OjEzfXB4O2ZvbnQtd2VpZ2h0OjcwMDtjdXJzb3I6cG9pbnRlcjtcclxuICAgICAgZm9udC1mYW1pbHk6aW5oZXJpdDt0cmFuc2l0aW9uOmFsbCAwLjJzIGVhc2U7bGV0dGVyLXNwYWNpbmc6MC4zcHg7XHJcbiAgICAgICR7YmlnP1wiYm94LXNoYWRvdzowIDRweCAxNHB4IFwiK2NvbG9yK1wiNDQ7XCI6XCJib3gtc2hhZG93OjAgMnB4IDhweCByZ2JhKDAsMCwwLDAuMTIpO1wifWA7XHJcbiAgICBiLnRleHRDb250ZW50PXRleHQ7XHJcbiAgICBiLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZW50ZXInLCgpPT57Yi5zdHlsZS50cmFuc2Zvcm09J3RyYW5zbGF0ZVkoLTFweCknO2Iuc3R5bGUuYm94U2hhZG93PWAwIDZweCAyMHB4ICR7Y29sb3J9NTVgO30pO1xyXG4gICAgYi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywoKT0+e2Iuc3R5bGUudHJhbnNmb3JtPSd0cmFuc2xhdGVZKDApJztiLnN0eWxlLmJveFNoYWRvdz1iaWc/YDAgNHB4IDE0cHggJHtjb2xvcn00NGA6JzAgMnB4IDhweCByZ2JhKDAsMCwwLDAuMTIpJzt9KTtcclxuICAgIHJldHVybiBiO1xyXG4gIH1cclxuICBjb25zdCBidG5TdGVwPW1rQnRuKFwi4pa2ICBCxrDhu5tjIHRp4bq/cCB0aGVvXCIsQy5jdXJyZW50LHRydWUpO1xyXG4gIGNvbnN0IGJ0bkF1dG89bWtCdG4oXCLij6kgQ2jhuqF5IHThu7EgxJHhu5luZ1wiLFwiIzZBMUI5QVwiLGZhbHNlKTtcclxuICBjb25zdCBidG5SZXNldD1ta0J0bihcIuKGuiDEkOG6t3QgbOG6oWlcIixcIiM3ODkwOUNcIixmYWxzZSk7XHJcbiAgY29uc3Qgc3RlcExhYmVsPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gIHN0ZXBMYWJlbC5zdHlsZS5jc3NUZXh0PWBmb250LXNpemU6MTNweDtmb250LXdlaWdodDo3MDA7Y29sb3I6JHtDLnN1Yn07Zm9udC1mYW1pbHk6JHttb25vfTttYXJnaW4tbGVmdDphdXRvO2A7XHJcbiAgY3RybFJvdy5hcHBlbmQoYnRuU3RlcCxidG5BdXRvLGJ0blJlc2V0LHN0ZXBMYWJlbCk7XHJcbiAgb3V0ZXIuYXBwZW5kQ2hpbGQoY3RybFJvdyk7XHJcblxyXG4gIC8vIOKUgOKUgCBTTElERVJTIOKUgOKUgFxyXG4gIGNvbnN0IFNMPXt9O1xyXG4gIFNMLnNpZ1IwPWNyZWF0ZVNsaWRlcihcIlByb3Bvc2FsIM+DKFLigoApXCIsMC4wMSwwLjUwLDAuMDEsMC4xNSxDLnByb3Bvc2UsXCJhbWJlclwiKTtcclxuICBTTC5zaWdHYW09Y3JlYXRlU2xpZGVyKFwiUHJvcG9zYWwgz4MozrMpXCIsMC4wMDUsMC4xMCwwLjAwNSwwLjAzMCxDLnByb3Bvc2UsXCJhbWJlclwiKTtcclxuICBTTC5zcGVlZD1jcmVhdGVTbGlkZXIoXCJU4buRYyDEkeG7mSAobXMvYsaw4bubYylcIiw1MCw1MDAsMTAsMjAwLFwiIzZBMUI5QVwiLFwicHVycGxlXCIpO1xyXG4gIGNvbnN0IHNyMT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO3NyMS5zdHlsZS5jc3NUZXh0PVwiZGlzcGxheTpmbGV4O2dhcDoxNHB4O3dpZHRoOjEwMCU7XCI7XHJcbiAgc3IxLmFwcGVuZChTTC5zaWdSMC5lbCxTTC5zaWdHYW0uZWwsU0wuc3BlZWQuZWwpO1xyXG4gIG91dGVyLmFwcGVuZENoaWxkKHNyMSk7XHJcblxyXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkCBNQUlOIFNWRyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcclxuICBjb25zdCBXPTkyMCxtYWluSD0zNjAsZ2FwPTQwO1xyXG4gIGNvbnN0IHBXPU1hdGguZmxvb3IoKFctZ2FwKS8yKTtcclxuICBjb25zdCBNPXt0OjMwLGI6MzgsbDo1MCxyOjE1fTtcclxuICBjb25zdCBpVz1wVy1NLmwtTS5yLCBpSD1tYWluSC1NLnQtTS5iO1xyXG4gIC8vIFRyYWNlIGFyZWE6IGxlZnQgcGFydCA9IHRyYWNlIGxpbmUsIHJpZ2h0IHBhcnQgPSBkZW5zaXR5IGhpc3RvZ3JhbVxyXG4gIGNvbnN0IGRlbnNXPTYwOyAvLyB3aWR0aCByZXNlcnZlZCBmb3IgZGVuc2l0eVxyXG4gIGNvbnN0IHRHYXA9NDIsdEg9TWF0aC5mbG9vcigobWFpbkgtdEdhcCkvMik7XHJcbiAgY29uc3QgdE09e3Q6MjQsYjo4fSx0TWI9e3Q6OCxiOjMwfTtcclxuICBjb25zdCB0SUg9dEgtdE0udC10TS5iLCB0SUhiPXRILXRNYi50LXRNYi5iO1xyXG4gIGNvbnN0IHRJVz1wVy1NLmwtTS5yLWRlbnNXLTg7IC8vIHRyYWNlIGlubmVyIHdpZHRoIChsZWF2ZSByb29tIGZvciBkZW5zaXR5KVxyXG5cclxuICBjb25zdCBtYWluU3ZnPWQzLmNyZWF0ZShcInN2Z1wiKS5hdHRyKFwidmlld0JveFwiLGAwIDAgJHtXfSAke21haW5IfWApXHJcbiAgICAuc3R5bGUoXCJ3aWR0aFwiLFwiMTAwJVwiKS5zdHlsZShcIm1heC13aWR0aFwiLFcrXCJweFwiKTtcclxuXHJcbiAgLy8g4pSA4pSAIENsaXAgcGF0aCBmb3IgaW5jaWRlbmNlIHBsb3Qg4pSA4pSAXHJcbiAgY29uc3QgY2xpcElkPVwiaW5jLWNsaXAtXCIrTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiw4KTtcclxuICBtYWluU3ZnLmFwcGVuZChcImRlZnNcIikuYXBwZW5kKFwiY2xpcFBhdGhcIikuYXR0cihcImlkXCIsY2xpcElkKVxyXG4gICAgLmFwcGVuZChcInJlY3RcIikuYXR0cihcInhcIiwwKS5hdHRyKFwieVwiLDApLmF0dHIoXCJ3aWR0aFwiLGlXKS5hdHRyKFwiaGVpZ2h0XCIsaUgpO1xyXG5cclxuICAvLyDilIDilIAgTEVGVDogSW5jaWRlbmNlIHBsb3Qg4pSA4pSAXHJcbiAgY29uc3QgZ0luYz1tYWluU3ZnLmFwcGVuZChcImdcIikuYXR0cihcInRyYW5zZm9ybVwiLGB0cmFuc2xhdGUoJHtNLmx9LCR7TS50fSlgKTtcclxuICBjb25zdCB4SW5jPWQzLnNjYWxlTGluZWFyKCkuZG9tYWluKFsxLDUyXSkucmFuZ2UoWzAsaVddKTtcclxuICBsZXQgeU1heD1kMy5tYXgob2JzRGF0YSkqMS4zO1xyXG4gIGxldCB5SW5jPWQzLnNjYWxlTGluZWFyKCkuZG9tYWluKFswLHlNYXhdKS5yYW5nZShbaUgsMF0pO1xyXG4gIGNvbnN0IGluY0F4aXNYPWdJbmMuYXBwZW5kKFwiZ1wiKS5hdHRyKFwidHJhbnNmb3JtXCIsYHRyYW5zbGF0ZSgwLCR7aUh9KWApO1xyXG4gIGNvbnN0IGluY0F4aXNZPWdJbmMuYXBwZW5kKFwiZ1wiKTtcclxuICBmdW5jdGlvbiBkcmF3SW5jQXhlcygpe1xyXG4gICAgaW5jQXhpc1guY2FsbChkMy5heGlzQm90dG9tKHhJbmMpLnRpY2tzKDgpLnRpY2tTaXplKC1pSCkudGlja0Zvcm1hdChkMy5mb3JtYXQoXCJkXCIpKSlcclxuICAgICAgLmNhbGwoZz0+e2cuc2VsZWN0QWxsKFwiLnRpY2sgbGluZVwiKS5hdHRyKFwic3Ryb2tlXCIsXCIjZWVlXCIpO2cuc2VsZWN0KFwiLmRvbWFpblwiKS5hdHRyKFwic3Ryb2tlXCIsQy5ib3JkZXIpO30pO1xyXG4gICAgaW5jQXhpc1kuY2FsbChkMy5heGlzTGVmdCh5SW5jKS50aWNrcyg2KS50aWNrU2l6ZSgtaVcpKVxyXG4gICAgICAuY2FsbChnPT57Zy5zZWxlY3RBbGwoXCIudGljayBsaW5lXCIpLmF0dHIoXCJzdHJva2VcIixcIiNlZWVcIik7Zy5zZWxlY3QoXCIuZG9tYWluXCIpLmF0dHIoXCJzdHJva2VcIixDLmJvcmRlcik7fSk7XHJcbiAgfVxyXG4gIGRyYXdJbmNBeGVzKCk7XHJcbiAgZ0luYy5hcHBlbmQoXCJ0ZXh0XCIpLmF0dHIoXCJ4XCIsaVcvMikuYXR0cihcInlcIiwtMTIpLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLFwibWlkZGxlXCIpXHJcbiAgICAuYXR0cihcImZvbnQtc2l6ZVwiLDEzKS5hdHRyKFwiZm9udC13ZWlnaHRcIiw3MDApLmF0dHIoXCJmaWxsXCIsQy50eHQpLnRleHQoXCJE4buvIGxp4buHdSAmIEThu7EgxJFvw6FuIG3DtCBow6xuaFwiKTtcclxuICBnSW5jLmFwcGVuZChcInRleHRcIikuYXR0cihcInhcIixpVy8yKS5hdHRyKFwieVwiLGlIKzMyKS5hdHRyKFwidGV4dC1hbmNob3JcIixcIm1pZGRsZVwiKVxyXG4gICAgLmF0dHIoXCJmb250LXNpemVcIiwxMCkuYXR0cihcImZpbGxcIixDLnN1YikudGV4dChcIlR14bqnblwiKTtcclxuICBnSW5jLmFwcGVuZChcInRleHRcIikuYXR0cihcInRyYW5zZm9ybVwiLFwicm90YXRlKC05MClcIikuYXR0cihcInhcIiwtaUgvMikuYXR0cihcInlcIiwtMzgpXHJcbiAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsXCJtaWRkbGVcIikuYXR0cihcImZvbnQtc2l6ZVwiLDEwKS5hdHRyKFwiZmlsbFwiLEMuc3ViKS50ZXh0KFwiU+G7kSBjYSBt4bubaSAvIHR14bqnblwiKTtcclxuXHJcbiAgLy8gY2xpcHBlZCBjb250ZW50IGdyb3VwXHJcbiAgY29uc3QgZ0luY0NsaXA9Z0luYy5hcHBlbmQoXCJnXCIpLmF0dHIoXCJjbGlwLXBhdGhcIixgdXJsKCMke2NsaXBJZH0pYCk7XHJcbiAgZ0luY0NsaXAuc2VsZWN0QWxsKFwiLm9icy1kb3RcIikuZGF0YShvYnNEYXRhKS5qb2luKFwiY2lyY2xlXCIpLmF0dHIoXCJjbGFzc1wiLFwib2JzLWRvdFwiKVxyXG4gICAgLmF0dHIoXCJjeFwiLChkLGkpPT54SW5jKGkrMSkpLmF0dHIoXCJjeVwiLGQ9PnlJbmMoZCkpLmF0dHIoXCJyXCIsMy41KVxyXG4gICAgLmF0dHIoXCJmaWxsXCIsQy5kYXRhKS5hdHRyKFwic3Ryb2tlXCIsQy5kYXRhU3Ryb2tlKS5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsMSkuYXR0cihcIm9wYWNpdHlcIiwwLjkpO1xyXG4gIGNvbnN0IG1vZGVsTGluZT1nSW5jQ2xpcC5hcHBlbmQoXCJwYXRoXCIpLmF0dHIoXCJmaWxsXCIsXCJub25lXCIpLmF0dHIoXCJzdHJva2VcIixDLm1vZGVsKS5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsMi41KS5hdHRyKFwib3BhY2l0eVwiLDAuODUpO1xyXG4gIGNvbnN0IHByb3BMaW5lPWdJbmNDbGlwLmFwcGVuZChcInBhdGhcIikuYXR0cihcImZpbGxcIixcIm5vbmVcIikuYXR0cihcInN0cm9rZVwiLEMucHJvcG9zZSkuYXR0cihcInN0cm9rZS13aWR0aFwiLDIpXHJcbiAgICAuYXR0cihcInN0cm9rZS1kYXNoYXJyYXlcIixcIjYsNFwiKS5hdHRyKFwib3BhY2l0eVwiLDApO1xyXG5cclxuICAvLyDilIDilIAgUklHSFQ6IFRyYWNlIHBsb3RzICsgZGVuc2l0eSDilIDilIBcclxuICBmdW5jdGlvbiBtYWtlVHJhY2VQYW5lbChnLGNvbG9yLGhpc3RDb2xvcixoaXN0U3Ryb2tlLGxhYmVsLHRydWVWYWwsaW5uZXJILG1hcmdpbnMpe1xyXG4gICAgY29uc3QgeFRyPWQzLnNjYWxlTGluZWFyKCkuZG9tYWluKFswLDEwXSkucmFuZ2UoWzAsdElXXSk7XHJcbiAgICBjb25zdCB5VHI9ZDMuc2NhbGVMaW5lYXIoKS5kb21haW4oW3RydWVWYWwtMC41LHRydWVWYWwrMC41XSkucmFuZ2UoW2lubmVySCwwXSk7XHJcbiAgICBjb25zdCBheFg9Zy5hcHBlbmQoXCJnXCIpLmF0dHIoXCJ0cmFuc2Zvcm1cIixgdHJhbnNsYXRlKDAsJHtpbm5lckh9KWApO1xyXG4gICAgY29uc3QgYXhZPWcuYXBwZW5kKFwiZ1wiKTtcclxuICAgIGcuYXBwZW5kKFwidGV4dFwiKS5hdHRyKFwieFwiLHRJVy8yKS5hdHRyKFwieVwiLC04KS5hdHRyKFwidGV4dC1hbmNob3JcIixcIm1pZGRsZVwiKVxyXG4gICAgICAuYXR0cihcImZvbnQtc2l6ZVwiLDExKS5hdHRyKFwiZm9udC13ZWlnaHRcIiw3MDApLmF0dHIoXCJmaWxsXCIsQy50eHQpLnRleHQobGFiZWwpO1xyXG4gICAgY29uc3QgdHJ1ZUxuPWcuYXBwZW5kKFwibGluZVwiKS5hdHRyKFwieDFcIiwwKS5hdHRyKFwieDJcIix0SVcpXHJcbiAgICAgIC5hdHRyKFwic3Ryb2tlXCIsQy50cnVlTGluZSkuYXR0cihcInN0cm9rZS13aWR0aFwiLDEuNSkuYXR0cihcInN0cm9rZS1kYXNoYXJyYXlcIixcIjQsM1wiKS5hdHRyKFwib3BhY2l0eVwiLDAuNyk7XHJcbiAgICBjb25zdCB0cmFjZVBhdGg9Zy5hcHBlbmQoXCJwYXRoXCIpLmF0dHIoXCJmaWxsXCIsXCJub25lXCIpLmF0dHIoXCJzdHJva2VcIixjb2xvcikuYXR0cihcInN0cm9rZS13aWR0aFwiLDEuNSk7XHJcbiAgICBjb25zdCBjdXJEb3Q9Zy5hcHBlbmQoXCJjaXJjbGVcIikuYXR0cihcInJcIiw0KS5hdHRyKFwiZmlsbFwiLGNvbG9yKS5hdHRyKFwic3Ryb2tlXCIsXCIjZmZmXCIpLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwyKTtcclxuICAgIGNvbnN0IHByb3BEb3Q9Zy5hcHBlbmQoXCJjaXJjbGVcIikuYXR0cihcInJcIiw0KS5hdHRyKFwiZmlsbFwiLFwibm9uZVwiKS5hdHRyKFwic3Ryb2tlXCIsQy5wcm9wb3NlKS5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsMikuYXR0cihcIm9wYWNpdHlcIiwwKTtcclxuICAgIC8vIGRlbnNpdHkgaGlzdG9ncmFtIGdyb3VwICh0byB0aGUgcmlnaHQgb2YgdHJhY2UpXHJcbiAgICBjb25zdCBnRGVucz1nLmFwcGVuZChcImdcIikuYXR0cihcInRyYW5zZm9ybVwiLGB0cmFuc2xhdGUoJHt0SVcrOH0sMClgKTtcclxuICAgIGNvbnN0IGRlbnNQYXRoPWdEZW5zLmFwcGVuZChcInBhdGhcIikuYXR0cihcImZpbGxcIixoaXN0Q29sb3IpLmF0dHIoXCJmaWxsLW9wYWNpdHlcIiwwLjM1KS5hdHRyKFwic3Ryb2tlXCIsaGlzdFN0cm9rZSkuYXR0cihcInN0cm9rZS13aWR0aFwiLDEuMik7XHJcbiAgICBjb25zdCBkZW5zVHJ1ZUxuPWdEZW5zLmFwcGVuZChcImxpbmVcIikuYXR0cihcInN0cm9rZVwiLEMudHJ1ZUxpbmUpLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwxLjUpLmF0dHIoXCJzdHJva2UtZGFzaGFycmF5XCIsXCI0LDNcIikuYXR0cihcIm9wYWNpdHlcIiwwLjcpO1xyXG4gICAgcmV0dXJuIHt4VHIseVRyLGF4WCxheFksdHJ1ZUxuLHRyYWNlUGF0aCxjdXJEb3QscHJvcERvdCxpbm5lckgsbWFyZ2lucyx0cnVlVmFsLGRlbnNQYXRoLGRlbnNUcnVlTG4sZ0RlbnN9O1xyXG4gIH1cclxuICBjb25zdCBnVHJSMD1tYWluU3ZnLmFwcGVuZChcImdcIikuYXR0cihcInRyYW5zZm9ybVwiLGB0cmFuc2xhdGUoJHtwVytnYXArTS5sfSwke3RNLnR9KWApO1xyXG4gIGNvbnN0IGdUckdhbT1tYWluU3ZnLmFwcGVuZChcImdcIikuYXR0cihcInRyYW5zZm9ybVwiLGB0cmFuc2xhdGUoJHtwVytnYXArTS5sfSwke3RIK3RHYXArdE1iLnR9KWApO1xyXG4gIGNvbnN0IHRyUjA9bWFrZVRyYWNlUGFuZWwoZ1RyUjAsQy50cmFjZVIwLEMuaGlzdCxDLmhpc3RTdHJva2UsXCJDaHXhu5dpIFLigoBcIixUUlVFX1IwLHRJSCx0TSk7XHJcbiAgY29uc3QgdHJHYW09bWFrZVRyYWNlUGFuZWwoZ1RyR2FtLEMudHJhY2VHYW0sQy5oaXN0R2FtLEMuaGlzdEdhbVN0cm9rZSxcIkNodeG7l2kgzrNcIixUUlVFX0dBTSx0SUhiLHRNYik7XHJcbiAgZ1RyR2FtLmFwcGVuZChcInRleHRcIikuYXR0cihcInhcIix0SVcvMikuYXR0cihcInlcIix0SUhiKzI1KS5hdHRyKFwidGV4dC1hbmNob3JcIixcIm1pZGRsZVwiKVxyXG4gICAgLmF0dHIoXCJmb250LXNpemVcIiwxMCkuYXR0cihcImZpbGxcIixDLnN1YikudGV4dChcIkLGsOG7m2NcIik7XHJcblxyXG4gIG91dGVyLmFwcGVuZENoaWxkKG1haW5Tdmcubm9kZSgpKTtcclxuXHJcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQIFNUQVRVUyBCT1gg4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgY29uc3Qgc3RhdHVzQm94PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgc3RhdHVzQm94LnN0eWxlLmNzc1RleHQ9YHdpZHRoOjEwMCU7cGFkZGluZzoxNHB4IDE4cHg7Ym9yZGVyLXJhZGl1czoxNHB4O2JvcmRlcjoxLjVweCBzb2xpZCAke0MuYm9yZGVyfTtcclxuICAgIGJhY2tncm91bmQ6I2ZmZjtmb250LWZhbWlseToke21vbm99O2ZvbnQtc2l6ZToxM3B4O2NvbG9yOiR7Qy50eHR9O21pbi1oZWlnaHQ6NDBweDtcclxuICAgIGJveC1zaGFkb3c6MCAycHggMTBweCByZ2JhKDAsMCwwLDAuMDQpO3RyYW5zaXRpb246Ym9yZGVyLWNvbG9yIDAuM3M7YDtcclxuICBvdXRlci5hcHBlbmRDaGlsZChzdGF0dXNCb3gpO1xyXG5cclxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAgU0NBVFRFUiBTVkcg4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgY29uc3Qgc2NXPTQyMCxzY0g9MjgwLHNjTT17dDoyMCxiOjM1LGw6NTAscjoxNX07XHJcbiAgY29uc3Qgc2NJVz1zY1ctc2NNLmwtc2NNLnIsc2NJSD1zY0gtc2NNLnQtc2NNLmI7XHJcbiAgY29uc3Qgc2NhdFN2Zz1kMy5jcmVhdGUoXCJzdmdcIikuYXR0cihcInZpZXdCb3hcIixgMCAwICR7c2NXfSAke3NjSH1gKVxyXG4gICAgLnN0eWxlKFwid2lkdGhcIixcIjEwMCVcIikuc3R5bGUoXCJtYXgtd2lkdGhcIixzY1crXCJweFwiKTtcclxuICBjb25zdCBnU2NhdD1zY2F0U3ZnLmFwcGVuZChcImdcIikuYXR0cihcInRyYW5zZm9ybVwiLGB0cmFuc2xhdGUoJHtzY00ubH0sJHtzY00udH0pYCk7XHJcbiAgY29uc3QgeFNjPWQzLnNjYWxlTGluZWFyKCkuZG9tYWluKFtHQU1fTE8sR0FNX0hJXSkucmFuZ2UoWzAsc2NJV10pO1xyXG4gIGNvbnN0IHlTYz1kMy5zY2FsZUxpbmVhcigpLmRvbWFpbihbUjBfTE8sUjBfSEldKS5yYW5nZShbc2NJSCwwXSk7XHJcbiAgZ1NjYXQuYXBwZW5kKFwiZ1wiKS5hdHRyKFwidHJhbnNmb3JtXCIsYHRyYW5zbGF0ZSgwLCR7c2NJSH0pYCkuY2FsbChkMy5heGlzQm90dG9tKHhTYykudGlja3MoNikudGlja1NpemUoLXNjSUgpKVxyXG4gICAgLmNhbGwoZz0+e2cuc2VsZWN0QWxsKFwiLnRpY2sgbGluZVwiKS5hdHRyKFwic3Ryb2tlXCIsXCIjZWVlXCIpO2cuc2VsZWN0KFwiLmRvbWFpblwiKS5hdHRyKFwic3Ryb2tlXCIsQy5ib3JkZXIpO30pO1xyXG4gIGdTY2F0LmFwcGVuZChcImdcIikuY2FsbChkMy5heGlzTGVmdCh5U2MpLnRpY2tzKDYpLnRpY2tTaXplKC1zY0lXKSlcclxuICAgIC5jYWxsKGc9PntnLnNlbGVjdEFsbChcIi50aWNrIGxpbmVcIikuYXR0cihcInN0cm9rZVwiLFwiI2VlZVwiKTtnLnNlbGVjdChcIi5kb21haW5cIikuYXR0cihcInN0cm9rZVwiLEMuYm9yZGVyKTt9KTtcclxuICBnU2NhdC5hcHBlbmQoXCJ0ZXh0XCIpLmF0dHIoXCJ4XCIsc2NJVy8yKS5hdHRyKFwieVwiLC02KS5hdHRyKFwidGV4dC1hbmNob3JcIixcIm1pZGRsZVwiKVxyXG4gICAgLmF0dHIoXCJmb250LXNpemVcIiwxMikuYXR0cihcImZvbnQtd2VpZ2h0XCIsNzAwKS5hdHRyKFwiZmlsbFwiLEMudHh0KS50ZXh0KFwiS2jDtG5nIGdpYW4gdGhhbSBz4buRXCIpO1xyXG4gIGdTY2F0LmFwcGVuZChcInRleHRcIikuYXR0cihcInhcIixzY0lXLzIpLmF0dHIoXCJ5XCIsc2NJSCszMCkuYXR0cihcInRleHQtYW5jaG9yXCIsXCJtaWRkbGVcIilcclxuICAgIC5hdHRyKFwiZm9udC1zaXplXCIsMTApLmF0dHIoXCJmaWxsXCIsQy5zdWIpLnRleHQoXCLOs1wiKTtcclxuICBnU2NhdC5hcHBlbmQoXCJ0ZXh0XCIpLmF0dHIoXCJ0cmFuc2Zvcm1cIixcInJvdGF0ZSgtOTApXCIpLmF0dHIoXCJ4XCIsLXNjSUgvMikuYXR0cihcInlcIiwtMzgpXHJcbiAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsXCJtaWRkbGVcIikuYXR0cihcImZvbnQtc2l6ZVwiLDEwKS5hdHRyKFwiZmlsbFwiLEMuc3ViKS50ZXh0KFwiUuKCgFwiKTtcclxuICBnU2NhdC5hcHBlbmQoXCJsaW5lXCIpLmF0dHIoXCJ4MVwiLHhTYyhUUlVFX0dBTSktOCkuYXR0cihcIngyXCIseFNjKFRSVUVfR0FNKSs4KVxyXG4gICAgLmF0dHIoXCJ5MVwiLHlTYyhUUlVFX1IwKSkuYXR0cihcInkyXCIseVNjKFRSVUVfUjApKS5hdHRyKFwic3Ryb2tlXCIsQy50cnVlTGluZSkuYXR0cihcInN0cm9rZS13aWR0aFwiLDIuNSk7XHJcbiAgZ1NjYXQuYXBwZW5kKFwibGluZVwiKS5hdHRyKFwieDFcIix4U2MoVFJVRV9HQU0pKS5hdHRyKFwieDJcIix4U2MoVFJVRV9HQU0pKVxyXG4gICAgLmF0dHIoXCJ5MVwiLHlTYyhUUlVFX1IwKS04KS5hdHRyKFwieTJcIix5U2MoVFJVRV9SMCkrOCkuYXR0cihcInN0cm9rZVwiLEMudHJ1ZUxpbmUpLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwyLjUpO1xyXG4gIGNvbnN0IHNjYXREb3RzPWdTY2F0LmFwcGVuZChcImdcIik7XHJcbiAgY29uc3Qgc2NhdEN1cj1nU2NhdC5hcHBlbmQoXCJjaXJjbGVcIikuYXR0cihcInJcIiw1KS5hdHRyKFwiZmlsbFwiLEMuY3VycmVudCkuYXR0cihcInN0cm9rZVwiLFwiI2ZmZlwiKS5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsMik7XHJcbiAgY29uc3Qgc2NhdFByb3A9Z1NjYXQuYXBwZW5kKFwiY2lyY2xlXCIpLmF0dHIoXCJyXCIsNSkuYXR0cihcImZpbGxcIixcIm5vbmVcIikuYXR0cihcInN0cm9rZVwiLEMucHJvcG9zZSkuYXR0cihcInN0cm9rZS13aWR0aFwiLDIpLmF0dHIoXCJvcGFjaXR5XCIsMCk7XHJcblxyXG4gIG91dGVyLmFwcGVuZENoaWxkKHNjYXRTdmcubm9kZSgpKTtcclxuXHJcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQIFJFTkRFUiBGVU5DVElPTlMg4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgY29uc3QgbGluZUdlbj1kMy5saW5lKCkueCgoXyxpKT0+eEluYyhpKzEpKS5jdXJ2ZShkMy5jdXJ2ZU1vbm90b25lWCk7XHJcblxyXG4gIGZ1bmN0aW9uIHJlbmRlckluY2lkZW5jZSgpe1xyXG4gICAgY29uc3QgY3VyPWNoYWluW2NoYWluLmxlbmd0aC0xXTtcclxuICAgIGNvbnN0IHNvbD1zb2x2ZVNJUihjdXIuUjAsY3VyLmdhbW1hLFMwLEkwLFIwUCk7XHJcbiAgICBjb25zdCBwcmVkPXdlZWtseUluYyhzb2wpO1xyXG4gICAgLy8gZHluYW1pY2FsbHkgYWRqdXN0IHktYXhpcyB0byBmaXQgYm90aCBkYXRhIGFuZCBtb2RlbFxyXG4gICAgY29uc3QgYWxsVmFscz1bLi4ub2JzRGF0YSwuLi5wcmVkXTtcclxuICAgIGxldCBwcm9wUHJlZD1udWxsO1xyXG4gICAgaWYoc3RlcFBoYXNlPT09XCJwcm9wb3NlZFwiJiZwcm9wb3NlZFIwIT1udWxsKXtcclxuICAgICAgY29uc3QgcFNvbD1zb2x2ZVNJUihwcm9wb3NlZFIwLHByb3Bvc2VkR2FtLFMwLEkwLFIwUCk7XHJcbiAgICAgIHByb3BQcmVkPXdlZWtseUluYyhwU29sKTtcclxuICAgICAgYWxsVmFscy5wdXNoKC4uLnByb3BQcmVkKTtcclxuICAgIH1cclxuICAgIGNvbnN0IG5ld1lNYXg9ZDMubWF4KGFsbFZhbHMpKjEuMjtcclxuICAgIHlJbmMuZG9tYWluKFswLE1hdGgubWF4KG5ld1lNYXgsMTApXSk7XHJcbiAgICBkcmF3SW5jQXhlcygpO1xyXG4gICAgLy8gcmUtcG9zaXRpb24gZGF0YSBkb3RzIHdpdGggbmV3IHNjYWxlXHJcbiAgICBnSW5jQ2xpcC5zZWxlY3RBbGwoXCIub2JzLWRvdFwiKS5hdHRyKFwiY3lcIixkPT55SW5jKGQpKTtcclxuICAgIG1vZGVsTGluZS5hdHRyKFwiZFwiLGxpbmVHZW4ueShkPT55SW5jKGQpKShwcmVkKSk7XHJcbiAgICBpZihwcm9wUHJlZCl7XHJcbiAgICAgIHByb3BMaW5lLmF0dHIoXCJkXCIsbGluZUdlbi55KGQ9PnlJbmMoZCkpKHByb3BQcmVkKSkuYXR0cihcIm9wYWNpdHlcIiwwLjgpO1xyXG4gICAgfSBlbHNlIHByb3BMaW5lLmF0dHIoXCJvcGFjaXR5XCIsMCk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiB1cGRhdGVUcmFjZSh0cix2YWxzLHByb3BWYWwsa2V5KXtcclxuICAgIGNvbnN0IG49dmFscy5sZW5ndGg7XHJcbiAgICB0ci54VHIuZG9tYWluKFswLE1hdGgubWF4KDEwLG4pXSk7XHJcbiAgICBjb25zdCBleHQ9ZDMuZXh0ZW50KHZhbHMubWFwKHY9PnZba2V5XSkpO1xyXG4gICAgY29uc3QgcGFkPU1hdGgubWF4KChleHRbMV0tZXh0WzBdKSowLjIsMC4wNSk7XHJcbiAgICBjb25zdCBsbz1NYXRoLm1pbihleHRbMF0sdHIudHJ1ZVZhbCktcGFkLCBoaT1NYXRoLm1heChleHRbMV0sdHIudHJ1ZVZhbCkrcGFkO1xyXG4gICAgdHIueVRyLmRvbWFpbihbbG8saGldKTtcclxuICAgIHRyLmF4WC5jYWxsKGQzLmF4aXNCb3R0b20odHIueFRyKS50aWNrcyg1KS50aWNrRm9ybWF0KGQzLmZvcm1hdChcImRcIikpLnRpY2tTaXplKC10ci5pbm5lckgpKVxyXG4gICAgICAuY2FsbChnPT57Zy5zZWxlY3RBbGwoXCIudGljayBsaW5lXCIpLmF0dHIoXCJzdHJva2VcIixcIiNlZWVcIik7Zy5zZWxlY3QoXCIuZG9tYWluXCIpLmF0dHIoXCJzdHJva2VcIixDLmJvcmRlcik7fSk7XHJcbiAgICB0ci5heFkuY2FsbChkMy5heGlzTGVmdCh0ci55VHIpLnRpY2tzKDQpLnRpY2tTaXplKC10SVcpKVxyXG4gICAgICAuY2FsbChnPT57Zy5zZWxlY3RBbGwoXCIudGljayBsaW5lXCIpLmF0dHIoXCJzdHJva2VcIixcIiNlZWVcIik7Zy5zZWxlY3QoXCIuZG9tYWluXCIpLmF0dHIoXCJzdHJva2VcIixDLmJvcmRlcik7fSk7XHJcbiAgICB0ci50cnVlTG4uYXR0cihcInkxXCIsdHIueVRyKHRyLnRydWVWYWwpKS5hdHRyKFwieTJcIix0ci55VHIodHIudHJ1ZVZhbCkpO1xyXG4gICAgY29uc3QgbGluZT1kMy5saW5lKCkueCgoXyxpKT0+dHIueFRyKGkpKS55KGQ9PnRyLnlUcihkW2tleV0pKTtcclxuICAgIHRyLnRyYWNlUGF0aC5hdHRyKFwiZFwiLGxpbmUodmFscykpO1xyXG4gICAgY29uc3QgbGFzdD12YWxzW3ZhbHMubGVuZ3RoLTFdO1xyXG4gICAgdHIuY3VyRG90LmF0dHIoXCJjeFwiLHRyLnhUcihuLTEpKS5hdHRyKFwiY3lcIix0ci55VHIobGFzdFtrZXldKSk7XHJcbiAgICBpZihzdGVwUGhhc2U9PT1cInByb3Bvc2VkXCImJnByb3BWYWwhPW51bGwpe1xyXG4gICAgICB0ci5wcm9wRG90LmF0dHIoXCJjeFwiLHRyLnhUcihuKSkuYXR0cihcImN5XCIsdHIueVRyKHByb3BWYWwpKS5hdHRyKFwib3BhY2l0eVwiLDEpO1xyXG4gICAgfSBlbHNlIHRyLnByb3BEb3QuYXR0cihcIm9wYWNpdHlcIiwwKTtcclxuICAgIC8vIOKUgOKUgCBEZW5zaXR5IGhpc3RvZ3JhbSAocm90YXRlZCA5MMKwLCBkcmF3biB0byB0aGUgcmlnaHQgb2YgdHJhY2UpIOKUgOKUgFxyXG4gICAgaWYobj49Myl7XHJcbiAgICAgIGNvbnN0IGRhdGE9dmFscy5tYXAodj0+dltrZXldKTtcclxuICAgICAgY29uc3QgbWVhbj1kMy5tZWFuKGRhdGEpLCBzZD1kMy5kZXZpYXRpb24oZGF0YSl8fDAuMDE7XHJcbiAgICAgIGNvbnN0IG5CaW5zPTMwO1xyXG4gICAgICBjb25zdCB5TG89dHIueVRyLmRvbWFpbigpWzBdLCB5SGk9dHIueVRyLmRvbWFpbigpWzFdO1xyXG4gICAgICBjb25zdCBzdGVwPSh5SGkteUxvKS9uQmlucztcclxuICAgICAgY29uc3QgcHRzPVtdO1xyXG4gICAgICBmb3IobGV0IGk9MDtpPD1uQmlucztpKyspe1xyXG4gICAgICAgIGNvbnN0IHY9eUxvK2kqc3RlcDtcclxuICAgICAgICBwdHMucHVzaCh7dixkOm5vcm1hbFBERih2LG1lYW4sc2QpfSk7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgeERlbnM9ZDMuc2NhbGVMaW5lYXIoKS5kb21haW4oWzAsZDMubWF4KHB0cyxwPT5wLmQpXSkucmFuZ2UoWzAsZGVuc1ddKTtcclxuICAgICAgY29uc3QgYXJlYT1kMy5hcmVhKCkueDAoMCkueDEocD0+eERlbnMocC5kKSkueShwPT50ci55VHIocC52KSkuY3VydmUoZDMuY3VydmVCYXNpcyk7XHJcbiAgICAgIHRyLmRlbnNQYXRoLmF0dHIoXCJkXCIsYXJlYShwdHMpKTtcclxuICAgICAgdHIuZGVuc1RydWVMbi5hdHRyKFwieDFcIiwwKS5hdHRyKFwieDJcIixkZW5zVylcclxuICAgICAgICAuYXR0cihcInkxXCIsdHIueVRyKHRyLnRydWVWYWwpKS5hdHRyKFwieTJcIix0ci55VHIodHIudHJ1ZVZhbCkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdHIuZGVuc1BhdGguYXR0cihcImRcIixcIlwiKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHJlbmRlclRyYWNlcygpe1xyXG4gICAgdXBkYXRlVHJhY2UodHJSMCxjaGFpbixwcm9wb3NlZFIwLFwiUjBcIik7XHJcbiAgICB1cGRhdGVUcmFjZSh0ckdhbSxjaGFpbixwcm9wb3NlZEdhbSxcImdhbW1hXCIpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcmVuZGVyU2NhdHRlcigpe1xyXG4gICAgc2NhdERvdHMuc2VsZWN0QWxsKFwiY2lyY2xlXCIpLmRhdGEoY2hhaW4pLmpvaW4oXCJjaXJjbGVcIilcclxuICAgICAgLmF0dHIoXCJjeFwiLGQ9PnhTYyhkLmdhbW1hKSkuYXR0cihcImN5XCIsZD0+eVNjKGQuUjApKVxyXG4gICAgICAuYXR0cihcInJcIiwyLjUpLmF0dHIoXCJmaWxsXCIsQy5zY2F0dGVyKS5hdHRyKFwib3BhY2l0eVwiLDAuNCk7XHJcbiAgICBjb25zdCBsYXN0PWNoYWluW2NoYWluLmxlbmd0aC0xXTtcclxuICAgIHNjYXRDdXIuYXR0cihcImN4XCIseFNjKGxhc3QuZ2FtbWEpKS5hdHRyKFwiY3lcIix5U2MobGFzdC5SMCkpO1xyXG4gICAgaWYoc3RlcFBoYXNlPT09XCJwcm9wb3NlZFwiJiZwcm9wb3NlZFIwIT1udWxsKXtcclxuICAgICAgc2NhdFByb3AuYXR0cihcImN4XCIseFNjKHByb3Bvc2VkR2FtKSkuYXR0cihcImN5XCIseVNjKHByb3Bvc2VkUjApKS5hdHRyKFwib3BhY2l0eVwiLDEpO1xyXG4gICAgfSBlbHNlIHNjYXRQcm9wLmF0dHIoXCJvcGFjaXR5XCIsMCk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBwaWxsKGxhYmVsLGNvbG9yKXtyZXR1cm4gYDxzcGFuIHN0eWxlPVwiZGlzcGxheTppbmxpbmUtYmxvY2s7cGFkZGluZzozcHggMTJweDtib3JkZXItcmFkaXVzOjZweDtiYWNrZ3JvdW5kOiR7Y29sb3J9O2NvbG9yOiNmZmY7Zm9udC13ZWlnaHQ6NzAwO2ZvbnQtc2l6ZToxMnB4O2xldHRlci1zcGFjaW5nOjAuNXB4O1wiPiR7bGFiZWx9PC9zcGFuPmA7fVxyXG4gIGZ1bmN0aW9uIHZsKHQsYyxiKXtyZXR1cm4gYDxzcGFuIHN0eWxlPVwiY29sb3I6JHtjfTtmb250LXdlaWdodDoke2I/ODAwOjYwMH07XCI+JHt0fTwvc3Bhbj5gO31cclxuICBmdW5jdGlvbiBsYih0LGMpe3JldHVybiBgPHNwYW4gc3R5bGU9XCJjb2xvcjoke2N9O2ZvbnQtc2l6ZToxMXB4O2ZvbnQtd2VpZ2h0OjYwMDtvcGFjaXR5OjAuNztcIj4ke3R9PC9zcGFuPmA7fVxyXG5cclxuICBmdW5jdGlvbiB1cGRhdGVTdGF0dXMoKXtcclxuICAgIGNvbnN0IGN1cj1jaGFpbltjaGFpbi5sZW5ndGgtMV07XHJcbiAgICBjb25zdCBzdGF0cz1gPGRpdiBzdHlsZT1cIm1hcmdpbi10b3A6NnB4O2ZvbnQtc2l6ZToxMXB4O2NvbG9yOiR7Qy5zdWJ9O1wiPkLGsOG7m2MgJHtzdGVwQ291bnR9IMK3ICR7bkFjY30gY2jhuqVwIG5o4bqtbjwvZGl2PmA7XHJcbiAgICBpZihzdGVwUGhhc2U9PT1cImlkbGVcIil7XHJcbiAgICAgIHN0YXR1c0JveC5zdHlsZS5ib3JkZXJDb2xvcj1DLmJvcmRlcjtcclxuICAgICAgc3RhdHVzQm94LmlubmVySFRNTD1gPGRpdiBzdHlsZT1cImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjEycHg7XCI+YCtwaWxsKCdT4bq0TiBTw4BORycsJyM1NDZFN0EnKStcclxuICAgICAgICBgPHNwYW4gc3R5bGU9XCJmb250LXNpemU6MTRweDtcIj5W4buLIHRyw60gaGnhu4duIHThuqFpOiAke3ZsKCdS4oKAID0gJytjdXIuUjAudG9GaXhlZCgzKSxDLmN1cnJlbnQsdHJ1ZSl9LCAke3ZsKCfOsyA9ICcrY3VyLmdhbW1hLnRvRml4ZWQoNCksQy50cmFjZUdhbSx0cnVlKX08L3NwYW4+YCtcclxuICAgICAgICBgPHNwYW4gc3R5bGU9XCJtYXJnaW4tbGVmdDphdXRvO2NvbG9yOiR7Qy5zdWJ9O2ZvbnQtc2l6ZToxMnB4O1wiPk5o4bqlbiA8YiBzdHlsZT1cImNvbG9yOiR7Qy5jdXJyZW50fVwiPkLGsOG7m2MgdGnhur9wIHRoZW88L2I+IOKWtjwvc3Bhbj48L2Rpdj5gK3N0YXRzO1xyXG4gICAgfSBlbHNlIGlmKHN0ZXBQaGFzZT09PVwicHJvcG9zZWRcIil7XHJcbiAgICAgIHN0YXR1c0JveC5zdHlsZS5ib3JkZXJDb2xvcj1DLnByb3Bvc2U7XHJcbiAgICAgIGNvbnN0IGNsYW1wZWRBbHBoYT1NYXRoLm1pbigxLE1hdGguZXhwKGxvZ0FscGhhKSk7XHJcbiAgICAgIHN0YXR1c0JveC5pbm5lckhUTUw9YDxkaXYgc3R5bGU9XCJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDoxMHB4O21hcmdpbi1ib3R0b206OHB4O1wiPmArXHJcbiAgICAgICAgcGlsbCgnxJDhu4AgWFXhuqRUJyxDLnByb3Bvc2UpK2A8c3BhbiBzdHlsZT1cImZvbnQtc2l6ZToxM3B4O1wiPlLigoAqID0gJHt2bChwcm9wb3NlZFIwLnRvRml4ZWQoMyksQy5wcm9wb3NlLHRydWUpfSwgzrMqID0gJHt2bChwcm9wb3NlZEdhbS50b0ZpeGVkKDQpLEMucHJvcG9zZSx0cnVlKX08L3NwYW4+PC9kaXY+YCtcclxuICAgICAgICBgPHRhYmxlIHN0eWxlPVwid2lkdGg6MTAwJTtib3JkZXItY29sbGFwc2U6c2VwYXJhdGU7Ym9yZGVyLXNwYWNpbmc6MDtib3JkZXItcmFkaXVzOjEwcHg7b3ZlcmZsb3c6aGlkZGVuO2JvcmRlcjoxcHggc29saWQgI0UwRTBFMDtmb250LXNpemU6MTJweDtcIj5gK1xyXG4gICAgICAgIGA8dGhlYWQ+PHRyIHN0eWxlPVwiYmFja2dyb3VuZDojRjVGNUY1O1wiPjx0aCBzdHlsZT1cInBhZGRpbmc6NnB4IDEycHg7dGV4dC1hbGlnbjpsZWZ0O2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNFMEUwRTA7XCI+PC90aD5gK1xyXG4gICAgICAgIGA8dGggc3R5bGU9XCJwYWRkaW5nOjZweCAxMnB4O3RleHQtYWxpZ246Y2VudGVyO2ZvbnQtd2VpZ2h0OjcwMDtjb2xvcjoke0MuY3VycmVudH07Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI0UwRTBFMDtcIj5IaeG7h24gdOG6oWk8L3RoPmArXHJcbiAgICAgICAgYDx0aCBzdHlsZT1cInBhZGRpbmc6NnB4IDEycHg7dGV4dC1hbGlnbjpjZW50ZXI7Zm9udC13ZWlnaHQ6NzAwO2NvbG9yOiR7Qy5wcm9wb3NlfTtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjRTBFMEUwO1wiPsSQ4buBIHh14bqldDwvdGg+PC90cj48L3RoZWFkPjx0Ym9keT5gK1xyXG4gICAgICAgIGA8dHI+PHRkIHN0eWxlPVwicGFkZGluZzo1cHggMTJweDtmb250LXdlaWdodDo2MDA7XCI+TG9nLUxpa2VsaWhvb2Q8L3RkPmArXHJcbiAgICAgICAgYDx0ZCBzdHlsZT1cInBhZGRpbmc6NXB4IDEycHg7dGV4dC1hbGlnbjpjZW50ZXI7Y29sb3I6JHtDLmN1cnJlbnR9O1wiPiR7Y3VyTEwudG9GaXhlZCgyKX08L3RkPmArXHJcbiAgICAgICAgYDx0ZCBzdHlsZT1cInBhZGRpbmc6NXB4IDEycHg7dGV4dC1hbGlnbjpjZW50ZXI7Y29sb3I6JHtDLnByb3Bvc2V9O1wiPiR7KHByb3BMTD09PS1JbmZpbml0eT9cIi3iiJ5cIjpwcm9wTEwudG9GaXhlZCgyKSl9PC90ZD48L3RyPjwvdGJvZHk+PC90YWJsZT5gK1xyXG4gICAgICAgIGA8ZGl2IHN0eWxlPVwiZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6MjBweDttYXJnaW4tdG9wOjhweDtwYWRkaW5nOjhweCAxMnB4O2JhY2tncm91bmQ6I2ZmZjtib3JkZXItcmFkaXVzOjhweDtib3JkZXI6MXB4IHNvbGlkICNFMEUwRTA7XCI+YCtcclxuICAgICAgICBgPHNwYW4+JHtsYignVOG7tyBs4buHIGNo4bqlcCBuaOG6rW4nLCcjMzMzJyl9IM6xID0gJHt2bChjbGFtcGVkQWxwaGEudG9GaXhlZCg0KSwnIzMzMycsdHJ1ZSl9PC9zcGFuPmArXHJcbiAgICAgICAgYDxzcGFuIHN0eWxlPVwiY29sb3I6I0JEQkRCRDtcIj7ilII8L3NwYW4+YCtcclxuICAgICAgICBgPHNwYW4+JHtsYignUsO6dCBuZ+G6q3Ugbmhpw6puJywnIzMzMycpfSB1ID0gJHt2bCh1UmFuZC50b0ZpeGVkKDQpLCcjRTY1MTAwJyx0cnVlKX08L3NwYW4+YCtcclxuICAgICAgICBgPHNwYW4gc3R5bGU9XCJtYXJnaW4tbGVmdDphdXRvO2ZvbnQtc2l6ZToxMnB4O2NvbG9yOiR7Qy5zdWJ9O1wiPk5o4bqlbiA8Yj5CxrDhu5tjIHRp4bq/cCB0aGVvPC9iPiDEkeG7gyBxdXnhur90IMSR4buLbmg8L3NwYW4+PC9kaXY+YDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IGRjPWFjY2VwdGVkP0MuYWNjZXB0OkMucmVqZWN0O1xyXG4gICAgICBzdGF0dXNCb3guc3R5bGUuYm9yZGVyQ29sb3I9ZGM7XHJcbiAgICAgIGNvbnN0IGNsYW1wZWRBbHBoYT1NYXRoLm1pbigxLE1hdGguZXhwKGxvZ0FscGhhKSk7XHJcbiAgICAgIHN0YXR1c0JveC5pbm5lckhUTUw9YDxkaXYgc3R5bGU9XCJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDoxMnB4O1wiPmArXHJcbiAgICAgICAgcGlsbChhY2NlcHRlZD8n4pyTIENI4bqkUCBOSOG6rE4nOifinJcgVOG7qiBDSOG7kEknLGRjKStcclxuICAgICAgICBgPHNwYW4gc3R5bGU9XCJmb250LXNpemU6MTRweDtmb250LXdlaWdodDo2MDA7XCI+zrEgPSAke3ZsKGNsYW1wZWRBbHBoYS50b0ZpeGVkKDQpLEMudHh0KX0gYCtcclxuICAgICAgICBgPHNwYW4gc3R5bGU9XCJjb2xvcjoke2RjfTtmb250LXdlaWdodDo4MDA7Zm9udC1zaXplOjE1cHg7XCI+JHthY2NlcHRlZD8n4omlJzonPCd9PC9zcGFuPiBgK1xyXG4gICAgICAgIGB1ID0gJHt2bCh1UmFuZC50b0ZpeGVkKDQpLEMucHJvcG9zZSl9PC9zcGFuPmArXHJcbiAgICAgICAgYDxzcGFuIHN0eWxlPVwibWFyZ2luLWxlZnQ6YXV0bztmb250LXNpemU6MTNweDtjb2xvcjoke2RjfTtmb250LXdlaWdodDo2MDA7XCI+YCtcclxuICAgICAgICAoYWNjZXB0ZWQ/YOKGkiBEaSBjaHV54buDbiDEkeG6v24gUuKCgCo9JHtwcm9wb3NlZFIwLnRvRml4ZWQoMyl9LCDOsyo9JHtwcm9wb3NlZEdhbS50b0ZpeGVkKDQpfWBcclxuICAgICAgICAgICAgICAgICA6YOKGkiDhu54gbOG6oWkgUuKCgD0ke2N1ci5SMC50b0ZpeGVkKDMpfSwgzrM9JHtjdXIuZ2FtbWEudG9GaXhlZCg0KX1gKStgPC9zcGFuPjwvZGl2PmArc3RhdHM7XHJcbiAgICB9XHJcbiAgICBzdGVwTGFiZWwudGV4dENvbnRlbnQ9YELGsOG7m2MgJHtzdGVwQ291bnR9IMK3ICR7bkFjY30gbeG6q3VgO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcmVuZGVyQWxsKCl7cmVuZGVySW5jaWRlbmNlKCk7cmVuZGVyVHJhY2VzKCk7cmVuZGVyU2NhdHRlcigpO3VwZGF0ZVN0YXR1cygpO31cclxuXHJcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQIE1DTUMgTE9HSUMg4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgZnVuY3Rpb24gZG9TdGVwKCl7XHJcbiAgICBpZihzdGVwUGhhc2U9PT1cImlkbGVcIil7XHJcbiAgICAgIHNpZ1IwPVNMLnNpZ1IwLnZhbCgpOyBzaWdHYW09U0wuc2lnR2FtLnZhbCgpO1xyXG4gICAgICBjb25zdCBjdXI9Y2hhaW5bY2hhaW4ubGVuZ3RoLTFdO1xyXG4gICAgICBwcm9wb3NlZFIwPWN1ci5SMCtzaWdSMCpyYW5kbigpO1xyXG4gICAgICBwcm9wb3NlZEdhbT1jdXIuZ2FtbWErc2lnR2FtKnJhbmRuKCk7XHJcbiAgICAgIGN1ckxMPXRhcmdldExMKGN1ci5SMCxjdXIuZ2FtbWEpO1xyXG4gICAgICBwcm9wTEw9dGFyZ2V0TEwocHJvcG9zZWRSMCxwcm9wb3NlZEdhbSk7XHJcbiAgICAgIGxvZ0FscGhhPXByb3BMTC1jdXJMTDtcclxuICAgICAgdVJhbmQ9TWF0aC5yYW5kb20oKTtcclxuICAgICAgc3RlcFBoYXNlPVwicHJvcG9zZWRcIjtcclxuICAgIH0gZWxzZSBpZihzdGVwUGhhc2U9PT1cInByb3Bvc2VkXCIpe1xyXG4gICAgICBhY2NlcHRlZD1NYXRoLmxvZyh1UmFuZCk8bG9nQWxwaGE7XHJcbiAgICAgIGlmKGFjY2VwdGVkKSBjaGFpbi5wdXNoKHtSMDpwcm9wb3NlZFIwLGdhbW1hOnByb3Bvc2VkR2FtfSk7XHJcbiAgICAgIGVsc2UgY2hhaW4ucHVzaCh7UjA6Y2hhaW5bY2hhaW4ubGVuZ3RoLTFdLlIwLGdhbW1hOmNoYWluW2NoYWluLmxlbmd0aC0xXS5nYW1tYX0pO1xyXG4gICAgICBzdGVwQ291bnQrKzsgaWYoYWNjZXB0ZWQpbkFjYysrO1xyXG4gICAgICBzdGVwUGhhc2U9XCJkZWNpZGVkXCI7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzdGVwUGhhc2U9XCJpZGxlXCI7XHJcbiAgICB9XHJcbiAgICByZW5kZXJBbGwoKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHJlc2V0QWxsKCl7XHJcbiAgICBzdG9wQXV0bygpO1xyXG4gICAgY2hhaW49W3tSMDoyLjUsZ2FtbWE6MC4xNX1dOyBzdGVwUGhhc2U9XCJpZGxlXCI7IHN0ZXBDb3VudD0wOyBuQWNjPTA7XHJcbiAgICBwcm9wb3NlZFIwPW51bGw7IHByb3Bvc2VkR2FtPW51bGw7IGN1ckxMPW51bGw7IHByb3BMTD1udWxsO1xyXG4gICAgcmVuZGVyQWxsKCk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBzdG9wQXV0bygpe2F1dG9SdW5uaW5nPWZhbHNlO2NsZWFySW50ZXJ2YWwoYXV0b1RpbWVyKTtidG5BdXRvLnRleHRDb250ZW50PVwi4o+pIENo4bqheSB04buxIMSR4buZbmdcIjtidG5BdXRvLnN0eWxlLmJhY2tncm91bmQ9XCJsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCM2QTFCOUEsIzZBMUI5QWRkKVwiO31cclxuXHJcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQIEVWRU5UIEhBTkRMRVJTIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gIGJ0blN0ZXAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsKCk9PntpZihhdXRvUnVubmluZylzdG9wQXV0bygpO2RvU3RlcCgpO30pO1xyXG4gIGJ0blJlc2V0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLHJlc2V0QWxsKTtcclxuICBidG5BdXRvLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCgpPT57XHJcbiAgICBpZihhdXRvUnVubmluZyl7c3RvcEF1dG8oKTtyZXR1cm47fVxyXG4gICAgYXV0b1J1bm5pbmc9dHJ1ZTtidG5BdXRvLnRleHRDb250ZW50PVwi4o+4IFThuqFtIGThu6tuZ1wiO2J0bkF1dG8uc3R5bGUuYmFja2dyb3VuZD1gbGluZWFyLWdyYWRpZW50KDEzNWRlZywke0MucmVqZWN0fSwke0MucmVqZWN0fWRkKWA7XHJcbiAgICBhdXRvU3BlZWQ9U0wuc3BlZWQudmFsKCk7XHJcbiAgICBhdXRvVGltZXI9c2V0SW50ZXJ2YWwoZG9TdGVwLGF1dG9TcGVlZCk7XHJcbiAgfSk7XHJcbiAgLy8gV2hlbiBzcGVlZCBzbGlkZXIgY2hhbmdlcyBkdXJpbmcgYXV0by1ydW4sIHJlc3RhcnQgdGltZXIgd2l0aCBuZXcgc3BlZWRcclxuICBTTC5zcGVlZC5pbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwoKT0+e1xyXG4gICAgU0wuc3BlZWQuc3luYygpO1xyXG4gICAgaWYoYXV0b1J1bm5pbmcpe2NsZWFySW50ZXJ2YWwoYXV0b1RpbWVyKTthdXRvU3BlZWQ9U0wuc3BlZWQudmFsKCk7YXV0b1RpbWVyPXNldEludGVydmFsKGRvU3RlcCxhdXRvU3BlZWQpO31cclxuICB9KTtcclxuICBmb3IoY29uc3QgayBvZiBPYmplY3Qua2V5cyhTTCkpe2lmKGshPT1cInNwZWVkXCIpU0xba10uaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsKCk9PlNMW2tdLnN5bmMoKSk7fVxyXG5cclxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAgSU5JVElBTCBSRU5ERVIg4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgcmVuZGVyQWxsKCk7XHJcbiAgcmV0dXJuIG91dGVyO1xyXG59XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnbWgnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnc2lyJykifV19
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../..";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "thinhong/s4bvn";
    script.dataset.repoId = "R_kgDOQtVYcQ";
    script.dataset.category = "General";
    script.dataset.categoryId = "DIC_kwDOQtVYcc4C00o0";
    script.dataset.mapping = "title";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./bayes.html" class="pagination-link" aria-label="Bayesian">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Bayesian</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./unc.html" class="pagination-link" aria-label="Sự không chắc chắn">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Sự không chắc chắn</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>