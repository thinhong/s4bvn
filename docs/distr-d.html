<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>4&nbsp; Phân phối rời rạc – Statistics for babies</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./distr-shape.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-832c273f0af7a47d06e59912ec7b3523.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="module" src="site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./distr-d.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Phân phối rời rạc</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Statistics for babies</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prob.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Xác suất</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Bayesian</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-shape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Hình dạng phân phối</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-d.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Phân phối rời rạc</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tài liệu tham khảo</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#phép-thử-bernoulli-bernoulli-trial-hay-binomial-trial" id="toc-phép-thử-bernoulli-bernoulli-trial-hay-binomial-trial" class="nav-link active" data-scroll-target="#phép-thử-bernoulli-bernoulli-trial-hay-binomial-trial"><span class="header-section-number">4.1</span> Phép thử Bernoulli (Bernoulli trial, hay binomial trial)</a></li>
  <li><a href="#đếm-số-lần-thành-công" id="toc-đếm-số-lần-thành-công" class="nav-link" data-scroll-target="#đếm-số-lần-thành-công"><span class="header-section-number">4.2</span> Đếm số lần thành công</a>
  <ul class="collapse">
  <li><a href="#phân-phối-nhị-nhức-binomial-distribution" id="toc-phân-phối-nhị-nhức-binomial-distribution" class="nav-link" data-scroll-target="#phân-phối-nhị-nhức-binomial-distribution"><span class="header-section-number">4.2.1</span> Phân phối nhị nhức (binomial distribution)</a></li>
  <li><a href="#phân-phối-siêu-bội-hypergeometric-distribution" id="toc-phân-phối-siêu-bội-hypergeometric-distribution" class="nav-link" data-scroll-target="#phân-phối-siêu-bội-hypergeometric-distribution"><span class="header-section-number">4.2.2</span> Phân phối siêu bội (hypergeometric distribution)</a></li>
  </ul></li>
  <li><a href="#đếm-số-lần-thử" id="toc-đếm-số-lần-thử" class="nav-link" data-scroll-target="#đếm-số-lần-thử"><span class="header-section-number">4.3</span> Đếm số lần thử</a>
  <ul class="collapse">
  <li><a href="#phân-phối-hình-học-geometric-distribution" id="toc-phân-phối-hình-học-geometric-distribution" class="nav-link" data-scroll-target="#phân-phối-hình-học-geometric-distribution"><span class="header-section-number">4.3.1</span> Phân phối hình học (geometric distribution)</a></li>
  <li><a href="#phân-phối-nhị-thức-âm-negative-binomial-distribution" id="toc-phân-phối-nhị-thức-âm-negative-binomial-distribution" class="nav-link" data-scroll-target="#phân-phối-nhị-thức-âm-negative-binomial-distribution"><span class="header-section-number">4.3.2</span> Phân phối nhị thức âm (negative binomial distribution)</a></li>
  </ul></li>
  <li><a href="#đếm-sự-kiện-khi-biết-tốc-độ-trung-bình" id="toc-đếm-sự-kiện-khi-biết-tốc-độ-trung-bình" class="nav-link" data-scroll-target="#đếm-sự-kiện-khi-biết-tốc-độ-trung-bình"><span class="header-section-number">4.4</span> Đếm sự kiện khi biết tốc độ trung bình</a>
  <ul class="collapse">
  <li><a href="#phân-phối-poisson" id="toc-phân-phối-poisson" class="nav-link" data-scroll-target="#phân-phối-poisson"><span class="header-section-number">4.4.1</span> Phân phối Poisson</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Phân phối rời rạc</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="phép-thử-bernoulli-bernoulli-trial-hay-binomial-trial" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="phép-thử-bernoulli-bernoulli-trial-hay-binomial-trial"><span class="header-section-number">4.1</span> Phép thử Bernoulli (Bernoulli trial, hay binomial trial)</h2>
<p>Là một lần thử nghiệm duy nhất, không gian mẫu chỉ có đúng 2 kết quả: Thành công (Success) hoặc Thất bại (Failure)</p>
<p>Ví dụ: tung đồng xu (mặt sấp, mặt ngửa), xét nghiệm một ca nghi ngờ (dương tính, âm tính)</p>
<p>Khi ta thực hiện phép thử Bernoulli nhiều lần liên tiếp (ví dụ: tung một đồng xu nhiều lần, dùng một loại xét nghiệm để test nhiều người), ta đang thực hiện 1 chuỗi Bernoulli (Bernoulli process). Chuỗi Bernoulli chuẩn cần thỏa 2 điều kiện:</p>
<ul>
<li>Độc lập (Independent): Kết quả của lần thử này không ảnh hưởng đến lần thử khác.</li>
<li>Xác suất không đổi: Xác suất thành công (<span class="math inline">\(p\)</span>) phải giống hệt nhau ở mọi lần thử.</li>
</ul>
<p>Hầu hết các phân phối rời rạc đều xuất phát từ chuỗi Bernoulli với các mục tiêu khác nhau.</p>
</section>
<section id="đếm-số-lần-thành-công" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="đếm-số-lần-thành-công"><span class="header-section-number">4.2</span> Đếm số lần thành công</h2>
<p>Chúng ta quyết định trước sẽ bỏ ra bao nhiêu công sức (<span class="math inline">\(n\)</span> lần thử), và đếm xem thu được bao nhiêu phần thưởng (<span class="math inline">\(k\)</span> thành công).</p>
<section id="phân-phối-nhị-nhức-binomial-distribution" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="phân-phối-nhị-nhức-binomial-distribution"><span class="header-section-number">4.2.1</span> Phân phối nhị nhức (binomial distribution)</h3>
<p>Đếm số lần thành công (<span class="math inline">\(k\)</span>) trong một số lượng cố định các phép thử Bernoulli độc lập (<span class="math inline">\(n\)</span>).</p>
<p>Xác suất để đạt được đúng <span class="math inline">\(k\)</span> lần thành công là:</p>
<p><span class="math display">\[P(X = k) = \binom{n}{k} p^k (1-p)^{n-k}\]</span></p>
<p>Với:</p>
<ul>
<li><span class="math inline">\(n\)</span>: Tổng số lần thực hiện phép thử</li>
<li><span class="math inline">\(p\)</span>: Xác suất thành công của mỗi lần thử (không đổi)</li>
</ul>
<section id="ví-dụ" class="level4" data-number="4.2.1.1">
<h4 data-number="4.2.1.1" class="anchored" data-anchor-id="ví-dụ"><span class="header-section-number">4.2.1.1</span> Ví dụ</h4>
<p>Tung 1 đồng xu 10 lần, sau 10 lần tung, khả năng đếm được 1, 2, 3… mặt ngửa là bao nhiêu?</p>
<ul>
<li>Tổng số lần thực hiện phép thử: <span class="math inline">\(n = 10\)</span></li>
<li>Xác suất ra mặt ngửa mỗi lần: <span class="math inline">\(p = 0.5\)</span></li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb1" data-startfrom="46" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 45;"><span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>viewof n_coins <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">1</span><span class="op">,</span> <span class="dv">20</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Coins per Flip (n)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>viewof p_head <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.01</span><span class="op">,</span> <span class="fl">0.99</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Prob. of Heads (p)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span>})</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>viewof speed <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">10</span><span class="op">,</span> <span class="dv">1000</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Speed (ms)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">200</span><span class="op">,</span> <span class="dt">transform</span><span class="op">:</span> x <span class="kw">=&gt;</span> <span class="dv">1010</span> <span class="op">-</span> x})</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>viewof flipBtn <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">button</span>(<span class="st">"Flip Once"</span>)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>viewof autoBtn <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">button</span>(<span class="st">"Start/Stop Auto-Flip"</span>)</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>viewof resetCoinBtn <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">button</span>(<span class="st">"Reset Data"</span>)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="co">// A. STATE CONTAINER</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="co">// Holds the data history.</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>coin_state <span class="op">=</span> {</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  <span class="co">// We define it once. It persists until you reload the page.</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    <span class="dt">history</span><span class="op">:</span> []<span class="op">,</span> </span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    <span class="dt">currentToss</span><span class="op">:</span> []<span class="op">,</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    <span class="dt">totalHeads</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    <span class="dt">count</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    <span class="dt">lastReset</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a><span class="co">// B. GAME LOGIC</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="co">// This cell runs whenever you click a button.</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>coin_logic <span class="op">=</span> {</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 1. LISTEN TO TRIGGERS</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>  flipBtn<span class="op">;</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  autoBtn<span class="op">;</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>  resetCoinBtn<span class="op">;</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 2. HANDLE RESET</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>  <span class="co">// We check if the reset button counter has increased</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (resetCoinBtn <span class="op">&gt;</span> coin_state<span class="op">.</span><span class="at">lastReset</span>) {</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>      coin_state<span class="op">.</span><span class="at">history</span> <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>      coin_state<span class="op">.</span><span class="at">currentToss</span> <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>      coin_state<span class="op">.</span><span class="at">totalHeads</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>      coin_state<span class="op">.</span><span class="at">count</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>      coin_state<span class="op">.</span><span class="at">lastReset</span> <span class="op">=</span> resetCoinBtn<span class="op">;</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Return immediately to clear the plot</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> coin_state<span class="op">.</span><span class="at">count</span><span class="op">;</span> </span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 3. DEFINE THE FLIP FUNCTION</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> doFlip <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> heads <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> outcome <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>n_coins<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> isHead <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>() <span class="op">&lt;</span> p_head<span class="op">;</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>      outcome<span class="op">.</span><span class="fu">push</span>(isHead <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(isHead) heads<span class="op">++;</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>    coin_state<span class="op">.</span><span class="at">currentToss</span> <span class="op">=</span> outcome<span class="op">;</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>    coin_state<span class="op">.</span><span class="at">history</span><span class="op">.</span><span class="fu">push</span>(heads)<span class="op">;</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>    coin_state<span class="op">.</span><span class="at">totalHeads</span> <span class="op">=</span> heads<span class="op">;</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>    coin_state<span class="op">.</span><span class="at">count</span><span class="op">++;</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 4. EXECUTION MODE</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>  <span class="co">// If Auto Button is ODD (1, 3, 5...), we are in Auto Mode</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> isAuto <span class="op">=</span> (autoBtn <span class="op">%</span> <span class="dv">2</span>) <span class="op">!==</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (isAuto) {</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>    <span class="co">// --- AUTO MODE (Loop) ---</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> (<span class="kw">true</span>) {</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>      <span class="fu">doFlip</span>()<span class="op">;</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>      <span class="kw">yield</span> coin_state<span class="op">.</span><span class="at">count</span><span class="op">;</span> <span class="co">// Yield updates the plot!</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">new</span> <span class="bu">Promise</span>(r <span class="kw">=&gt;</span> <span class="pp">setTimeout</span>(r<span class="op">,</span> <span class="dv">1010</span> <span class="op">-</span> speed))<span class="op">;</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>    <span class="co">// --- MANUAL MODE (Single Shot) ---</span></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>    <span class="co">// If we aren't in auto, and this cell ran, it means 'flipBtn' was clicked</span></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>    <span class="co">// (or a slider changed). We flip once.</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (coin_state<span class="op">.</span><span class="at">count</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">||</span> flipBtn <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>       <span class="fu">doFlip</span>()<span class="op">;</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> coin_state<span class="op">.</span><span class="at">count</span><span class="op">;</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. THE VISUALIZATION (Fixed: Split into two plots)</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>  <span class="co">// DEPENDENCY: Listen to the logic!</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>  coin_logic<span class="op">;</span> </span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Plot A: The Coins (Top Strip)</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> coinPlot <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">600</span><span class="op">,</span></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="dv">80</span><span class="op">,</span> <span class="co">// Fixed height for just the coins</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="vs">`Toss #</span><span class="sc">${</span>coin_state<span class="op">.</span><span class="at">count</span><span class="sc">}</span><span class="vs">: Result`</span><span class="op">,</span></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> {<span class="dt">axis</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> n_coins]}<span class="op">,</span></span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {<span class="dt">axis</span><span class="op">:</span> <span class="kw">null</span>}<span class="op">,</span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">dot</span>(coin_state<span class="op">.</span><span class="at">currentToss</span><span class="op">.</span><span class="fu">map</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> ({<span class="dt">x</span><span class="op">:</span> i<span class="op">,</span> <span class="dt">val</span><span class="op">:</span> d}))<span class="op">,</span> {</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> (d<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="fu">mapRange</span>(i<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> n_coins<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">,</span> n_coins<span class="op">-</span><span class="fl">0.5</span>)<span class="op">,</span> </span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> </span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>        <span class="dt">r</span><span class="op">:</span> <span class="dv">12</span><span class="op">,</span></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">val</span> <span class="op">===</span> <span class="dv">1</span> <span class="op">?</span> <span class="st">"#f7941d"</span> <span class="op">:</span> <span class="st">"#ccc"</span><span class="op">,</span> </span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">2</span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">text</span>(coin_state<span class="op">.</span><span class="at">currentToss</span><span class="op">.</span><span class="fu">map</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> ({<span class="dt">x</span><span class="op">:</span> i<span class="op">,</span> <span class="dt">val</span><span class="op">:</span> d}))<span class="op">,</span> {</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> (d<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="fu">mapRange</span>(i<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> n_coins<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">,</span> n_coins<span class="op">-</span><span class="fl">0.5</span>)<span class="op">,</span> </span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> </span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">val</span> <span class="op">===</span> <span class="dv">1</span> <span class="op">?</span> <span class="st">"H"</span> <span class="op">:</span> <span class="st">"T"</span><span class="op">,</span></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span> <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Plot B: The Histogram (Bottom Chart)</span></span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> histPlot <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">600</span><span class="op">,</span></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="dv">350</span><span class="op">,</span></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="vs">`Distribution of Heads (Total: </span><span class="sc">${</span>coin_state<span class="op">.</span><span class="at">history</span><span class="op">.</span><span class="at">length</span><span class="sc">}</span><span class="vs"> experiments)`</span><span class="op">,</span></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Number of Heads"</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> n_coins]}<span class="op">,</span></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Frequency"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span>}<span class="op">,</span> <span class="co">// Standard quantitative axis (Bottom-Up)</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>      <span class="co">// 1. The Blue Histogram</span></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">rectY</span>(coin_state<span class="op">.</span><span class="at">history</span><span class="op">,</span> Plot<span class="op">.</span><span class="fu">binX</span>(</span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>        {<span class="dt">y</span><span class="op">:</span> <span class="st">"count"</span>}<span class="op">,</span> </span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>        {<span class="dt">x</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> n_coins]<span class="op">,</span> <span class="dt">thresholds</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> n_coins <span class="op">+</span> <span class="dv">2</span>)<span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"#4e79a7"</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.6</span>}</span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>      ))<span class="op">,</span></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>      <span class="co">// 2. The Theoretical Red Line</span></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">line</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> n_coins <span class="op">+</span> <span class="dv">1</span>)<span class="op">,</span> {</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> d <span class="kw">=&gt;</span> d <span class="op">+</span> <span class="fl">0.5</span><span class="op">,</span> </span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">binomialPMF</span>(d<span class="op">,</span> n_coins<span class="op">,</span> p_head) <span class="op">*</span> coin_state<span class="op">.</span><span class="at">history</span><span class="op">.</span><span class="at">length</span><span class="op">,</span></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stroke</span><span class="op">:</span> <span class="st">"red"</span><span class="op">,</span> <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">curve</span><span class="op">:</span> <span class="st">"natural"</span></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>])</span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Return both stacked together</span></span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;div&gt;</span><span class="sc">${</span>coinPlot<span class="sc">}${</span>histPlot<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-9" data-nodetype="expression">

</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb2" data-startfrom="184" data-source-offset="-4096"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 183;"><span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">mapRange</span>(value<span class="op">,</span> low1<span class="op">,</span> high1<span class="op">,</span> low2<span class="op">,</span> high2) {</span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (high1 <span class="op">===</span> low1) <span class="cf">return</span> low2<span class="op">;</span></span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> low2 <span class="op">+</span> (high2 <span class="op">-</span> low2) <span class="op">*</span> (value <span class="op">-</span> low1) <span class="op">/</span> (high1 <span class="op">-</span> low1)<span class="op">;</span></span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">factorial</span>(n) {</span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (n <span class="op">===</span> <span class="dv">0</span> <span class="op">||</span> n <span class="op">===</span> <span class="dv">1</span>) <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> result <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> </span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">2</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> i<span class="op">++</span>) result <span class="op">*=</span> i<span class="op">;</span> </span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> result<span class="op">;</span> </span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">combination</span>(n<span class="op">,</span> k) {</span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">factorial</span>(n) <span class="op">/</span> (<span class="fu">factorial</span>(k) <span class="op">*</span> <span class="fu">factorial</span>(n <span class="op">-</span> k))<span class="op">;</span></span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">binomialPMF</span>(k<span class="op">,</span> n<span class="op">,</span> p) {</span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">combination</span>(n<span class="op">,</span> k) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(p<span class="op">,</span> k) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(<span class="dv">1</span> <span class="op">-</span> p<span class="op">,</span> n <span class="op">-</span> k)<span class="op">;</span></span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-13" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</section>
<section id="bảng-galton" class="level4" data-number="4.2.1.2">
<h4 data-number="4.2.1.2" class="anchored" data-anchor-id="bảng-galton"><span class="header-section-number">4.2.1.2</span> Bảng Galton</h4>
<p>Bảng Galton (Galton board) là một tấm bảng dựng đứng, được đóng các hàng đinh so le nhau theo hình tam giác. Ta thả những viên bi nhỏ từ đỉnh tháp. Khi một viên bi chạm vào một chiếc đinh, nó sẽ nảy sang trái hoặc sang phải. Sau khi đi hết các hàng đinh, viên bi sẽ rơi vào các ô chứa để hứng bi. Số lượng bi trong các ô chứa này tuân theo phân phối nhị thức.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb3" data-startfrom="211" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 210;"><span id="cb3-211"><a href="#cb3-211" aria-hidden="true" tabindex="-1"></a>viewof galton_sharp <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>({</span>
<span id="cb3-212"><a href="#cb3-212" aria-hidden="true" tabindex="-1"></a>  <span class="dt">rows</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">8</span><span class="op">,</span> <span class="dv">20</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Số hàng đinh"</span>})<span class="op">,</span></span>
<span id="cb3-213"><a href="#cb3-213" aria-hidden="true" tabindex="-1"></a>  <span class="dt">speed</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="dv">3</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Tốc độ"</span>})<span class="op">,</span></span>
<span id="cb3-214"><a href="#cb3-214" aria-hidden="true" tabindex="-1"></a>  <span class="dt">total</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">50</span><span class="op">,</span> <span class="dv">800</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">200</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Số viên bi"</span>})</span>
<span id="cb3-215"><a href="#cb3-215" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-216"><a href="#cb3-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-217"><a href="#cb3-217" aria-hidden="true" tabindex="-1"></a>viewof control_sharp <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>({</span>
<span id="cb3-218"><a href="#cb3-218" aria-hidden="true" tabindex="-1"></a>  <span class="dt">start</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">button</span>(<span class="st">"Bắt đầu"</span><span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">reduce</span><span class="op">:</span> () <span class="kw">=&gt;</span> <span class="st">"START"</span>})<span class="op">,</span></span>
<span id="cb3-219"><a href="#cb3-219" aria-hidden="true" tabindex="-1"></a>  <span class="dt">stop</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">button</span>(<span class="st">"Dừng"</span><span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">reduce</span><span class="op">:</span> () <span class="kw">=&gt;</span> <span class="st">"STOP"</span>})</span>
<span id="cb3-220"><a href="#cb3-220" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-221"><a href="#cb3-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-222"><a href="#cb3-222" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb3-223"><a href="#cb3-223" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> rows <span class="op">=</span> galton_sharp<span class="op">.</span><span class="at">rows</span><span class="op">;</span></span>
<span id="cb3-224"><a href="#cb3-224" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> speed <span class="op">=</span> galton_sharp<span class="op">.</span><span class="at">speed</span><span class="op">;</span></span>
<span id="cb3-225"><a href="#cb3-225" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> maxBalls <span class="op">=</span> galton_sharp<span class="op">.</span><span class="at">total</span><span class="op">;</span></span>
<span id="cb3-226"><a href="#cb3-226" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-227"><a href="#cb3-227" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 1. DIMENSIONS</span></span>
<span id="cb3-228"><a href="#cb3-228" aria-hidden="true" tabindex="-1"></a>  <span class="co">// The "Logical" size (how big it looks on screen)</span></span>
<span id="cb3-229"><a href="#cb3-229" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> logicalWidth <span class="op">=</span> <span class="dv">360</span><span class="op">;</span></span>
<span id="cb3-230"><a href="#cb3-230" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> logicalHeight <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span>
<span id="cb3-231"><a href="#cb3-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-232"><a href="#cb3-232" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 2. HIGH-DPI SCALING</span></span>
<span id="cb3-233"><a href="#cb3-233" aria-hidden="true" tabindex="-1"></a>  <span class="co">// We detect the user's screen density (e.g., 2.0 for Retina)</span></span>
<span id="cb3-234"><a href="#cb3-234" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dpr <span class="op">=</span> <span class="bu">window</span><span class="op">.</span><span class="at">devicePixelRatio</span> <span class="op">||</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-235"><a href="#cb3-235" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-236"><a href="#cb3-236" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> canvas <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"canvas"</span>)<span class="op">;</span></span>
<span id="cb3-237"><a href="#cb3-237" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Set the "Real" size (pixels in memory) higher</span></span>
<span id="cb3-238"><a href="#cb3-238" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">width</span> <span class="op">=</span> logicalWidth <span class="op">*</span> dpr<span class="op">;</span></span>
<span id="cb3-239"><a href="#cb3-239" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">height</span> <span class="op">=</span> logicalHeight <span class="op">*</span> dpr<span class="op">;</span></span>
<span id="cb3-240"><a href="#cb3-240" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Set the "CSS" size (pixels on screen) standard</span></span>
<span id="cb3-241"><a href="#cb3-241" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">width</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>logicalWidth<span class="sc">}</span><span class="vs">px`</span><span class="op">;</span></span>
<span id="cb3-242"><a href="#cb3-242" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">height</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>logicalHeight<span class="sc">}</span><span class="vs">px`</span><span class="op">;</span></span>
<span id="cb3-243"><a href="#cb3-243" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-244"><a href="#cb3-244" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ctx <span class="op">=</span> canvas<span class="op">.</span><span class="fu">getContext</span>(<span class="st">"2d"</span>)<span class="op">;</span></span>
<span id="cb3-245"><a href="#cb3-245" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Scale all drawing operations automatically</span></span>
<span id="cb3-246"><a href="#cb3-246" aria-hidden="true" tabindex="-1"></a>  ctx<span class="op">.</span><span class="fu">scale</span>(dpr<span class="op">,</span> dpr)<span class="op">;</span></span>
<span id="cb3-247"><a href="#cb3-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-248"><a href="#cb3-248" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- GEOMETRY (Uses logical units) ---</span></span>
<span id="cb3-249"><a href="#cb3-249" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pegSpacing <span class="op">=</span> logicalWidth <span class="op">/</span> (rows <span class="op">+</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-250"><a href="#cb3-250" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> rowHeight <span class="op">=</span> pegSpacing <span class="op">*</span> <span class="fl">0.85</span><span class="op">;</span> </span>
<span id="cb3-251"><a href="#cb3-251" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> startY <span class="op">=</span> <span class="dv">60</span><span class="op">;</span></span>
<span id="cb3-252"><a href="#cb3-252" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pegRadius <span class="op">=</span> pegSpacing <span class="op">*</span> <span class="fl">0.12</span><span class="op">;</span> </span>
<span id="cb3-253"><a href="#cb3-253" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ballRadius <span class="op">=</span> pegSpacing <span class="op">*</span> <span class="fl">0.23</span><span class="op">;</span> </span>
<span id="cb3-254"><a href="#cb3-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-255"><a href="#cb3-255" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> floorY <span class="op">=</span> logicalHeight <span class="op">-</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb3-256"><a href="#cb3-256" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> binWidth <span class="op">=</span> pegSpacing<span class="op">;</span></span>
<span id="cb3-257"><a href="#cb3-257" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalBinWidth <span class="op">=</span> (rows <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> binWidth<span class="op">;</span></span>
<span id="cb3-258"><a href="#cb3-258" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> binsStartX <span class="op">=</span> (logicalWidth <span class="op">-</span> totalBinWidth) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb3-259"><a href="#cb3-259" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> wallsTopY <span class="op">=</span> startY <span class="op">+</span> (rows) <span class="op">*</span> rowHeight <span class="op">+</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb3-260"><a href="#cb3-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-261"><a href="#cb3-261" aria-hidden="true" tabindex="-1"></a>  <span class="co">// PRE-COMPUTE BOARD</span></span>
<span id="cb3-262"><a href="#cb3-262" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pegGrid <span class="op">=</span> []<span class="op">;</span> </span>
<span id="cb3-263"><a href="#cb3-263" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> r <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> r <span class="op">&lt;</span> rows<span class="op">;</span> r<span class="op">++</span>) {</span>
<span id="cb3-264"><a href="#cb3-264" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rowPegs <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb3-265"><a href="#cb3-265" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pegsInThisRow <span class="op">=</span> r <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-266"><a href="#cb3-266" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rowWidth <span class="op">=</span> (pegsInThisRow <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> pegSpacing<span class="op">;</span></span>
<span id="cb3-267"><a href="#cb3-267" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rowStartX <span class="op">=</span> (logicalWidth <span class="op">-</span> rowWidth) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb3-268"><a href="#cb3-268" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> p <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> p <span class="op">&lt;</span> pegsInThisRow<span class="op">;</span> p<span class="op">++</span>) {</span>
<span id="cb3-269"><a href="#cb3-269" aria-hidden="true" tabindex="-1"></a>      rowPegs<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb3-270"><a href="#cb3-270" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> rowStartX <span class="op">+</span> p <span class="op">*</span> pegSpacing<span class="op">,</span></span>
<span id="cb3-271"><a href="#cb3-271" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> startY <span class="op">+</span> r <span class="op">*</span> rowHeight</span>
<span id="cb3-272"><a href="#cb3-272" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb3-273"><a href="#cb3-273" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-274"><a href="#cb3-274" aria-hidden="true" tabindex="-1"></a>    pegGrid<span class="op">.</span><span class="fu">push</span>(rowPegs)<span class="op">;</span></span>
<span id="cb3-275"><a href="#cb3-275" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-276"><a href="#cb3-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-277"><a href="#cb3-277" aria-hidden="true" tabindex="-1"></a>  <span class="co">// STATE</span></span>
<span id="cb3-278"><a href="#cb3-278" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> balls <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb3-279"><a href="#cb3-279" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> bins <span class="op">=</span> <span class="kw">new</span> <span class="bu">Array</span>(rows <span class="op">+</span> <span class="dv">1</span>)<span class="op">.</span><span class="fu">fill</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb3-280"><a href="#cb3-280" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> spawnedCount <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-281"><a href="#cb3-281" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> isRunning <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb3-282"><a href="#cb3-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-283"><a href="#cb3-283" aria-hidden="true" tabindex="-1"></a>  <span class="co">// CONTROLS</span></span>
<span id="cb3-284"><a href="#cb3-284" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> startBtn <span class="op">=</span> viewof control_sharp<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"button"</span>)<span class="op">;</span> </span>
<span id="cb3-285"><a href="#cb3-285" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> stopBtn <span class="op">=</span> viewof control_sharp<span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">"button"</span>)[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb3-286"><a href="#cb3-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-287"><a href="#cb3-287" aria-hidden="true" tabindex="-1"></a>  startBtn<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb3-288"><a href="#cb3-288" aria-hidden="true" tabindex="-1"></a>    balls <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb3-289"><a href="#cb3-289" aria-hidden="true" tabindex="-1"></a>    bins <span class="op">=</span> <span class="kw">new</span> <span class="bu">Array</span>(rows <span class="op">+</span> <span class="dv">1</span>)<span class="op">.</span><span class="fu">fill</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb3-290"><a href="#cb3-290" aria-hidden="true" tabindex="-1"></a>    spawnedCount <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-291"><a href="#cb3-291" aria-hidden="true" tabindex="-1"></a>    isRunning <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb3-292"><a href="#cb3-292" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb3-293"><a href="#cb3-293" aria-hidden="true" tabindex="-1"></a>  stopBtn<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> () <span class="kw">=&gt;</span> { isRunning <span class="op">=</span> <span class="kw">false</span><span class="op">;</span> }<span class="op">;</span></span>
<span id="cb3-294"><a href="#cb3-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-295"><a href="#cb3-295" aria-hidden="true" tabindex="-1"></a>  <span class="co">// PATH LOGIC</span></span>
<span id="cb3-296"><a href="#cb3-296" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">createBall</span>() {</span>
<span id="cb3-297"><a href="#cb3-297" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> currentInd <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> </span>
<span id="cb3-298"><a href="#cb3-298" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> path <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb3-299"><a href="#cb3-299" aria-hidden="true" tabindex="-1"></a>    path<span class="op">.</span><span class="fu">push</span>({ <span class="dt">x</span><span class="op">:</span> logicalWidth <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> startY <span class="op">-</span> <span class="dv">20</span> })<span class="op">;</span></span>
<span id="cb3-300"><a href="#cb3-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-301"><a href="#cb3-301" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> r <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> r <span class="op">&lt;</span> rows<span class="op">;</span> r<span class="op">++</span>) {</span>
<span id="cb3-302"><a href="#cb3-302" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> peg <span class="op">=</span> pegGrid[r][currentInd]<span class="op">;</span></span>
<span id="cb3-303"><a href="#cb3-303" aria-hidden="true" tabindex="-1"></a>       path<span class="op">.</span><span class="fu">push</span>({ <span class="dt">x</span><span class="op">:</span> peg<span class="op">.</span><span class="at">x</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> peg<span class="op">.</span><span class="at">y</span> <span class="op">-</span> pegRadius <span class="op">-</span> ballRadius })<span class="op">;</span></span>
<span id="cb3-304"><a href="#cb3-304" aria-hidden="true" tabindex="-1"></a>       <span class="cf">if</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>() <span class="op">&gt;</span> <span class="fl">0.5</span>) currentInd<span class="op">++;</span> </span>
<span id="cb3-305"><a href="#cb3-305" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-306"><a href="#cb3-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-307"><a href="#cb3-307" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> binX <span class="op">=</span> binsStartX <span class="op">+</span> currentInd <span class="op">*</span> binWidth <span class="op">+</span> binWidth<span class="op">/</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb3-308"><a href="#cb3-308" aria-hidden="true" tabindex="-1"></a>    path<span class="op">.</span><span class="fu">push</span>({ <span class="dt">x</span><span class="op">:</span> binX<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> wallsTopY })<span class="op">;</span></span>
<span id="cb3-309"><a href="#cb3-309" aria-hidden="true" tabindex="-1"></a>    path<span class="op">.</span><span class="fu">push</span>({ <span class="dt">x</span><span class="op">:</span> binX<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> floorY <span class="op">-</span> ballRadius<span class="op">,</span> <span class="dt">isFloor</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">binIndex</span><span class="op">:</span> currentInd })<span class="op">;</span></span>
<span id="cb3-310"><a href="#cb3-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-311"><a href="#cb3-311" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb3-312"><a href="#cb3-312" aria-hidden="true" tabindex="-1"></a>      <span class="dt">path</span><span class="op">:</span> path<span class="op">,</span></span>
<span id="cb3-313"><a href="#cb3-313" aria-hidden="true" tabindex="-1"></a>      <span class="dt">segment</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">active</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb3-314"><a href="#cb3-314" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> path[<span class="dv">0</span>]<span class="op">.</span><span class="at">x</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> path[<span class="dv">0</span>]<span class="op">.</span><span class="at">y</span></span>
<span id="cb3-315"><a href="#cb3-315" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb3-316"><a href="#cb3-316" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-317"><a href="#cb3-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-318"><a href="#cb3-318" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">spawnBall</span>() {</span>
<span id="cb3-319"><a href="#cb3-319" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>isRunning) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb3-320"><a href="#cb3-320" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (spawnedCount <span class="op">&gt;=</span> maxBalls) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb3-321"><a href="#cb3-321" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-322"><a href="#cb3-322" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> centerBinIdx <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(rows <span class="op">/</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-323"><a href="#cb3-323" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> maxCapacity <span class="op">=</span> (floorY <span class="op">-</span> wallsTopY) <span class="op">/</span> (ballRadius <span class="op">*</span> <span class="fl">0.6</span>)<span class="op">;</span> </span>
<span id="cb3-324"><a href="#cb3-324" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (bins[centerBinIdx] <span class="op">&gt;=</span> maxCapacity) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb3-325"><a href="#cb3-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-326"><a href="#cb3-326" aria-hidden="true" tabindex="-1"></a>    balls<span class="op">.</span><span class="fu">push</span>(<span class="fu">createBall</span>())<span class="op">;</span></span>
<span id="cb3-327"><a href="#cb3-327" aria-hidden="true" tabindex="-1"></a>    spawnedCount<span class="op">++;</span></span>
<span id="cb3-328"><a href="#cb3-328" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-329"><a href="#cb3-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-330"><a href="#cb3-330" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">update</span>(dt) {</span>
<span id="cb3-331"><a href="#cb3-331" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> spawnRate <span class="op">=</span> <span class="fl">0.15</span> <span class="op">/</span> speed<span class="op">;</span> </span>
<span id="cb3-332"><a href="#cb3-332" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (isRunning <span class="op">&amp;&amp;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>() <span class="op">&lt;</span> dt <span class="op">/</span> spawnRate) <span class="fu">spawnBall</span>()<span class="op">;</span></span>
<span id="cb3-333"><a href="#cb3-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-334"><a href="#cb3-334" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> b <span class="kw">of</span> balls) {</span>
<span id="cb3-335"><a href="#cb3-335" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>b<span class="op">.</span><span class="at">active</span>) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb3-336"><a href="#cb3-336" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>isRunning) <span class="cf">continue</span><span class="op">;</span> </span>
<span id="cb3-337"><a href="#cb3-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-338"><a href="#cb3-338" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> moveSpeed <span class="op">=</span> <span class="fl">3.5</span> <span class="op">*</span> speed <span class="op">*</span> dt<span class="op">;</span> </span>
<span id="cb3-339"><a href="#cb3-339" aria-hidden="true" tabindex="-1"></a>      b<span class="op">.</span><span class="at">t</span> <span class="op">+=</span> moveSpeed<span class="op">;</span></span>
<span id="cb3-340"><a href="#cb3-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-341"><a href="#cb3-341" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (b<span class="op">.</span><span class="at">t</span> <span class="op">&gt;=</span> <span class="dv">1</span>) {</span>
<span id="cb3-342"><a href="#cb3-342" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">t</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-343"><a href="#cb3-343" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">segment</span><span class="op">++;</span></span>
<span id="cb3-344"><a href="#cb3-344" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (b<span class="op">.</span><span class="at">segment</span> <span class="op">&gt;=</span> b<span class="op">.</span><span class="at">path</span><span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>) {</span>
<span id="cb3-345"><a href="#cb3-345" aria-hidden="true" tabindex="-1"></a>           b<span class="op">.</span><span class="at">active</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb3-346"><a href="#cb3-346" aria-hidden="true" tabindex="-1"></a>           <span class="kw">const</span> finalPt <span class="op">=</span> b<span class="op">.</span><span class="at">path</span>[b<span class="op">.</span><span class="at">path</span><span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb3-347"><a href="#cb3-347" aria-hidden="true" tabindex="-1"></a>           bins[finalPt<span class="op">.</span><span class="at">binIndex</span>]<span class="op">++;</span></span>
<span id="cb3-348"><a href="#cb3-348" aria-hidden="true" tabindex="-1"></a>           <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb3-349"><a href="#cb3-349" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb3-350"><a href="#cb3-350" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-351"><a href="#cb3-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-352"><a href="#cb3-352" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> p0 <span class="op">=</span> b<span class="op">.</span><span class="at">path</span>[b<span class="op">.</span><span class="at">segment</span>]<span class="op">;</span></span>
<span id="cb3-353"><a href="#cb3-353" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> p1 <span class="op">=</span> b<span class="op">.</span><span class="at">path</span>[b<span class="op">.</span><span class="at">segment</span> <span class="op">+</span> <span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb3-354"><a href="#cb3-354" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb3-355"><a href="#cb3-355" aria-hidden="true" tabindex="-1"></a>      b<span class="op">.</span><span class="at">x</span> <span class="op">=</span> p0<span class="op">.</span><span class="at">x</span> <span class="op">+</span> (p1<span class="op">.</span><span class="at">x</span> <span class="op">-</span> p0<span class="op">.</span><span class="at">x</span>) <span class="op">*</span> b<span class="op">.</span><span class="at">t</span><span class="op">;</span></span>
<span id="cb3-356"><a href="#cb3-356" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (p1<span class="op">.</span><span class="at">isFloor</span>) {</span>
<span id="cb3-357"><a href="#cb3-357" aria-hidden="true" tabindex="-1"></a>         b<span class="op">.</span><span class="at">y</span> <span class="op">=</span> p0<span class="op">.</span><span class="at">y</span> <span class="op">+</span> (p1<span class="op">.</span><span class="at">y</span> <span class="op">-</span> p0<span class="op">.</span><span class="at">y</span>) <span class="op">*</span> (b<span class="op">.</span><span class="at">t</span> <span class="op">*</span> b<span class="op">.</span><span class="at">t</span>)<span class="op">;</span> </span>
<span id="cb3-358"><a href="#cb3-358" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb3-359"><a href="#cb3-359" aria-hidden="true" tabindex="-1"></a>         b<span class="op">.</span><span class="at">y</span> <span class="op">=</span> p0<span class="op">.</span><span class="at">y</span> <span class="op">+</span> (p1<span class="op">.</span><span class="at">y</span> <span class="op">-</span> p0<span class="op">.</span><span class="at">y</span>) <span class="op">*</span> (b<span class="op">.</span><span class="at">t</span> <span class="op">*</span> b<span class="op">.</span><span class="at">t</span>)<span class="op">;</span> </span>
<span id="cb3-360"><a href="#cb3-360" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-361"><a href="#cb3-361" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-362"><a href="#cb3-362" aria-hidden="true" tabindex="-1"></a>    balls <span class="op">=</span> balls<span class="op">.</span><span class="fu">filter</span>(b <span class="kw">=&gt;</span> b<span class="op">.</span><span class="at">active</span>)<span class="op">;</span></span>
<span id="cb3-363"><a href="#cb3-363" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-364"><a href="#cb3-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-365"><a href="#cb3-365" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">draw</span>() {</span>
<span id="cb3-366"><a href="#cb3-366" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Clear the full logical area</span></span>
<span id="cb3-367"><a href="#cb3-367" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#E8E0C5"</span><span class="op">;</span></span>
<span id="cb3-368"><a href="#cb3-368" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillRect</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> logicalWidth<span class="op">,</span> logicalHeight)<span class="op">;</span></span>
<span id="cb3-369"><a href="#cb3-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-370"><a href="#cb3-370" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Pegs</span></span>
<span id="cb3-371"><a href="#cb3-371" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#666"</span><span class="op">;</span></span>
<span id="cb3-372"><a href="#cb3-372" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> row <span class="kw">of</span> pegGrid) {</span>
<span id="cb3-373"><a href="#cb3-373" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (<span class="kw">let</span> p <span class="kw">of</span> row) {</span>
<span id="cb3-374"><a href="#cb3-374" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb3-375"><a href="#cb3-375" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="fu">arc</span>(p<span class="op">.</span><span class="at">x</span><span class="op">,</span> p<span class="op">.</span><span class="at">y</span><span class="op">,</span> pegRadius<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">*</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-376"><a href="#cb3-376" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb3-377"><a href="#cb3-377" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-378"><a href="#cb3-378" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-379"><a href="#cb3-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-380"><a href="#cb3-380" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Walls</span></span>
<span id="cb3-381"><a href="#cb3-381" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"#998866"</span><span class="op">;</span></span>
<span id="cb3-382"><a href="#cb3-382" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-383"><a href="#cb3-383" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> rows <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-384"><a href="#cb3-384" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x <span class="op">=</span> binsStartX <span class="op">+</span> i <span class="op">*</span> binWidth<span class="op">;</span></span>
<span id="cb3-385"><a href="#cb3-385" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb3-386"><a href="#cb3-386" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="fu">moveTo</span>(x<span class="op">,</span> wallsTopY)<span class="op">;</span></span>
<span id="cb3-387"><a href="#cb3-387" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="fu">lineTo</span>(x<span class="op">,</span> logicalHeight)<span class="op">;</span></span>
<span id="cb3-388"><a href="#cb3-388" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb3-389"><a href="#cb3-389" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-390"><a href="#cb3-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-391"><a href="#cb3-391" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Active Balls</span></span>
<span id="cb3-392"><a href="#cb3-392" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#0033CC"</span><span class="op">;</span></span>
<span id="cb3-393"><a href="#cb3-393" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> b <span class="kw">of</span> balls) {</span>
<span id="cb3-394"><a href="#cb3-394" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb3-395"><a href="#cb3-395" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="fu">arc</span>(b<span class="op">.</span><span class="at">x</span><span class="op">,</span> b<span class="op">.</span><span class="at">y</span><span class="op">,</span> ballRadius<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">*</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-396"><a href="#cb3-396" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb3-397"><a href="#cb3-397" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-398"><a href="#cb3-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-399"><a href="#cb3-399" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Stacked Balls</span></span>
<span id="cb3-400"><a href="#cb3-400" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> bins<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-401"><a href="#cb3-401" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> count <span class="op">=</span> bins[i]<span class="op">;</span></span>
<span id="cb3-402"><a href="#cb3-402" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> cx <span class="op">=</span> binsStartX <span class="op">+</span> i <span class="op">*</span> binWidth <span class="op">+</span> binWidth<span class="op">/</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb3-403"><a href="#cb3-403" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"#4d79ff"</span><span class="op">;</span></span>
<span id="cb3-404"><a href="#cb3-404" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb3-405"><a href="#cb3-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-406"><a href="#cb3-406" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (<span class="kw">let</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> count<span class="op">;</span> j<span class="op">++</span>) {</span>
<span id="cb3-407"><a href="#cb3-407" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> cy <span class="op">=</span> floorY <span class="op">-</span> j <span class="op">*</span> (ballRadius <span class="op">*</span> <span class="fl">0.6</span>)<span class="op">;</span> </span>
<span id="cb3-408"><a href="#cb3-408" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (cy <span class="op">&lt;</span> wallsTopY) <span class="cf">break</span><span class="op">;</span></span>
<span id="cb3-409"><a href="#cb3-409" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb3-410"><a href="#cb3-410" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="fu">arc</span>(cx<span class="op">,</span> cy<span class="op">,</span> ballRadius<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">*</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-411"><a href="#cb3-411" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#0033CC"</span><span class="op">;</span></span>
<span id="cb3-412"><a href="#cb3-412" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb3-413"><a href="#cb3-413" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb3-414"><a href="#cb3-414" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-415"><a href="#cb3-415" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-416"><a href="#cb3-416" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-417"><a href="#cb3-417" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Status Text</span></span>
<span id="cb3-418"><a href="#cb3-418" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#444"</span><span class="op">;</span></span>
<span id="cb3-419"><a href="#cb3-419" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">font</span> <span class="op">=</span> <span class="st">"bold 14px sans-serif"</span><span class="op">;</span></span>
<span id="cb3-420"><a href="#cb3-420" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillText</span>(<span class="vs">`Số viên bi: </span><span class="sc">${</span>spawnedCount<span class="sc">}</span><span class="vs"> / </span><span class="sc">${</span>maxBalls<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">25</span>)<span class="op">;</span></span>
<span id="cb3-421"><a href="#cb3-421" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-422"><a href="#cb3-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-423"><a href="#cb3-423" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> lastTime <span class="op">=</span> <span class="bu">performance</span><span class="op">.</span><span class="fu">now</span>()<span class="op">;</span></span>
<span id="cb3-424"><a href="#cb3-424" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> frameId<span class="op">;</span></span>
<span id="cb3-425"><a href="#cb3-425" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">tick</span>(now) {</span>
<span id="cb3-426"><a href="#cb3-426" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> dt <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>((now <span class="op">-</span> lastTime) <span class="op">/</span> <span class="dv">1000</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">;</span></span>
<span id="cb3-427"><a href="#cb3-427" aria-hidden="true" tabindex="-1"></a>    lastTime <span class="op">=</span> now<span class="op">;</span></span>
<span id="cb3-428"><a href="#cb3-428" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update</span>(dt)<span class="op">;</span></span>
<span id="cb3-429"><a href="#cb3-429" aria-hidden="true" tabindex="-1"></a>    <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb3-430"><a href="#cb3-430" aria-hidden="true" tabindex="-1"></a>    frameId <span class="op">=</span> <span class="fu">requestAnimationFrame</span>(tick)<span class="op">;</span></span>
<span id="cb3-431"><a href="#cb3-431" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-432"><a href="#cb3-432" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-433"><a href="#cb3-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb3-434"><a href="#cb3-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tick</span>(lastTime)<span class="op">;</span></span>
<span id="cb3-435"><a href="#cb3-435" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-436"><a href="#cb3-436" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">assign</span>(canvas<span class="op">,</span> {</span>
<span id="cb3-437"><a href="#cb3-437" aria-hidden="true" tabindex="-1"></a>    <span class="dt">remove</span><span class="op">:</span> () <span class="kw">=&gt;</span> <span class="fu">cancelAnimationFrame</span>(frameId)</span>
<span id="cb3-438"><a href="#cb3-438" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb3-439"><a href="#cb3-439" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-3" data-nodetype="expression">

</div>
</div>
</div>
</div>
<p><strong>Tại sao lại là phân phối nhị thức?</strong></p>
<ul>
<li>Mỗi lần viên bi chạm vào chiếc đinh, có hai trường hợp xảy ra: viên bi sẽ nảy sang trái hoặc sang phải, xác suất nảy sang mỗi bên là <span class="math inline">\(p = 0.5\)</span>, giống như tung đồng xu. Đây là một phép thử Bernoulli.</li>
<li>Nếu bảng có 10 hàng đinh, viên bi sẽ thực hiện 10 lần tung đồng xu liên tiếp.</li>
<li>Các ô chứa tương ứng với số lần viên bi nảy về bên phải. Để vào ô giữa, viên bi phải nảy sang bên phải 5 lần, để vào ô cuối cùng, viên bi phải nảy sang bên phải 10 lần.</li>
</ul>
</section>
<section id="hồi-quy-logistic" class="level4" data-number="4.2.1.3">
<h4 data-number="4.2.1.3" class="anchored" data-anchor-id="hồi-quy-logistic"><span class="header-section-number">4.2.1.3</span> Hồi quy logistic</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(formula, data, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(formula, data, <span class="at">family =</span> <span class="st">"binomial"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>Tại sao trong hồi quy logistic lại ghi <code>family = "binomial"</code>?</strong></p>
<p>Ví dụ: Hút thuốc lá có làm tăng nguy cơ ung thư phổi không?</p>
<ul>
<li>Biến độc lập: Số điếu thuốc hút mỗi ngày</li>
<li>Biến phụ thuộc: Tình trạng ung thư phổi (1 = Có bệnh, 0 = Không bệnh)</li>
</ul>
<p>Khi xây dựng mô hình, chúng ta xem xét từng cá nhân trong dữ liệu như một phép thử ngẫu nhiên:</p>
<ul>
<li>Với một người cụ thể (ví dụ: anh A, hút 1 gói/ngày), việc anh ta có bị ung thư hay không giống như việc tung một đồng xu: mặt ngửa (1) là bị ung thư, mặt sấp (0) là không bị ung thư. <strong>Nhưng</strong> xác suất tung ra mặt ngửa của đồng xu này không phải là 0.5, mà phụ thuộc vào việc anh ta hút bao nhiêu thuốc.</li>
<li>Khi chúng ta tiến hành nghiên cứu trên <span class="math inline">\(n\)</span> người, đây là 1 chuỗi Bernoulli, vì vậy có thể chọn phân phối Binomial để mô hình nó.</li>
</ul>
<p>Khai báo <code>family = "binomial"</code> nghĩa là: “Biến kết quả (<span class="math inline">\(Y\)</span>) là đếm số lần thành công (hoặc thất bại) từ các phép thử nhị phân, hãy dùng công thức xác suất của phân phối nhị thức để ước lượng.”</p>
</section>
</section>
<section id="phân-phối-siêu-bội-hypergeometric-distribution" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="phân-phối-siêu-bội-hypergeometric-distribution"><span class="header-section-number">4.2.2</span> Phân phối siêu bội (hypergeometric distribution)</h3>
<p>Tình huống: Bạn có bộ bài 52 lá, trong đó có 4 lá hậu. Bạn rút 5 lá.</p>
<p>Luật chơi:</p>
<ul>
<li>Số lần thử cố định (<span class="math inline">\(n\)</span>)</li>
<li>Các lần thử phụ thuộc nhau</li>
<li>Lấy mẫu không hoàn lại từ một quần thể hữu hạn (<span class="math inline">\(N\)</span>)</li>
</ul>
<p>Câu hỏi: “Tôi rút được bao nhiêu lá hậu?”</p>
</section>
</section>
<section id="đếm-số-lần-thử" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="đếm-số-lần-thử"><span class="header-section-number">4.3</span> Đếm số lần thử</h2>
<p>Chúng ta quyết định trước phần thưởng mình muốn đạt được (<span class="math inline">\(k\)</span> thành công), và đếm xem phải tốn bao nhiêu công sức (<span class="math inline">\(n\)</span> lần thử) để đạt được nó. Nhánh này mô hình hóa sự “kiên trì” hoặc “sức chịu đựng”.</p>
<section id="phân-phối-hình-học-geometric-distribution" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="phân-phối-hình-học-geometric-distribution"><span class="header-section-number">4.3.1</span> Phân phối hình học (geometric distribution)</h3>
<p>Tình huống: Một gia đình phong kiến trọng nam khinh nữ muốn có một đứa con trai, họ cứ sinh con cho đến khi có con trai thì thôi</p>
<p>Câu hỏi: Họ phải sinh bao nhiêu con cho đến khi có con trai?</p>
<p>Đặc tính: Không có bộ nhớ (Memoryless). Dù đã sinh 10 con gái liên tiếp, xác suất đứa tiếp theo là trai vẫn y như lúc bắt đầu.</p>
</section>
<section id="phân-phối-nhị-thức-âm-negative-binomial-distribution" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="phân-phối-nhị-thức-âm-negative-binomial-distribution"><span class="header-section-number">4.3.2</span> Phân phối nhị thức âm (negative binomial distribution)</h3>
<p>Tình huống: Gia đình phong kiến đã sinh được con trai nhưng vẫn muốn có con trai nữa, thầy bói nói nhà phải có 3 đứa con trai mới giàu được</p>
<p>Câu hỏi: Họ sẽ sinh bao nhiêu con trước khi có được đứa con trai thứ 3?</p>
<p>Về lý thuyết, đây là tổng của <span class="math inline">\(k\)</span> biến thuộc phân phối hình học.</p>
<p>Trong sinh học thực tế (ví dụ: đếm số ký sinh trùng, ấu trùng muỗi), phương sai thường lớn hơn trung bình rất nhiều (do hiện tượng tụ đám/clumping). Phân phối Nhị thức Âm khớp với kiểu dữ liệu này tốt hơn nhiều so với Poisson hay Nhị thức.</p>
</section>
</section>
<section id="đếm-sự-kiện-khi-biết-tốc-độ-trung-bình" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="đếm-sự-kiện-khi-biết-tốc-độ-trung-bình"><span class="header-section-number">4.4</span> Đếm sự kiện khi biết tốc độ trung bình</h2>
<section id="phân-phối-poisson" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="phân-phối-poisson"><span class="header-section-number">4.4.1</span> Phân phối Poisson</h3>
<p>Poisson là giới hạn của nhị thức khi <span class="math inline">\(n \to \infty\)</span> và <span class="math inline">\(p \to 0\)</span>, sao cho <span class="math inline">\(np = \lambda\)</span></p>
<p>Các phân phối phức tạp có thể được tạo ra bằng cách cộng các phân phối đơn giản:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Nếu cộng</th>
<th>Sẽ có</th>
<th>Điều kiện</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Nhiều Bernoulli</td>
<td>Nhị thức</td>
<td>Cùng <span class="math inline">\(p\)</span>.</td>
</tr>
<tr class="even">
<td>Nhiều Nhị thức</td>
<td>Nhị thức</td>
<td><span class="math inline">\(X+Y \sim \text{Bin}(n+m, p)\)</span></td>
</tr>
<tr class="odd">
<td>Nhiều Hình học</td>
<td>Nhị thức âm</td>
<td>Chờ <span class="math inline">\(k\)</span> thành công thực chất là chờ 1 thành công, lặp lại <span class="math inline">\(k\)</span> lần</td>
</tr>
<tr class="even">
<td>Nhiều Nhị thức âm</td>
<td>Nhị thức âm</td>
<td><span class="math inline">\(X+Y \sim \text{NB}(r_1+r_2, p)\)</span></td>
</tr>
<tr class="odd">
<td>Nhiều Poisson</td>
<td>Poisson</td>
<td><span class="math inline">\(X+Y \sim \text{Pois}(\lambda_1 + \lambda_2)\)</span></td>
</tr>
</tbody>
</table>


</section>
</section>

</main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxudmlld29mIG5fY29pbnMgPSBJbnB1dHMucmFuZ2UoWzEsIDIwXSwge2xhYmVsOiBcIkNvaW5zIHBlciBGbGlwIChuKVwiLCB2YWx1ZTogMTAsIHN0ZXA6IDF9KVxudmlld29mIHBfaGVhZCA9IElucHV0cy5yYW5nZShbMC4wMSwgMC45OV0sIHtsYWJlbDogXCJQcm9iLiBvZiBIZWFkcyAocClcIiwgdmFsdWU6IDAuNSwgc3RlcDogMC4wMX0pXG52aWV3b2Ygc3BlZWQgPSBJbnB1dHMucmFuZ2UoWzEwLCAxMDAwXSwge2xhYmVsOiBcIlNwZWVkIChtcylcIiwgdmFsdWU6IDIwMCwgdHJhbnNmb3JtOiB4ID0+IDEwMTAgLSB4fSlcblxudmlld29mIGZsaXBCdG4gPSBJbnB1dHMuYnV0dG9uKFwiRmxpcCBPbmNlXCIpXG52aWV3b2YgYXV0b0J0biA9IElucHV0cy5idXR0b24oXCJTdGFydC9TdG9wIEF1dG8tRmxpcFwiKVxudmlld29mIHJlc2V0Q29pbkJ0biA9IElucHV0cy5idXR0b24oXCJSZXNldCBEYXRhXCIpXG5cbi8vIEEuIFNUQVRFIENPTlRBSU5FUlxuLy8gSG9sZHMgdGhlIGRhdGEgaGlzdG9yeS5cbmNvaW5fc3RhdGUgPSB7XG4gIC8vIFdlIGRlZmluZSBpdCBvbmNlLiBJdCBwZXJzaXN0cyB1bnRpbCB5b3UgcmVsb2FkIHRoZSBwYWdlLlxuICByZXR1cm4ge1xuICAgIGhpc3Rvcnk6IFtdLCBcbiAgICBjdXJyZW50VG9zczogW10sXG4gICAgdG90YWxIZWFkczogMCxcbiAgICBjb3VudDogMCxcbiAgICBsYXN0UmVzZXQ6IDBcbiAgfTtcbn1cblxuLy8gQi4gR0FNRSBMT0dJQ1xuLy8gVGhpcyBjZWxsIHJ1bnMgd2hlbmV2ZXIgeW91IGNsaWNrIGEgYnV0dG9uLlxuY29pbl9sb2dpYyA9IHtcbiAgLy8gMS4gTElTVEVOIFRPIFRSSUdHRVJTXG4gIGZsaXBCdG47XG4gIGF1dG9CdG47XG4gIHJlc2V0Q29pbkJ0bjtcbiAgXG4gIC8vIDIuIEhBTkRMRSBSRVNFVFxuICAvLyBXZSBjaGVjayBpZiB0aGUgcmVzZXQgYnV0dG9uIGNvdW50ZXIgaGFzIGluY3JlYXNlZFxuICBpZiAocmVzZXRDb2luQnRuID4gY29pbl9zdGF0ZS5sYXN0UmVzZXQpIHtcbiAgICAgIGNvaW5fc3RhdGUuaGlzdG9yeSA9IFtdO1xuICAgICAgY29pbl9zdGF0ZS5jdXJyZW50VG9zcyA9IFtdO1xuICAgICAgY29pbl9zdGF0ZS50b3RhbEhlYWRzID0gMDtcbiAgICAgIGNvaW5fc3RhdGUuY291bnQgPSAwO1xuICAgICAgY29pbl9zdGF0ZS5sYXN0UmVzZXQgPSByZXNldENvaW5CdG47XG4gICAgICAvLyBSZXR1cm4gaW1tZWRpYXRlbHkgdG8gY2xlYXIgdGhlIHBsb3RcbiAgICAgIHJldHVybiBjb2luX3N0YXRlLmNvdW50OyBcbiAgfVxuXG4gIC8vIDMuIERFRklORSBUSEUgRkxJUCBGVU5DVElPTlxuICBjb25zdCBkb0ZsaXAgPSAoKSA9PiB7XG4gICAgbGV0IGhlYWRzID0gMDtcbiAgICBjb25zdCBvdXRjb21lID0gW107XG4gICAgZm9yKGxldCBpPTA7IGk8bl9jb2luczsgaSsrKSB7XG4gICAgICBjb25zdCBpc0hlYWQgPSBNYXRoLnJhbmRvbSgpIDwgcF9oZWFkO1xuICAgICAgb3V0Y29tZS5wdXNoKGlzSGVhZCA/IDEgOiAwKTtcbiAgICAgIGlmKGlzSGVhZCkgaGVhZHMrKztcbiAgICB9XG4gICAgY29pbl9zdGF0ZS5jdXJyZW50VG9zcyA9IG91dGNvbWU7XG4gICAgY29pbl9zdGF0ZS5oaXN0b3J5LnB1c2goaGVhZHMpO1xuICAgIGNvaW5fc3RhdGUudG90YWxIZWFkcyA9IGhlYWRzO1xuICAgIGNvaW5fc3RhdGUuY291bnQrKztcbiAgfTtcblxuICAvLyA0LiBFWEVDVVRJT04gTU9ERVxuICAvLyBJZiBBdXRvIEJ1dHRvbiBpcyBPREQgKDEsIDMsIDUuLi4pLCB3ZSBhcmUgaW4gQXV0byBNb2RlXG4gIGNvbnN0IGlzQXV0byA9IChhdXRvQnRuICUgMikgIT09IDA7XG5cbiAgaWYgKGlzQXV0bykge1xuICAgIC8vIC0tLSBBVVRPIE1PREUgKExvb3ApIC0tLVxuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICBkb0ZsaXAoKTtcbiAgICAgIHlpZWxkIGNvaW5fc3RhdGUuY291bnQ7IC8vIFlpZWxkIHVwZGF0ZXMgdGhlIHBsb3QhXG4gICAgICBhd2FpdCBuZXcgUHJvbWlzZShyID0+IHNldFRpbWVvdXQociwgMTAxMCAtIHNwZWVkKSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIC8vIC0tLSBNQU5VQUwgTU9ERSAoU2luZ2xlIFNob3QpIC0tLVxuICAgIC8vIElmIHdlIGFyZW4ndCBpbiBhdXRvLCBhbmQgdGhpcyBjZWxsIHJhbiwgaXQgbWVhbnMgJ2ZsaXBCdG4nIHdhcyBjbGlja2VkXG4gICAgLy8gKG9yIGEgc2xpZGVyIGNoYW5nZWQpLiBXZSBmbGlwIG9uY2UuXG4gICAgaWYgKGNvaW5fc3RhdGUuY291bnQgPiAwIHx8IGZsaXBCdG4gPiAwKSB7XG4gICAgICAgZG9GbGlwKCk7XG4gICAgfVxuICAgIHJldHVybiBjb2luX3N0YXRlLmNvdW50O1xuICB9XG59XG5cbi8vIDMuIFRIRSBWSVNVQUxJWkFUSU9OIChGaXhlZDogU3BsaXQgaW50byB0d28gcGxvdHMpXG57XG4gIC8vIERFUEVOREVOQ1k6IExpc3RlbiB0byB0aGUgbG9naWMhXG4gIGNvaW5fbG9naWM7IFxuICBcbiAgLy8gUGxvdCBBOiBUaGUgQ29pbnMgKFRvcCBTdHJpcClcbiAgY29uc3QgY29pblBsb3QgPSBQbG90LnBsb3Qoe1xuICAgIHdpZHRoOiA2MDAsXG4gICAgaGVpZ2h0OiA4MCwgLy8gRml4ZWQgaGVpZ2h0IGZvciBqdXN0IHRoZSBjb2luc1xuICAgIHRpdGxlOiBgVG9zcyAjJHtjb2luX3N0YXRlLmNvdW50fTogUmVzdWx0YCxcbiAgICB4OiB7YXhpczogbnVsbCwgZG9tYWluOiBbMCwgbl9jb2luc119LFxuICAgIHk6IHtheGlzOiBudWxsfSxcbiAgICBtYXJrczogW1xuICAgICAgUGxvdC5kb3QoY29pbl9zdGF0ZS5jdXJyZW50VG9zcy5tYXAoKGQsIGkpID0+ICh7eDogaSwgdmFsOiBkfSkpLCB7XG4gICAgICAgIHg6IChkLCBpKSA9PiBtYXBSYW5nZShpLCAwLCBuX2NvaW5zLTEsIDAuNSwgbl9jb2lucy0wLjUpLCBcbiAgICAgICAgeTogMCwgXG4gICAgICAgIHI6IDEyLFxuICAgICAgICBmaWxsOiBkID0+IGQudmFsID09PSAxID8gXCIjZjc5NDFkXCIgOiBcIiNjY2NcIiwgXG4gICAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgICBzdHJva2VXaWR0aDogMlxuICAgICAgfSksXG4gICAgICBQbG90LnRleHQoY29pbl9zdGF0ZS5jdXJyZW50VG9zcy5tYXAoKGQsIGkpID0+ICh7eDogaSwgdmFsOiBkfSkpLCB7XG4gICAgICAgIHg6IChkLCBpKSA9PiBtYXBSYW5nZShpLCAwLCBuX2NvaW5zLTEsIDAuNSwgbl9jb2lucy0wLjUpLCBcbiAgICAgICAgeTogMCwgXG4gICAgICAgIHRleHQ6IGQgPT4gZC52YWwgPT09IDEgPyBcIkhcIiA6IFwiVFwiLFxuICAgICAgICBmaWxsOiBcImJsYWNrXCIsIGZvbnRXZWlnaHQ6IFwiYm9sZFwiLCBkeTogMVxuICAgICAgfSlcbiAgICBdXG4gIH0pO1xuXG4gIC8vIFBsb3QgQjogVGhlIEhpc3RvZ3JhbSAoQm90dG9tIENoYXJ0KVxuICBjb25zdCBoaXN0UGxvdCA9IFBsb3QucGxvdCh7XG4gICAgd2lkdGg6IDYwMCxcbiAgICBoZWlnaHQ6IDM1MCxcbiAgICB0aXRsZTogYERpc3RyaWJ1dGlvbiBvZiBIZWFkcyAoVG90YWw6ICR7Y29pbl9zdGF0ZS5oaXN0b3J5Lmxlbmd0aH0gZXhwZXJpbWVudHMpYCxcbiAgICB4OiB7bGFiZWw6IFwiTnVtYmVyIG9mIEhlYWRzXCIsIGRvbWFpbjogWzAsIG5fY29pbnNdfSxcbiAgICB5OiB7bGFiZWw6IFwiRnJlcXVlbmN5XCIsIGdyaWQ6IHRydWV9LCAvLyBTdGFuZGFyZCBxdWFudGl0YXRpdmUgYXhpcyAoQm90dG9tLVVwKVxuICAgIG1hcmtzOiBbXG4gICAgICAvLyAxLiBUaGUgQmx1ZSBIaXN0b2dyYW1cbiAgICAgIFBsb3QucmVjdFkoY29pbl9zdGF0ZS5oaXN0b3J5LCBQbG90LmJpblgoXG4gICAgICAgIHt5OiBcImNvdW50XCJ9LCBcbiAgICAgICAge3g6IGQgPT4gZCwgZG9tYWluOiBbMCwgbl9jb2luc10sIHRocmVzaG9sZHM6IGQzLnJhbmdlKDAsIG5fY29pbnMgKyAyKSwgZmlsbDogXCIjNGU3OWE3XCIsIG9wYWNpdHk6IDAuNn1cbiAgICAgICkpLFxuICAgICAgXG4gICAgICAvLyAyLiBUaGUgVGhlb3JldGljYWwgUmVkIExpbmVcbiAgICAgIFBsb3QubGluZShkMy5yYW5nZSgwLCBuX2NvaW5zICsgMSksIHtcbiAgICAgICAgeDogZCA9PiBkICsgMC41LCBcbiAgICAgICAgeTogZCA9PiBiaW5vbWlhbFBNRihkLCBuX2NvaW5zLCBwX2hlYWQpICogY29pbl9zdGF0ZS5oaXN0b3J5Lmxlbmd0aCxcbiAgICAgICAgc3Ryb2tlOiBcInJlZFwiLCBzdHJva2VXaWR0aDogMiwgY3VydmU6IFwibmF0dXJhbFwiXG4gICAgICB9KSxcbiAgICAgIFxuICAgICAgUGxvdC5ydWxlWShbMF0pXG4gICAgXVxuICB9KTtcblxuICAvLyBSZXR1cm4gYm90aCBzdGFja2VkIHRvZ2V0aGVyXG4gIHJldHVybiBodGwuaHRtbGA8ZGl2PiR7Y29pblBsb3R9JHtoaXN0UGxvdH08L2Rpdj5gO1xufVxuXG4vLyBIZWxwZXIgRnVuY3Rpb25zXG5mdW5jdGlvbiBtYXBSYW5nZSh2YWx1ZSwgbG93MSwgaGlnaDEsIGxvdzIsIGhpZ2gyKSB7XG4gICAgaWYgKGhpZ2gxID09PSBsb3cxKSByZXR1cm4gbG93MjtcbiAgICByZXR1cm4gbG93MiArIChoaWdoMiAtIGxvdzIpICogKHZhbHVlIC0gbG93MSkgLyAoaGlnaDEgLSBsb3cxKTtcbn1cblxuZnVuY3Rpb24gZmFjdG9yaWFsKG4pIHtcbiAgaWYgKG4gPT09IDAgfHwgbiA9PT0gMSkgcmV0dXJuIDE7XG4gIGxldCByZXN1bHQgPSAxOyBcbiAgZm9yIChsZXQgaSA9IDI7IGkgPD0gbjsgaSsrKSByZXN1bHQgKj0gaTsgXG4gIHJldHVybiByZXN1bHQ7IFxufVxuXG5mdW5jdGlvbiBjb21iaW5hdGlvbihuLCBrKSB7XG4gIHJldHVybiBmYWN0b3JpYWwobikgLyAoZmFjdG9yaWFsKGspICogZmFjdG9yaWFsKG4gLSBrKSk7XG59XG5cbmZ1bmN0aW9uIGJpbm9taWFsUE1GKGssIG4sIHApIHtcbiAgcmV0dXJuIGNvbWJpbmF0aW9uKG4sIGspICogTWF0aC5wb3cocCwgaykgKiBNYXRoLnBvdygxIC0gcCwgbiAtIGspO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIGdhbHRvbl9zaGFycCA9IElucHV0cy5mb3JtKHtcbiAgcm93czogSW5wdXRzLnJhbmdlKFs4LCAyMF0sIHt2YWx1ZTogMTAsIHN0ZXA6IDEsIGxhYmVsOiBcIlPhu5EgaMOgbmcgxJFpbmhcIn0pLFxuICBzcGVlZDogSW5wdXRzLnJhbmdlKFswLjUsIDNdLCB7dmFsdWU6IDIsIHN0ZXA6IDAuMSwgbGFiZWw6IFwiVOG7kWMgxJHhu5lcIn0pLFxuICB0b3RhbDogSW5wdXRzLnJhbmdlKFs1MCwgODAwXSwge3ZhbHVlOiAyMDAsIHN0ZXA6IDEwLCBsYWJlbDogXCJT4buRIHZpw6puIGJpXCJ9KVxufSlcblxudmlld29mIGNvbnRyb2xfc2hhcnAgPSBJbnB1dHMuZm9ybSh7XG4gIHN0YXJ0OiBJbnB1dHMuYnV0dG9uKFwiQuG6r3QgxJHhuqd1XCIsIHt2YWx1ZTogbnVsbCwgcmVkdWNlOiAoKSA9PiBcIlNUQVJUXCJ9KSxcbiAgc3RvcDogSW5wdXRzLmJ1dHRvbihcIkThu6tuZ1wiLCB7dmFsdWU6IG51bGwsIHJlZHVjZTogKCkgPT4gXCJTVE9QXCJ9KVxufSlcblxue1xuICBjb25zdCByb3dzID0gZ2FsdG9uX3NoYXJwLnJvd3M7XG4gIGNvbnN0IHNwZWVkID0gZ2FsdG9uX3NoYXJwLnNwZWVkO1xuICBjb25zdCBtYXhCYWxscyA9IGdhbHRvbl9zaGFycC50b3RhbDtcbiAgXG4gIC8vIDEuIERJTUVOU0lPTlNcbiAgLy8gVGhlIFwiTG9naWNhbFwiIHNpemUgKGhvdyBiaWcgaXQgbG9va3Mgb24gc2NyZWVuKVxuICBjb25zdCBsb2dpY2FsV2lkdGggPSAzNjA7XG4gIGNvbnN0IGxvZ2ljYWxIZWlnaHQgPSA2MDA7XG5cbiAgLy8gMi4gSElHSC1EUEkgU0NBTElOR1xuICAvLyBXZSBkZXRlY3QgdGhlIHVzZXIncyBzY3JlZW4gZGVuc2l0eSAoZS5nLiwgMi4wIGZvciBSZXRpbmEpXG4gIGNvbnN0IGRwciA9IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIHx8IDE7XG4gIFxuICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAvLyBTZXQgdGhlIFwiUmVhbFwiIHNpemUgKHBpeGVscyBpbiBtZW1vcnkpIGhpZ2hlclxuICBjYW52YXMud2lkdGggPSBsb2dpY2FsV2lkdGggKiBkcHI7XG4gIGNhbnZhcy5oZWlnaHQgPSBsb2dpY2FsSGVpZ2h0ICogZHByO1xuICAvLyBTZXQgdGhlIFwiQ1NTXCIgc2l6ZSAocGl4ZWxzIG9uIHNjcmVlbikgc3RhbmRhcmRcbiAgY2FudmFzLnN0eWxlLndpZHRoID0gYCR7bG9naWNhbFdpZHRofXB4YDtcbiAgY2FudmFzLnN0eWxlLmhlaWdodCA9IGAke2xvZ2ljYWxIZWlnaHR9cHhgO1xuICBcbiAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgLy8gU2NhbGUgYWxsIGRyYXdpbmcgb3BlcmF0aW9ucyBhdXRvbWF0aWNhbGx5XG4gIGN0eC5zY2FsZShkcHIsIGRwcik7XG5cbiAgLy8gLS0tIEdFT01FVFJZIChVc2VzIGxvZ2ljYWwgdW5pdHMpIC0tLVxuICBjb25zdCBwZWdTcGFjaW5nID0gbG9naWNhbFdpZHRoIC8gKHJvd3MgKyAyKTtcbiAgY29uc3Qgcm93SGVpZ2h0ID0gcGVnU3BhY2luZyAqIDAuODU7IFxuICBjb25zdCBzdGFydFkgPSA2MDtcbiAgY29uc3QgcGVnUmFkaXVzID0gcGVnU3BhY2luZyAqIDAuMTI7IFxuICBjb25zdCBiYWxsUmFkaXVzID0gcGVnU3BhY2luZyAqIDAuMjM7IFxuXG4gIGNvbnN0IGZsb29yWSA9IGxvZ2ljYWxIZWlnaHQgLSAxMDtcbiAgY29uc3QgYmluV2lkdGggPSBwZWdTcGFjaW5nO1xuICBjb25zdCB0b3RhbEJpbldpZHRoID0gKHJvd3MgKyAxKSAqIGJpbldpZHRoO1xuICBjb25zdCBiaW5zU3RhcnRYID0gKGxvZ2ljYWxXaWR0aCAtIHRvdGFsQmluV2lkdGgpIC8gMjtcbiAgY29uc3Qgd2FsbHNUb3BZID0gc3RhcnRZICsgKHJvd3MpICogcm93SGVpZ2h0ICsgMTA7XG5cbiAgLy8gUFJFLUNPTVBVVEUgQk9BUkRcbiAgY29uc3QgcGVnR3JpZCA9IFtdOyBcbiAgZm9yIChsZXQgciA9IDA7IHIgPCByb3dzOyByKyspIHtcbiAgICBjb25zdCByb3dQZWdzID0gW107XG4gICAgY29uc3QgcGVnc0luVGhpc1JvdyA9IHIgKyAxO1xuICAgIGNvbnN0IHJvd1dpZHRoID0gKHBlZ3NJblRoaXNSb3cgLSAxKSAqIHBlZ1NwYWNpbmc7XG4gICAgY29uc3Qgcm93U3RhcnRYID0gKGxvZ2ljYWxXaWR0aCAtIHJvd1dpZHRoKSAvIDI7XG4gICAgZm9yIChsZXQgcCA9IDA7IHAgPCBwZWdzSW5UaGlzUm93OyBwKyspIHtcbiAgICAgIHJvd1BlZ3MucHVzaCh7XG4gICAgICAgIHg6IHJvd1N0YXJ0WCArIHAgKiBwZWdTcGFjaW5nLFxuICAgICAgICB5OiBzdGFydFkgKyByICogcm93SGVpZ2h0XG4gICAgICB9KTtcbiAgICB9XG4gICAgcGVnR3JpZC5wdXNoKHJvd1BlZ3MpO1xuICB9XG5cbiAgLy8gU1RBVEVcbiAgbGV0IGJhbGxzID0gW107XG4gIGxldCBiaW5zID0gbmV3IEFycmF5KHJvd3MgKyAxKS5maWxsKDApO1xuICBsZXQgc3Bhd25lZENvdW50ID0gMDtcbiAgbGV0IGlzUnVubmluZyA9IGZhbHNlO1xuXG4gIC8vIENPTlRST0xTXG4gIGNvbnN0IHN0YXJ0QnRuID0gdmlld29mIGNvbnRyb2xfc2hhcnAucXVlcnlTZWxlY3RvcihcImJ1dHRvblwiKTsgXG4gIGNvbnN0IHN0b3BCdG4gPSB2aWV3b2YgY29udHJvbF9zaGFycC5xdWVyeVNlbGVjdG9yQWxsKFwiYnV0dG9uXCIpWzFdO1xuXG4gIHN0YXJ0QnRuLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgYmFsbHMgPSBbXTtcbiAgICBiaW5zID0gbmV3IEFycmF5KHJvd3MgKyAxKS5maWxsKDApO1xuICAgIHNwYXduZWRDb3VudCA9IDA7XG4gICAgaXNSdW5uaW5nID0gdHJ1ZTtcbiAgfTtcbiAgc3RvcEJ0bi5vbmNsaWNrID0gKCkgPT4geyBpc1J1bm5pbmcgPSBmYWxzZTsgfTtcblxuICAvLyBQQVRIIExPR0lDXG4gIGZ1bmN0aW9uIGNyZWF0ZUJhbGwoKSB7XG4gICAgbGV0IGN1cnJlbnRJbmQgPSAwOyBcbiAgICBsZXQgcGF0aCA9IFtdO1xuICAgIHBhdGgucHVzaCh7IHg6IGxvZ2ljYWxXaWR0aCAvIDIsIHk6IHN0YXJ0WSAtIDIwIH0pO1xuXG4gICAgZm9yIChsZXQgciA9IDA7IHIgPCByb3dzOyByKyspIHtcbiAgICAgICBjb25zdCBwZWcgPSBwZWdHcmlkW3JdW2N1cnJlbnRJbmRdO1xuICAgICAgIHBhdGgucHVzaCh7IHg6IHBlZy54LCB5OiBwZWcueSAtIHBlZ1JhZGl1cyAtIGJhbGxSYWRpdXMgfSk7XG4gICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPiAwLjUpIGN1cnJlbnRJbmQrKzsgXG4gICAgfVxuXG4gICAgY29uc3QgYmluWCA9IGJpbnNTdGFydFggKyBjdXJyZW50SW5kICogYmluV2lkdGggKyBiaW5XaWR0aC8yO1xuICAgIHBhdGgucHVzaCh7IHg6IGJpblgsIHk6IHdhbGxzVG9wWSB9KTtcbiAgICBwYXRoLnB1c2goeyB4OiBiaW5YLCB5OiBmbG9vclkgLSBiYWxsUmFkaXVzLCBpc0Zsb29yOiB0cnVlLCBiaW5JbmRleDogY3VycmVudEluZCB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICBwYXRoOiBwYXRoLFxuICAgICAgc2VnbWVudDogMCwgdDogMCwgYWN0aXZlOiB0cnVlLFxuICAgICAgeDogcGF0aFswXS54LCB5OiBwYXRoWzBdLnlcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gc3Bhd25CYWxsKCkge1xuICAgIGlmICghaXNSdW5uaW5nKSByZXR1cm47XG4gICAgaWYgKHNwYXduZWRDb3VudCA+PSBtYXhCYWxscykgcmV0dXJuO1xuICAgIFxuICAgIGNvbnN0IGNlbnRlckJpbklkeCA9IE1hdGguZmxvb3Iocm93cyAvIDIpO1xuICAgIGNvbnN0IG1heENhcGFjaXR5ID0gKGZsb29yWSAtIHdhbGxzVG9wWSkgLyAoYmFsbFJhZGl1cyAqIDAuNik7IFxuICAgIGlmIChiaW5zW2NlbnRlckJpbklkeF0gPj0gbWF4Q2FwYWNpdHkpIHJldHVybjtcblxuICAgIGJhbGxzLnB1c2goY3JlYXRlQmFsbCgpKTtcbiAgICBzcGF3bmVkQ291bnQrKztcbiAgfVxuXG4gIGZ1bmN0aW9uIHVwZGF0ZShkdCkge1xuICAgIGNvbnN0IHNwYXduUmF0ZSA9IDAuMTUgLyBzcGVlZDsgXG4gICAgaWYgKGlzUnVubmluZyAmJiBNYXRoLnJhbmRvbSgpIDwgZHQgLyBzcGF3blJhdGUpIHNwYXduQmFsbCgpO1xuXG4gICAgZm9yIChsZXQgYiBvZiBiYWxscykge1xuICAgICAgaWYgKCFiLmFjdGl2ZSkgY29udGludWU7XG4gICAgICBpZiAoIWlzUnVubmluZykgY29udGludWU7IFxuXG4gICAgICBjb25zdCBtb3ZlU3BlZWQgPSAzLjUgKiBzcGVlZCAqIGR0OyBcbiAgICAgIGIudCArPSBtb3ZlU3BlZWQ7XG5cbiAgICAgIGlmIChiLnQgPj0gMSkge1xuICAgICAgICBiLnQgPSAwO1xuICAgICAgICBiLnNlZ21lbnQrKztcbiAgICAgICAgaWYgKGIuc2VnbWVudCA+PSBiLnBhdGgubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICBiLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICBjb25zdCBmaW5hbFB0ID0gYi5wYXRoW2IucGF0aC5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgYmluc1tmaW5hbFB0LmJpbkluZGV4XSsrO1xuICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCBwMCA9IGIucGF0aFtiLnNlZ21lbnRdO1xuICAgICAgY29uc3QgcDEgPSBiLnBhdGhbYi5zZWdtZW50ICsgMV07XG4gICAgICBcbiAgICAgIGIueCA9IHAwLnggKyAocDEueCAtIHAwLngpICogYi50O1xuICAgICAgaWYgKHAxLmlzRmxvb3IpIHtcbiAgICAgICAgIGIueSA9IHAwLnkgKyAocDEueSAtIHAwLnkpICogKGIudCAqIGIudCk7IFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgIGIueSA9IHAwLnkgKyAocDEueSAtIHAwLnkpICogKGIudCAqIGIudCk7IFxuICAgICAgfVxuICAgIH1cbiAgICBiYWxscyA9IGJhbGxzLmZpbHRlcihiID0+IGIuYWN0aXZlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRyYXcoKSB7XG4gICAgLy8gQ2xlYXIgdGhlIGZ1bGwgbG9naWNhbCBhcmVhXG4gICAgY3R4LmZpbGxTdHlsZSA9IFwiI0U4RTBDNVwiO1xuICAgIGN0eC5maWxsUmVjdCgwLCAwLCBsb2dpY2FsV2lkdGgsIGxvZ2ljYWxIZWlnaHQpO1xuXG4gICAgLy8gUGVnc1xuICAgIGN0eC5maWxsU3R5bGUgPSBcIiM2NjZcIjtcbiAgICBmb3IgKGxldCByb3cgb2YgcGVnR3JpZCkge1xuICAgICAgZm9yIChsZXQgcCBvZiByb3cpIHtcbiAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICBjdHguYXJjKHAueCwgcC55LCBwZWdSYWRpdXMsIDAsIE1hdGguUEkqMik7XG4gICAgICAgIGN0eC5maWxsKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gV2FsbHNcbiAgICBjdHguc3Ryb2tlU3R5bGUgPSBcIiM5OTg4NjZcIjtcbiAgICBjdHgubGluZVdpZHRoID0gMTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSByb3dzICsgMTsgaSsrKSB7XG4gICAgICBjb25zdCB4ID0gYmluc1N0YXJ0WCArIGkgKiBiaW5XaWR0aDtcbiAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgIGN0eC5tb3ZlVG8oeCwgd2FsbHNUb3BZKTtcbiAgICAgIGN0eC5saW5lVG8oeCwgbG9naWNhbEhlaWdodCk7XG4gICAgICBjdHguc3Ryb2tlKCk7XG4gICAgfVxuXG4gICAgLy8gQWN0aXZlIEJhbGxzXG4gICAgY3R4LmZpbGxTdHlsZSA9IFwiIzAwMzNDQ1wiO1xuICAgIGZvciAobGV0IGIgb2YgYmFsbHMpIHtcbiAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgIGN0eC5hcmMoYi54LCBiLnksIGJhbGxSYWRpdXMsIDAsIE1hdGguUEkqMik7XG4gICAgICBjdHguZmlsbCgpO1xuICAgIH1cblxuICAgIC8vIFN0YWNrZWQgQmFsbHNcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJpbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGNvdW50ID0gYmluc1tpXTtcbiAgICAgIGNvbnN0IGN4ID0gYmluc1N0YXJ0WCArIGkgKiBiaW5XaWR0aCArIGJpbldpZHRoLzI7XG4gICAgICBjdHguc3Ryb2tlU3R5bGUgPSBcIiM0ZDc5ZmZcIjtcbiAgICAgIGN0eC5saW5lV2lkdGggPSAwLjU7XG5cbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY291bnQ7IGorKykge1xuICAgICAgICBjb25zdCBjeSA9IGZsb29yWSAtIGogKiAoYmFsbFJhZGl1cyAqIDAuNik7IFxuICAgICAgICBpZiAoY3kgPCB3YWxsc1RvcFkpIGJyZWFrO1xuICAgICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICAgIGN0eC5hcmMoY3gsIGN5LCBiYWxsUmFkaXVzLCAwLCBNYXRoLlBJKjIpO1xuICAgICAgICBjdHguZmlsbFN0eWxlID0gXCIjMDAzM0NDXCI7XG4gICAgICAgIGN0eC5maWxsKCk7XG4gICAgICAgIGN0eC5zdHJva2UoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gU3RhdHVzIFRleHRcbiAgICBjdHguZmlsbFN0eWxlID0gXCIjNDQ0XCI7XG4gICAgY3R4LmZvbnQgPSBcImJvbGQgMTRweCBzYW5zLXNlcmlmXCI7XG4gICAgY3R4LmZpbGxUZXh0KGBT4buRIHZpw6puIGJpOiAke3NwYXduZWRDb3VudH0gLyAke21heEJhbGxzfWAsIDEwLCAyNSk7XG4gIH1cblxuICBsZXQgbGFzdFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgbGV0IGZyYW1lSWQ7XG4gIGZ1bmN0aW9uIHRpY2sobm93KSB7XG4gICAgY29uc3QgZHQgPSBNYXRoLm1pbigobm93IC0gbGFzdFRpbWUpIC8gMTAwMCwgMC4xKTtcbiAgICBsYXN0VGltZSA9IG5vdztcbiAgICB1cGRhdGUoZHQpO1xuICAgIGRyYXcoKTtcbiAgICBmcmFtZUlkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRpY2spO1xuICB9XG4gIFxuICBkcmF3KCk7XG4gIHRpY2sobGFzdFRpbWUpO1xuICBcbiAgcmV0dXJuIE9iamVjdC5hc3NpZ24oY2FudmFzLCB7XG4gICAgcmVtb3ZlOiAoKSA9PiBjYW5jZWxBbmltYXRpb25GcmFtZShmcmFtZUlkKVxuICB9KTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnbl9jb2lucycpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdwX2hlYWQnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnc3BlZWQnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnZmxpcEJ0bicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdhdXRvQnRuJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3Jlc2V0Q29pbkJ0bicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdnYWx0b25fc2hhcnAnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnY29udHJvbF9zaGFycCcpIn1dfQ==
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../..";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./distr-shape.html" class="pagination-link" aria-label="Hình dạng phân phối">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Hình dạng phân phối</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link" aria-label="Tài liệu tham khảo">
        <span class="nav-page-text">Tài liệu tham khảo</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>