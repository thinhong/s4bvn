<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Phân phối rời rạc – Statistics for babies</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./distr-bin.html" rel="next">
<link href="./distr.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-832c273f0af7a47d06e59912ec7b3523.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-N2T5TFNFY7"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-N2T5TFNFY7', { 'anonymize_ip': true});
</script>
<script type="module" src="site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./distr-d.html">Phân phối rời rạc</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Statistics for babies</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prob.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Xác suất</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Phân phối xác suất</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./distr-d.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Phân phối rời rạc</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-bin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Phân phối nhị thức</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-pois.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Phân phối Poisson</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./distr-c.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Phân phối liên tục</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-norm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Phân phối bình thường</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-lnorm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Phân phối log-normal</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-exp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Phân phối mũ</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-pl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Phân phối quy tắc lũy thừa</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lik.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hàm hợp lý</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Bayesian</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./thanks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lời cảm ơn</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tài liệu tham khảo</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#phép-thử-bernoulli-bernoulli-trial-hay-binomial-trial" id="toc-phép-thử-bernoulli-bernoulli-trial-hay-binomial-trial" class="nav-link active" data-scroll-target="#phép-thử-bernoulli-bernoulli-trial-hay-binomial-trial">Phép thử Bernoulli (Bernoulli trial, hay binomial trial)</a></li>
  <li><a href="#đếm-số-lần-thành-công" id="toc-đếm-số-lần-thành-công" class="nav-link" data-scroll-target="#đếm-số-lần-thành-công">Đếm số lần thành công</a>
  <ul class="collapse">
  <li><a href="#phân-phối-nhị-thức-binomial-distribution" id="toc-phân-phối-nhị-thức-binomial-distribution" class="nav-link" data-scroll-target="#phân-phối-nhị-thức-binomial-distribution">Phân phối Nhị thức (Binomial distribution)</a></li>
  <li><a href="#phân-phối-siêu-bội-hypergeometric-distribution" id="toc-phân-phối-siêu-bội-hypergeometric-distribution" class="nav-link" data-scroll-target="#phân-phối-siêu-bội-hypergeometric-distribution">Phân phối Siêu bội (Hypergeometric distribution)</a></li>
  </ul></li>
  <li><a href="#đếm-số-lần-thử" id="toc-đếm-số-lần-thử" class="nav-link" data-scroll-target="#đếm-số-lần-thử">Đếm số lần thử</a>
  <ul class="collapse">
  <li><a href="#phân-phối-hình-học-geometric-distribution" id="toc-phân-phối-hình-học-geometric-distribution" class="nav-link" data-scroll-target="#phân-phối-hình-học-geometric-distribution">Phân phối hình học (geometric distribution)</a></li>
  <li><a href="#phân-phối-nhị-thức-âm-negative-binomial-distribution" id="toc-phân-phối-nhị-thức-âm-negative-binomial-distribution" class="nav-link" data-scroll-target="#phân-phối-nhị-thức-âm-negative-binomial-distribution">Phân phối Nhị thức âm (negative binomial distribution)</a></li>
  </ul></li>
  <li><a href="#đếm-sự-kiện-khi-biết-tốc-độ-trung-bình" id="toc-đếm-sự-kiện-khi-biết-tốc-độ-trung-bình" class="nav-link" data-scroll-target="#đếm-sự-kiện-khi-biết-tốc-độ-trung-bình">Đếm sự kiện khi biết tốc độ trung bình</a>
  <ul class="collapse">
  <li><a href="#phân-phối-poisson" id="toc-phân-phối-poisson" class="nav-link" data-scroll-target="#phân-phối-poisson">Phân phối Poisson</a></li>
  <li><a href="#ví-dụ-1" id="toc-ví-dụ-1" class="nav-link" data-scroll-target="#ví-dụ-1">Ví dụ</a></li>
  </ul></li>
  <li><a href="#ứng-dụng" id="toc-ứng-dụng" class="nav-link" data-scroll-target="#ứng-dụng">Ứng dụng</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Phân phối rời rạc</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="phép-thử-bernoulli-bernoulli-trial-hay-binomial-trial" class="level2">
<h2 class="anchored" data-anchor-id="phép-thử-bernoulli-bernoulli-trial-hay-binomial-trial">Phép thử Bernoulli (Bernoulli trial, hay binomial trial)</h2>
<p>Là một lần thử nghiệm duy nhất, không gian mẫu chỉ có đúng 2 kết quả: Thành công (Success) hoặc Thất bại (Failure)</p>
<p>Ví dụ: tung đồng xu (mặt sấp, mặt ngửa), xét nghiệm một ca nghi ngờ (dương tính, âm tính)</p>
<p>Khi ta thực hiện phép thử Bernoulli nhiều lần liên tiếp (ví dụ: tung một đồng xu nhiều lần, dùng một loại xét nghiệm để test nhiều người), ta đang thực hiện 1 chuỗi Bernoulli (Bernoulli process). Chuỗi Bernoulli chuẩn cần thỏa 2 điều kiện:</p>
<ul>
<li>Độc lập (Independent): Kết quả của lần thử này không ảnh hưởng đến lần thử khác.</li>
<li>Xác suất không đổi: Xác suất thành công (<span class="math inline">\(p\)</span>) phải giống hệt nhau ở mọi lần thử.</li>
</ul>
<p>Hầu hết các phân phối rời rạc đều xuất phát từ chuỗi Bernoulli với các mục tiêu khác nhau.</p>
</section>
<section id="đếm-số-lần-thành-công" class="level2">
<h2 class="anchored" data-anchor-id="đếm-số-lần-thành-công">Đếm số lần thành công</h2>
<p>Chúng ta quyết định trước sẽ bỏ ra bao nhiêu công sức (<span class="math inline">\(n\)</span> lần thử), và đếm xem thu được bao nhiêu phần thưởng (<span class="math inline">\(k\)</span> thành công).</p>
<section id="phân-phối-nhị-thức-binomial-distribution" class="level3">
<h3 class="anchored" data-anchor-id="phân-phối-nhị-thức-binomial-distribution">Phân phối Nhị thức (Binomial distribution)</h3>
<p>Đếm số lần thành công (<span class="math inline">\(k\)</span>) trong một số lượng cố định các phép thử Bernoulli độc lập (<span class="math inline">\(n\)</span>).</p>
<p>Xác suất để đạt được đúng <span class="math inline">\(k\)</span> lần thành công là:</p>
<p><span class="math display">\[\mathbb{P}(X = k) = \binom{n}{k} p^k (1-p)^{n-k}\]</span></p>
<p>Với:</p>
<ul>
<li><span class="math inline">\(n\)</span>: Tổng số lần thực hiện phép thử</li>
<li><span class="math inline">\(p\)</span>: Xác suất thành công của mỗi lần thử (không đổi)</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Giải thích
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="math display">\[\underbrace{\binom{n}{k}}_{\text{Số cách chọn}} \cdot \underbrace{p^k}_{k \text{ lần thành công}} \cdot \underbrace{(1-p)^{n-k}}_{n-k \text{ lần thất bại}}\]</span></p>
</div>
</div>
<section id="ví-dụ" class="level4">
<h4 class="anchored" data-anchor-id="ví-dụ">Ví dụ</h4>
<p>Tung 1 đồng xu 10 lần, khả năng đếm được 1, 2, 3… mặt ngửa là bao nhiêu?</p>
<ul>
<li>Tổng số lần thực hiện phép thử: <span class="math inline">\(n = 10\)</span></li>
<li>Xác suất ra mặt ngửa mỗi lần: <span class="math inline">\(p = 0.5\)</span></li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb1" data-startfrom="50" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 49;"><span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>viewof coin_sim_manual <span class="op">=</span> (() <span class="kw">=&gt;</span> {</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 1. SETUP DOM &amp; STYLES ---</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Rigid container size: 400px width, 340px height (40px controls + 300px canvas)</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="vs">    width: 400px;</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="vs">    height: 340px; </span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="vs">    margin: 0 auto;</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="vs">    display: flex;</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="vs">    flex-direction: column;</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="vs">    align-items: center;</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="vs">    border: 1px solid transparent;</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Inject UI HTML directly (Total Control, Zero Shift)</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;style&gt;</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="vs">      .coin-controls-row {</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="vs">        width: 100%;</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="vs">        height: 40px;</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a><span class="vs">        display: flex;</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a><span class="vs">        justify-content: center;</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a><span class="vs">        align-items: center;</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a><span class="vs">        gap: 12px;</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a><span class="vs">        margin-bottom: 0px;</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a><span class="vs">      .coin-btn {</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a><span class="vs">        padding: 6px 14px;</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a><span class="vs">        border-radius: 6px;</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a><span class="vs">        border: 1px solid #d1d5db;</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a><span class="vs">        background-color: white;</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a><span class="vs">        color: #374151;</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-size: 14px;</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-weight: 600;</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a><span class="vs">        cursor: pointer;</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a><span class="vs">        line-height: 1.2;</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a><span class="vs">      .coin-btn:hover { background-color: #f3f4f6; }</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a><span class="vs">      .coin-btn-primary {</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a><span class="vs">        background-color: #3b82f6; </span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a><span class="vs">        color: white; </span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a><span class="vs">        border-color: #2563eb;</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a><span class="vs">      .coin-btn-primary:hover { background-color: #2563eb; color: white; }</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a><span class="vs">      .coin-toggle {</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a><span class="vs">        display: flex; align-items: center; gap: 6px;</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-size: 14px; font-weight: 500; color: #4b5563;</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a><span class="vs">        cursor: pointer; user-select: none;</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a><span class="vs">      .coin-toggle input { width: 16px; height: 16px; accent-color: #10b981; cursor: pointer; }</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a><span class="vs">      canvas { display: block; } /* Removes ghost margin */</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/style&gt;</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div class="coin-controls-row"&gt;</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;button id="btn-flip" class="coin-btn coin-btn-primary"&gt;Tung đồng xu&lt;/button&gt;</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;label class="coin-toggle"&gt;</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;input type="checkbox" id="chk-auto"&gt;</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a><span class="vs">        Tự động chạy</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/label&gt;</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;button id="btn-reset" class="coin-btn"&gt;Làm lại&lt;/button&gt;</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 2. CANVAS SETUP ---</span></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> width <span class="op">=</span> <span class="dv">400</span><span class="op">;</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> height <span class="op">=</span> <span class="dv">300</span><span class="op">;</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> canvas <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"canvas"</span>)<span class="op">;</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dpr <span class="op">=</span> <span class="bu">window</span><span class="op">.</span><span class="at">devicePixelRatio</span> <span class="op">||</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">width</span> <span class="op">=</span> width <span class="op">*</span> dpr<span class="op">;</span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">height</span> <span class="op">=</span> height <span class="op">*</span> dpr<span class="op">;</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">width</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>width<span class="sc">}</span><span class="vs">px`</span><span class="op">;</span></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">height</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>height<span class="sc">}</span><span class="vs">px`</span><span class="op">;</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ctx <span class="op">=</span> canvas<span class="op">.</span><span class="fu">getContext</span>(<span class="st">"2d"</span><span class="op">,</span> { <span class="dt">alpha</span><span class="op">:</span> <span class="kw">false</span> })<span class="op">;</span></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>  ctx<span class="op">.</span><span class="fu">scale</span>(dpr<span class="op">,</span> dpr)<span class="op">;</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="fu">appendChild</span>(canvas)<span class="op">;</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 3. STATE &amp; CONSTANTS ---</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> N <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> P <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Colors</span></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> BG_COLOR<span class="op">=</span><span class="st">"#fff"</span><span class="op">,</span> TEXT_COLOR<span class="op">=</span><span class="st">"#2c3e50"</span><span class="op">;</span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> HEAD_COLOR<span class="op">=</span><span class="st">"#f1c40f"</span><span class="op">,</span> HEAD_BORDER<span class="op">=</span><span class="st">"#d4ac0d"</span><span class="op">;</span></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> TAIL_COLOR<span class="op">=</span><span class="st">"#bdc3c7"</span><span class="op">,</span> TAIL_BORDER<span class="op">=</span><span class="st">"#95a5a6"</span><span class="op">;</span></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> CHART_BAR<span class="op">=</span><span class="st">"#3498db"</span><span class="op">,</span> CHART_ACTIVE<span class="op">=</span><span class="st">"#2980b9"</span><span class="op">,</span> CHART_THEO<span class="op">=</span><span class="st">"rgba(44, 62, 80, 0.1)"</span><span class="op">;</span></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Math Helper</span></span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">binomial</span>(k<span class="op">,</span> n<span class="op">,</span> p) {</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">nCr</span>(n<span class="op">,</span> r) {</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (r <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">||</span> r <span class="op">&gt;</span> n) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> res <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>r<span class="op">;</span> i<span class="op">++</span>) res <span class="op">=</span> res <span class="op">*</span> (n <span class="op">-</span> i) <span class="op">/</span> (i <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> res<span class="op">;</span></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">nCr</span>(n<span class="op">,</span> k) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(p<span class="op">,</span> k) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(<span class="dv">1</span> <span class="op">-</span> p<span class="op">,</span> n <span class="op">-</span> k)<span class="op">;</span></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Simulation State</span></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> S <span class="op">=</span> {</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>     <span class="dt">history</span><span class="op">:</span> []<span class="op">,</span> </span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>     <span class="dt">counts</span><span class="op">:</span> {}<span class="op">,</span>  </span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>     <span class="dt">totalFlips</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>     <span class="dt">currentResult</span><span class="op">:</span> []<span class="op">,</span> </span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>     <span class="dt">animation</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> </span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>     <span class="dt">cooldown</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>     <span class="dt">isAuto</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;=</span>N<span class="op">;</span> i<span class="op">++</span>) S<span class="op">.</span><span class="at">counts</span>[i] <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 4. LOGIC ---</span></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">runFlip</span>() {</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>     <span class="kw">let</span> heads <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>     <span class="kw">const</span> res <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>     <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>N<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> isHead <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>() <span class="op">&lt;</span> P<span class="op">;</span></span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>        res<span class="op">.</span><span class="fu">push</span>(isHead <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (isHead) heads<span class="op">++;</span></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>     <span class="kw">const</span> coinSize <span class="op">=</span> <span class="dv">28</span><span class="op">;</span></span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>     <span class="kw">const</span> gap <span class="op">=</span> <span class="dv">6</span><span class="op">;</span></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>     <span class="kw">const</span> totalW <span class="op">=</span> N <span class="op">*</span> coinSize <span class="op">+</span> (N<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>gap<span class="op">;</span></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>     <span class="kw">const</span> startX <span class="op">=</span> (width <span class="op">-</span> totalW) <span class="op">/</span> <span class="dv">2</span> <span class="op">+</span> coinSize<span class="op">/</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>     S<span class="op">.</span><span class="at">currentResult</span> <span class="op">=</span> res<span class="op">.</span><span class="fu">map</span>((val<span class="op">,</span> i) <span class="kw">=&gt;</span> ({</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>        <span class="dt">val</span><span class="op">:</span> val<span class="op">,</span></span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> width<span class="op">/</span><span class="dv">2</span><span class="op">,</span> </span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span></span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>        <span class="dt">targetX</span><span class="op">:</span> startX <span class="op">+</span> i <span class="op">*</span> (coinSize <span class="op">+</span> gap)<span class="op">,</span> </span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>        <span class="dt">targetY</span><span class="op">:</span> <span class="dv">85</span><span class="op">,</span></span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>        <span class="dt">r</span><span class="op">:</span> coinSize <span class="op">/</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>        <span class="dt">t</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>     }))<span class="op">;</span></span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>     S<span class="op">.</span><span class="at">history</span><span class="op">.</span><span class="fu">push</span>(heads)<span class="op">;</span></span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>     S<span class="op">.</span><span class="at">counts</span>[heads] <span class="op">=</span> (S<span class="op">.</span><span class="at">counts</span>[heads] <span class="op">||</span> <span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>     S<span class="op">.</span><span class="at">totalFlips</span><span class="op">++;</span></span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>     S<span class="op">.</span><span class="at">animation</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>     S<span class="op">.</span><span class="at">cooldown</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">reset</span>() {</span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>     S<span class="op">.</span><span class="at">history</span> <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>     <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;=</span>N<span class="op">;</span> i<span class="op">++</span>) S<span class="op">.</span><span class="at">counts</span>[i] <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>     S<span class="op">.</span><span class="at">totalFlips</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>     S<span class="op">.</span><span class="at">currentResult</span> <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>     S<span class="op">.</span><span class="at">animation</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 5. LOOP ---</span></span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">update</span>() {</span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>     <span class="co">// Auto Run Logic</span></span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> (S<span class="op">.</span><span class="at">isAuto</span> <span class="op">&amp;&amp;</span> S<span class="op">.</span><span class="at">animation</span> <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>        S<span class="op">.</span><span class="at">cooldown</span><span class="op">++;</span></span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (S<span class="op">.</span><span class="at">cooldown</span> <span class="op">&gt;</span> <span class="dv">20</span>) <span class="fu">runFlip</span>()<span class="op">;</span> <span class="co">// Speed: ~0.3s</span></span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>     <span class="co">// Animation Logic</span></span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> (S<span class="op">.</span><span class="at">animation</span> <span class="op">===</span> <span class="dv">1</span>) {</span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>       <span class="kw">let</span> done <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>       <span class="cf">for</span> (<span class="kw">let</span> c <span class="kw">of</span> S<span class="op">.</span><span class="at">currentResult</span>) {</span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (c<span class="op">.</span><span class="at">t</span> <span class="op">&lt;</span> <span class="dv">1</span>) {</span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>             c<span class="op">.</span><span class="at">t</span> <span class="op">+=</span> <span class="fl">0.2</span><span class="op">;</span> </span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>             <span class="cf">if</span> (c<span class="op">.</span><span class="at">t</span> <span class="op">&gt;</span> <span class="dv">1</span>) c<span class="op">.</span><span class="at">t</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>             <span class="kw">const</span> ease <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(<span class="dv">1</span> <span class="op">-</span> c<span class="op">.</span><span class="at">t</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>             c<span class="op">.</span><span class="at">x</span> <span class="op">=</span> width<span class="op">/</span><span class="dv">2</span> <span class="op">+</span> (c<span class="op">.</span><span class="at">targetX</span> <span class="op">-</span> width<span class="op">/</span><span class="dv">2</span>) <span class="op">*</span> ease<span class="op">;</span></span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>             c<span class="op">.</span><span class="at">y</span> <span class="op">=</span> c<span class="op">.</span><span class="at">targetY</span> <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(c<span class="op">.</span><span class="at">t</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">*</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>             done <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>       }</span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>       <span class="cf">if</span> (done) S<span class="op">.</span><span class="at">animation</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">draw</span>() {</span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> BG_COLOR<span class="op">;</span></span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillRect</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height)<span class="op">;</span></span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">save</span>()<span class="op">;</span></span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">font</span> <span class="op">=</span> <span class="st">"bold 14px -apple-system, BlinkMacSystemFont, sans-serif"</span><span class="op">;</span></span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fontVariantNumeric</span> <span class="op">=</span> <span class="st">"tabular-nums"</span><span class="op">;</span></span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1. Text Info</span></span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Left: Count</span></span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">textAlign</span> <span class="op">=</span> <span class="st">"left"</span><span class="op">;</span> ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> TEXT_COLOR<span class="op">;</span></span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillText</span>(<span class="vs">`Lần chạy: </span><span class="sc">${</span>S<span class="op">.</span><span class="at">totalFlips</span><span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span>)<span class="op">;</span></span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Center: Status</span></span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (S<span class="op">.</span><span class="at">isAuto</span>) {</span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">textAlign</span> <span class="op">=</span> <span class="st">"center"</span><span class="op">;</span> ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#27ae60"</span><span class="op">;</span></span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">fillText</span>(<span class="st">"● Đang chạy..."</span><span class="op">,</span> <span class="dv">170</span><span class="op">,</span> <span class="dv">30</span>)<span class="op">;</span> <span class="co">// Adjusted center for visual balance</span></span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Right: Result</span></span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (S<span class="op">.</span><span class="at">currentResult</span><span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> hCount <span class="op">=</span> S<span class="op">.</span><span class="at">currentResult</span><span class="op">.</span><span class="fu">filter</span>(c <span class="kw">=&gt;</span> c<span class="op">.</span><span class="at">val</span><span class="op">===</span><span class="dv">1</span>)<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">textAlign</span> <span class="op">=</span> <span class="st">"right"</span><span class="op">;</span> ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#d35400"</span><span class="op">;</span></span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">fillText</span>(<span class="vs">`Mặt Ngửa: </span><span class="sc">${</span>hCount<span class="sc">}</span><span class="vs"> / </span><span class="sc">${</span>N<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> width <span class="op">-</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span>)<span class="op">;</span></span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">restore</span>()<span class="op">;</span></span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 2. Coins</span></span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> c <span class="kw">of</span> S<span class="op">.</span><span class="at">currentResult</span>) {</span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">arc</span>(c<span class="op">.</span><span class="at">x</span><span class="op">,</span> c<span class="op">.</span><span class="at">y</span><span class="op">,</span> c<span class="op">.</span><span class="at">r</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">*</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> c<span class="op">.</span><span class="at">val</span> <span class="op">===</span> <span class="dv">1</span> <span class="op">?</span> HEAD_COLOR <span class="op">:</span> TAIL_COLOR<span class="op">;</span></span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> c<span class="op">.</span><span class="at">val</span> <span class="op">===</span> <span class="dv">1</span> <span class="op">?</span> HEAD_BORDER <span class="op">:</span> TAIL_BORDER<span class="op">;</span></span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"white"</span><span class="op">;</span></span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">textAlign</span> <span class="op">=</span> <span class="st">"center"</span><span class="op">;</span> ctx<span class="op">.</span><span class="at">textBaseline</span> <span class="op">=</span> <span class="st">"middle"</span><span class="op">;</span></span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">font</span> <span class="op">=</span> <span class="vs">`bold </span><span class="sc">${</span>c<span class="op">.</span><span class="at">r</span><span class="sc">}</span><span class="vs">px sans-serif`</span><span class="op">;</span></span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">fillText</span>(c<span class="op">.</span><span class="at">val</span> <span class="op">===</span> <span class="dv">1</span> <span class="op">?</span> <span class="st">"N"</span> <span class="op">:</span> <span class="st">"S"</span><span class="op">,</span> c<span class="op">.</span><span class="at">x</span><span class="op">,</span> c<span class="op">.</span><span class="at">y</span> <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 3. Chart</span></span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartY <span class="op">=</span> <span class="dv">280</span><span class="op">;</span> </span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartH <span class="op">=</span> <span class="dv">140</span><span class="op">;</span> </span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartX <span class="op">=</span> <span class="dv">40</span><span class="op">;</span></span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartW <span class="op">=</span> width <span class="op">-</span> <span class="dv">60</span><span class="op">;</span></span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"#bdc3c7"</span><span class="op">;</span> ctx<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">moveTo</span>(chartX<span class="op">,</span> chartY)<span class="op">;</span> ctx<span class="op">.</span><span class="fu">lineTo</span>(chartX <span class="op">+</span> chartW<span class="op">,</span> chartY)<span class="op">;</span> ctx<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> barW <span class="op">=</span> chartW <span class="op">/</span> (N <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> MAX_PROB <span class="op">=</span> <span class="fl">0.246</span><span class="op">;</span> </span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> Y_SCALE_MAX <span class="op">=</span> MAX_PROB <span class="op">*</span> <span class="fl">1.2</span><span class="op">;</span> </span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> activeHeads <span class="op">=</span> S<span class="op">.</span><span class="at">currentResult</span><span class="op">.</span><span class="fu">filter</span>(c <span class="kw">=&gt;</span> c<span class="op">.</span><span class="at">val</span><span class="op">===</span><span class="dv">1</span>)<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;=</span> N<span class="op">;</span> k<span class="op">++</span>) {</span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> cx <span class="op">=</span> chartX <span class="op">+</span> k <span class="op">*</span> barW <span class="op">+</span> barW<span class="op">/</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>       <span class="co">// Theoretical</span></span>
<span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> prob <span class="op">=</span> <span class="fu">binomial</span>(k<span class="op">,</span> N<span class="op">,</span> P)<span class="op">;</span></span>
<span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> theoH <span class="op">=</span> (prob <span class="op">/</span> Y_SCALE_MAX) <span class="op">*</span> chartH<span class="op">;</span></span>
<span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> CHART_THEO<span class="op">;</span></span>
<span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">fillRect</span>(cx <span class="op">-</span> barW<span class="op">*</span><span class="fl">0.3</span><span class="op">,</span> chartY <span class="op">-</span> theoH<span class="op">,</span> barW<span class="op">*</span><span class="fl">0.6</span><span class="op">,</span> theoH)<span class="op">;</span></span>
<span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a>       <span class="co">// Actual</span></span>
<span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a>       <span class="kw">let</span> observedProb <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a>       <span class="cf">if</span> (S<span class="op">.</span><span class="at">totalFlips</span> <span class="op">&gt;</span> <span class="dv">0</span>) observedProb <span class="op">=</span> S<span class="op">.</span><span class="at">counts</span>[k] <span class="op">/</span> S<span class="op">.</span><span class="at">totalFlips</span><span class="op">;</span></span>
<span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a>       <span class="kw">let</span> barH <span class="op">=</span> (observedProb <span class="op">/</span> Y_SCALE_MAX) <span class="op">*</span> chartH<span class="op">;</span></span>
<span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a>       <span class="cf">if</span> (barH <span class="op">&gt;</span> chartH <span class="op">+</span> <span class="dv">10</span>) barH <span class="op">=</span> chartH <span class="op">+</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> isActive <span class="op">=</span> (S<span class="op">.</span><span class="at">animation</span> <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> k <span class="op">===</span> activeHeads <span class="op">&amp;&amp;</span> S<span class="op">.</span><span class="at">totalFlips</span> <span class="op">&gt;</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> isActive <span class="op">?</span> CHART_ACTIVE <span class="op">:</span> CHART_BAR<span class="op">;</span></span>
<span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">fillRect</span>(cx <span class="op">-</span> barW<span class="op">*</span><span class="fl">0.3</span><span class="op">,</span> chartY <span class="op">-</span> barH<span class="op">,</span> barW<span class="op">*</span><span class="fl">0.6</span><span class="op">,</span> barH)<span class="op">;</span></span>
<span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a>       <span class="co">// Labels</span></span>
<span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">save</span>()<span class="op">;</span></span>
<span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">fontVariantNumeric</span> <span class="op">=</span> <span class="st">"tabular-nums"</span><span class="op">;</span></span>
<span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> TEXT_COLOR<span class="op">;</span></span>
<span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">font</span> <span class="op">=</span> <span class="st">"10px sans-serif"</span><span class="op">;</span></span>
<span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">textAlign</span> <span class="op">=</span> <span class="st">"center"</span><span class="op">;</span></span>
<span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">fillText</span>(k<span class="op">,</span> cx<span class="op">,</span> chartY <span class="op">+</span> <span class="dv">15</span>)<span class="op">;</span></span>
<span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">restore</span>()<span class="op">;</span></span>
<span id="cb1-314"><a href="#cb1-314" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-315"><a href="#cb1-315" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Y-Axis Label</span></span>
<span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">save</span>()<span class="op">;</span></span>
<span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">translate</span>(<span class="dv">12</span><span class="op">,</span> chartY <span class="op">-</span> chartH<span class="op">/</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">rotate</span>(<span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">/</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">textAlign</span> <span class="op">=</span> <span class="st">"center"</span><span class="op">;</span></span>
<span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">font</span> <span class="op">=</span> <span class="st">"14px sans-serif"</span><span class="op">;</span></span>
<span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#7f8c8d"</span><span class="op">;</span></span>
<span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillText</span>(<span class="st">"Tần suất"</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">restore</span>()<span class="op">;</span></span>
<span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-326"><a href="#cb1-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-327"><a href="#cb1-327" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 6. BINDINGS ---</span></span>
<span id="cb1-328"><a href="#cb1-328" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> btnFlip <span class="op">=</span> container<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#btn-flip"</span>)<span class="op">;</span></span>
<span id="cb1-329"><a href="#cb1-329" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> btnReset <span class="op">=</span> container<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#btn-reset"</span>)<span class="op">;</span></span>
<span id="cb1-330"><a href="#cb1-330" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chkAuto <span class="op">=</span> container<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#chk-auto"</span>)<span class="op">;</span></span>
<span id="cb1-331"><a href="#cb1-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-332"><a href="#cb1-332" aria-hidden="true" tabindex="-1"></a>  btnFlip<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="fu">runFlip</span>()<span class="op">;</span></span>
<span id="cb1-333"><a href="#cb1-333" aria-hidden="true" tabindex="-1"></a>  btnReset<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="fu">reset</span>()<span class="op">;</span></span>
<span id="cb1-334"><a href="#cb1-334" aria-hidden="true" tabindex="-1"></a>  chkAuto<span class="op">.</span><span class="at">onchange</span> <span class="op">=</span> (e) <span class="kw">=&gt;</span> { S<span class="op">.</span><span class="at">isAuto</span> <span class="op">=</span> e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">checked</span><span class="op">;</span> }<span class="op">;</span></span>
<span id="cb1-335"><a href="#cb1-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-336"><a href="#cb1-336" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> frameId<span class="op">;</span></span>
<span id="cb1-337"><a href="#cb1-337" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">tick</span>() {</span>
<span id="cb1-338"><a href="#cb1-338" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update</span>()<span class="op">;</span></span>
<span id="cb1-339"><a href="#cb1-339" aria-hidden="true" tabindex="-1"></a>    <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb1-340"><a href="#cb1-340" aria-hidden="true" tabindex="-1"></a>    frameId <span class="op">=</span> <span class="fu">requestAnimationFrame</span>(tick)<span class="op">;</span></span>
<span id="cb1-341"><a href="#cb1-341" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-342"><a href="#cb1-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tick</span>()<span class="op">;</span></span>
<span id="cb1-343"><a href="#cb1-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-344"><a href="#cb1-344" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="kw">this</span> <span class="op">&amp;&amp;</span> <span class="kw">this</span><span class="op">.</span><span class="at">invalidation</span>) <span class="kw">this</span><span class="op">.</span><span class="at">invalidation</span><span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> <span class="fu">cancelAnimationFrame</span>(frameId))<span class="op">;</span></span>
<span id="cb1-345"><a href="#cb1-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-346"><a href="#cb1-346" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">;</span></span>
<span id="cb1-347"><a href="#cb1-347" aria-hidden="true" tabindex="-1"></a>})()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-1" data-nodetype="declaration">

</div>
</div>
</div>
</section>
<section id="bảng-galton" class="level4">
<h4 class="anchored" data-anchor-id="bảng-galton">Bảng Galton</h4>
<p>Bảng Galton (Galton board) là một tấm bảng dựng đứng, được đóng các hàng đinh so le nhau theo hình tam giác. Ta thả những viên bi nhỏ từ đỉnh tháp. Khi một viên bi chạm vào một chiếc đinh, nó sẽ nảy sang trái hoặc sang phải. Sau khi đi hết các hàng đinh, viên bi sẽ rơi vào các ô chứa để hứng bi. Số lượng bi trong các ô chứa này tuân theo phân phối Nhị thức.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb2" data-startfrom="358" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 357;"><span id="cb2-358"><a href="#cb2-358" aria-hidden="true" tabindex="-1"></a>viewof galton_sharp <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>({</span>
<span id="cb2-359"><a href="#cb2-359" aria-hidden="true" tabindex="-1"></a>  <span class="dt">rows</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">8</span><span class="op">,</span> <span class="dv">20</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Số hàng đinh"</span>})<span class="op">,</span></span>
<span id="cb2-360"><a href="#cb2-360" aria-hidden="true" tabindex="-1"></a>  <span class="dt">speed</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="dv">3</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Tốc độ"</span>})<span class="op">,</span></span>
<span id="cb2-361"><a href="#cb2-361" aria-hidden="true" tabindex="-1"></a>  <span class="dt">total</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">50</span><span class="op">,</span> <span class="dv">800</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">200</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Số viên bi"</span>})</span>
<span id="cb2-362"><a href="#cb2-362" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb2-363"><a href="#cb2-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-364"><a href="#cb2-364" aria-hidden="true" tabindex="-1"></a>viewof galton_sim_dense <span class="op">=</span> (() <span class="kw">=&gt;</span> {</span>
<span id="cb2-365"><a href="#cb2-365" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 1. CONFIGURATION ---</span></span>
<span id="cb2-366"><a href="#cb2-366" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> config <span class="op">=</span> {</span>
<span id="cb2-367"><a href="#cb2-367" aria-hidden="true" tabindex="-1"></a>      <span class="dt">rows</span><span class="op">:</span> galton_sharp<span class="op">.</span><span class="at">rows</span><span class="op">,</span></span>
<span id="cb2-368"><a href="#cb2-368" aria-hidden="true" tabindex="-1"></a>      <span class="dt">speed</span><span class="op">:</span> galton_sharp<span class="op">.</span><span class="at">speed</span><span class="op">,</span></span>
<span id="cb2-369"><a href="#cb2-369" aria-hidden="true" tabindex="-1"></a>      <span class="dt">maxBalls</span><span class="op">:</span> galton_sharp<span class="op">.</span><span class="at">total</span></span>
<span id="cb2-370"><a href="#cb2-370" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb2-371"><a href="#cb2-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-372"><a href="#cb2-372" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 2. SETUP CONTAINER (Centered) ---</span></span>
<span id="cb2-373"><a href="#cb2-373" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> outerWrapper <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb2-374"><a href="#cb2-374" aria-hidden="true" tabindex="-1"></a>  outerWrapper<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb2-375"><a href="#cb2-375" aria-hidden="true" tabindex="-1"></a><span class="vs">    width: 100%;</span></span>
<span id="cb2-376"><a href="#cb2-376" aria-hidden="true" tabindex="-1"></a><span class="vs">    display: flex;</span></span>
<span id="cb2-377"><a href="#cb2-377" aria-hidden="true" tabindex="-1"></a><span class="vs">    justify-content: center;</span></span>
<span id="cb2-378"><a href="#cb2-378" aria-hidden="true" tabindex="-1"></a><span class="vs">    margin-top: 20px;</span></span>
<span id="cb2-379"><a href="#cb2-379" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb2-380"><a href="#cb2-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-381"><a href="#cb2-381" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb2-382"><a href="#cb2-382" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb2-383"><a href="#cb2-383" aria-hidden="true" tabindex="-1"></a><span class="vs">    display: flex;</span></span>
<span id="cb2-384"><a href="#cb2-384" aria-hidden="true" tabindex="-1"></a><span class="vs">    flex-direction: column;</span></span>
<span id="cb2-385"><a href="#cb2-385" aria-hidden="true" tabindex="-1"></a><span class="vs">    align-items: center;</span></span>
<span id="cb2-386"><a href="#cb2-386" aria-hidden="true" tabindex="-1"></a><span class="vs">    width: 380px; </span></span>
<span id="cb2-387"><a href="#cb2-387" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;</span></span>
<span id="cb2-388"><a href="#cb2-388" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb2-389"><a href="#cb2-389" aria-hidden="true" tabindex="-1"></a>  outerWrapper<span class="op">.</span><span class="fu">appendChild</span>(container)<span class="op">;</span></span>
<span id="cb2-390"><a href="#cb2-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-391"><a href="#cb2-391" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 3. INJECT UI ---</span></span>
<span id="cb2-392"><a href="#cb2-392" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb2-393"><a href="#cb2-393" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;style&gt;</span></span>
<span id="cb2-394"><a href="#cb2-394" aria-hidden="true" tabindex="-1"></a><span class="vs">      .galton-ctrl-row {</span></span>
<span id="cb2-395"><a href="#cb2-395" aria-hidden="true" tabindex="-1"></a><span class="vs">        width: 100%;</span></span>
<span id="cb2-396"><a href="#cb2-396" aria-hidden="true" tabindex="-1"></a><span class="vs">        display: flex;</span></span>
<span id="cb2-397"><a href="#cb2-397" aria-hidden="true" tabindex="-1"></a><span class="vs">        justify-content: center;</span></span>
<span id="cb2-398"><a href="#cb2-398" aria-hidden="true" tabindex="-1"></a><span class="vs">        gap: 12px;</span></span>
<span id="cb2-399"><a href="#cb2-399" aria-hidden="true" tabindex="-1"></a><span class="vs">        margin-bottom: 10px;</span></span>
<span id="cb2-400"><a href="#cb2-400" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb2-401"><a href="#cb2-401" aria-hidden="true" tabindex="-1"></a><span class="vs">      .galton-btn {</span></span>
<span id="cb2-402"><a href="#cb2-402" aria-hidden="true" tabindex="-1"></a><span class="vs">        padding: 6px 16px;</span></span>
<span id="cb2-403"><a href="#cb2-403" aria-hidden="true" tabindex="-1"></a><span class="vs">        border-radius: 6px;</span></span>
<span id="cb2-404"><a href="#cb2-404" aria-hidden="true" tabindex="-1"></a><span class="vs">        border: 1px solid #d1d5db;</span></span>
<span id="cb2-405"><a href="#cb2-405" aria-hidden="true" tabindex="-1"></a><span class="vs">        background-color: white;</span></span>
<span id="cb2-406"><a href="#cb2-406" aria-hidden="true" tabindex="-1"></a><span class="vs">        color: #374151;</span></span>
<span id="cb2-407"><a href="#cb2-407" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-size: 14px;</span></span>
<span id="cb2-408"><a href="#cb2-408" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-weight: 600;</span></span>
<span id="cb2-409"><a href="#cb2-409" aria-hidden="true" tabindex="-1"></a><span class="vs">        cursor: pointer;</span></span>
<span id="cb2-410"><a href="#cb2-410" aria-hidden="true" tabindex="-1"></a><span class="vs">        transition: all 0.1s ease;</span></span>
<span id="cb2-411"><a href="#cb2-411" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb2-412"><a href="#cb2-412" aria-hidden="true" tabindex="-1"></a><span class="vs">      .galton-btn:hover { background-color: #f3f4f6; }</span></span>
<span id="cb2-413"><a href="#cb2-413" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span></span>
<span id="cb2-414"><a href="#cb2-414" aria-hidden="true" tabindex="-1"></a><span class="vs">      .galton-btn-primary {</span></span>
<span id="cb2-415"><a href="#cb2-415" aria-hidden="true" tabindex="-1"></a><span class="vs">        background-color: #3b82f6; </span></span>
<span id="cb2-416"><a href="#cb2-416" aria-hidden="true" tabindex="-1"></a><span class="vs">        color: white; </span></span>
<span id="cb2-417"><a href="#cb2-417" aria-hidden="true" tabindex="-1"></a><span class="vs">        border-color: #2563eb;</span></span>
<span id="cb2-418"><a href="#cb2-418" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb2-419"><a href="#cb2-419" aria-hidden="true" tabindex="-1"></a><span class="vs">      .galton-btn-primary:hover { background-color: #2563eb; color: white; }</span></span>
<span id="cb2-420"><a href="#cb2-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-421"><a href="#cb2-421" aria-hidden="true" tabindex="-1"></a><span class="vs">      canvas {</span></span>
<span id="cb2-422"><a href="#cb2-422" aria-hidden="true" tabindex="-1"></a><span class="vs">        border-radius: 4px;</span></span>
<span id="cb2-423"><a href="#cb2-423" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb2-424"><a href="#cb2-424" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/style&gt;</span></span>
<span id="cb2-425"><a href="#cb2-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-426"><a href="#cb2-426" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div class="galton-ctrl-row"&gt;</span></span>
<span id="cb2-427"><a href="#cb2-427" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;button id="btn-start" class="galton-btn galton-btn-primary"&gt;Bắt đầu&lt;/button&gt;</span></span>
<span id="cb2-428"><a href="#cb2-428" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;button id="btn-stop" class="galton-btn"&gt;Dừng&lt;/button&gt;</span></span>
<span id="cb2-429"><a href="#cb2-429" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb2-430"><a href="#cb2-430" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb2-431"><a href="#cb2-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-432"><a href="#cb2-432" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 4. CANVAS SETUP ---</span></span>
<span id="cb2-433"><a href="#cb2-433" aria-hidden="true" tabindex="-1"></a>  <span class="co">// INCREASED HEIGHT from 500 -&gt; 600</span></span>
<span id="cb2-434"><a href="#cb2-434" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> logicalWidth <span class="op">=</span> <span class="dv">380</span><span class="op">;</span></span>
<span id="cb2-435"><a href="#cb2-435" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> logicalHeight <span class="op">=</span> <span class="dv">600</span><span class="op">;</span> </span>
<span id="cb2-436"><a href="#cb2-436" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dpr <span class="op">=</span> <span class="bu">window</span><span class="op">.</span><span class="at">devicePixelRatio</span> <span class="op">||</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-437"><a href="#cb2-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-438"><a href="#cb2-438" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> canvas <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"canvas"</span>)<span class="op">;</span></span>
<span id="cb2-439"><a href="#cb2-439" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">width</span> <span class="op">=</span> logicalWidth <span class="op">*</span> dpr<span class="op">;</span></span>
<span id="cb2-440"><a href="#cb2-440" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">height</span> <span class="op">=</span> logicalHeight <span class="op">*</span> dpr<span class="op">;</span></span>
<span id="cb2-441"><a href="#cb2-441" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">width</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>logicalWidth<span class="sc">}</span><span class="vs">px`</span><span class="op">;</span></span>
<span id="cb2-442"><a href="#cb2-442" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">height</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>logicalHeight<span class="sc">}</span><span class="vs">px`</span><span class="op">;</span></span>
<span id="cb2-443"><a href="#cb2-443" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-444"><a href="#cb2-444" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ctx <span class="op">=</span> canvas<span class="op">.</span><span class="fu">getContext</span>(<span class="st">"2d"</span><span class="op">,</span> { <span class="dt">alpha</span><span class="op">:</span> <span class="kw">false</span> })<span class="op">;</span></span>
<span id="cb2-445"><a href="#cb2-445" aria-hidden="true" tabindex="-1"></a>  ctx<span class="op">.</span><span class="fu">scale</span>(dpr<span class="op">,</span> dpr)<span class="op">;</span></span>
<span id="cb2-446"><a href="#cb2-446" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="fu">appendChild</span>(canvas)<span class="op">;</span></span>
<span id="cb2-447"><a href="#cb2-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-448"><a href="#cb2-448" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 5. GEOMETRY &amp; STATE ---</span></span>
<span id="cb2-449"><a href="#cb2-449" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pegSpacing <span class="op">=</span> logicalWidth <span class="op">/</span> (config<span class="op">.</span><span class="at">rows</span> <span class="op">+</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb2-450"><a href="#cb2-450" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> startY <span class="op">=</span> <span class="dv">60</span><span class="op">;</span></span>
<span id="cb2-451"><a href="#cb2-451" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pegRadius <span class="op">=</span> pegSpacing <span class="op">*</span> <span class="fl">0.12</span><span class="op">;</span> </span>
<span id="cb2-452"><a href="#cb2-452" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ballRadius <span class="op">=</span> pegSpacing <span class="op">*</span> <span class="fl">0.23</span><span class="op">;</span> </span>
<span id="cb2-453"><a href="#cb2-453" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> rowHeight <span class="op">=</span> pegSpacing <span class="op">*</span> <span class="fl">0.85</span><span class="op">;</span></span>
<span id="cb2-454"><a href="#cb2-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-455"><a href="#cb2-455" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bin Geometry</span></span>
<span id="cb2-456"><a href="#cb2-456" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> floorY <span class="op">=</span> logicalHeight <span class="op">-</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb2-457"><a href="#cb2-457" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> binWidth <span class="op">=</span> pegSpacing<span class="op">;</span></span>
<span id="cb2-458"><a href="#cb2-458" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalBinWidth <span class="op">=</span> (config<span class="op">.</span><span class="at">rows</span> <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> binWidth<span class="op">;</span></span>
<span id="cb2-459"><a href="#cb2-459" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> binsStartX <span class="op">=</span> (logicalWidth <span class="op">-</span> totalBinWidth) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-460"><a href="#cb2-460" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> wallsTopY <span class="op">=</span> startY <span class="op">+</span> (config<span class="op">.</span><span class="at">rows</span>) <span class="op">*</span> rowHeight <span class="op">+</span> <span class="dv">15</span><span class="op">;</span></span>
<span id="cb2-461"><a href="#cb2-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-462"><a href="#cb2-462" aria-hidden="true" tabindex="-1"></a>  <span class="co">// DENSE PACKING FACTOR</span></span>
<span id="cb2-463"><a href="#cb2-463" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 70% Overlap means the vertical step is small.</span></span>
<span id="cb2-464"><a href="#cb2-464" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Normal Diameter = 2*r.</span></span>
<span id="cb2-465"><a href="#cb2-465" aria-hidden="true" tabindex="-1"></a>  <span class="co">// We use step = 0.6 * r. This is very dense.</span></span>
<span id="cb2-466"><a href="#cb2-466" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> stackStep <span class="op">=</span> ballRadius <span class="op">*</span> <span class="fl">0.6</span><span class="op">;</span> </span>
<span id="cb2-467"><a href="#cb2-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-468"><a href="#cb2-468" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Pre-calculate Peg Positions</span></span>
<span id="cb2-469"><a href="#cb2-469" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pegGrid <span class="op">=</span> []<span class="op">;</span> </span>
<span id="cb2-470"><a href="#cb2-470" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> r <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> r <span class="op">&lt;</span> config<span class="op">.</span><span class="at">rows</span><span class="op">;</span> r<span class="op">++</span>) {</span>
<span id="cb2-471"><a href="#cb2-471" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rowPegs <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb2-472"><a href="#cb2-472" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pegsInThisRow <span class="op">=</span> r <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-473"><a href="#cb2-473" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rowWidth <span class="op">=</span> (pegsInThisRow <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> pegSpacing<span class="op">;</span></span>
<span id="cb2-474"><a href="#cb2-474" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rowStartX <span class="op">=</span> (logicalWidth <span class="op">-</span> rowWidth) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-475"><a href="#cb2-475" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> p <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> p <span class="op">&lt;</span> pegsInThisRow<span class="op">;</span> p<span class="op">++</span>) {</span>
<span id="cb2-476"><a href="#cb2-476" aria-hidden="true" tabindex="-1"></a>      rowPegs<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb2-477"><a href="#cb2-477" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> rowStartX <span class="op">+</span> p <span class="op">*</span> pegSpacing<span class="op">,</span></span>
<span id="cb2-478"><a href="#cb2-478" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> startY <span class="op">+</span> r <span class="op">*</span> rowHeight</span>
<span id="cb2-479"><a href="#cb2-479" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb2-480"><a href="#cb2-480" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-481"><a href="#cb2-481" aria-hidden="true" tabindex="-1"></a>    pegGrid<span class="op">.</span><span class="fu">push</span>(rowPegs)<span class="op">;</span></span>
<span id="cb2-482"><a href="#cb2-482" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-483"><a href="#cb2-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-484"><a href="#cb2-484" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Simulation State</span></span>
<span id="cb2-485"><a href="#cb2-485" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> S <span class="op">=</span> {</span>
<span id="cb2-486"><a href="#cb2-486" aria-hidden="true" tabindex="-1"></a>    <span class="dt">balls</span><span class="op">:</span> []<span class="op">,</span></span>
<span id="cb2-487"><a href="#cb2-487" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bins</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Array</span>(config<span class="op">.</span><span class="at">rows</span> <span class="op">+</span> <span class="dv">1</span>)<span class="op">.</span><span class="fu">fill</span>(<span class="dv">0</span>)<span class="op">,</span></span>
<span id="cb2-488"><a href="#cb2-488" aria-hidden="true" tabindex="-1"></a>    <span class="dt">spawned</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb2-489"><a href="#cb2-489" aria-hidden="true" tabindex="-1"></a>    <span class="dt">running</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb2-490"><a href="#cb2-490" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb2-491"><a href="#cb2-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-492"><a href="#cb2-492" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 6. LOGIC ---</span></span>
<span id="cb2-493"><a href="#cb2-493" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">createBall</span>() {</span>
<span id="cb2-494"><a href="#cb2-494" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> currentInd <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> </span>
<span id="cb2-495"><a href="#cb2-495" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> path <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb2-496"><a href="#cb2-496" aria-hidden="true" tabindex="-1"></a>    path<span class="op">.</span><span class="fu">push</span>({ <span class="dt">x</span><span class="op">:</span> logicalWidth <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> startY <span class="op">-</span> <span class="dv">20</span> })<span class="op">;</span> </span>
<span id="cb2-497"><a href="#cb2-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-498"><a href="#cb2-498" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> r <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> r <span class="op">&lt;</span> config<span class="op">.</span><span class="at">rows</span><span class="op">;</span> r<span class="op">++</span>) {</span>
<span id="cb2-499"><a href="#cb2-499" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> peg <span class="op">=</span> pegGrid[r][currentInd]<span class="op">;</span></span>
<span id="cb2-500"><a href="#cb2-500" aria-hidden="true" tabindex="-1"></a>       path<span class="op">.</span><span class="fu">push</span>({ <span class="dt">x</span><span class="op">:</span> peg<span class="op">.</span><span class="at">x</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> peg<span class="op">.</span><span class="at">y</span> <span class="op">-</span> pegRadius <span class="op">-</span> ballRadius })<span class="op">;</span></span>
<span id="cb2-501"><a href="#cb2-501" aria-hidden="true" tabindex="-1"></a>       <span class="cf">if</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>() <span class="op">&gt;</span> <span class="fl">0.5</span>) currentInd<span class="op">++;</span> </span>
<span id="cb2-502"><a href="#cb2-502" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-503"><a href="#cb2-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-504"><a href="#cb2-504" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> binX <span class="op">=</span> binsStartX <span class="op">+</span> currentInd <span class="op">*</span> binWidth <span class="op">+</span> binWidth<span class="op">/</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-505"><a href="#cb2-505" aria-hidden="true" tabindex="-1"></a>    path<span class="op">.</span><span class="fu">push</span>({ <span class="dt">x</span><span class="op">:</span> binX<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> wallsTopY })<span class="op">;</span></span>
<span id="cb2-506"><a href="#cb2-506" aria-hidden="true" tabindex="-1"></a>    path<span class="op">.</span><span class="fu">push</span>({ <span class="dt">x</span><span class="op">:</span> binX<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> floorY<span class="op">,</span> <span class="dt">isFloor</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">binIndex</span><span class="op">:</span> currentInd })<span class="op">;</span></span>
<span id="cb2-507"><a href="#cb2-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-508"><a href="#cb2-508" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb2-509"><a href="#cb2-509" aria-hidden="true" tabindex="-1"></a>      <span class="dt">path</span><span class="op">:</span> path<span class="op">,</span></span>
<span id="cb2-510"><a href="#cb2-510" aria-hidden="true" tabindex="-1"></a>      <span class="dt">segment</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">active</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb2-511"><a href="#cb2-511" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> path[<span class="dv">0</span>]<span class="op">.</span><span class="at">x</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> path[<span class="dv">0</span>]<span class="op">.</span><span class="at">y</span></span>
<span id="cb2-512"><a href="#cb2-512" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb2-513"><a href="#cb2-513" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-514"><a href="#cb2-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-515"><a href="#cb2-515" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">spawn</span>() {</span>
<span id="cb2-516"><a href="#cb2-516" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> (S<span class="op">.</span><span class="at">spawned</span> <span class="op">&gt;=</span> config<span class="op">.</span><span class="at">maxBalls</span>) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb2-517"><a href="#cb2-517" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb2-518"><a href="#cb2-518" aria-hidden="true" tabindex="-1"></a>     <span class="co">// Check capacity using new DENSE packing logic</span></span>
<span id="cb2-519"><a href="#cb2-519" aria-hidden="true" tabindex="-1"></a>     <span class="co">// Available height = floorY - wallsTopY</span></span>
<span id="cb2-520"><a href="#cb2-520" aria-hidden="true" tabindex="-1"></a>     <span class="co">// Height consumed = count * stackStep</span></span>
<span id="cb2-521"><a href="#cb2-521" aria-hidden="true" tabindex="-1"></a>     <span class="kw">const</span> centerBin <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(config<span class="op">.</span><span class="at">rows</span><span class="op">/</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb2-522"><a href="#cb2-522" aria-hidden="true" tabindex="-1"></a>     <span class="kw">const</span> currentHeight <span class="op">=</span> S<span class="op">.</span><span class="at">bins</span>[centerBin] <span class="op">*</span> stackStep<span class="op">;</span></span>
<span id="cb2-523"><a href="#cb2-523" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb2-524"><a href="#cb2-524" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> (currentHeight <span class="op">&gt;</span> (floorY <span class="op">-</span> wallsTopY <span class="op">-</span> <span class="dv">20</span>)) <span class="cf">return</span><span class="op">;</span> <span class="co">// -20 buffer</span></span>
<span id="cb2-525"><a href="#cb2-525" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb2-526"><a href="#cb2-526" aria-hidden="true" tabindex="-1"></a>     S<span class="op">.</span><span class="at">balls</span><span class="op">.</span><span class="fu">push</span>(<span class="fu">createBall</span>())<span class="op">;</span></span>
<span id="cb2-527"><a href="#cb2-527" aria-hidden="true" tabindex="-1"></a>     S<span class="op">.</span><span class="at">spawned</span><span class="op">++;</span></span>
<span id="cb2-528"><a href="#cb2-528" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-529"><a href="#cb2-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-530"><a href="#cb2-530" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">update</span>(dt) {</span>
<span id="cb2-531"><a href="#cb2-531" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (S<span class="op">.</span><span class="at">running</span>) {</span>
<span id="cb2-532"><a href="#cb2-532" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> spawnChance <span class="op">=</span> <span class="fl">0.25</span> <span class="op">*</span> config<span class="op">.</span><span class="at">speed</span><span class="op">;</span> </span>
<span id="cb2-533"><a href="#cb2-533" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>() <span class="op">&lt;</span> spawnChance) <span class="fu">spawn</span>()<span class="op">;</span></span>
<span id="cb2-534"><a href="#cb2-534" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-535"><a href="#cb2-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-536"><a href="#cb2-536" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> S<span class="op">.</span><span class="at">balls</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb2-537"><a href="#cb2-537" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> b <span class="op">=</span> S<span class="op">.</span><span class="at">balls</span>[i]<span class="op">;</span></span>
<span id="cb2-538"><a href="#cb2-538" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>b<span class="op">.</span><span class="at">active</span>) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb2-539"><a href="#cb2-539" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>S<span class="op">.</span><span class="at">running</span>) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb2-540"><a href="#cb2-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-541"><a href="#cb2-541" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> moveSpeed <span class="op">=</span> <span class="fl">3.0</span> <span class="op">*</span> config<span class="op">.</span><span class="at">speed</span> <span class="op">*</span> dt<span class="op">;</span></span>
<span id="cb2-542"><a href="#cb2-542" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">t</span> <span class="op">+=</span> moveSpeed<span class="op">;</span></span>
<span id="cb2-543"><a href="#cb2-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-544"><a href="#cb2-544" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (b<span class="op">.</span><span class="at">t</span> <span class="op">&gt;=</span> <span class="dv">1</span>) {</span>
<span id="cb2-545"><a href="#cb2-545" aria-hidden="true" tabindex="-1"></a>            b<span class="op">.</span><span class="at">t</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-546"><a href="#cb2-546" aria-hidden="true" tabindex="-1"></a>            b<span class="op">.</span><span class="at">segment</span><span class="op">++;</span></span>
<span id="cb2-547"><a href="#cb2-547" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (b<span class="op">.</span><span class="at">segment</span> <span class="op">&gt;=</span> b<span class="op">.</span><span class="at">path</span><span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>) {</span>
<span id="cb2-548"><a href="#cb2-548" aria-hidden="true" tabindex="-1"></a>                b<span class="op">.</span><span class="at">active</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb2-549"><a href="#cb2-549" aria-hidden="true" tabindex="-1"></a>                <span class="kw">const</span> finalPt <span class="op">=</span> b<span class="op">.</span><span class="at">path</span>[b<span class="op">.</span><span class="at">path</span><span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb2-550"><a href="#cb2-550" aria-hidden="true" tabindex="-1"></a>                S<span class="op">.</span><span class="at">bins</span>[finalPt<span class="op">.</span><span class="at">binIndex</span>]<span class="op">++;</span></span>
<span id="cb2-551"><a href="#cb2-551" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb2-552"><a href="#cb2-552" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb2-553"><a href="#cb2-553" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-554"><a href="#cb2-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-555"><a href="#cb2-555" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> p0 <span class="op">=</span> b<span class="op">.</span><span class="at">path</span>[b<span class="op">.</span><span class="at">segment</span>]<span class="op">;</span></span>
<span id="cb2-556"><a href="#cb2-556" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> p1 <span class="op">=</span> b<span class="op">.</span><span class="at">path</span>[b<span class="op">.</span><span class="at">segment</span> <span class="op">+</span> <span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb2-557"><a href="#cb2-557" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> t <span class="op">=</span> b<span class="op">.</span><span class="at">t</span><span class="op">;</span></span>
<span id="cb2-558"><a href="#cb2-558" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> ease <span class="op">=</span> t <span class="op">*</span> t<span class="op">;</span> </span>
<span id="cb2-559"><a href="#cb2-559" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-560"><a href="#cb2-560" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">x</span> <span class="op">=</span> p0<span class="op">.</span><span class="at">x</span> <span class="op">+</span> (p1<span class="op">.</span><span class="at">x</span> <span class="op">-</span> p0<span class="op">.</span><span class="at">x</span>) <span class="op">*</span> t<span class="op">;</span></span>
<span id="cb2-561"><a href="#cb2-561" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">y</span> <span class="op">=</span> p0<span class="op">.</span><span class="at">y</span> <span class="op">+</span> (p1<span class="op">.</span><span class="at">y</span> <span class="op">-</span> p0<span class="op">.</span><span class="at">y</span>) <span class="op">*</span> (p1<span class="op">.</span><span class="at">isFloor</span> <span class="op">?</span> ease <span class="op">:</span> ease)<span class="op">;</span></span>
<span id="cb2-562"><a href="#cb2-562" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-563"><a href="#cb2-563" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-564"><a href="#cb2-564" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (S<span class="op">.</span><span class="at">balls</span><span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> config<span class="op">.</span><span class="at">maxBalls</span> <span class="op">+</span> <span class="dv">50</span>) {</span>
<span id="cb2-565"><a href="#cb2-565" aria-hidden="true" tabindex="-1"></a>        S<span class="op">.</span><span class="at">balls</span> <span class="op">=</span> S<span class="op">.</span><span class="at">balls</span><span class="op">.</span><span class="fu">filter</span>(b <span class="kw">=&gt;</span> b<span class="op">.</span><span class="at">active</span>)<span class="op">;</span></span>
<span id="cb2-566"><a href="#cb2-566" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-567"><a href="#cb2-567" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-568"><a href="#cb2-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-569"><a href="#cb2-569" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 7. DRAW LOOP ---</span></span>
<span id="cb2-570"><a href="#cb2-570" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">draw</span>() {</span>
<span id="cb2-571"><a href="#cb2-571" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Clear</span></span>
<span id="cb2-572"><a href="#cb2-572" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#f8f9fa"</span><span class="op">;</span></span>
<span id="cb2-573"><a href="#cb2-573" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillRect</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> logicalWidth<span class="op">,</span> logicalHeight)<span class="op">;</span></span>
<span id="cb2-574"><a href="#cb2-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-575"><a href="#cb2-575" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Pegs</span></span>
<span id="cb2-576"><a href="#cb2-576" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#9ca3af"</span><span class="op">;</span></span>
<span id="cb2-577"><a href="#cb2-577" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb2-578"><a href="#cb2-578" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> r <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> r <span class="op">&lt;</span> pegGrid<span class="op">.</span><span class="at">length</span><span class="op">;</span> r<span class="op">++</span>) {</span>
<span id="cb2-579"><a href="#cb2-579" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (<span class="kw">let</span> p <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> p <span class="op">&lt;</span> pegGrid[r]<span class="op">.</span><span class="at">length</span><span class="op">;</span> p<span class="op">++</span>) {</span>
<span id="cb2-580"><a href="#cb2-580" aria-hidden="true" tabindex="-1"></a>         <span class="kw">const</span> peg <span class="op">=</span> pegGrid[r][p]<span class="op">;</span></span>
<span id="cb2-581"><a href="#cb2-581" aria-hidden="true" tabindex="-1"></a>         ctx<span class="op">.</span><span class="fu">moveTo</span>(peg<span class="op">.</span><span class="at">x</span> <span class="op">+</span> pegRadius<span class="op">,</span> peg<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb2-582"><a href="#cb2-582" aria-hidden="true" tabindex="-1"></a>         ctx<span class="op">.</span><span class="fu">arc</span>(peg<span class="op">.</span><span class="at">x</span><span class="op">,</span> peg<span class="op">.</span><span class="at">y</span><span class="op">,</span> pegRadius<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">*</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb2-583"><a href="#cb2-583" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-584"><a href="#cb2-584" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-585"><a href="#cb2-585" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span> </span>
<span id="cb2-586"><a href="#cb2-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-587"><a href="#cb2-587" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Active Balls</span></span>
<span id="cb2-588"><a href="#cb2-588" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#3b82f6"</span><span class="op">;</span></span>
<span id="cb2-589"><a href="#cb2-589" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb2-590"><a href="#cb2-590" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> S<span class="op">.</span><span class="at">balls</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb2-591"><a href="#cb2-591" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> b <span class="op">=</span> S<span class="op">.</span><span class="at">balls</span>[i]<span class="op">;</span></span>
<span id="cb2-592"><a href="#cb2-592" aria-hidden="true" tabindex="-1"></a>       <span class="cf">if</span> (b<span class="op">.</span><span class="at">active</span>) {</span>
<span id="cb2-593"><a href="#cb2-593" aria-hidden="true" tabindex="-1"></a>         ctx<span class="op">.</span><span class="fu">moveTo</span>(b<span class="op">.</span><span class="at">x</span> <span class="op">+</span> ballRadius<span class="op">,</span> b<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb2-594"><a href="#cb2-594" aria-hidden="true" tabindex="-1"></a>         ctx<span class="op">.</span><span class="fu">arc</span>(b<span class="op">.</span><span class="at">x</span><span class="op">,</span> b<span class="op">.</span><span class="at">y</span><span class="op">,</span> ballRadius<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">*</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb2-595"><a href="#cb2-595" aria-hidden="true" tabindex="-1"></a>       }</span>
<span id="cb2-596"><a href="#cb2-596" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-597"><a href="#cb2-597" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span> </span>
<span id="cb2-598"><a href="#cb2-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-599"><a href="#cb2-599" aria-hidden="true" tabindex="-1"></a>    <span class="co">// BINS (Dense Stacking)</span></span>
<span id="cb2-600"><a href="#cb2-600" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#3b82f6"</span><span class="op">;</span></span>
<span id="cb2-601"><a href="#cb2-601" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"#1d4ed8"</span><span class="op">;</span> <span class="co">// Darker border for definition</span></span>
<span id="cb2-602"><a href="#cb2-602" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-603"><a href="#cb2-603" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-604"><a href="#cb2-604" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> S<span class="op">.</span><span class="at">bins</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb2-605"><a href="#cb2-605" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> count <span class="op">=</span> S<span class="op">.</span><span class="at">bins</span>[i]<span class="op">;</span></span>
<span id="cb2-606"><a href="#cb2-606" aria-hidden="true" tabindex="-1"></a>       <span class="cf">if</span> (count <span class="op">===</span> <span class="dv">0</span>) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb2-607"><a href="#cb2-607" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb2-608"><a href="#cb2-608" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> cx <span class="op">=</span> binsStartX <span class="op">+</span> i <span class="op">*</span> binWidth <span class="op">+</span> binWidth<span class="op">/</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-609"><a href="#cb2-609" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb2-610"><a href="#cb2-610" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb2-611"><a href="#cb2-611" aria-hidden="true" tabindex="-1"></a>       <span class="cf">for</span> (<span class="kw">let</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> count<span class="op">;</span> j<span class="op">++</span>) {</span>
<span id="cb2-612"><a href="#cb2-612" aria-hidden="true" tabindex="-1"></a>          <span class="co">// DENSE LOGIC: stackStep = 0.6 * r</span></span>
<span id="cb2-613"><a href="#cb2-613" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> cy <span class="op">=</span> floorY <span class="op">-</span> ballRadius <span class="op">-</span> (j <span class="op">*</span> stackStep)<span class="op">;</span></span>
<span id="cb2-614"><a href="#cb2-614" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb2-615"><a href="#cb2-615" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (cy <span class="op">&lt;</span> wallsTopY) <span class="cf">break</span><span class="op">;</span> </span>
<span id="cb2-616"><a href="#cb2-616" aria-hidden="true" tabindex="-1"></a>          ctx<span class="op">.</span><span class="fu">moveTo</span>(cx <span class="op">+</span> ballRadius<span class="op">,</span> cy)<span class="op">;</span></span>
<span id="cb2-617"><a href="#cb2-617" aria-hidden="true" tabindex="-1"></a>          ctx<span class="op">.</span><span class="fu">arc</span>(cx<span class="op">,</span> cy<span class="op">,</span> ballRadius<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">*</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb2-618"><a href="#cb2-618" aria-hidden="true" tabindex="-1"></a>       }</span>
<span id="cb2-619"><a href="#cb2-619" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb2-620"><a href="#cb2-620" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb2-621"><a href="#cb2-621" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-622"><a href="#cb2-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-623"><a href="#cb2-623" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Walls/Floor</span></span>
<span id="cb2-624"><a href="#cb2-624" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"#d1d5db"</span><span class="op">;</span></span>
<span id="cb2-625"><a href="#cb2-625" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-626"><a href="#cb2-626" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb2-627"><a href="#cb2-627" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">moveTo</span>(binsStartX<span class="op">,</span> floorY)<span class="op">;</span></span>
<span id="cb2-628"><a href="#cb2-628" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">lineTo</span>(binsStartX <span class="op">+</span> totalBinWidth<span class="op">,</span> floorY)<span class="op">;</span></span>
<span id="cb2-629"><a href="#cb2-629" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> config<span class="op">.</span><span class="at">rows</span> <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb2-630"><a href="#cb2-630" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> x <span class="op">=</span> binsStartX <span class="op">+</span> i <span class="op">*</span> binWidth<span class="op">;</span></span>
<span id="cb2-631"><a href="#cb2-631" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">moveTo</span>(x<span class="op">,</span> wallsTopY)<span class="op">;</span></span>
<span id="cb2-632"><a href="#cb2-632" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">lineTo</span>(x<span class="op">,</span> floorY)<span class="op">;</span></span>
<span id="cb2-633"><a href="#cb2-633" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-634"><a href="#cb2-634" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb2-635"><a href="#cb2-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-636"><a href="#cb2-636" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Text</span></span>
<span id="cb2-637"><a href="#cb2-637" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#374151"</span><span class="op">;</span></span>
<span id="cb2-638"><a href="#cb2-638" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">font</span> <span class="op">=</span> <span class="st">"bold 14px sans-serif"</span><span class="op">;</span></span>
<span id="cb2-639"><a href="#cb2-639" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillText</span>(<span class="vs">`Số bi: </span><span class="sc">${</span>S<span class="op">.</span><span class="at">spawned</span><span class="sc">}</span><span class="vs"> / </span><span class="sc">${</span>config<span class="op">.</span><span class="at">maxBalls</span><span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">25</span>)<span class="op">;</span></span>
<span id="cb2-640"><a href="#cb2-640" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-641"><a href="#cb2-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-642"><a href="#cb2-642" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 8. RUNTIME ---</span></span>
<span id="cb2-643"><a href="#cb2-643" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> lastTime <span class="op">=</span> <span class="bu">performance</span><span class="op">.</span><span class="fu">now</span>()<span class="op">;</span></span>
<span id="cb2-644"><a href="#cb2-644" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> frameId<span class="op">;</span></span>
<span id="cb2-645"><a href="#cb2-645" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-646"><a href="#cb2-646" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">tick</span>(now) {</span>
<span id="cb2-647"><a href="#cb2-647" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> dt <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>((now <span class="op">-</span> lastTime) <span class="op">/</span> <span class="dv">1000</span><span class="op">,</span> <span class="fl">0.1</span>)<span class="op">;</span> </span>
<span id="cb2-648"><a href="#cb2-648" aria-hidden="true" tabindex="-1"></a>    lastTime <span class="op">=</span> now<span class="op">;</span></span>
<span id="cb2-649"><a href="#cb2-649" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-650"><a href="#cb2-650" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update</span>(dt)<span class="op">;</span></span>
<span id="cb2-651"><a href="#cb2-651" aria-hidden="true" tabindex="-1"></a>    <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb2-652"><a href="#cb2-652" aria-hidden="true" tabindex="-1"></a>    frameId <span class="op">=</span> <span class="fu">requestAnimationFrame</span>(tick)<span class="op">;</span></span>
<span id="cb2-653"><a href="#cb2-653" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-654"><a href="#cb2-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-655"><a href="#cb2-655" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bind Buttons</span></span>
<span id="cb2-656"><a href="#cb2-656" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> btnStart <span class="op">=</span> container<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#btn-start"</span>)<span class="op">;</span></span>
<span id="cb2-657"><a href="#cb2-657" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> btnStop <span class="op">=</span> container<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#btn-stop"</span>)<span class="op">;</span></span>
<span id="cb2-658"><a href="#cb2-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-659"><a href="#cb2-659" aria-hidden="true" tabindex="-1"></a>  btnStart<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb2-660"><a href="#cb2-660" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> (<span class="op">!</span>S<span class="op">.</span><span class="at">running</span> <span class="op">&amp;&amp;</span> S<span class="op">.</span><span class="at">spawned</span> <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb2-661"><a href="#cb2-661" aria-hidden="true" tabindex="-1"></a>         S<span class="op">.</span><span class="at">running</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb2-662"><a href="#cb2-662" aria-hidden="true" tabindex="-1"></a>     } <span class="cf">else</span> {</span>
<span id="cb2-663"><a href="#cb2-663" aria-hidden="true" tabindex="-1"></a>         S<span class="op">.</span><span class="at">running</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb2-664"><a href="#cb2-664" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> (S<span class="op">.</span><span class="at">spawned</span> <span class="op">&gt;=</span> config<span class="op">.</span><span class="at">maxBalls</span>) {</span>
<span id="cb2-665"><a href="#cb2-665" aria-hidden="true" tabindex="-1"></a>             S<span class="op">.</span><span class="at">balls</span> <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb2-666"><a href="#cb2-666" aria-hidden="true" tabindex="-1"></a>             S<span class="op">.</span><span class="at">bins</span><span class="op">.</span><span class="fu">fill</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb2-667"><a href="#cb2-667" aria-hidden="true" tabindex="-1"></a>             S<span class="op">.</span><span class="at">spawned</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-668"><a href="#cb2-668" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb2-669"><a href="#cb2-669" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb2-670"><a href="#cb2-670" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb2-671"><a href="#cb2-671" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-672"><a href="#cb2-672" aria-hidden="true" tabindex="-1"></a>  btnStop<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb2-673"><a href="#cb2-673" aria-hidden="true" tabindex="-1"></a>      S<span class="op">.</span><span class="at">running</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb2-674"><a href="#cb2-674" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb2-675"><a href="#cb2-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-676"><a href="#cb2-676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tick</span>(<span class="bu">performance</span><span class="op">.</span><span class="fu">now</span>())<span class="op">;</span></span>
<span id="cb2-677"><a href="#cb2-677" aria-hidden="true" tabindex="-1"></a>  invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> <span class="fu">cancelAnimationFrame</span>(frameId))<span class="op">;</span></span>
<span id="cb2-678"><a href="#cb2-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-679"><a href="#cb2-679" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> outerWrapper<span class="op">;</span></span>
<span id="cb2-680"><a href="#cb2-680" aria-hidden="true" tabindex="-1"></a>})()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<p><strong>Tại sao lại là phân phối Nhị thức?</strong></p>
<ul>
<li>Mỗi lần viên bi chạm vào chiếc đinh, có hai trường hợp xảy ra: viên bi sẽ nảy sang trái hoặc sang phải, xác suất nảy sang mỗi bên là <span class="math inline">\(p = 0.5\)</span>, giống như tung đồng xu. Đây là một phép thử Bernoulli.</li>
<li>Nếu bảng có 10 hàng đinh, viên bi sẽ thực hiện chuỗi Bernoulli có 10 phép thử liên tiếp.</li>
<li>Các ô chứa tương ứng với số lần viên bi nảy về bên phải. Để vào ô giữa, viên bi phải nảy sang bên phải 5 lần (và bên trái 5 lần), để vào ô cuối cùng, viên bi phải nảy sang bên phải 10 lần (và bên trái 0 lần).</li>
</ul>
</section>
<section id="hồi-quy-logistic" class="level4">
<h4 class="anchored" data-anchor-id="hồi-quy-logistic">Hồi quy logistic</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(formula, data, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(formula, data, <span class="at">family =</span> <span class="st">"binomial"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>Tại sao trong hồi quy logistic lại ghi <code>family = "binomial"</code>?</strong></p>
<p>Ví dụ: Hút thuốc lá có làm tăng nguy cơ ung thư phổi không?</p>
<ul>
<li>Biến độc lập: Số điếu thuốc hút mỗi ngày</li>
<li>Biến phụ thuộc: Tình trạng ung thư phổi (1 = Có bệnh, 0 = Không bệnh)</li>
</ul>
<p>Khi xây dựng mô hình, chúng ta xem xét từng cá nhân trong dữ liệu như một phép thử ngẫu nhiên:</p>
<ul>
<li>Với một người cụ thể (ví dụ: anh A, hút 1 gói/ngày), việc anh ta có bị ung thư hay không giống như việc tung một đồng xu: mặt ngửa (1) là bị ung thư, mặt sấp (0) là không bị ung thư. <strong>Nhưng</strong> xác suất tung ra mặt ngửa của đồng xu này không phải là 0.5, mà phụ thuộc vào việc anh ta hút bao nhiêu thuốc.</li>
<li>Khi chúng ta tiến hành nghiên cứu trên <span class="math inline">\(n\)</span> người, đây là 1 chuỗi Bernoulli, vì vậy có thể chọn phân phối Binomial để mô hình nó.</li>
</ul>
<p>Khai báo <code>family = "binomial"</code> nghĩa là: “Biến kết quả (<span class="math inline">\(Y\)</span>) là đếm số lần thành công (hoặc thất bại) từ các phép thử nhị phân, hãy dùng công thức xác suất của phân phối Nhị thức để ước lượng.”</p>
</section>
<section id="xấp-xỉ-phân-phối-chuẩn" class="level4">
<h4 class="anchored" data-anchor-id="xấp-xỉ-phân-phối-chuẩn">Xấp xỉ phân phối Chuẩn</h4>
<p>Định lý Moivre-Laplace (một dạng đặc biệt của Định lý Giới hạn Trung tâm): Khi số lượng phép thử <span class="math inline">\(n\)</span> đủ lớn, hình dáng của phân phối Nhị thức sẽ tiệm cận về phân phối Chuẩn.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb4" data-startfrom="716" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 715;"><span id="cb4-716"><a href="#cb4-716" aria-hidden="true" tabindex="-1"></a>viewof normal_approx_fixed_axis <span class="op">=</span> (() <span class="kw">=&gt;</span> {</span>
<span id="cb4-717"><a href="#cb4-717" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 1. SETUP CONTAINER ---</span></span>
<span id="cb4-718"><a href="#cb4-718" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> wrapper <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb4-719"><a href="#cb4-719" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb4-720"><a href="#cb4-720" aria-hidden="true" tabindex="-1"></a><span class="vs">    display: flex;</span></span>
<span id="cb4-721"><a href="#cb4-721" aria-hidden="true" tabindex="-1"></a><span class="vs">    flex-direction: column;</span></span>
<span id="cb4-722"><a href="#cb4-722" aria-hidden="true" tabindex="-1"></a><span class="vs">    align-items: center;</span></span>
<span id="cb4-723"><a href="#cb4-723" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;</span></span>
<span id="cb4-724"><a href="#cb4-724" aria-hidden="true" tabindex="-1"></a><span class="vs">    margin-top: 20px;</span></span>
<span id="cb4-725"><a href="#cb4-725" aria-hidden="true" tabindex="-1"></a><span class="vs">    width: 100%;</span></span>
<span id="cb4-726"><a href="#cb4-726" aria-hidden="true" tabindex="-1"></a><span class="vs">    min-height: 500px;</span></span>
<span id="cb4-727"><a href="#cb4-727" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb4-728"><a href="#cb4-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-729"><a href="#cb4-729" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 2. INPUT CREATION ---</span></span>
<span id="cb4-730"><a href="#cb4-730" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">createInput</span>(id<span class="op">,</span> label<span class="op">,</span> min<span class="op">,</span> max<span class="op">,</span> step<span class="op">,</span> val) {</span>
<span id="cb4-731"><a href="#cb4-731" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> container <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb4-732"><a href="#cb4-732" aria-hidden="true" tabindex="-1"></a>    container<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display: flex; flex-direction: column; width: 220px;"</span><span class="op">;</span></span>
<span id="cb4-733"><a href="#cb4-733" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-734"><a href="#cb4-734" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> labelEl <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"label"</span>)<span class="op">;</span></span>
<span id="cb4-735"><a href="#cb4-735" aria-hidden="true" tabindex="-1"></a>    labelEl<span class="op">.</span><span class="at">htmlFor</span> <span class="op">=</span> id<span class="op">;</span></span>
<span id="cb4-736"><a href="#cb4-736" aria-hidden="true" tabindex="-1"></a>    labelEl<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 6px;"</span><span class="op">;</span></span>
<span id="cb4-737"><a href="#cb4-737" aria-hidden="true" tabindex="-1"></a>    labelEl<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>label<span class="sc">}</span><span class="vs"> &lt;span style="color: #be185d;"&gt;</span><span class="sc">${</span>val<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">;</span></span>
<span id="cb4-738"><a href="#cb4-738" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-739"><a href="#cb4-739" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> input <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"input"</span>)<span class="op">;</span></span>
<span id="cb4-740"><a href="#cb4-740" aria-hidden="true" tabindex="-1"></a>    input<span class="op">.</span><span class="at">type</span> <span class="op">=</span> <span class="st">"range"</span><span class="op">;</span></span>
<span id="cb4-741"><a href="#cb4-741" aria-hidden="true" tabindex="-1"></a>    input<span class="op">.</span><span class="at">id</span> <span class="op">=</span> id<span class="op">;</span></span>
<span id="cb4-742"><a href="#cb4-742" aria-hidden="true" tabindex="-1"></a>    input<span class="op">.</span><span class="at">min</span> <span class="op">=</span> min<span class="op">;</span></span>
<span id="cb4-743"><a href="#cb4-743" aria-hidden="true" tabindex="-1"></a>    input<span class="op">.</span><span class="at">max</span> <span class="op">=</span> max<span class="op">;</span></span>
<span id="cb4-744"><a href="#cb4-744" aria-hidden="true" tabindex="-1"></a>    input<span class="op">.</span><span class="at">step</span> <span class="op">=</span> step<span class="op">;</span></span>
<span id="cb4-745"><a href="#cb4-745" aria-hidden="true" tabindex="-1"></a>    input<span class="op">.</span><span class="at">value</span> <span class="op">=</span> val<span class="op">;</span></span>
<span id="cb4-746"><a href="#cb4-746" aria-hidden="true" tabindex="-1"></a>    input<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">width</span> <span class="op">=</span> <span class="st">"100%"</span><span class="op">;</span></span>
<span id="cb4-747"><a href="#cb4-747" aria-hidden="true" tabindex="-1"></a>    input<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">accentColor</span> <span class="op">=</span> <span class="st">"#be185d"</span><span class="op">;</span> </span>
<span id="cb4-748"><a href="#cb4-748" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-749"><a href="#cb4-749" aria-hidden="true" tabindex="-1"></a>    container<span class="op">.</span><span class="fu">appendChild</span>(labelEl)<span class="op">;</span></span>
<span id="cb4-750"><a href="#cb4-750" aria-hidden="true" tabindex="-1"></a>    container<span class="op">.</span><span class="fu">appendChild</span>(input)<span class="op">;</span></span>
<span id="cb4-751"><a href="#cb4-751" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { container<span class="op">,</span> input<span class="op">,</span> labelEl }<span class="op">;</span></span>
<span id="cb4-752"><a href="#cb4-752" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-753"><a href="#cb4-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-754"><a href="#cb4-754" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nCtrl <span class="op">=</span> <span class="fu">createInput</span>(<span class="st">"n_val_fx"</span><span class="op">,</span> <span class="st">"Số phép thử (n):"</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">500</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">50</span>)<span class="op">;</span></span>
<span id="cb4-755"><a href="#cb4-755" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pCtrl <span class="op">=</span> <span class="fu">createInput</span>(<span class="st">"p_val_fx"</span><span class="op">,</span> <span class="st">"Xác suất (p):"</span><span class="op">,</span> <span class="fl">0.05</span><span class="op">,</span> <span class="fl">0.95</span><span class="op">,</span> <span class="fl">0.05</span><span class="op">,</span> <span class="fl">0.5</span>)<span class="op">;</span></span>
<span id="cb4-756"><a href="#cb4-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-757"><a href="#cb4-757" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> controlsDiv <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb4-758"><a href="#cb4-758" aria-hidden="true" tabindex="-1"></a>  controlsDiv<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display: flex; flex-wrap: wrap; gap: 30px; justify-content: center; margin-bottom: 20px; width: 100%;"</span><span class="op">;</span></span>
<span id="cb4-759"><a href="#cb4-759" aria-hidden="true" tabindex="-1"></a>  controlsDiv<span class="op">.</span><span class="fu">appendChild</span>(nCtrl<span class="op">.</span><span class="at">container</span>)<span class="op">;</span></span>
<span id="cb4-760"><a href="#cb4-760" aria-hidden="true" tabindex="-1"></a>  controlsDiv<span class="op">.</span><span class="fu">appendChild</span>(pCtrl<span class="op">.</span><span class="at">container</span>)<span class="op">;</span></span>
<span id="cb4-761"><a href="#cb4-761" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(controlsDiv)<span class="op">;</span></span>
<span id="cb4-762"><a href="#cb4-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-763"><a href="#cb4-763" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stats Display</span></span>
<span id="cb4-764"><a href="#cb4-764" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> statsDiv <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb4-765"><a href="#cb4-765" aria-hidden="true" tabindex="-1"></a>  statsDiv<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"font-size: 16px; color: #374151; margin-bottom: 10px; font-weight: 500; font-family: monospace;"</span><span class="op">;</span></span>
<span id="cb4-766"><a href="#cb4-766" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(statsDiv)<span class="op">;</span></span>
<span id="cb4-767"><a href="#cb4-767" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-768"><a href="#cb4-768" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Plot Container</span></span>
<span id="cb4-769"><a href="#cb4-769" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotContainer <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb4-770"><a href="#cb4-770" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(plotContainer)<span class="op">;</span></span>
<span id="cb4-771"><a href="#cb4-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-772"><a href="#cb4-772" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 3. MATH KERNEL ---</span></span>
<span id="cb4-773"><a href="#cb4-773" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">logFact</span>(n) {</span>
<span id="cb4-774"><a href="#cb4-774" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (n <span class="op">&lt;=</span> <span class="dv">1</span>) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-775"><a href="#cb4-775" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(n) <span class="op">-</span> n <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> n)<span class="op">;</span></span>
<span id="cb4-776"><a href="#cb4-776" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-777"><a href="#cb4-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-778"><a href="#cb4-778" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">getBinomialProb</span>(k<span class="op">,</span> n<span class="op">,</span> p) {</span>
<span id="cb4-779"><a href="#cb4-779" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (k <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">||</span> k <span class="op">&gt;</span> n) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-780"><a href="#cb4-780" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (p <span class="op">&lt;=</span> <span class="dv">0</span>) <span class="cf">return</span> k <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-781"><a href="#cb4-781" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (p <span class="op">&gt;=</span> <span class="dv">1</span>) <span class="cf">return</span> k <span class="op">===</span> n <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-782"><a href="#cb4-782" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-783"><a href="#cb4-783" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> logP <span class="op">=</span> <span class="fu">logFact</span>(n) <span class="op">-</span> <span class="fu">logFact</span>(k) <span class="op">-</span> <span class="fu">logFact</span>(n <span class="op">-</span> k) <span class="op">+</span> k <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(p) <span class="op">+</span> (n <span class="op">-</span> k) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="dv">1</span> <span class="op">-</span> p)<span class="op">;</span></span>
<span id="cb4-784"><a href="#cb4-784" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(logP)<span class="op">;</span></span>
<span id="cb4-785"><a href="#cb4-785" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-786"><a href="#cb4-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-787"><a href="#cb4-787" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">normalPDF</span>(x<span class="op">,</span> mu<span class="op">,</span> sigma) {</span>
<span id="cb4-788"><a href="#cb4-788" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (sigma <span class="op">&lt;=</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-789"><a href="#cb4-789" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="dv">1</span> <span class="op">/</span> (sigma <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>))) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>((x <span class="op">-</span> mu) <span class="op">/</span> sigma<span class="op">,</span> <span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb4-790"><a href="#cb4-790" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-791"><a href="#cb4-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-792"><a href="#cb4-792" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 4. RENDER LOGIC ---</span></span>
<span id="cb4-793"><a href="#cb4-793" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">update</span>() {</span>
<span id="cb4-794"><a href="#cb4-794" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> n <span class="op">=</span> <span class="pp">parseFloat</span>(nCtrl<span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb4-795"><a href="#cb4-795" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> p <span class="op">=</span> <span class="pp">parseFloat</span>(pCtrl<span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb4-796"><a href="#cb4-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-797"><a href="#cb4-797" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update Text</span></span>
<span id="cb4-798"><a href="#cb4-798" aria-hidden="true" tabindex="-1"></a>    nCtrl<span class="op">.</span><span class="at">labelEl</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"span"</span>)<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> n<span class="op">;</span></span>
<span id="cb4-799"><a href="#cb4-799" aria-hidden="true" tabindex="-1"></a>    pCtrl<span class="op">.</span><span class="at">labelEl</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"span"</span>)<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> p<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb4-800"><a href="#cb4-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-801"><a href="#cb4-801" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> mu <span class="op">=</span> n <span class="op">*</span> p<span class="op">;</span></span>
<span id="cb4-802"><a href="#cb4-802" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sigma <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(n <span class="op">*</span> p <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> p))<span class="op">;</span></span>
<span id="cb4-803"><a href="#cb4-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-804"><a href="#cb4-804" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Stats</span></span>
<span id="cb4-805"><a href="#cb4-805" aria-hidden="true" tabindex="-1"></a>    statsDiv<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`&amp;mu; = &lt;b&gt;</span><span class="sc">${</span>mu<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">&lt;/b&gt; &amp;nbsp;|&amp;nbsp; &amp;sigma; = &lt;b&gt;</span><span class="sc">${</span>sigma<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">&lt;/b&gt;`</span><span class="op">;</span></span>
<span id="cb4-806"><a href="#cb4-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-807"><a href="#cb4-807" aria-hidden="true" tabindex="-1"></a>    <span class="co">// CALCULATION WINDOW: We still optimize calculation to +/- 4 sigma</span></span>
<span id="cb4-808"><a href="#cb4-808" aria-hidden="true" tabindex="-1"></a>    <span class="co">// to keep performance high, even though visual axis is 0-n.</span></span>
<span id="cb4-809"><a href="#cb4-809" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> startK <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(mu <span class="op">-</span> <span class="dv">4</span> <span class="op">*</span> sigma)<span class="op">;</span></span>
<span id="cb4-810"><a href="#cb4-810" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> endK <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(mu <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> sigma)<span class="op">;</span></span>
<span id="cb4-811"><a href="#cb4-811" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (startK <span class="op">&lt;</span> <span class="dv">0</span>) startK <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-812"><a href="#cb4-812" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (endK <span class="op">&gt;</span> n) endK <span class="op">=</span> n<span class="op">;</span></span>
<span id="cb4-813"><a href="#cb4-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-814"><a href="#cb4-814" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1. Generate Binomial Data</span></span>
<span id="cb4-815"><a href="#cb4-815" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> binomData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb4-816"><a href="#cb4-816" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> k <span class="op">=</span> startK<span class="op">;</span> k <span class="op">&lt;=</span> endK<span class="op">;</span> k<span class="op">++</span>) {</span>
<span id="cb4-817"><a href="#cb4-817" aria-hidden="true" tabindex="-1"></a>      binomData<span class="op">.</span><span class="fu">push</span>({ </span>
<span id="cb4-818"><a href="#cb4-818" aria-hidden="true" tabindex="-1"></a>          <span class="dt">k</span><span class="op">:</span> k<span class="op">,</span> </span>
<span id="cb4-819"><a href="#cb4-819" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x1</span><span class="op">:</span> k <span class="op">-</span> <span class="fl">0.5</span><span class="op">,</span> </span>
<span id="cb4-820"><a href="#cb4-820" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x2</span><span class="op">:</span> k <span class="op">+</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb4-821"><a href="#cb4-821" aria-hidden="true" tabindex="-1"></a>          <span class="dt">prob</span><span class="op">:</span> <span class="fu">getBinomialProb</span>(k<span class="op">,</span> n<span class="op">,</span> p) </span>
<span id="cb4-822"><a href="#cb4-822" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb4-823"><a href="#cb4-823" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-824"><a href="#cb4-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-825"><a href="#cb4-825" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 2. Generate Normal Data</span></span>
<span id="cb4-826"><a href="#cb4-826" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> normalData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb4-827"><a href="#cb4-827" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> step <span class="op">=</span> (endK <span class="op">-</span> startK) <span class="op">/</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb4-828"><a href="#cb4-828" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> safeStep <span class="op">=</span> step <span class="op">&gt;</span> <span class="fl">0.1</span> <span class="op">?</span> step <span class="op">:</span> <span class="fl">0.1</span><span class="op">;</span></span>
<span id="cb4-829"><a href="#cb4-829" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-830"><a href="#cb4-830" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> x <span class="op">=</span> startK<span class="op">;</span> x <span class="op">&lt;=</span> endK<span class="op">;</span> x <span class="op">+=</span> safeStep) {</span>
<span id="cb4-831"><a href="#cb4-831" aria-hidden="true" tabindex="-1"></a>      normalData<span class="op">.</span><span class="fu">push</span>({ <span class="dt">x</span><span class="op">:</span> x<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="fu">normalPDF</span>(x<span class="op">,</span> mu<span class="op">,</span> sigma) })<span class="op">;</span></span>
<span id="cb4-832"><a href="#cb4-832" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-833"><a href="#cb4-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-834"><a href="#cb4-834" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 3. Plot</span></span>
<span id="cb4-835"><a href="#cb4-835" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chart <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb4-836"><a href="#cb4-836" aria-hidden="true" tabindex="-1"></a>      <span class="dt">width</span><span class="op">:</span> <span class="dv">600</span><span class="op">,</span></span>
<span id="cb4-837"><a href="#cb4-837" aria-hidden="true" tabindex="-1"></a>      <span class="dt">height</span><span class="op">:</span> <span class="dv">380</span><span class="op">,</span></span>
<span id="cb4-838"><a href="#cb4-838" aria-hidden="true" tabindex="-1"></a>      <span class="dt">marginTop</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb4-839"><a href="#cb4-839" aria-hidden="true" tabindex="-1"></a>      <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb4-840"><a href="#cb4-840" aria-hidden="true" tabindex="-1"></a>      <span class="dt">marginBottom</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb4-841"><a href="#cb4-841" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> { </span>
<span id="cb4-842"><a href="#cb4-842" aria-hidden="true" tabindex="-1"></a>        <span class="dt">label</span><span class="op">:</span> <span class="st">"Số lần thành công (k)"</span><span class="op">,</span></span>
<span id="cb4-843"><a href="#cb4-843" aria-hidden="true" tabindex="-1"></a>        <span class="co">// FIX: Hard-code domain to full range [0, n] to prevent jumping</span></span>
<span id="cb4-844"><a href="#cb4-844" aria-hidden="true" tabindex="-1"></a>        <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> n]</span>
<span id="cb4-845"><a href="#cb4-845" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb4-846"><a href="#cb4-846" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> { </span>
<span id="cb4-847"><a href="#cb4-847" aria-hidden="true" tabindex="-1"></a>        <span class="dt">label</span><span class="op">:</span> <span class="st">"Xác suất"</span><span class="op">,</span> </span>
<span id="cb4-848"><a href="#cb4-848" aria-hidden="true" tabindex="-1"></a>        <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span> </span>
<span id="cb4-849"><a href="#cb4-849" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb4-850"><a href="#cb4-850" aria-hidden="true" tabindex="-1"></a>      <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb4-851"><a href="#cb4-851" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Binomial</span></span>
<span id="cb4-852"><a href="#cb4-852" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">rectY</span>(binomData<span class="op">,</span> {</span>
<span id="cb4-853"><a href="#cb4-853" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x1</span><span class="op">:</span> <span class="st">"x1"</span><span class="op">,</span> </span>
<span id="cb4-854"><a href="#cb4-854" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x2</span><span class="op">:</span> <span class="st">"x2"</span><span class="op">,</span> </span>
<span id="cb4-855"><a href="#cb4-855" aria-hidden="true" tabindex="-1"></a>          <span class="dt">y</span><span class="op">:</span> <span class="st">"prob"</span><span class="op">,</span> </span>
<span id="cb4-856"><a href="#cb4-856" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fill</span><span class="op">:</span> <span class="st">"#3b82f6"</span><span class="op">,</span> </span>
<span id="cb4-857"><a href="#cb4-857" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb4-858"><a href="#cb4-858" aria-hidden="true" tabindex="-1"></a>          <span class="dt">title</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="vs">`k: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">k</span><span class="sc">}\n</span><span class="vs">P: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">prob</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb4-859"><a href="#cb4-859" aria-hidden="true" tabindex="-1"></a>        })<span class="op">,</span></span>
<span id="cb4-860"><a href="#cb4-860" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-861"><a href="#cb4-861" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Normal Curve</span></span>
<span id="cb4-862"><a href="#cb4-862" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">line</span>(normalData<span class="op">,</span> {</span>
<span id="cb4-863"><a href="#cb4-863" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> </span>
<span id="cb4-864"><a href="#cb4-864" aria-hidden="true" tabindex="-1"></a>          <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span> </span>
<span id="cb4-865"><a href="#cb4-865" aria-hidden="true" tabindex="-1"></a>          <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#be185d"</span><span class="op">,</span> </span>
<span id="cb4-866"><a href="#cb4-866" aria-hidden="true" tabindex="-1"></a>          <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">3</span></span>
<span id="cb4-867"><a href="#cb4-867" aria-hidden="true" tabindex="-1"></a>        })<span class="op">,</span></span>
<span id="cb4-868"><a href="#cb4-868" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-869"><a href="#cb4-869" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Mean Line</span></span>
<span id="cb4-870"><a href="#cb4-870" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">ruleX</span>([mu]<span class="op">,</span> {</span>
<span id="cb4-871"><a href="#cb4-871" aria-hidden="true" tabindex="-1"></a>          <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#374151"</span><span class="op">,</span> </span>
<span id="cb4-872"><a href="#cb4-872" aria-hidden="true" tabindex="-1"></a>          <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="st">"4,4"</span><span class="op">,</span> </span>
<span id="cb4-873"><a href="#cb4-873" aria-hidden="true" tabindex="-1"></a>          <span class="dt">strokeOpacity</span><span class="op">:</span> <span class="fl">0.6</span></span>
<span id="cb4-874"><a href="#cb4-874" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb4-875"><a href="#cb4-875" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb4-876"><a href="#cb4-876" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb4-877"><a href="#cb4-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-878"><a href="#cb4-878" aria-hidden="true" tabindex="-1"></a>    plotContainer<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb4-879"><a href="#cb4-879" aria-hidden="true" tabindex="-1"></a>    plotContainer<span class="op">.</span><span class="fu">appendChild</span>(chart)<span class="op">;</span></span>
<span id="cb4-880"><a href="#cb4-880" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-881"><a href="#cb4-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-882"><a href="#cb4-882" aria-hidden="true" tabindex="-1"></a>  nCtrl<span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span> update)<span class="op">;</span></span>
<span id="cb4-883"><a href="#cb4-883" aria-hidden="true" tabindex="-1"></a>  pCtrl<span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span> update)<span class="op">;</span></span>
<span id="cb4-884"><a href="#cb4-884" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-885"><a href="#cb4-885" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update</span>()<span class="op">;</span></span>
<span id="cb4-886"><a href="#cb4-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-887"><a href="#cb4-887" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> wrapper<span class="op">;</span></span>
<span id="cb4-888"><a href="#cb4-888" aria-hidden="true" tabindex="-1"></a>})()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="declaration">

</div>
</div>
</div>
</section>
</section>
<section id="phân-phối-siêu-bội-hypergeometric-distribution" class="level3">
<h3 class="anchored" data-anchor-id="phân-phối-siêu-bội-hypergeometric-distribution">Phân phối Siêu bội (Hypergeometric distribution)</h3>
<p>Nếu phân phối Nhị thức là việc tung đồng xu, thì Phân phối Siêu bội giống như việc chia bài.</p>
<p>Tình huống: Bạn có bộ bài 52 lá, trong đó có 4 lá Át. Bạn rút 10 lá và hỏi “Tôi rút được bao nhiêu lá Át?”.</p>
<p>Luật chơi:</p>
<ul>
<li>Số lần thử cố định (<span class="math inline">\(n\)</span>)</li>
<li>Các lần thử phụ thuộc nhau</li>
<li>Lấy mẫu không hoàn lại từ một quần thể hữu hạn (<span class="math inline">\(N\)</span>)</li>
</ul>
<p>Khi bạn rút được một lá Át ra khỏi bộ bài và giữ nó lại, <strong>xác suất rút được lá Át tiếp theo sẽ thay đổi</strong> (vì trong bộ bài giờ đây thiếu mất 1 lá Át và tổng số lá cũng giảm đi 1). Đây là đặc trưng của việc lấy mẫu không hoàn lại.</p>
<p>Phân phối Siêu bội mô tả xác suất lấy được đúng <span class="math inline">\(k\)</span> phần tử thành công trong <span class="math inline">\(n\)</span> lần lấy mẫu từ một quần thể hữu hạn gồm <span class="math inline">\(N\)</span> phần tử, mà không có sự thay thế (không hoàn lại).</p>
<p><span class="math display">\[\mathbb{P}(X=k) = \frac{\binom{K}{k} \binom{N-K}{n-k}}{\binom{N}{n}}\]</span></p>
<ul>
<li><span class="math inline">\(N\)</span>: Tổng kích thước quần thể (Ví dụ: 52 lá bài)</li>
<li><span class="math inline">\(n\)</span>: Kích thước mẫu lấy ra (Ví dụ: Rút 5 lá trên tay)</li>
<li><span class="math inline">\(K\)</span>: Tổng số phần tử thành công có trong quần thể (Ví dụ: 4 lá Át)</li>
<li><span class="math inline">\(k\)</span>: Số lượng thành công mong muốn trong mẫu (Ví dụ: Muốn có đúng 2 lá Át)</li>
<li><span class="math inline">\(N-K\)</span>: Số lượng phần tử thất bại trong quần thể (Ví dụ: 48 lá bài còn lại)</li>
<li><span class="math inline">\(n-k\)</span>: Số lượng thất bại phải lấy trong mẫu (Ví dụ: 3 lá còn lại trong tay phải là lá thường).</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Giải thích
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="math display">\[\frac{ \overbrace{\binom{K}{k}}^{\text{Chọn } k \text{ thành công}} \cdot \overbrace{\binom{N-K}{n-k}}^{\text{Chọn } n-k \text{ thất bại}} }{ \underbrace{\binom{N}{n}}_{\text{Tổng số cách chọn ra } n \text{ mẫu}} }\]</span></p>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb5" data-startfrom="924" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 923;"><span id="cb5-924"><a href="#cb5-924" aria-hidden="true" tabindex="-1"></a>viewof ace_sim_manual <span class="op">=</span> (() <span class="kw">=&gt;</span> {</span>
<span id="cb5-925"><a href="#cb5-925" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 1. SETUP DOM &amp; STYLES ---</span></span>
<span id="cb5-926"><a href="#cb5-926" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb5-927"><a href="#cb5-927" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb5-928"><a href="#cb5-928" aria-hidden="true" tabindex="-1"></a><span class="vs">    width: 400px;</span></span>
<span id="cb5-929"><a href="#cb5-929" aria-hidden="true" tabindex="-1"></a><span class="vs">    height: 440px; </span></span>
<span id="cb5-930"><a href="#cb5-930" aria-hidden="true" tabindex="-1"></a><span class="vs">    margin: 0 auto;</span></span>
<span id="cb5-931"><a href="#cb5-931" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;</span></span>
<span id="cb5-932"><a href="#cb5-932" aria-hidden="true" tabindex="-1"></a><span class="vs">    display: flex;</span></span>
<span id="cb5-933"><a href="#cb5-933" aria-hidden="true" tabindex="-1"></a><span class="vs">    flex-direction: column;</span></span>
<span id="cb5-934"><a href="#cb5-934" aria-hidden="true" tabindex="-1"></a><span class="vs">    align-items: center;</span></span>
<span id="cb5-935"><a href="#cb5-935" aria-hidden="true" tabindex="-1"></a><span class="vs">    border: 1px solid transparent; /* Prevents margin collapse */</span></span>
<span id="cb5-936"><a href="#cb5-936" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb5-937"><a href="#cb5-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-938"><a href="#cb5-938" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Inject UI HTML directly (Total Control)</span></span>
<span id="cb5-939"><a href="#cb5-939" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb5-940"><a href="#cb5-940" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;style&gt;</span></span>
<span id="cb5-941"><a href="#cb5-941" aria-hidden="true" tabindex="-1"></a><span class="vs">      .ace-controls-row {</span></span>
<span id="cb5-942"><a href="#cb5-942" aria-hidden="true" tabindex="-1"></a><span class="vs">        width: 100%;</span></span>
<span id="cb5-943"><a href="#cb5-943" aria-hidden="true" tabindex="-1"></a><span class="vs">        height: 40px;</span></span>
<span id="cb5-944"><a href="#cb5-944" aria-hidden="true" tabindex="-1"></a><span class="vs">        display: flex;</span></span>
<span id="cb5-945"><a href="#cb5-945" aria-hidden="true" tabindex="-1"></a><span class="vs">        justify-content: center;</span></span>
<span id="cb5-946"><a href="#cb5-946" aria-hidden="true" tabindex="-1"></a><span class="vs">        align-items: center;</span></span>
<span id="cb5-947"><a href="#cb5-947" aria-hidden="true" tabindex="-1"></a><span class="vs">        gap: 12px;</span></span>
<span id="cb5-948"><a href="#cb5-948" aria-hidden="true" tabindex="-1"></a><span class="vs">        margin-bottom: 5px;</span></span>
<span id="cb5-949"><a href="#cb5-949" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb5-950"><a href="#cb5-950" aria-hidden="true" tabindex="-1"></a><span class="vs">      .ace-btn {</span></span>
<span id="cb5-951"><a href="#cb5-951" aria-hidden="true" tabindex="-1"></a><span class="vs">        padding: 6px 14px;</span></span>
<span id="cb5-952"><a href="#cb5-952" aria-hidden="true" tabindex="-1"></a><span class="vs">        border-radius: 6px;</span></span>
<span id="cb5-953"><a href="#cb5-953" aria-hidden="true" tabindex="-1"></a><span class="vs">        border: 1px solid #d1d5db;</span></span>
<span id="cb5-954"><a href="#cb5-954" aria-hidden="true" tabindex="-1"></a><span class="vs">        background-color: white;</span></span>
<span id="cb5-955"><a href="#cb5-955" aria-hidden="true" tabindex="-1"></a><span class="vs">        color: #374151;</span></span>
<span id="cb5-956"><a href="#cb5-956" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-size: 14px;</span></span>
<span id="cb5-957"><a href="#cb5-957" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-weight: 600;</span></span>
<span id="cb5-958"><a href="#cb5-958" aria-hidden="true" tabindex="-1"></a><span class="vs">        cursor: pointer;</span></span>
<span id="cb5-959"><a href="#cb5-959" aria-hidden="true" tabindex="-1"></a><span class="vs">        line-height: 1.2;</span></span>
<span id="cb5-960"><a href="#cb5-960" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb5-961"><a href="#cb5-961" aria-hidden="true" tabindex="-1"></a><span class="vs">      .ace-btn:hover { background-color: #f3f4f6; }</span></span>
<span id="cb5-962"><a href="#cb5-962" aria-hidden="true" tabindex="-1"></a><span class="vs">      .ace-btn-primary {</span></span>
<span id="cb5-963"><a href="#cb5-963" aria-hidden="true" tabindex="-1"></a><span class="vs">        background-color: #3b82f6; </span></span>
<span id="cb5-964"><a href="#cb5-964" aria-hidden="true" tabindex="-1"></a><span class="vs">        color: white; </span></span>
<span id="cb5-965"><a href="#cb5-965" aria-hidden="true" tabindex="-1"></a><span class="vs">        border-color: #2563eb;</span></span>
<span id="cb5-966"><a href="#cb5-966" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb5-967"><a href="#cb5-967" aria-hidden="true" tabindex="-1"></a><span class="vs">      .ace-btn-primary:hover { background-color: #2563eb; color: white; }</span></span>
<span id="cb5-968"><a href="#cb5-968" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span></span>
<span id="cb5-969"><a href="#cb5-969" aria-hidden="true" tabindex="-1"></a><span class="vs">      .ace-toggle {</span></span>
<span id="cb5-970"><a href="#cb5-970" aria-hidden="true" tabindex="-1"></a><span class="vs">        display: flex; align-items: center; gap: 6px;</span></span>
<span id="cb5-971"><a href="#cb5-971" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-size: 14px; font-weight: 500; color: #4b5563;</span></span>
<span id="cb5-972"><a href="#cb5-972" aria-hidden="true" tabindex="-1"></a><span class="vs">        cursor: pointer; user-select: none;</span></span>
<span id="cb5-973"><a href="#cb5-973" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb5-974"><a href="#cb5-974" aria-hidden="true" tabindex="-1"></a><span class="vs">      .ace-toggle input { width: 16px; height: 16px; accent-color: #10b981; cursor: pointer; }</span></span>
<span id="cb5-975"><a href="#cb5-975" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span></span>
<span id="cb5-976"><a href="#cb5-976" aria-hidden="true" tabindex="-1"></a><span class="vs">      canvas { display: block; } /* Removes ghost margin */</span></span>
<span id="cb5-977"><a href="#cb5-977" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/style&gt;</span></span>
<span id="cb5-978"><a href="#cb5-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-979"><a href="#cb5-979" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div class="ace-controls-row"&gt;</span></span>
<span id="cb5-980"><a href="#cb5-980" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;button id="btn-draw" class="ace-btn ace-btn-primary"&gt;Rút 10 lá&lt;/button&gt;</span></span>
<span id="cb5-981"><a href="#cb5-981" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;label class="ace-toggle"&gt;</span></span>
<span id="cb5-982"><a href="#cb5-982" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;input type="checkbox" id="chk-auto"&gt;</span></span>
<span id="cb5-983"><a href="#cb5-983" aria-hidden="true" tabindex="-1"></a><span class="vs">        Tự động chạy</span></span>
<span id="cb5-984"><a href="#cb5-984" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/label&gt;</span></span>
<span id="cb5-985"><a href="#cb5-985" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;button id="btn-reset" class="ace-btn"&gt;Làm lại&lt;/button&gt;</span></span>
<span id="cb5-986"><a href="#cb5-986" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb5-987"><a href="#cb5-987" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb5-988"><a href="#cb5-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-989"><a href="#cb5-989" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 2. CANVAS SETUP ---</span></span>
<span id="cb5-990"><a href="#cb5-990" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> width <span class="op">=</span> <span class="dv">400</span><span class="op">;</span></span>
<span id="cb5-991"><a href="#cb5-991" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> height <span class="op">=</span> <span class="dv">380</span><span class="op">;</span></span>
<span id="cb5-992"><a href="#cb5-992" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> canvas <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"canvas"</span>)<span class="op">;</span></span>
<span id="cb5-993"><a href="#cb5-993" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dpr <span class="op">=</span> <span class="bu">window</span><span class="op">.</span><span class="at">devicePixelRatio</span> <span class="op">||</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb5-994"><a href="#cb5-994" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-995"><a href="#cb5-995" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">width</span> <span class="op">=</span> width <span class="op">*</span> dpr<span class="op">;</span></span>
<span id="cb5-996"><a href="#cb5-996" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">height</span> <span class="op">=</span> height <span class="op">*</span> dpr<span class="op">;</span></span>
<span id="cb5-997"><a href="#cb5-997" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">width</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>width<span class="sc">}</span><span class="vs">px`</span><span class="op">;</span></span>
<span id="cb5-998"><a href="#cb5-998" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">height</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>height<span class="sc">}</span><span class="vs">px`</span><span class="op">;</span></span>
<span id="cb5-999"><a href="#cb5-999" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1000"><a href="#cb5-1000" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ctx <span class="op">=</span> canvas<span class="op">.</span><span class="fu">getContext</span>(<span class="st">"2d"</span><span class="op">,</span> { <span class="dt">alpha</span><span class="op">:</span> <span class="kw">false</span> })<span class="op">;</span></span>
<span id="cb5-1001"><a href="#cb5-1001" aria-hidden="true" tabindex="-1"></a>  ctx<span class="op">.</span><span class="fu">scale</span>(dpr<span class="op">,</span> dpr)<span class="op">;</span></span>
<span id="cb5-1002"><a href="#cb5-1002" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="fu">appendChild</span>(canvas)<span class="op">;</span></span>
<span id="cb5-1003"><a href="#cb5-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1004"><a href="#cb5-1004" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 3. STATE &amp; CONSTANTS ---</span></span>
<span id="cb5-1005"><a href="#cb5-1005" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> SUITS <span class="op">=</span> [<span class="st">"♠"</span><span class="op">,</span> <span class="st">"♥"</span><span class="op">,</span> <span class="st">"♣"</span><span class="op">,</span> <span class="st">"♦"</span>]<span class="op">;</span></span>
<span id="cb5-1006"><a href="#cb5-1006" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> RANKS <span class="op">=</span> [<span class="st">"2"</span><span class="op">,</span><span class="st">"3"</span><span class="op">,</span><span class="st">"4"</span><span class="op">,</span><span class="st">"5"</span><span class="op">,</span><span class="st">"6"</span><span class="op">,</span><span class="st">"7"</span><span class="op">,</span><span class="st">"8"</span><span class="op">,</span><span class="st">"9"</span><span class="op">,</span><span class="st">"10"</span><span class="op">,</span><span class="st">"J"</span><span class="op">,</span><span class="st">"Q"</span><span class="op">,</span><span class="st">"K"</span><span class="op">,</span><span class="st">"A"</span>]<span class="op">;</span></span>
<span id="cb5-1007"><a href="#cb5-1007" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> CARD_W <span class="op">=</span> <span class="dv">30</span><span class="op">,</span> CARD_H <span class="op">=</span> <span class="dv">45</span><span class="op">;</span></span>
<span id="cb5-1008"><a href="#cb5-1008" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1009"><a href="#cb5-1009" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Layout Constants</span></span>
<span id="cb5-1010"><a href="#cb5-1010" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> Y_HEADER <span class="op">=</span> <span class="dv">45</span><span class="op">;</span></span>
<span id="cb5-1011"><a href="#cb5-1011" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> Y_CARDS <span class="op">=</span> <span class="dv">85</span><span class="op">;</span></span>
<span id="cb5-1012"><a href="#cb5-1012" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> Y_CHART_BASE <span class="op">=</span> <span class="dv">320</span><span class="op">;</span></span>
<span id="cb5-1013"><a href="#cb5-1013" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> CHART_H <span class="op">=</span> <span class="dv">60</span><span class="op">;</span></span>
<span id="cb5-1014"><a href="#cb5-1014" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1015"><a href="#cb5-1015" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Colors</span></span>
<span id="cb5-1016"><a href="#cb5-1016" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> BG_COLOR<span class="op">=</span><span class="st">"#fff"</span><span class="op">,</span> TEXT_COLOR<span class="op">=</span><span class="st">"#333333"</span><span class="op">,</span> ACE_COLOR<span class="op">=</span><span class="st">"#d35400"</span><span class="op">,</span> ACE_BG<span class="op">=</span><span class="st">"#fffbe6"</span><span class="op">;</span></span>
<span id="cb5-1017"><a href="#cb5-1017" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> CARD_BG<span class="op">=</span><span class="st">"#ffffff"</span><span class="op">,</span> CARD_BORDER<span class="op">=</span><span class="st">"#cccccc"</span><span class="op">,</span> RED<span class="op">=</span><span class="st">"#e74c3c"</span><span class="op">,</span> BLACK<span class="op">=</span><span class="st">"#2c3e50"</span><span class="op">;</span></span>
<span id="cb5-1018"><a href="#cb5-1018" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> CHART_THEO<span class="op">=</span><span class="st">"rgba(44, 62, 80, 0.1)"</span><span class="op">,</span> CHART_ACT<span class="op">=</span><span class="st">"#009688"</span><span class="op">,</span> CHART_ACTIVE<span class="op">=</span><span class="st">"#00796b"</span><span class="op">;</span></span>
<span id="cb5-1019"><a href="#cb5-1019" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> DECK_BACK<span class="op">=</span><span class="st">"#c0392b"</span><span class="op">;</span></span>
<span id="cb5-1020"><a href="#cb5-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1021"><a href="#cb5-1021" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">hypergeom</span>(k<span class="op">,</span> N<span class="op">,</span> K<span class="op">,</span> n) {</span>
<span id="cb5-1022"><a href="#cb5-1022" aria-hidden="true" tabindex="-1"></a>     <span class="kw">function</span> <span class="fu">nCr</span>(n<span class="op">,</span> r) {</span>
<span id="cb5-1023"><a href="#cb5-1023" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (r <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">||</span> r <span class="op">&gt;</span> n) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb5-1024"><a href="#cb5-1024" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> res <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb5-1025"><a href="#cb5-1025" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>r<span class="op">;</span> i<span class="op">++</span>) res <span class="op">=</span> res <span class="op">*</span> (n <span class="op">-</span> i) <span class="op">/</span> (i <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb5-1026"><a href="#cb5-1026" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> res<span class="op">;</span></span>
<span id="cb5-1027"><a href="#cb5-1027" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb5-1028"><a href="#cb5-1028" aria-hidden="true" tabindex="-1"></a>     <span class="cf">return</span> (<span class="fu">nCr</span>(K<span class="op">,</span> k) <span class="op">*</span> <span class="fu">nCr</span>(N <span class="op">-</span> K<span class="op">,</span> n <span class="op">-</span> k)) <span class="op">/</span> <span class="fu">nCr</span>(N<span class="op">,</span> n)<span class="op">;</span></span>
<span id="cb5-1029"><a href="#cb5-1029" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1030"><a href="#cb5-1030" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> THEORETICAL <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb5-1031"><a href="#cb5-1031" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">let</span> k<span class="op">=</span><span class="dv">0</span><span class="op">;</span> k<span class="op">&lt;=</span><span class="dv">4</span><span class="op">;</span> k<span class="op">++</span>) THEORETICAL[k] <span class="op">=</span> <span class="fu">hypergeom</span>(k<span class="op">,</span> <span class="dv">52</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb5-1032"><a href="#cb5-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1033"><a href="#cb5-1033" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> S <span class="op">=</span> {</span>
<span id="cb5-1034"><a href="#cb5-1034" aria-hidden="true" tabindex="-1"></a>     <span class="dt">counts</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span> </span>
<span id="cb5-1035"><a href="#cb5-1035" aria-hidden="true" tabindex="-1"></a>     <span class="dt">totalDeals</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb5-1036"><a href="#cb5-1036" aria-hidden="true" tabindex="-1"></a>     <span class="dt">lastHand</span><span class="op">:</span> []<span class="op">,</span></span>
<span id="cb5-1037"><a href="#cb5-1037" aria-hidden="true" tabindex="-1"></a>     <span class="dt">animation</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> </span>
<span id="cb5-1038"><a href="#cb5-1038" aria-hidden="true" tabindex="-1"></a>     <span class="dt">cooldown</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb5-1039"><a href="#cb5-1039" aria-hidden="true" tabindex="-1"></a>     <span class="dt">isAuto</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb5-1040"><a href="#cb5-1040" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb5-1041"><a href="#cb5-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1042"><a href="#cb5-1042" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 4. LOGIC ---</span></span>
<span id="cb5-1043"><a href="#cb5-1043" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">runDeal</span>() {</span>
<span id="cb5-1044"><a href="#cb5-1044" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> deck <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb5-1045"><a href="#cb5-1045" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> s <span class="kw">of</span> SUITS) {</span>
<span id="cb5-1046"><a href="#cb5-1046" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(<span class="kw">let</span> r <span class="kw">of</span> RANKS) deck<span class="op">.</span><span class="fu">push</span>({ <span class="dt">rank</span><span class="op">:</span> r<span class="op">,</span> <span class="dt">suit</span><span class="op">:</span> s<span class="op">,</span> <span class="dt">isAce</span><span class="op">:</span> r <span class="op">===</span> <span class="st">"A"</span> })<span class="op">;</span></span>
<span id="cb5-1047"><a href="#cb5-1047" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-1048"><a href="#cb5-1048" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span>deck<span class="op">.</span><span class="at">length</span><span class="op">-</span><span class="dv">1</span><span class="op">;</span> i<span class="op">&gt;</span><span class="dv">0</span><span class="op">;</span> i<span class="op">--</span>) {</span>
<span id="cb5-1049"><a href="#cb5-1049" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> j <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>() <span class="op">*</span> (i<span class="op">+</span><span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb5-1050"><a href="#cb5-1050" aria-hidden="true" tabindex="-1"></a>       [deck[i]<span class="op">,</span> deck[j]] <span class="op">=</span> [deck[j]<span class="op">,</span> deck[i]]<span class="op">;</span></span>
<span id="cb5-1051"><a href="#cb5-1051" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-1052"><a href="#cb5-1052" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-1053"><a href="#cb5-1053" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hand <span class="op">=</span> deck<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb5-1054"><a href="#cb5-1054" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> aceCount <span class="op">=</span> hand<span class="op">.</span><span class="fu">filter</span>(c <span class="kw">=&gt;</span> c<span class="op">.</span><span class="at">isAce</span>)<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb5-1055"><a href="#cb5-1055" aria-hidden="true" tabindex="-1"></a>    S<span class="op">.</span><span class="at">counts</span>[aceCount]<span class="op">++;</span></span>
<span id="cb5-1056"><a href="#cb5-1056" aria-hidden="true" tabindex="-1"></a>    S<span class="op">.</span><span class="at">totalDeals</span><span class="op">++;</span></span>
<span id="cb5-1057"><a href="#cb5-1057" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-1058"><a href="#cb5-1058" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Animation targets</span></span>
<span id="cb5-1059"><a href="#cb5-1059" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> startX <span class="op">=</span> (width <span class="op">-</span> (<span class="dv">5</span> <span class="op">*</span> (CARD_W <span class="op">+</span> <span class="dv">8</span>))) <span class="op">/</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb5-1060"><a href="#cb5-1060" aria-hidden="true" tabindex="-1"></a>    S<span class="op">.</span><span class="at">lastHand</span> <span class="op">=</span> hand<span class="op">.</span><span class="fu">map</span>((c<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb5-1061"><a href="#cb5-1061" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> row <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(i <span class="op">/</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb5-1062"><a href="#cb5-1062" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> col <span class="op">=</span> i <span class="op">%</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb5-1063"><a href="#cb5-1063" aria-hidden="true" tabindex="-1"></a>       <span class="cf">return</span> {</span>
<span id="cb5-1064"><a href="#cb5-1064" aria-hidden="true" tabindex="-1"></a>         <span class="op">...</span>c<span class="op">,</span></span>
<span id="cb5-1065"><a href="#cb5-1065" aria-hidden="true" tabindex="-1"></a>         <span class="dt">x</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb5-1066"><a href="#cb5-1066" aria-hidden="true" tabindex="-1"></a>         <span class="dt">targetX</span><span class="op">:</span> startX <span class="op">+</span> col <span class="op">*</span> (CARD_W <span class="op">+</span> <span class="dv">8</span>)<span class="op">,</span></span>
<span id="cb5-1067"><a href="#cb5-1067" aria-hidden="true" tabindex="-1"></a>         <span class="dt">targetY</span><span class="op">:</span> Y_CARDS <span class="op">+</span> row <span class="op">*</span> (CARD_H <span class="op">+</span> <span class="dv">12</span>)<span class="op">,</span></span>
<span id="cb5-1068"><a href="#cb5-1068" aria-hidden="true" tabindex="-1"></a>         <span class="dt">t</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb5-1069"><a href="#cb5-1069" aria-hidden="true" tabindex="-1"></a>       }<span class="op">;</span></span>
<span id="cb5-1070"><a href="#cb5-1070" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb5-1071"><a href="#cb5-1071" aria-hidden="true" tabindex="-1"></a>    S<span class="op">.</span><span class="at">animation</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb5-1072"><a href="#cb5-1072" aria-hidden="true" tabindex="-1"></a>    S<span class="op">.</span><span class="at">cooldown</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> </span>
<span id="cb5-1073"><a href="#cb5-1073" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1074"><a href="#cb5-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1075"><a href="#cb5-1075" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">reset</span>() {</span>
<span id="cb5-1076"><a href="#cb5-1076" aria-hidden="true" tabindex="-1"></a>     S<span class="op">.</span><span class="at">counts</span> <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb5-1077"><a href="#cb5-1077" aria-hidden="true" tabindex="-1"></a>     S<span class="op">.</span><span class="at">totalDeals</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb5-1078"><a href="#cb5-1078" aria-hidden="true" tabindex="-1"></a>     S<span class="op">.</span><span class="at">lastHand</span> <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb5-1079"><a href="#cb5-1079" aria-hidden="true" tabindex="-1"></a>     S<span class="op">.</span><span class="at">animation</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb5-1080"><a href="#cb5-1080" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1081"><a href="#cb5-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1082"><a href="#cb5-1082" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 5. LOOP ---</span></span>
<span id="cb5-1083"><a href="#cb5-1083" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">update</span>() {</span>
<span id="cb5-1084"><a href="#cb5-1084" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> (S<span class="op">.</span><span class="at">isAuto</span> <span class="op">&amp;&amp;</span> S<span class="op">.</span><span class="at">animation</span> <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb5-1085"><a href="#cb5-1085" aria-hidden="true" tabindex="-1"></a>        S<span class="op">.</span><span class="at">cooldown</span><span class="op">++;</span></span>
<span id="cb5-1086"><a href="#cb5-1086" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (S<span class="op">.</span><span class="at">cooldown</span> <span class="op">&gt;</span> <span class="dv">40</span>) <span class="fu">runDeal</span>()<span class="op">;</span></span>
<span id="cb5-1087"><a href="#cb5-1087" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb5-1088"><a href="#cb5-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1089"><a href="#cb5-1089" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> (S<span class="op">.</span><span class="at">animation</span> <span class="op">===</span> <span class="dv">1</span>) {</span>
<span id="cb5-1090"><a href="#cb5-1090" aria-hidden="true" tabindex="-1"></a>       <span class="kw">let</span> done <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb5-1091"><a href="#cb5-1091" aria-hidden="true" tabindex="-1"></a>       <span class="cf">for</span> (<span class="kw">let</span> c <span class="kw">of</span> S<span class="op">.</span><span class="at">lastHand</span>) {</span>
<span id="cb5-1092"><a href="#cb5-1092" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (c<span class="op">.</span><span class="at">t</span> <span class="op">&lt;</span> <span class="dv">1</span>) {</span>
<span id="cb5-1093"><a href="#cb5-1093" aria-hidden="true" tabindex="-1"></a>             c<span class="op">.</span><span class="at">t</span> <span class="op">+=</span> <span class="fl">0.1</span><span class="op">;</span> </span>
<span id="cb5-1094"><a href="#cb5-1094" aria-hidden="true" tabindex="-1"></a>             <span class="cf">if</span> (c<span class="op">.</span><span class="at">t</span> <span class="op">&gt;</span> <span class="dv">1</span>) c<span class="op">.</span><span class="at">t</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb5-1095"><a href="#cb5-1095" aria-hidden="true" tabindex="-1"></a>             <span class="kw">const</span> ease <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(<span class="dv">1</span> <span class="op">-</span> c<span class="op">.</span><span class="at">t</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb5-1096"><a href="#cb5-1096" aria-hidden="true" tabindex="-1"></a>             c<span class="op">.</span><span class="at">x</span> <span class="op">=</span> <span class="dv">30</span> <span class="op">+</span> (c<span class="op">.</span><span class="at">targetX</span> <span class="op">-</span> <span class="dv">30</span>) <span class="op">*</span> ease<span class="op">;</span></span>
<span id="cb5-1097"><a href="#cb5-1097" aria-hidden="true" tabindex="-1"></a>             c<span class="op">.</span><span class="at">y</span> <span class="op">=</span> <span class="dv">30</span> <span class="op">+</span> (c<span class="op">.</span><span class="at">targetY</span> <span class="op">-</span> <span class="dv">30</span>) <span class="op">*</span> ease<span class="op">;</span></span>
<span id="cb5-1098"><a href="#cb5-1098" aria-hidden="true" tabindex="-1"></a>             done <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb5-1099"><a href="#cb5-1099" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb5-1100"><a href="#cb5-1100" aria-hidden="true" tabindex="-1"></a>       }</span>
<span id="cb5-1101"><a href="#cb5-1101" aria-hidden="true" tabindex="-1"></a>       <span class="cf">if</span> (done) S<span class="op">.</span><span class="at">animation</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb5-1102"><a href="#cb5-1102" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-1103"><a href="#cb5-1103" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1104"><a href="#cb5-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1105"><a href="#cb5-1105" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">draw</span>() {</span>
<span id="cb5-1106"><a href="#cb5-1106" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> BG_COLOR<span class="op">;</span></span>
<span id="cb5-1107"><a href="#cb5-1107" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillRect</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height)<span class="op">;</span></span>
<span id="cb5-1108"><a href="#cb5-1108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-1109"><a href="#cb5-1109" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">save</span>()<span class="op">;</span></span>
<span id="cb5-1110"><a href="#cb5-1110" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">font</span> <span class="op">=</span> <span class="st">"bold 14px -apple-system, BlinkMacSystemFont, sans-serif"</span><span class="op">;</span></span>
<span id="cb5-1111"><a href="#cb5-1111" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fontVariantNumeric</span> <span class="op">=</span> <span class="st">"tabular-nums"</span><span class="op">;</span></span>
<span id="cb5-1112"><a href="#cb5-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1113"><a href="#cb5-1113" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Header</span></span>
<span id="cb5-1114"><a href="#cb5-1114" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">textAlign</span> <span class="op">=</span> <span class="st">"left"</span><span class="op">;</span> ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> TEXT_COLOR<span class="op">;</span></span>
<span id="cb5-1115"><a href="#cb5-1115" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillText</span>(<span class="vs">`Lần rút: </span><span class="sc">${</span>S<span class="op">.</span><span class="at">totalDeals</span><span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="dv">75</span><span class="op">,</span> Y_HEADER)<span class="op">;</span> </span>
<span id="cb5-1116"><a href="#cb5-1116" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-1117"><a href="#cb5-1117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (S<span class="op">.</span><span class="at">isAuto</span>) {</span>
<span id="cb5-1118"><a href="#cb5-1118" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="at">textAlign</span> <span class="op">=</span> <span class="st">"center"</span><span class="op">;</span> ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> CHART_ACT<span class="op">;</span></span>
<span id="cb5-1119"><a href="#cb5-1119" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="fu">fillText</span>(<span class="st">"● Đang chạy..."</span><span class="op">,</span> width<span class="op">/</span><span class="dv">2</span><span class="op">,</span> Y_HEADER)<span class="op">;</span></span>
<span id="cb5-1120"><a href="#cb5-1120" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-1121"><a href="#cb5-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1122"><a href="#cb5-1122" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (S<span class="op">.</span><span class="at">lastHand</span><span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb5-1123"><a href="#cb5-1123" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> aces <span class="op">=</span> S<span class="op">.</span><span class="at">lastHand</span><span class="op">.</span><span class="fu">filter</span>(c<span class="kw">=&gt;</span>c<span class="op">.</span><span class="at">isAce</span>)<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb5-1124"><a href="#cb5-1124" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">textAlign</span> <span class="op">=</span> <span class="st">"right"</span><span class="op">;</span> ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> ACE_COLOR<span class="op">;</span></span>
<span id="cb5-1125"><a href="#cb5-1125" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">fillText</span>(<span class="vs">`Kết quả: </span><span class="sc">${</span>aces<span class="sc">}</span><span class="vs"> lá Át`</span><span class="op">,</span> width <span class="op">-</span> <span class="dv">30</span><span class="op">,</span> Y_HEADER)<span class="op">;</span> </span>
<span id="cb5-1126"><a href="#cb5-1126" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-1127"><a href="#cb5-1127" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">restore</span>()<span class="op">;</span></span>
<span id="cb5-1128"><a href="#cb5-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1129"><a href="#cb5-1129" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Deck</span></span>
<span id="cb5-1130"><a href="#cb5-1130" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span><span class="dv">3</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb5-1131"><a href="#cb5-1131" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"white"</span><span class="op">;</span> ctx<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"#ccc"</span><span class="op">;</span></span>
<span id="cb5-1132"><a href="#cb5-1132" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="fu">fillRect</span>(<span class="dv">30</span><span class="op">-</span>i<span class="op">*</span><span class="dv">2</span><span class="op">,</span> <span class="dv">30</span><span class="op">-</span>i<span class="op">*</span><span class="dv">2</span><span class="op">,</span> CARD_W<span class="op">,</span> CARD_H)<span class="op">;</span></span>
<span id="cb5-1133"><a href="#cb5-1133" aria-hidden="true" tabindex="-1"></a>      ctx<span class="op">.</span><span class="fu">strokeRect</span>(<span class="dv">30</span><span class="op">-</span>i<span class="op">*</span><span class="dv">2</span><span class="op">,</span> <span class="dv">30</span><span class="op">-</span>i<span class="op">*</span><span class="dv">2</span><span class="op">,</span> CARD_W<span class="op">,</span> CARD_H)<span class="op">;</span></span>
<span id="cb5-1134"><a href="#cb5-1134" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-1135"><a href="#cb5-1135" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> DECK_BACK<span class="op">;</span> ctx<span class="op">.</span><span class="fu">fillRect</span>(<span class="dv">30</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> CARD_W<span class="op">,</span> CARD_H)<span class="op">;</span></span>
<span id="cb5-1136"><a href="#cb5-1136" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"white"</span><span class="op">;</span> ctx<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">2</span><span class="op">;</span> ctx<span class="op">.</span><span class="fu">strokeRect</span>(<span class="dv">34</span><span class="op">,</span> <span class="dv">34</span><span class="op">,</span> CARD_W<span class="op">-</span><span class="dv">8</span><span class="op">,</span> CARD_H<span class="op">-</span><span class="dv">8</span>)<span class="op">;</span></span>
<span id="cb5-1137"><a href="#cb5-1137" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb5-1138"><a href="#cb5-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1139"><a href="#cb5-1139" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Hand</span></span>
<span id="cb5-1140"><a href="#cb5-1140" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> c <span class="kw">of</span> S<span class="op">.</span><span class="at">lastHand</span>) {</span>
<span id="cb5-1141"><a href="#cb5-1141" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> c<span class="op">.</span><span class="at">isAce</span> <span class="op">?</span> ACE_BG <span class="op">:</span> CARD_BG<span class="op">;</span></span>
<span id="cb5-1142"><a href="#cb5-1142" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="fu">fillRect</span>(c<span class="op">.</span><span class="at">x</span><span class="op">,</span> c<span class="op">.</span><span class="at">y</span><span class="op">,</span> CARD_W<span class="op">,</span> CARD_H)<span class="op">;</span></span>
<span id="cb5-1143"><a href="#cb5-1143" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-1144"><a href="#cb5-1144" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> c<span class="op">.</span><span class="at">isAce</span> <span class="op">?</span> ACE_COLOR <span class="op">:</span> CARD_BORDER<span class="op">;</span></span>
<span id="cb5-1145"><a href="#cb5-1145" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="fu">strokeRect</span>(c<span class="op">.</span><span class="at">x</span><span class="op">,</span> c<span class="op">.</span><span class="at">y</span><span class="op">,</span> CARD_W<span class="op">,</span> CARD_H)<span class="op">;</span></span>
<span id="cb5-1146"><a href="#cb5-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1147"><a href="#cb5-1147" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> isRed <span class="op">=</span> (c<span class="op">.</span><span class="at">suit</span> <span class="op">===</span> <span class="st">"♥"</span> <span class="op">||</span> c<span class="op">.</span><span class="at">suit</span> <span class="op">===</span> <span class="st">"♦"</span>)<span class="op">;</span></span>
<span id="cb5-1148"><a href="#cb5-1148" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> c<span class="op">.</span><span class="at">isAce</span> <span class="op">?</span> ACE_COLOR <span class="op">:</span> (isRed <span class="op">?</span> RED <span class="op">:</span> BLACK)<span class="op">;</span></span>
<span id="cb5-1149"><a href="#cb5-1149" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="at">textAlign</span> <span class="op">=</span> <span class="st">"left"</span><span class="op">;</span> ctx<span class="op">.</span><span class="at">textBaseline</span> <span class="op">=</span> <span class="st">"top"</span><span class="op">;</span></span>
<span id="cb5-1150"><a href="#cb5-1150" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="at">font</span> <span class="op">=</span> <span class="st">"bold 14px sans-serif"</span><span class="op">;</span></span>
<span id="cb5-1151"><a href="#cb5-1151" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="fu">fillText</span>(c<span class="op">.</span><span class="at">rank</span><span class="op">,</span> c<span class="op">.</span><span class="at">x</span> <span class="op">+</span> <span class="dv">3</span><span class="op">,</span> c<span class="op">.</span><span class="at">y</span> <span class="op">+</span> <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb5-1152"><a href="#cb5-1152" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="at">font</span> <span class="op">=</span> <span class="st">"16px sans-serif"</span><span class="op">;</span></span>
<span id="cb5-1153"><a href="#cb5-1153" aria-hidden="true" tabindex="-1"></a>        ctx<span class="op">.</span><span class="fu">fillText</span>(c<span class="op">.</span><span class="at">suit</span><span class="op">,</span> c<span class="op">.</span><span class="at">x</span> <span class="op">+</span> <span class="dv">3</span><span class="op">,</span> c<span class="op">.</span><span class="at">y</span> <span class="op">+</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb5-1154"><a href="#cb5-1154" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-1155"><a href="#cb5-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1156"><a href="#cb5-1156" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Chart</span></span>
<span id="cb5-1157"><a href="#cb5-1157" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartX <span class="op">=</span> <span class="dv">50</span><span class="op">,</span> barW <span class="op">=</span> <span class="dv">40</span><span class="op">,</span> gap <span class="op">=</span> <span class="dv">25</span><span class="op">;</span></span>
<span id="cb5-1158"><a href="#cb5-1158" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-1159"><a href="#cb5-1159" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span> ctx<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"#bdc3c7"</span><span class="op">;</span> ctx<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb5-1160"><a href="#cb5-1160" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">moveTo</span>(chartX <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> Y_CHART_BASE)<span class="op">;</span> ctx<span class="op">.</span><span class="fu">lineTo</span>(width <span class="op">-</span> <span class="dv">20</span><span class="op">,</span> Y_CHART_BASE)<span class="op">;</span> ctx<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb5-1161"><a href="#cb5-1161" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-1162"><a href="#cb5-1162" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">save</span>()<span class="op">;</span></span>
<span id="cb5-1163"><a href="#cb5-1163" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> TEXT_COLOR<span class="op">;</span> ctx<span class="op">.</span><span class="at">font</span> <span class="op">=</span> <span class="st">"12px sans-serif"</span><span class="op">;</span> ctx<span class="op">.</span><span class="at">textAlign</span> <span class="op">=</span> <span class="st">"center"</span><span class="op">;</span></span>
<span id="cb5-1164"><a href="#cb5-1164" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillText</span>(<span class="st">"Số lá Át rút được (k)"</span><span class="op">,</span> width<span class="op">/</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">15</span><span class="op">,</span> Y_CHART_BASE <span class="op">+</span> <span class="dv">35</span>)<span class="op">;</span></span>
<span id="cb5-1165"><a href="#cb5-1165" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-1166"><a href="#cb5-1166" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">translate</span>(<span class="dv">20</span><span class="op">,</span> Y_CHART_BASE <span class="op">-</span> CHART_H<span class="op">/</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb5-1167"><a href="#cb5-1167" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">rotate</span>(<span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">/</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb5-1168"><a href="#cb5-1168" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#7f8c8d"</span><span class="op">;</span></span>
<span id="cb5-1169"><a href="#cb5-1169" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">fillText</span>(<span class="st">"Tần suất"</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb5-1170"><a href="#cb5-1170" aria-hidden="true" tabindex="-1"></a>    ctx<span class="op">.</span><span class="fu">restore</span>()<span class="op">;</span></span>
<span id="cb5-1171"><a href="#cb5-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1172"><a href="#cb5-1172" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> activeAces <span class="op">=</span> S<span class="op">.</span><span class="at">lastHand</span><span class="op">.</span><span class="fu">filter</span>(c<span class="kw">=&gt;</span>c<span class="op">.</span><span class="at">isAce</span>)<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb5-1173"><a href="#cb5-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1174"><a href="#cb5-1174" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;=</span> <span class="dv">4</span><span class="op">;</span> k<span class="op">++</span>) {</span>
<span id="cb5-1175"><a href="#cb5-1175" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> x <span class="op">=</span> chartX <span class="op">+</span> k <span class="op">*</span> (barW <span class="op">+</span> gap)<span class="op">;</span></span>
<span id="cb5-1176"><a href="#cb5-1176" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> Y_SCALE <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb5-1177"><a href="#cb5-1177" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb5-1178"><a href="#cb5-1178" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> theoH <span class="op">=</span> (THEORETICAL[k] <span class="op">/</span> Y_SCALE) <span class="op">*</span> CHART_H<span class="op">;</span></span>
<span id="cb5-1179"><a href="#cb5-1179" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> CHART_THEO<span class="op">;</span></span>
<span id="cb5-1180"><a href="#cb5-1180" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">fillRect</span>(x<span class="op">,</span> Y_CHART_BASE <span class="op">-</span> theoH<span class="op">,</span> barW<span class="op">,</span> theoH)<span class="op">;</span></span>
<span id="cb5-1181"><a href="#cb5-1181" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb5-1182"><a href="#cb5-1182" aria-hidden="true" tabindex="-1"></a>       <span class="kw">let</span> count <span class="op">=</span> S<span class="op">.</span><span class="at">counts</span>[k]<span class="op">;</span></span>
<span id="cb5-1183"><a href="#cb5-1183" aria-hidden="true" tabindex="-1"></a>       <span class="kw">let</span> pct <span class="op">=</span> S<span class="op">.</span><span class="at">totalDeals</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> count <span class="op">/</span> S<span class="op">.</span><span class="at">totalDeals</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb5-1184"><a href="#cb5-1184" aria-hidden="true" tabindex="-1"></a>       <span class="kw">let</span> barH <span class="op">=</span> (pct <span class="op">/</span> Y_SCALE) <span class="op">*</span> CHART_H<span class="op">;</span></span>
<span id="cb5-1185"><a href="#cb5-1185" aria-hidden="true" tabindex="-1"></a>       <span class="cf">if</span> (barH <span class="op">&gt;</span> CHART_H <span class="op">+</span> <span class="dv">10</span>) barH <span class="op">=</span> CHART_H <span class="op">+</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb5-1186"><a href="#cb5-1186" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb5-1187"><a href="#cb5-1187" aria-hidden="true" tabindex="-1"></a>       <span class="kw">const</span> isActive <span class="op">=</span> (S<span class="op">.</span><span class="at">animation</span> <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> S<span class="op">.</span><span class="at">totalDeals</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> k <span class="op">===</span> activeAces)<span class="op">;</span></span>
<span id="cb5-1188"><a href="#cb5-1188" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> isActive <span class="op">?</span> CHART_ACTIVE <span class="op">:</span> CHART_ACT<span class="op">;</span></span>
<span id="cb5-1189"><a href="#cb5-1189" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">fillRect</span>(x<span class="op">,</span> Y_CHART_BASE <span class="op">-</span> barH<span class="op">,</span> barW<span class="op">,</span> barH)<span class="op">;</span></span>
<span id="cb5-1190"><a href="#cb5-1190" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb5-1191"><a href="#cb5-1191" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">save</span>()<span class="op">;</span></span>
<span id="cb5-1192"><a href="#cb5-1192" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">fontVariantNumeric</span> <span class="op">=</span> <span class="st">"tabular-nums"</span><span class="op">;</span></span>
<span id="cb5-1193"><a href="#cb5-1193" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> TEXT_COLOR<span class="op">;</span> ctx<span class="op">.</span><span class="at">font</span> <span class="op">=</span> <span class="st">"12px sans-serif"</span><span class="op">;</span> ctx<span class="op">.</span><span class="at">textAlign</span> <span class="op">=</span> <span class="st">"center"</span><span class="op">;</span></span>
<span id="cb5-1194"><a href="#cb5-1194" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">fillText</span>(k<span class="op">,</span> x <span class="op">+</span> barW<span class="op">/</span><span class="dv">2</span><span class="op">,</span> Y_CHART_BASE <span class="op">+</span> <span class="dv">15</span>)<span class="op">;</span></span>
<span id="cb5-1195"><a href="#cb5-1195" aria-hidden="true" tabindex="-1"></a>       ctx<span class="op">.</span><span class="fu">restore</span>()<span class="op">;</span></span>
<span id="cb5-1196"><a href="#cb5-1196" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-1197"><a href="#cb5-1197" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1198"><a href="#cb5-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1199"><a href="#cb5-1199" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 6. BINDINGS ---</span></span>
<span id="cb5-1200"><a href="#cb5-1200" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> btnDraw <span class="op">=</span> container<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#btn-draw"</span>)<span class="op">;</span></span>
<span id="cb5-1201"><a href="#cb5-1201" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> btnReset <span class="op">=</span> container<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#btn-reset"</span>)<span class="op">;</span></span>
<span id="cb5-1202"><a href="#cb5-1202" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chkAuto <span class="op">=</span> container<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#chk-auto"</span>)<span class="op">;</span></span>
<span id="cb5-1203"><a href="#cb5-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1204"><a href="#cb5-1204" aria-hidden="true" tabindex="-1"></a>  btnDraw<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="fu">runDeal</span>()<span class="op">;</span></span>
<span id="cb5-1205"><a href="#cb5-1205" aria-hidden="true" tabindex="-1"></a>  btnReset<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="fu">reset</span>()<span class="op">;</span></span>
<span id="cb5-1206"><a href="#cb5-1206" aria-hidden="true" tabindex="-1"></a>  chkAuto<span class="op">.</span><span class="at">onchange</span> <span class="op">=</span> (e) <span class="kw">=&gt;</span> { S<span class="op">.</span><span class="at">isAuto</span> <span class="op">=</span> e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">checked</span><span class="op">;</span> }<span class="op">;</span></span>
<span id="cb5-1207"><a href="#cb5-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1208"><a href="#cb5-1208" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> frameId<span class="op">;</span></span>
<span id="cb5-1209"><a href="#cb5-1209" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">tick</span>() {</span>
<span id="cb5-1210"><a href="#cb5-1210" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update</span>()<span class="op">;</span></span>
<span id="cb5-1211"><a href="#cb5-1211" aria-hidden="true" tabindex="-1"></a>    <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb5-1212"><a href="#cb5-1212" aria-hidden="true" tabindex="-1"></a>    frameId <span class="op">=</span> <span class="fu">requestAnimationFrame</span>(tick)<span class="op">;</span></span>
<span id="cb5-1213"><a href="#cb5-1213" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1214"><a href="#cb5-1214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tick</span>()<span class="op">;</span></span>
<span id="cb5-1215"><a href="#cb5-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1216"><a href="#cb5-1216" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Clean up</span></span>
<span id="cb5-1217"><a href="#cb5-1217" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="kw">this</span> <span class="op">&amp;&amp;</span> <span class="kw">this</span><span class="op">.</span><span class="at">invalidation</span>) <span class="kw">this</span><span class="op">.</span><span class="at">invalidation</span><span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> <span class="fu">cancelAnimationFrame</span>(frameId))<span class="op">;</span></span>
<span id="cb5-1218"><a href="#cb5-1218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1219"><a href="#cb5-1219" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">;</span></span>
<span id="cb5-1220"><a href="#cb5-1220" aria-hidden="true" tabindex="-1"></a>})()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="declaration">

</div>
</div>
</div>
</section>
</section>
<section id="đếm-số-lần-thử" class="level2">
<h2 class="anchored" data-anchor-id="đếm-số-lần-thử">Đếm số lần thử</h2>
<p>Chúng ta quyết định trước phần thưởng mình muốn đạt được (<span class="math inline">\(k\)</span> thành công), và đếm xem phải tốn bao nhiêu công sức (<span class="math inline">\(n\)</span> lần thử) để đạt được nó. Nhánh này mô hình hóa sự “kiên trì” hoặc “sức chịu đựng”.</p>
<section id="phân-phối-hình-học-geometric-distribution" class="level3">
<h3 class="anchored" data-anchor-id="phân-phối-hình-học-geometric-distribution">Phân phối hình học (geometric distribution)</h3>
<p>Tình huống: Một gia đình phong kiến trọng nam khinh nữ muốn có một đứa con trai, họ cứ sinh con cho đến khi có con trai thì thôi</p>
<p>Câu hỏi: Họ phải sinh bao nhiêu con cho đến khi có con trai?</p>
<p>Đặc tính: Không có bộ nhớ (Memoryless). Dù đã sinh 10 con gái liên tiếp, xác suất đứa tiếp theo là trai vẫn y như lúc bắt đầu.</p>
</section>
<section id="phân-phối-nhị-thức-âm-negative-binomial-distribution" class="level3">
<h3 class="anchored" data-anchor-id="phân-phối-nhị-thức-âm-negative-binomial-distribution">Phân phối Nhị thức âm (negative binomial distribution)</h3>
<p>Tình huống: Gia đình phong kiến đã sinh được con trai nhưng vẫn muốn có con trai nữa, thầy bói nói nhà phải có 3 đứa con trai mới giàu được</p>
<p>Câu hỏi: Họ sẽ sinh bao nhiêu con trước khi có được đứa con trai thứ 3?</p>
<p>Về lý thuyết, đây là tổng của <span class="math inline">\(k\)</span> biến thuộc phân phối hình học.</p>
<p>Trong sinh học thực tế (ví dụ: đếm số ký sinh trùng, ấu trùng muỗi), phương sai thường lớn hơn trung bình rất nhiều (do hiện tượng tụ đám/clumping). Phân phối Nhị thức Âm khớp với kiểu dữ liệu này tốt hơn nhiều so với Poisson hay Nhị thức.</p>
</section>
</section>
<section id="đếm-sự-kiện-khi-biết-tốc-độ-trung-bình" class="level2">
<h2 class="anchored" data-anchor-id="đếm-sự-kiện-khi-biết-tốc-độ-trung-bình">Đếm sự kiện khi biết tốc độ trung bình</h2>
<section id="phân-phối-poisson" class="level3">
<h3 class="anchored" data-anchor-id="phân-phối-poisson">Phân phối Poisson</h3>
<p>Khác với những phân phối kể trên, phân phối Poisson không dựa trên chuỗi Bernoulli, mà dựa trên quá trình Poisson (Poisson process).</p>
<p>Quá trình Poisson là 1 cơ chế xảy ra biến cố với các điều kiện:</p>
<ul>
<li>Các biến cố xảy ra độc lập nhau (independent): biến cố này xảy ra không ảnh hưởng đến xác suất xảy ra của biến cố tiếp theo</li>
<li>Các biến cố xảy ra với 1 <strong>tốc độ trung bình không đổi</strong>: Số lượng sự kiện trung bình trên một đơn vị thời gian là hằng số (ví dụ: trung bình có 5 chiếc xe chạy trên con đường này mỗi giờ)</li>
<li>Các biến cố không xảy ra cùng 1 lúc</li>
</ul>
<p>Phân phối Poisson dùng để đếm <strong>số lượng</strong> biến cố ngẫu nhiên xảy ra trong 1 khoảng thời gian cố định (với điều kiện <span class="math inline">\(\lambda\)</span> không thay đổi trong khoảng thời gian này) của quá trình Poisson.</p>
<p><span class="math display">\[P(X=k) = \frac{e^{-\lambda} \lambda^k}{k!}\]</span></p>
<p>Trong đó:</p>
<ul>
<li><span class="math inline">\(\lambda\)</span>: Tốc độ trung bình (kỳ vọng) số sự kiện trong khoảng thời gian đó.</li>
<li><span class="math inline">\(k\)</span>: Số sự kiện muốn tính xác suất.</li>
</ul>
</section>
<section id="ví-dụ-1" class="level3">
<h3 class="anchored" data-anchor-id="ví-dụ-1">Ví dụ</h3>
<p>Tại một phòng cấp cứu, trung bình cứ 1 giờ lại có 3 bệnh nhân đến khám (<span class="math inline">\(\lambda = 3\)</span>). Xác suất để trong 1 giờ tới có chính xác 5 ca đến khám là bao nhiêu?</p>
<p>Áp dụng công thức với <span class="math inline">\(\lambda = 3\)</span> và <span class="math inline">\(k = 5\)</span>:</p>
<p><span class="math display">\[P(X=5) = \frac{e^{-3} \cdot 3^5}{5!} = \frac{0.0498 \times 243}{120} \approx 0.1008 \quad (\approx 10\%)\]</span></p>
<p>Poisson là giới hạn của Nhị thức khi <span class="math inline">\(n \to \infty\)</span> và xác suất thành công <span class="math inline">\(p \to 0\)</span>, sao cho <span class="math inline">\(np = \lambda\)</span></p>
<p>Hãy tưởng tượng bạn đang ngồi đợi tin nhắn điện thoại trong 1 giờ. Dựa vào kinh nghiệm, trung bình bạn nhận được <span class="math inline">\(\lambda = 5\)</span> tin nhắn/giờ. Xác suất trong 1 giờ tới bạn chỉ nhận được 2 tin nhắn là bao nhiêu?</p>
<ul>
<li>Bạn chia 1 giờ thành 60 phút. Mỗi phút là một phép thử Bernoulli (có tin nhắn/không tin nhắn). Bạn có <span class="math inline">\(n = 60\)</span> phép thử liên tiếp.</li>
<li>Bạn chia nhỏ thời gian ra nữa. Lúc này số phép thử <span class="math inline">\(n\)</span> trở nên vô cùng lớn, và xác suất có tin nhắn trong một khoảnh khắc siêu nhỏ (<span class="math inline">\(p\)</span>) trở nên vô cùng nhỏ. Càng chia nhỏ, bạn sẽ thấy phân phối nhị thức càng gần với Poisson.</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb6" data-startfrom="1283" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1282;"><span id="cb6-1283"><a href="#cb6-1283" aria-hidden="true" tabindex="-1"></a>viewof poisson_visual_final <span class="op">=</span> (() <span class="kw">=&gt;</span> {</span>
<span id="cb6-1284"><a href="#cb6-1284" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 1. CONFIGURATION ---</span></span>
<span id="cb6-1285"><a href="#cb6-1285" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lambda <span class="op">=</span> <span class="dv">5</span><span class="op">;</span> </span>
<span id="cb6-1286"><a href="#cb6-1286" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-1287"><a href="#cb6-1287" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Input Slider (Width 400px to match binning bar)</span></span>
<span id="cb6-1288"><a href="#cb6-1288" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> form <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">10</span><span class="op">,</span> <span class="dv">360</span>]<span class="op">,</span> {</span>
<span id="cb6-1289"><a href="#cb6-1289" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> </span>
<span id="cb6-1290"><a href="#cb6-1290" aria-hidden="true" tabindex="-1"></a>    <span class="dt">step</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span> </span>
<span id="cb6-1291"><a href="#cb6-1291" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Chia 1 giờ thành n khoảng (n)"</span></span>
<span id="cb6-1292"><a href="#cb6-1292" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb6-1293"><a href="#cb6-1293" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-1294"><a href="#cb6-1294" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> wrapper <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb6-1295"><a href="#cb6-1295" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb6-1296"><a href="#cb6-1296" aria-hidden="true" tabindex="-1"></a><span class="vs">    display: flex;</span></span>
<span id="cb6-1297"><a href="#cb6-1297" aria-hidden="true" tabindex="-1"></a><span class="vs">    flex-direction: column;</span></span>
<span id="cb6-1298"><a href="#cb6-1298" aria-hidden="true" tabindex="-1"></a><span class="vs">    align-items: center;</span></span>
<span id="cb6-1299"><a href="#cb6-1299" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;</span></span>
<span id="cb6-1300"><a href="#cb6-1300" aria-hidden="true" tabindex="-1"></a><span class="vs">    margin-top: 20px;</span></span>
<span id="cb6-1301"><a href="#cb6-1301" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb6-1302"><a href="#cb6-1302" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-1303"><a href="#cb6-1303" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 2. TIME BIN VISUALIZATION (Canvas) ---</span></span>
<span id="cb6-1304"><a href="#cb6-1304" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> timeCanvas <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"canvas"</span>)<span class="op">;</span></span>
<span id="cb6-1305"><a href="#cb6-1305" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> timeW <span class="op">=</span> <span class="dv">400</span><span class="op">;</span> <span class="co">// REDUCED WIDTH</span></span>
<span id="cb6-1306"><a href="#cb6-1306" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> timeH <span class="op">=</span> <span class="dv">50</span><span class="op">;</span></span>
<span id="cb6-1307"><a href="#cb6-1307" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dpr <span class="op">=</span> <span class="bu">window</span><span class="op">.</span><span class="at">devicePixelRatio</span> <span class="op">||</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb6-1308"><a href="#cb6-1308" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-1309"><a href="#cb6-1309" aria-hidden="true" tabindex="-1"></a>  timeCanvas<span class="op">.</span><span class="at">width</span> <span class="op">=</span> timeW <span class="op">*</span> dpr<span class="op">;</span></span>
<span id="cb6-1310"><a href="#cb6-1310" aria-hidden="true" tabindex="-1"></a>  timeCanvas<span class="op">.</span><span class="at">height</span> <span class="op">=</span> timeH <span class="op">*</span> dpr<span class="op">;</span></span>
<span id="cb6-1311"><a href="#cb6-1311" aria-hidden="true" tabindex="-1"></a>  timeCanvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">width</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>timeW<span class="sc">}</span><span class="vs">px`</span><span class="op">;</span></span>
<span id="cb6-1312"><a href="#cb6-1312" aria-hidden="true" tabindex="-1"></a>  timeCanvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">height</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>timeH<span class="sc">}</span><span class="vs">px`</span><span class="op">;</span></span>
<span id="cb6-1313"><a href="#cb6-1313" aria-hidden="true" tabindex="-1"></a>  timeCanvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">marginTop</span> <span class="op">=</span> <span class="st">"10px"</span><span class="op">;</span> </span>
<span id="cb6-1314"><a href="#cb6-1314" aria-hidden="true" tabindex="-1"></a>  timeCanvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">marginBottom</span> <span class="op">=</span> <span class="st">"5px"</span><span class="op">;</span></span>
<span id="cb6-1315"><a href="#cb6-1315" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-1316"><a href="#cb6-1316" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tCtx <span class="op">=</span> timeCanvas<span class="op">.</span><span class="fu">getContext</span>(<span class="st">"2d"</span>)<span class="op">;</span></span>
<span id="cb6-1317"><a href="#cb6-1317" aria-hidden="true" tabindex="-1"></a>  tCtx<span class="op">.</span><span class="fu">scale</span>(dpr<span class="op">,</span> dpr)<span class="op">;</span></span>
<span id="cb6-1318"><a href="#cb6-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1319"><a href="#cb6-1319" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 3. STATS DISPLAY ---</span></span>
<span id="cb6-1320"><a href="#cb6-1320" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> statsDiv <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb6-1321"><a href="#cb6-1321" aria-hidden="true" tabindex="-1"></a>  statsDiv<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb6-1322"><a href="#cb6-1322" aria-hidden="true" tabindex="-1"></a><span class="vs">    margin-bottom: 5px; </span></span>
<span id="cb6-1323"><a href="#cb6-1323" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-size: 16px; </span></span>
<span id="cb6-1324"><a href="#cb6-1324" aria-hidden="true" tabindex="-1"></a><span class="vs">    color: #333;</span></span>
<span id="cb6-1325"><a href="#cb6-1325" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-weight: 500;</span></span>
<span id="cb6-1326"><a href="#cb6-1326" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb6-1327"><a href="#cb6-1327" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-1328"><a href="#cb6-1328" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 4. APPEND ELEMENTS (Order: Input -&gt; Binning -&gt; Stats -&gt; Plot) ---</span></span>
<span id="cb6-1329"><a href="#cb6-1329" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(form)<span class="op">;</span>       </span>
<span id="cb6-1330"><a href="#cb6-1330" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(timeCanvas)<span class="op">;</span> </span>
<span id="cb6-1331"><a href="#cb6-1331" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(statsDiv)<span class="op">;</span>   </span>
<span id="cb6-1332"><a href="#cb6-1332" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotContainer <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb6-1333"><a href="#cb6-1333" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(plotContainer)<span class="op">;</span> </span>
<span id="cb6-1334"><a href="#cb6-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1335"><a href="#cb6-1335" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 5. MATH HELPERS ---</span></span>
<span id="cb6-1336"><a href="#cb6-1336" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">getBinomialData</span>(n<span class="op">,</span> p) {</span>
<span id="cb6-1337"><a href="#cb6-1337" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> data <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb6-1338"><a href="#cb6-1338" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> prob <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(<span class="dv">1</span> <span class="op">-</span> p<span class="op">,</span> n)<span class="op">;</span> </span>
<span id="cb6-1339"><a href="#cb6-1339" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;=</span> <span class="dv">16</span><span class="op">;</span> k<span class="op">++</span>) {</span>
<span id="cb6-1340"><a href="#cb6-1340" aria-hidden="true" tabindex="-1"></a>      data<span class="op">.</span><span class="fu">push</span>({k<span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">"Binomial"</span><span class="op">,</span> prob})<span class="op">;</span></span>
<span id="cb6-1341"><a href="#cb6-1341" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (k <span class="op">&lt;</span> n) {</span>
<span id="cb6-1342"><a href="#cb6-1342" aria-hidden="true" tabindex="-1"></a>        prob <span class="op">=</span> prob <span class="op">*</span> ((n <span class="op">-</span> k) <span class="op">/</span> (k <span class="op">+</span> <span class="dv">1</span>)) <span class="op">*</span> (p <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> p))<span class="op">;</span></span>
<span id="cb6-1343"><a href="#cb6-1343" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb6-1344"><a href="#cb6-1344" aria-hidden="true" tabindex="-1"></a>        prob <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-1345"><a href="#cb6-1345" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb6-1346"><a href="#cb6-1346" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-1347"><a href="#cb6-1347" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb6-1348"><a href="#cb6-1348" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-1349"><a href="#cb6-1349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1350"><a href="#cb6-1350" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> poissonData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb6-1351"><a href="#cb6-1351" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb6-1352"><a href="#cb6-1352" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> prob <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="op">-</span>lambda)<span class="op">;</span> </span>
<span id="cb6-1353"><a href="#cb6-1353" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;=</span> <span class="dv">16</span><span class="op">;</span> k<span class="op">++</span>) {</span>
<span id="cb6-1354"><a href="#cb6-1354" aria-hidden="true" tabindex="-1"></a>      poissonData<span class="op">.</span><span class="fu">push</span>({k<span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">"Poisson"</span><span class="op">,</span> prob})<span class="op">;</span></span>
<span id="cb6-1355"><a href="#cb6-1355" aria-hidden="true" tabindex="-1"></a>      prob <span class="op">=</span> prob <span class="op">*</span> lambda <span class="op">/</span> (k <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb6-1356"><a href="#cb6-1356" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-1357"><a href="#cb6-1357" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-1358"><a href="#cb6-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1359"><a href="#cb6-1359" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- 6. RENDER LOOPS ---</span></span>
<span id="cb6-1360"><a href="#cb6-1360" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">drawTimeBins</span>(n) {</span>
<span id="cb6-1361"><a href="#cb6-1361" aria-hidden="true" tabindex="-1"></a>    tCtx<span class="op">.</span><span class="fu">clearRect</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> timeW<span class="op">,</span> timeH)<span class="op">;</span></span>
<span id="cb6-1362"><a href="#cb6-1362" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-1363"><a href="#cb6-1363" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> barX <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// Start at 0 since canvas is now exact width</span></span>
<span id="cb6-1364"><a href="#cb6-1364" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> barY <span class="op">=</span> <span class="dv">15</span><span class="op">;</span></span>
<span id="cb6-1365"><a href="#cb6-1365" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> barW <span class="op">=</span> timeW<span class="op">;</span></span>
<span id="cb6-1366"><a href="#cb6-1366" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> barH <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb6-1367"><a href="#cb6-1367" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-1368"><a href="#cb6-1368" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Background</span></span>
<span id="cb6-1369"><a href="#cb6-1369" aria-hidden="true" tabindex="-1"></a>    tCtx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#f3f4f6"</span><span class="op">;</span></span>
<span id="cb6-1370"><a href="#cb6-1370" aria-hidden="true" tabindex="-1"></a>    tCtx<span class="op">.</span><span class="fu">fillRect</span>(barX<span class="op">,</span> barY<span class="op">,</span> barW<span class="op">,</span> barH)<span class="op">;</span></span>
<span id="cb6-1371"><a href="#cb6-1371" aria-hidden="true" tabindex="-1"></a>    tCtx<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"#9ca3af"</span><span class="op">;</span></span>
<span id="cb6-1372"><a href="#cb6-1372" aria-hidden="true" tabindex="-1"></a>    tCtx<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb6-1373"><a href="#cb6-1373" aria-hidden="true" tabindex="-1"></a>    tCtx<span class="op">.</span><span class="fu">strokeRect</span>(barX<span class="op">,</span> barY<span class="op">,</span> barW<span class="op">,</span> barH)<span class="op">;</span></span>
<span id="cb6-1374"><a href="#cb6-1374" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-1375"><a href="#cb6-1375" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Draw Dividers</span></span>
<span id="cb6-1376"><a href="#cb6-1376" aria-hidden="true" tabindex="-1"></a>    tCtx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb6-1377"><a href="#cb6-1377" aria-hidden="true" tabindex="-1"></a>    tCtx<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> n <span class="op">&gt;</span> <span class="dv">150</span> <span class="op">?</span> <span class="st">"rgba(107, 114, 128, 0.5)"</span> <span class="op">:</span> <span class="st">"#6b7280"</span><span class="op">;</span></span>
<span id="cb6-1378"><a href="#cb6-1378" aria-hidden="true" tabindex="-1"></a>    tCtx<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> n <span class="op">&gt;</span> <span class="dv">200</span> <span class="op">?</span> <span class="fl">0.5</span> <span class="op">:</span> <span class="dv">1</span><span class="op">;</span> </span>
<span id="cb6-1379"><a href="#cb6-1379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1380"><a href="#cb6-1380" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> binSize <span class="op">=</span> barW <span class="op">/</span> n<span class="op">;</span></span>
<span id="cb6-1381"><a href="#cb6-1381" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-1382"><a href="#cb6-1382" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Draw internal lines</span></span>
<span id="cb6-1383"><a href="#cb6-1383" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb6-1384"><a href="#cb6-1384" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> x <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(barX <span class="op">+</span> i <span class="op">*</span> binSize) <span class="op">+</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb6-1385"><a href="#cb6-1385" aria-hidden="true" tabindex="-1"></a>        tCtx<span class="op">.</span><span class="fu">moveTo</span>(x<span class="op">,</span> barY)<span class="op">;</span></span>
<span id="cb6-1386"><a href="#cb6-1386" aria-hidden="true" tabindex="-1"></a>        tCtx<span class="op">.</span><span class="fu">lineTo</span>(x<span class="op">,</span> barY <span class="op">+</span> barH)<span class="op">;</span></span>
<span id="cb6-1387"><a href="#cb6-1387" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-1388"><a href="#cb6-1388" aria-hidden="true" tabindex="-1"></a>    tCtx<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb6-1389"><a href="#cb6-1389" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-1390"><a href="#cb6-1390" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Labels</span></span>
<span id="cb6-1391"><a href="#cb6-1391" aria-hidden="true" tabindex="-1"></a>    tCtx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#374151"</span><span class="op">;</span></span>
<span id="cb6-1392"><a href="#cb6-1392" aria-hidden="true" tabindex="-1"></a>    tCtx<span class="op">.</span><span class="at">font</span> <span class="op">=</span> <span class="st">"bold 12px sans-serif"</span><span class="op">;</span></span>
<span id="cb6-1393"><a href="#cb6-1393" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-1394"><a href="#cb6-1394" aria-hidden="true" tabindex="-1"></a>    tCtx<span class="op">.</span><span class="at">textAlign</span> <span class="op">=</span> <span class="st">"left"</span><span class="op">;</span> </span>
<span id="cb6-1395"><a href="#cb6-1395" aria-hidden="true" tabindex="-1"></a>    tCtx<span class="op">.</span><span class="fu">fillText</span>(<span class="st">"0"</span><span class="op">,</span> barX<span class="op">,</span> barY <span class="op">+</span> barH <span class="op">+</span> <span class="dv">14</span>)<span class="op">;</span></span>
<span id="cb6-1396"><a href="#cb6-1396" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-1397"><a href="#cb6-1397" aria-hidden="true" tabindex="-1"></a>    tCtx<span class="op">.</span><span class="at">textAlign</span> <span class="op">=</span> <span class="st">"right"</span><span class="op">;</span> </span>
<span id="cb6-1398"><a href="#cb6-1398" aria-hidden="true" tabindex="-1"></a>    tCtx<span class="op">.</span><span class="fu">fillText</span>(<span class="st">"1h"</span><span class="op">,</span> barX <span class="op">+</span> barW<span class="op">,</span> barY <span class="op">+</span> barH <span class="op">+</span> <span class="dv">14</span>)<span class="op">;</span></span>
<span id="cb6-1399"><a href="#cb6-1399" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-1400"><a href="#cb6-1400" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Center Label (Changed Text)</span></span>
<span id="cb6-1401"><a href="#cb6-1401" aria-hidden="true" tabindex="-1"></a>    tCtx<span class="op">.</span><span class="at">textAlign</span> <span class="op">=</span> <span class="st">"center"</span><span class="op">;</span> </span>
<span id="cb6-1402"><a href="#cb6-1402" aria-hidden="true" tabindex="-1"></a>    tCtx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#3b82f6"</span><span class="op">;</span></span>
<span id="cb6-1403"><a href="#cb6-1403" aria-hidden="true" tabindex="-1"></a>    tCtx<span class="op">.</span><span class="fu">fillText</span>(<span class="vs">`</span><span class="sc">${</span>n<span class="sc">}</span><span class="vs"> phép thử liên tiếp`</span><span class="op">,</span> timeW <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> barY <span class="op">-</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb6-1404"><a href="#cb6-1404" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-1405"><a href="#cb6-1405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1406"><a href="#cb6-1406" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">update</span>() {</span>
<span id="cb6-1407"><a href="#cb6-1407" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> n <span class="op">=</span> form<span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb6-1408"><a href="#cb6-1408" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> p <span class="op">=</span> lambda <span class="op">/</span> n<span class="op">;</span> </span>
<span id="cb6-1409"><a href="#cb6-1409" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-1410"><a href="#cb6-1410" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update Stats</span></span>
<span id="cb6-1411"><a href="#cb6-1411" aria-hidden="true" tabindex="-1"></a>    statsDiv<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`n = </span><span class="sc">${</span>n<span class="sc">}</span><span class="vs"> &amp;nbsp;|&amp;nbsp; p = </span><span class="sc">${</span>p<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="sc">}</span><span class="vs"> &amp;nbsp;|&amp;nbsp; np = </span><span class="sc">${</span>(n<span class="op">*</span>p)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb6-1412"><a href="#cb6-1412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1413"><a href="#cb6-1413" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update Top Canvas</span></span>
<span id="cb6-1414"><a href="#cb6-1414" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drawTimeBins</span>(n)<span class="op">;</span></span>
<span id="cb6-1415"><a href="#cb6-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1416"><a href="#cb6-1416" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update Plot</span></span>
<span id="cb6-1417"><a href="#cb6-1417" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> binomData <span class="op">=</span> <span class="fu">getBinomialData</span>(n<span class="op">,</span> p)<span class="op">;</span></span>
<span id="cb6-1418"><a href="#cb6-1418" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> combinedData <span class="op">=</span> poissonData<span class="op">.</span><span class="fu">concat</span>(binomData)<span class="op">;</span></span>
<span id="cb6-1419"><a href="#cb6-1419" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> xDomain <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> <span class="dv">17</span>}<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> i)<span class="op">;</span></span>
<span id="cb6-1420"><a href="#cb6-1420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1421"><a href="#cb6-1421" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chart <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb6-1422"><a href="#cb6-1422" aria-hidden="true" tabindex="-1"></a>      <span class="dt">width</span><span class="op">:</span> <span class="dv">600</span><span class="op">,</span></span>
<span id="cb6-1423"><a href="#cb6-1423" aria-hidden="true" tabindex="-1"></a>      <span class="dt">height</span><span class="op">:</span> <span class="dv">320</span><span class="op">,</span></span>
<span id="cb6-1424"><a href="#cb6-1424" aria-hidden="true" tabindex="-1"></a>      <span class="dt">marginTop</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span></span>
<span id="cb6-1425"><a href="#cb6-1425" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> { </span>
<span id="cb6-1426"><a href="#cb6-1426" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"band"</span><span class="op">,</span> </span>
<span id="cb6-1427"><a href="#cb6-1427" aria-hidden="true" tabindex="-1"></a>        <span class="dt">domain</span><span class="op">:</span> xDomain<span class="op">,</span> </span>
<span id="cb6-1428"><a href="#cb6-1428" aria-hidden="true" tabindex="-1"></a>        <span class="dt">label</span><span class="op">:</span> <span class="st">"Số tin nhắn (k)"</span><span class="op">,</span></span>
<span id="cb6-1429"><a href="#cb6-1429" aria-hidden="true" tabindex="-1"></a>        <span class="dt">padding</span><span class="op">:</span> <span class="fl">0.1</span></span>
<span id="cb6-1430"><a href="#cb6-1430" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb6-1431"><a href="#cb6-1431" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Xác suất"</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="fl">0.2</span>] }<span class="op">,</span></span>
<span id="cb6-1432"><a href="#cb6-1432" aria-hidden="true" tabindex="-1"></a>      <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb6-1433"><a href="#cb6-1433" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Binomial Bars</span></span>
<span id="cb6-1434"><a href="#cb6-1434" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">barY</span>(combinedData<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">type</span> <span class="op">===</span> <span class="st">"Binomial"</span>)<span class="op">,</span> {</span>
<span id="cb6-1435"><a href="#cb6-1435" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> <span class="st">"k"</span><span class="op">,</span> </span>
<span id="cb6-1436"><a href="#cb6-1436" aria-hidden="true" tabindex="-1"></a>          <span class="dt">y</span><span class="op">:</span> <span class="st">"prob"</span><span class="op">,</span> </span>
<span id="cb6-1437"><a href="#cb6-1437" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fill</span><span class="op">:</span> <span class="st">"#3b82f6"</span><span class="op">,</span> </span>
<span id="cb6-1438"><a href="#cb6-1438" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.6</span><span class="op">,</span></span>
<span id="cb6-1439"><a href="#cb6-1439" aria-hidden="true" tabindex="-1"></a>          <span class="dt">title</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="vs">`Binomial: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">prob</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb6-1440"><a href="#cb6-1440" aria-hidden="true" tabindex="-1"></a>        })<span class="op">,</span></span>
<span id="cb6-1441"><a href="#cb6-1441" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Poisson Line</span></span>
<span id="cb6-1442"><a href="#cb6-1442" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">line</span>(combinedData<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">type</span> <span class="op">===</span> <span class="st">"Poisson"</span>)<span class="op">,</span> {</span>
<span id="cb6-1443"><a href="#cb6-1443" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> <span class="st">"k"</span><span class="op">,</span> </span>
<span id="cb6-1444"><a href="#cb6-1444" aria-hidden="true" tabindex="-1"></a>          <span class="dt">y</span><span class="op">:</span> <span class="st">"prob"</span><span class="op">,</span> </span>
<span id="cb6-1445"><a href="#cb6-1445" aria-hidden="true" tabindex="-1"></a>          <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#be185d"</span><span class="op">,</span> </span>
<span id="cb6-1446"><a href="#cb6-1446" aria-hidden="true" tabindex="-1"></a>          <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb6-1447"><a href="#cb6-1447" aria-hidden="true" tabindex="-1"></a>          <span class="dt">curve</span><span class="op">:</span> <span class="st">"monotone-x"</span></span>
<span id="cb6-1448"><a href="#cb6-1448" aria-hidden="true" tabindex="-1"></a>        })<span class="op">,</span></span>
<span id="cb6-1449"><a href="#cb6-1449" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Poisson Dots</span></span>
<span id="cb6-1450"><a href="#cb6-1450" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">dot</span>(combinedData<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">type</span> <span class="op">===</span> <span class="st">"Poisson"</span>)<span class="op">,</span> {</span>
<span id="cb6-1451"><a href="#cb6-1451" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> <span class="st">"k"</span><span class="op">,</span> </span>
<span id="cb6-1452"><a href="#cb6-1452" aria-hidden="true" tabindex="-1"></a>          <span class="dt">y</span><span class="op">:</span> <span class="st">"prob"</span><span class="op">,</span> </span>
<span id="cb6-1453"><a href="#cb6-1453" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fill</span><span class="op">:</span> <span class="st">"#be185d"</span><span class="op">,</span></span>
<span id="cb6-1454"><a href="#cb6-1454" aria-hidden="true" tabindex="-1"></a>          <span class="dt">r</span><span class="op">:</span> <span class="dv">4</span></span>
<span id="cb6-1455"><a href="#cb6-1455" aria-hidden="true" tabindex="-1"></a>        })<span class="op">,</span></span>
<span id="cb6-1456"><a href="#cb6-1456" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>])</span>
<span id="cb6-1457"><a href="#cb6-1457" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb6-1458"><a href="#cb6-1458" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb6-1459"><a href="#cb6-1459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1460"><a href="#cb6-1460" aria-hidden="true" tabindex="-1"></a>    plotContainer<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb6-1461"><a href="#cb6-1461" aria-hidden="true" tabindex="-1"></a>    plotContainer<span class="op">.</span><span class="fu">appendChild</span>(chart)<span class="op">;</span></span>
<span id="cb6-1462"><a href="#cb6-1462" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-1463"><a href="#cb6-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1464"><a href="#cb6-1464" aria-hidden="true" tabindex="-1"></a>  form<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span> update)<span class="op">;</span></span>
<span id="cb6-1465"><a href="#cb6-1465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update</span>()<span class="op">;</span></span>
<span id="cb6-1466"><a href="#cb6-1466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1467"><a href="#cb6-1467" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> wrapper<span class="op">;</span></span>
<span id="cb6-1468"><a href="#cb6-1468" aria-hidden="true" tabindex="-1"></a>})()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="declaration">

</div>
</div>
</div>
</section>
</section>
<section id="ứng-dụng" class="level2">
<h2 class="anchored" data-anchor-id="ứng-dụng">Ứng dụng</h2>
<p>Dữ liệu dạng đếm (ví dụ: số ca bệnh trong 1 tuần):</p>
<ul>
<li>Poisson</li>
<li>Negative binomial</li>
</ul>
<p>Dữ liệu là tỉ lệ:</p>
<p>Các phân phối phức tạp có thể được tạo ra bằng cách cộng các phân phối đơn giản:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Nếu cộng</th>
<th>Sẽ có</th>
<th>Điều kiện</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Nhiều Bernoulli</td>
<td>Nhị thức</td>
<td>Cùng <span class="math inline">\(p\)</span>.</td>
</tr>
<tr class="even">
<td>Nhiều Nhị thức</td>
<td>Nhị thức</td>
<td><span class="math inline">\(X+Y \sim \text{Bin}(n+m, p)\)</span></td>
</tr>
<tr class="odd">
<td>Nhiều Hình học</td>
<td>Nhị thức âm</td>
<td>Chờ <span class="math inline">\(k\)</span> thành công thực chất là chờ 1 thành công, lặp lại <span class="math inline">\(k\)</span> lần</td>
</tr>
<tr class="even">
<td>Nhiều Nhị thức âm</td>
<td>Nhị thức âm</td>
<td><span class="math inline">\(X+Y \sim \text{NB}(r_1+r_2, p)\)</span></td>
</tr>
<tr class="odd">
<td>Nhiều Poisson</td>
<td>Poisson</td>
<td><span class="math inline">\(X+Y \sim \text{Pois}(\lambda_1 + \lambda_2)\)</span></td>
</tr>
</tbody>
</table>


</section>

</main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBjb2luX3NpbV9tYW51YWwgPSAoKCkgPT4ge1xuICAvLyAtLS0gMS4gU0VUVVAgRE9NICYgU1RZTEVTIC0tLVxuICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAvLyBSaWdpZCBjb250YWluZXIgc2l6ZTogNDAwcHggd2lkdGgsIDM0MHB4IGhlaWdodCAoNDBweCBjb250cm9scyArIDMwMHB4IGNhbnZhcylcbiAgY29udGFpbmVyLnN0eWxlLmNzc1RleHQgPSBgXG4gICAgd2lkdGg6IDQwMHB4O1xuICAgIGhlaWdodDogMzQwcHg7IFxuICAgIG1hcmdpbjogMCBhdXRvO1xuICAgIGZvbnQtZmFtaWx5OiAtYXBwbGUtc3lzdGVtLCBCbGlua01hY1N5c3RlbUZvbnQsIFwiU2Vnb2UgVUlcIiwgUm9ib3RvLCBzYW5zLXNlcmlmO1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgIGJvcmRlcjogMXB4IHNvbGlkIHRyYW5zcGFyZW50O1xuICBgO1xuXG4gIC8vIEluamVjdCBVSSBIVE1MIGRpcmVjdGx5IChUb3RhbCBDb250cm9sLCBaZXJvIFNoaWZ0KVxuICBjb250YWluZXIuaW5uZXJIVE1MID0gYFxuICAgIDxzdHlsZT5cbiAgICAgIC5jb2luLWNvbnRyb2xzLXJvdyB7XG4gICAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgICBoZWlnaHQ6IDQwcHg7XG4gICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAgICBnYXA6IDEycHg7XG4gICAgICAgIG1hcmdpbi1ib3R0b206IDBweDtcbiAgICAgIH1cbiAgICAgIC5jb2luLWJ0biB7XG4gICAgICAgIHBhZGRpbmc6IDZweCAxNHB4O1xuICAgICAgICBib3JkZXItcmFkaXVzOiA2cHg7XG4gICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNkMWQ1ZGI7XG4gICAgICAgIGJhY2tncm91bmQtY29sb3I6IHdoaXRlO1xuICAgICAgICBjb2xvcjogIzM3NDE1MTtcbiAgICAgICAgZm9udC1zaXplOiAxNHB4O1xuICAgICAgICBmb250LXdlaWdodDogNjAwO1xuICAgICAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgICAgIGxpbmUtaGVpZ2h0OiAxLjI7XG4gICAgICB9XG4gICAgICAuY29pbi1idG46aG92ZXIgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjZjNmNGY2OyB9XG4gICAgICBcbiAgICAgIC5jb2luLWJ0bi1wcmltYXJ5IHtcbiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzNiODJmNjsgXG4gICAgICAgIGNvbG9yOiB3aGl0ZTsgXG4gICAgICAgIGJvcmRlci1jb2xvcjogIzI1NjNlYjtcbiAgICAgIH1cbiAgICAgIC5jb2luLWJ0bi1wcmltYXJ5OmhvdmVyIHsgYmFja2dyb3VuZC1jb2xvcjogIzI1NjNlYjsgY29sb3I6IHdoaXRlOyB9XG4gICAgICBcbiAgICAgIC5jb2luLXRvZ2dsZSB7XG4gICAgICAgIGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogNnB4O1xuICAgICAgICBmb250LXNpemU6IDE0cHg7IGZvbnQtd2VpZ2h0OiA1MDA7IGNvbG9yOiAjNGI1NTYzO1xuICAgICAgICBjdXJzb3I6IHBvaW50ZXI7IHVzZXItc2VsZWN0OiBub25lO1xuICAgICAgfVxuICAgICAgLmNvaW4tdG9nZ2xlIGlucHV0IHsgd2lkdGg6IDE2cHg7IGhlaWdodDogMTZweDsgYWNjZW50LWNvbG9yOiAjMTBiOTgxOyBjdXJzb3I6IHBvaW50ZXI7IH1cbiAgICAgIFxuICAgICAgY2FudmFzIHsgZGlzcGxheTogYmxvY2s7IH0gLyogUmVtb3ZlcyBnaG9zdCBtYXJnaW4gKi9cbiAgICA8L3N0eWxlPlxuXG4gICAgPGRpdiBjbGFzcz1cImNvaW4tY29udHJvbHMtcm93XCI+XG4gICAgICA8YnV0dG9uIGlkPVwiYnRuLWZsaXBcIiBjbGFzcz1cImNvaW4tYnRuIGNvaW4tYnRuLXByaW1hcnlcIj5UdW5nIMSR4buTbmcgeHU8L2J1dHRvbj5cbiAgICAgIDxsYWJlbCBjbGFzcz1cImNvaW4tdG9nZ2xlXCI+XG4gICAgICAgIDxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiBpZD1cImNoay1hdXRvXCI+XG4gICAgICAgIFThu7EgxJHhu5luZyBjaOG6oXlcbiAgICAgIDwvbGFiZWw+XG4gICAgICA8YnV0dG9uIGlkPVwiYnRuLXJlc2V0XCIgY2xhc3M9XCJjb2luLWJ0blwiPkzDoG0gbOG6oWk8L2J1dHRvbj5cbiAgICA8L2Rpdj5cbiAgYDtcblxuICAvLyAtLS0gMi4gQ0FOVkFTIFNFVFVQIC0tLVxuICBjb25zdCB3aWR0aCA9IDQwMDtcbiAgY29uc3QgaGVpZ2h0ID0gMzAwO1xuICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICBjb25zdCBkcHIgPSB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxO1xuICBcbiAgY2FudmFzLndpZHRoID0gd2lkdGggKiBkcHI7XG4gIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQgKiBkcHI7XG4gIGNhbnZhcy5zdHlsZS53aWR0aCA9IGAke3dpZHRofXB4YDtcbiAgY2FudmFzLnN0eWxlLmhlaWdodCA9IGAke2hlaWdodH1weGA7XG4gIFxuICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIsIHsgYWxwaGE6IGZhbHNlIH0pO1xuICBjdHguc2NhbGUoZHByLCBkcHIpO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY2FudmFzKTtcblxuICAvLyAtLS0gMy4gU1RBVEUgJiBDT05TVEFOVFMgLS0tXG4gIGNvbnN0IE4gPSAxMDtcbiAgY29uc3QgUCA9IDAuNTtcbiAgXG4gIC8vIENvbG9yc1xuICBjb25zdCBCR19DT0xPUj1cIiNmZmZcIiwgVEVYVF9DT0xPUj1cIiMyYzNlNTBcIjtcbiAgY29uc3QgSEVBRF9DT0xPUj1cIiNmMWM0MGZcIiwgSEVBRF9CT1JERVI9XCIjZDRhYzBkXCI7XG4gIGNvbnN0IFRBSUxfQ09MT1I9XCIjYmRjM2M3XCIsIFRBSUxfQk9SREVSPVwiIzk1YTVhNlwiO1xuICBjb25zdCBDSEFSVF9CQVI9XCIjMzQ5OGRiXCIsIENIQVJUX0FDVElWRT1cIiMyOTgwYjlcIiwgQ0hBUlRfVEhFTz1cInJnYmEoNDQsIDYyLCA4MCwgMC4xKVwiO1xuXG4gIC8vIE1hdGggSGVscGVyXG4gIGZ1bmN0aW9uIGJpbm9taWFsKGssIG4sIHApIHtcbiAgICBmdW5jdGlvbiBuQ3Iobiwgcikge1xuICAgICAgICBpZiAociA8IDAgfHwgciA+IG4pIHJldHVybiAwO1xuICAgICAgICBsZXQgcmVzID0gMTtcbiAgICAgICAgZm9yKGxldCBpPTA7IGk8cjsgaSsrKSByZXMgPSByZXMgKiAobiAtIGkpIC8gKGkgKyAxKTtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICB9XG4gICAgcmV0dXJuIG5DcihuLCBrKSAqIE1hdGgucG93KHAsIGspICogTWF0aC5wb3coMSAtIHAsIG4gLSBrKTtcbiAgfVxuXG4gIC8vIFNpbXVsYXRpb24gU3RhdGVcbiAgY29uc3QgUyA9IHtcbiAgICAgaGlzdG9yeTogW10sIFxuICAgICBjb3VudHM6IHt9LCAgXG4gICAgIHRvdGFsRmxpcHM6IDAsXG4gICAgIGN1cnJlbnRSZXN1bHQ6IFtdLCBcbiAgICAgYW5pbWF0aW9uOiAwLCBcbiAgICAgY29vbGRvd246IDAsXG4gICAgIGlzQXV0bzogZmFsc2VcbiAgfTtcbiAgZm9yKGxldCBpPTA7IGk8PU47IGkrKykgUy5jb3VudHNbaV0gPSAwO1xuXG4gIC8vIC0tLSA0LiBMT0dJQyAtLS1cbiAgZnVuY3Rpb24gcnVuRmxpcCgpIHtcbiAgICAgbGV0IGhlYWRzID0gMDtcbiAgICAgY29uc3QgcmVzID0gW107XG4gICAgIGZvcihsZXQgaT0wOyBpPE47IGkrKykge1xuICAgICAgICBjb25zdCBpc0hlYWQgPSBNYXRoLnJhbmRvbSgpIDwgUDtcbiAgICAgICAgcmVzLnB1c2goaXNIZWFkID8gMSA6IDApO1xuICAgICAgICBpZiAoaXNIZWFkKSBoZWFkcysrO1xuICAgICB9XG4gICAgIFxuICAgICBjb25zdCBjb2luU2l6ZSA9IDI4O1xuICAgICBjb25zdCBnYXAgPSA2O1xuICAgICBjb25zdCB0b3RhbFcgPSBOICogY29pblNpemUgKyAoTi0xKSpnYXA7XG4gICAgIGNvbnN0IHN0YXJ0WCA9ICh3aWR0aCAtIHRvdGFsVykgLyAyICsgY29pblNpemUvMjtcblxuICAgICBTLmN1cnJlbnRSZXN1bHQgPSByZXMubWFwKCh2YWwsIGkpID0+ICh7XG4gICAgICAgIHZhbDogdmFsLFxuICAgICAgICB4OiB3aWR0aC8yLCBcbiAgICAgICAgeTogNTAsXG4gICAgICAgIHRhcmdldFg6IHN0YXJ0WCArIGkgKiAoY29pblNpemUgKyBnYXApLCBcbiAgICAgICAgdGFyZ2V0WTogODUsXG4gICAgICAgIHI6IGNvaW5TaXplIC8gMixcbiAgICAgICAgdDogMFxuICAgICB9KSk7XG5cbiAgICAgUy5oaXN0b3J5LnB1c2goaGVhZHMpO1xuICAgICBTLmNvdW50c1toZWFkc10gPSAoUy5jb3VudHNbaGVhZHNdIHx8IDApICsgMTtcbiAgICAgUy50b3RhbEZsaXBzKys7XG4gICAgIFMuYW5pbWF0aW9uID0gMTtcbiAgICAgUy5jb29sZG93biA9IDA7XG4gIH1cblxuICBmdW5jdGlvbiByZXNldCgpIHtcbiAgICAgUy5oaXN0b3J5ID0gW107XG4gICAgIGZvcihsZXQgaT0wOyBpPD1OOyBpKyspIFMuY291bnRzW2ldID0gMDtcbiAgICAgUy50b3RhbEZsaXBzID0gMDtcbiAgICAgUy5jdXJyZW50UmVzdWx0ID0gW107XG4gICAgIFMuYW5pbWF0aW9uID0gMDtcbiAgfVxuXG4gIC8vIC0tLSA1LiBMT09QIC0tLVxuICBmdW5jdGlvbiB1cGRhdGUoKSB7XG4gICAgIC8vIEF1dG8gUnVuIExvZ2ljXG4gICAgIGlmIChTLmlzQXV0byAmJiBTLmFuaW1hdGlvbiA9PT0gMCkge1xuICAgICAgICBTLmNvb2xkb3duKys7XG4gICAgICAgIGlmIChTLmNvb2xkb3duID4gMjApIHJ1bkZsaXAoKTsgLy8gU3BlZWQ6IH4wLjNzXG4gICAgIH1cblxuICAgICAvLyBBbmltYXRpb24gTG9naWNcbiAgICAgaWYgKFMuYW5pbWF0aW9uID09PSAxKSB7XG4gICAgICAgbGV0IGRvbmUgPSB0cnVlO1xuICAgICAgIGZvciAobGV0IGMgb2YgUy5jdXJyZW50UmVzdWx0KSB7XG4gICAgICAgICAgaWYgKGMudCA8IDEpIHtcbiAgICAgICAgICAgICBjLnQgKz0gMC4yOyBcbiAgICAgICAgICAgICBpZiAoYy50ID4gMSkgYy50ID0gMTtcbiAgICAgICAgICAgICBjb25zdCBlYXNlID0gMSAtIE1hdGgucG93KDEgLSBjLnQsIDMpO1xuICAgICAgICAgICAgIGMueCA9IHdpZHRoLzIgKyAoYy50YXJnZXRYIC0gd2lkdGgvMikgKiBlYXNlO1xuICAgICAgICAgICAgIGMueSA9IGMudGFyZ2V0WSAtIE1hdGguc2luKGMudCAqIE1hdGguUEkpICogMjA7XG4gICAgICAgICAgICAgZG9uZSA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICB9XG4gICAgICAgaWYgKGRvbmUpIFMuYW5pbWF0aW9uID0gMDtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBkcmF3KCkge1xuICAgIGN0eC5maWxsU3R5bGUgPSBCR19DT0xPUjtcbiAgICBjdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7XG5cbiAgICBjdHguc2F2ZSgpO1xuICAgIGN0eC5mb250ID0gXCJib2xkIDE0cHggLWFwcGxlLXN5c3RlbSwgQmxpbmtNYWNTeXN0ZW1Gb250LCBzYW5zLXNlcmlmXCI7XG4gICAgY3R4LmZvbnRWYXJpYW50TnVtZXJpYyA9IFwidGFidWxhci1udW1zXCI7XG4gICAgXG4gICAgLy8gMS4gVGV4dCBJbmZvXG4gICAgLy8gTGVmdDogQ291bnRcbiAgICBjdHgudGV4dEFsaWduID0gXCJsZWZ0XCI7IGN0eC5maWxsU3R5bGUgPSBURVhUX0NPTE9SO1xuICAgIGN0eC5maWxsVGV4dChgTOG6p24gY2jhuqF5OiAke1MudG90YWxGbGlwc31gLCAyMCwgMzApO1xuICAgIFxuICAgIC8vIENlbnRlcjogU3RhdHVzXG4gICAgaWYgKFMuaXNBdXRvKSB7XG4gICAgICAgY3R4LnRleHRBbGlnbiA9IFwiY2VudGVyXCI7IGN0eC5maWxsU3R5bGUgPSBcIiMyN2FlNjBcIjtcbiAgICAgICBjdHguZmlsbFRleHQoXCLil48gxJBhbmcgY2jhuqF5Li4uXCIsIDE3MCwgMzApOyAvLyBBZGp1c3RlZCBjZW50ZXIgZm9yIHZpc3VhbCBiYWxhbmNlXG4gICAgfVxuICAgIFxuICAgIC8vIFJpZ2h0OiBSZXN1bHRcbiAgICBpZiAoUy5jdXJyZW50UmVzdWx0Lmxlbmd0aCA+IDApIHtcbiAgICAgICBjb25zdCBoQ291bnQgPSBTLmN1cnJlbnRSZXN1bHQuZmlsdGVyKGMgPT4gYy52YWw9PT0xKS5sZW5ndGg7XG4gICAgICAgY3R4LnRleHRBbGlnbiA9IFwicmlnaHRcIjsgY3R4LmZpbGxTdHlsZSA9IFwiI2QzNTQwMFwiO1xuICAgICAgIGN0eC5maWxsVGV4dChgTeG6t3QgTmfhu61hOiAke2hDb3VudH0gLyAke059YCwgd2lkdGggLSAyMCwgMzApO1xuICAgIH1cbiAgICBjdHgucmVzdG9yZSgpO1xuXG4gICAgLy8gMi4gQ29pbnNcbiAgICBmb3IgKGxldCBjIG9mIFMuY3VycmVudFJlc3VsdCkge1xuICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICBjdHguYXJjKGMueCwgYy55LCBjLnIsIDAsIE1hdGguUEkqMik7XG4gICAgICAgY3R4LmZpbGxTdHlsZSA9IGMudmFsID09PSAxID8gSEVBRF9DT0xPUiA6IFRBSUxfQ09MT1I7XG4gICAgICAgY3R4LmZpbGwoKTtcbiAgICAgICBjdHgubGluZVdpZHRoID0gMjtcbiAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSBjLnZhbCA9PT0gMSA/IEhFQURfQk9SREVSIDogVEFJTF9CT1JERVI7XG4gICAgICAgY3R4LnN0cm9rZSgpO1xuICAgICAgIGN0eC5maWxsU3R5bGUgPSBcIndoaXRlXCI7XG4gICAgICAgY3R4LnRleHRBbGlnbiA9IFwiY2VudGVyXCI7IGN0eC50ZXh0QmFzZWxpbmUgPSBcIm1pZGRsZVwiO1xuICAgICAgIGN0eC5mb250ID0gYGJvbGQgJHtjLnJ9cHggc2Fucy1zZXJpZmA7XG4gICAgICAgY3R4LmZpbGxUZXh0KGMudmFsID09PSAxID8gXCJOXCIgOiBcIlNcIiwgYy54LCBjLnkgKyAxKTtcbiAgICB9XG5cbiAgICAvLyAzLiBDaGFydFxuICAgIGNvbnN0IGNoYXJ0WSA9IDI4MDsgXG4gICAgY29uc3QgY2hhcnRIID0gMTQwOyBcbiAgICBjb25zdCBjaGFydFggPSA0MDtcbiAgICBjb25zdCBjaGFydFcgPSB3aWR0aCAtIDYwO1xuICAgIFxuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBjdHguc3Ryb2tlU3R5bGUgPSBcIiNiZGMzYzdcIjsgY3R4LmxpbmVXaWR0aCA9IDE7XG4gICAgY3R4Lm1vdmVUbyhjaGFydFgsIGNoYXJ0WSk7IGN0eC5saW5lVG8oY2hhcnRYICsgY2hhcnRXLCBjaGFydFkpOyBjdHguc3Ryb2tlKCk7XG5cbiAgICBjb25zdCBiYXJXID0gY2hhcnRXIC8gKE4gKyAxKTtcbiAgICBjb25zdCBNQVhfUFJPQiA9IDAuMjQ2OyBcbiAgICBjb25zdCBZX1NDQUxFX01BWCA9IE1BWF9QUk9CICogMS4yOyBcbiAgICBjb25zdCBhY3RpdmVIZWFkcyA9IFMuY3VycmVudFJlc3VsdC5maWx0ZXIoYyA9PiBjLnZhbD09PTEpLmxlbmd0aDtcblxuICAgIGZvciAobGV0IGsgPSAwOyBrIDw9IE47IGsrKykge1xuICAgICAgIGNvbnN0IGN4ID0gY2hhcnRYICsgayAqIGJhclcgKyBiYXJXLzI7XG4gICAgICAgXG4gICAgICAgLy8gVGhlb3JldGljYWxcbiAgICAgICBjb25zdCBwcm9iID0gYmlub21pYWwoaywgTiwgUCk7XG4gICAgICAgY29uc3QgdGhlb0ggPSAocHJvYiAvIFlfU0NBTEVfTUFYKSAqIGNoYXJ0SDtcbiAgICAgICBjdHguZmlsbFN0eWxlID0gQ0hBUlRfVEhFTztcbiAgICAgICBjdHguZmlsbFJlY3QoY3ggLSBiYXJXKjAuMywgY2hhcnRZIC0gdGhlb0gsIGJhclcqMC42LCB0aGVvSCk7XG4gICAgICAgXG4gICAgICAgLy8gQWN0dWFsXG4gICAgICAgbGV0IG9ic2VydmVkUHJvYiA9IDA7XG4gICAgICAgaWYgKFMudG90YWxGbGlwcyA+IDApIG9ic2VydmVkUHJvYiA9IFMuY291bnRzW2tdIC8gUy50b3RhbEZsaXBzO1xuICAgICAgIGxldCBiYXJIID0gKG9ic2VydmVkUHJvYiAvIFlfU0NBTEVfTUFYKSAqIGNoYXJ0SDtcbiAgICAgICBpZiAoYmFySCA+IGNoYXJ0SCArIDEwKSBiYXJIID0gY2hhcnRIICsgMTA7XG5cbiAgICAgICBjb25zdCBpc0FjdGl2ZSA9IChTLmFuaW1hdGlvbiA9PT0gMCAmJiBrID09PSBhY3RpdmVIZWFkcyAmJiBTLnRvdGFsRmxpcHMgPiAwKTtcbiAgICAgICBjdHguZmlsbFN0eWxlID0gaXNBY3RpdmUgPyBDSEFSVF9BQ1RJVkUgOiBDSEFSVF9CQVI7XG4gICAgICAgY3R4LmZpbGxSZWN0KGN4IC0gYmFyVyowLjMsIGNoYXJ0WSAtIGJhckgsIGJhclcqMC42LCBiYXJIKTtcbiAgICAgICBcbiAgICAgICAvLyBMYWJlbHNcbiAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgIGN0eC5mb250VmFyaWFudE51bWVyaWMgPSBcInRhYnVsYXItbnVtc1wiO1xuICAgICAgIGN0eC5maWxsU3R5bGUgPSBURVhUX0NPTE9SO1xuICAgICAgIGN0eC5mb250ID0gXCIxMHB4IHNhbnMtc2VyaWZcIjtcbiAgICAgICBjdHgudGV4dEFsaWduID0gXCJjZW50ZXJcIjtcbiAgICAgICBjdHguZmlsbFRleHQoaywgY3gsIGNoYXJ0WSArIDE1KTtcbiAgICAgICBjdHgucmVzdG9yZSgpO1xuICAgIH1cbiAgICBcbiAgICAvLyBZLUF4aXMgTGFiZWxcbiAgICBjdHguc2F2ZSgpO1xuICAgIGN0eC50cmFuc2xhdGUoMTIsIGNoYXJ0WSAtIGNoYXJ0SC8yKTtcbiAgICBjdHgucm90YXRlKC1NYXRoLlBJLzIpO1xuICAgIGN0eC50ZXh0QWxpZ24gPSBcImNlbnRlclwiO1xuICAgIGN0eC5mb250ID0gXCIxNHB4IHNhbnMtc2VyaWZcIjtcbiAgICBjdHguZmlsbFN0eWxlID0gXCIjN2Y4YzhkXCI7XG4gICAgY3R4LmZpbGxUZXh0KFwiVOG6p24gc3XhuqV0XCIsIDAsIDApO1xuICAgIGN0eC5yZXN0b3JlKCk7XG4gIH1cblxuICAvLyAtLS0gNi4gQklORElOR1MgLS0tXG4gIGNvbnN0IGJ0bkZsaXAgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcihcIiNidG4tZmxpcFwiKTtcbiAgY29uc3QgYnRuUmVzZXQgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcihcIiNidG4tcmVzZXRcIik7XG4gIGNvbnN0IGNoa0F1dG8gPSBjb250YWluZXIucXVlcnlTZWxlY3RvcihcIiNjaGstYXV0b1wiKTtcblxuICBidG5GbGlwLm9uY2xpY2sgPSAoKSA9PiBydW5GbGlwKCk7XG4gIGJ0blJlc2V0Lm9uY2xpY2sgPSAoKSA9PiByZXNldCgpO1xuICBjaGtBdXRvLm9uY2hhbmdlID0gKGUpID0+IHsgUy5pc0F1dG8gPSBlLnRhcmdldC5jaGVja2VkOyB9O1xuXG4gIGxldCBmcmFtZUlkO1xuICBmdW5jdGlvbiB0aWNrKCkge1xuICAgIHVwZGF0ZSgpO1xuICAgIGRyYXcoKTtcbiAgICBmcmFtZUlkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRpY2spO1xuICB9XG4gIHRpY2soKTtcblxuICBpZiAodGhpcyAmJiB0aGlzLmludmFsaWRhdGlvbikgdGhpcy5pbnZhbGlkYXRpb24udGhlbigoKSA9PiBjYW5jZWxBbmltYXRpb25GcmFtZShmcmFtZUlkKSk7XG5cbiAgcmV0dXJuIGNvbnRhaW5lcjtcbn0pKCk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbnZpZXdvZiBnYWx0b25fc2hhcnAgPSBJbnB1dHMuZm9ybSh7XG4gIHJvd3M6IElucHV0cy5yYW5nZShbOCwgMjBdLCB7dmFsdWU6IDEwLCBzdGVwOiAxLCBsYWJlbDogXCJT4buRIGjDoG5nIMSRaW5oXCJ9KSxcbiAgc3BlZWQ6IElucHV0cy5yYW5nZShbMC41LCAzXSwge3ZhbHVlOiAyLCBzdGVwOiAwLjEsIGxhYmVsOiBcIlThu5FjIMSR4buZXCJ9KSxcbiAgdG90YWw6IElucHV0cy5yYW5nZShbNTAsIDgwMF0sIHt2YWx1ZTogMjAwLCBzdGVwOiAxMCwgbGFiZWw6IFwiU+G7kSB2acOqbiBiaVwifSlcbn0pXG5cbnZpZXdvZiBnYWx0b25fc2ltX2RlbnNlID0gKCgpID0+IHtcbiAgLy8gLS0tIDEuIENPTkZJR1VSQVRJT04gLS0tXG4gIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgIHJvd3M6IGdhbHRvbl9zaGFycC5yb3dzLFxuICAgICAgc3BlZWQ6IGdhbHRvbl9zaGFycC5zcGVlZCxcbiAgICAgIG1heEJhbGxzOiBnYWx0b25fc2hhcnAudG90YWxcbiAgfTtcblxuICAvLyAtLS0gMi4gU0VUVVAgQ09OVEFJTkVSIChDZW50ZXJlZCkgLS0tXG4gIGNvbnN0IG91dGVyV3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gIG91dGVyV3JhcHBlci5zdHlsZS5jc3NUZXh0ID0gYFxuICAgIHdpZHRoOiAxMDAlO1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gICAgbWFyZ2luLXRvcDogMjBweDtcbiAgYDtcblxuICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICBjb250YWluZXIuc3R5bGUuY3NzVGV4dCA9IGBcbiAgICBkaXNwbGF5OiBmbGV4O1xuICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICB3aWR0aDogMzgwcHg7IFxuICAgIGZvbnQtZmFtaWx5OiAtYXBwbGUtc3lzdGVtLCBCbGlua01hY1N5c3RlbUZvbnQsIFwiU2Vnb2UgVUlcIiwgUm9ib3RvLCBzYW5zLXNlcmlmO1xuICBgO1xuICBvdXRlcldyYXBwZXIuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTtcblxuICAvLyAtLS0gMy4gSU5KRUNUIFVJIC0tLVxuICBjb250YWluZXIuaW5uZXJIVE1MID0gYFxuICAgIDxzdHlsZT5cbiAgICAgIC5nYWx0b24tY3RybC1yb3cge1xuICAgICAgICB3aWR0aDogMTAwJTtcbiAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gICAgICAgIGdhcDogMTJweDtcbiAgICAgICAgbWFyZ2luLWJvdHRvbTogMTBweDtcbiAgICAgIH1cbiAgICAgIC5nYWx0b24tYnRuIHtcbiAgICAgICAgcGFkZGluZzogNnB4IDE2cHg7XG4gICAgICAgIGJvcmRlci1yYWRpdXM6IDZweDtcbiAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2QxZDVkYjtcbiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7XG4gICAgICAgIGNvbG9yOiAjMzc0MTUxO1xuICAgICAgICBmb250LXNpemU6IDE0cHg7XG4gICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7XG4gICAgICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuMXMgZWFzZTtcbiAgICAgIH1cbiAgICAgIC5nYWx0b24tYnRuOmhvdmVyIHsgYmFja2dyb3VuZC1jb2xvcjogI2YzZjRmNjsgfVxuICAgICAgXG4gICAgICAuZ2FsdG9uLWJ0bi1wcmltYXJ5IHtcbiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzNiODJmNjsgXG4gICAgICAgIGNvbG9yOiB3aGl0ZTsgXG4gICAgICAgIGJvcmRlci1jb2xvcjogIzI1NjNlYjtcbiAgICAgIH1cbiAgICAgIC5nYWx0b24tYnRuLXByaW1hcnk6aG92ZXIgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjMjU2M2ViOyBjb2xvcjogd2hpdGU7IH1cblxuICAgICAgY2FudmFzIHtcbiAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4O1xuICAgICAgfVxuICAgIDwvc3R5bGU+XG5cbiAgICA8ZGl2IGNsYXNzPVwiZ2FsdG9uLWN0cmwtcm93XCI+XG4gICAgICA8YnV0dG9uIGlkPVwiYnRuLXN0YXJ0XCIgY2xhc3M9XCJnYWx0b24tYnRuIGdhbHRvbi1idG4tcHJpbWFyeVwiPkLhuq90IMSR4bqndTwvYnV0dG9uPlxuICAgICAgPGJ1dHRvbiBpZD1cImJ0bi1zdG9wXCIgY2xhc3M9XCJnYWx0b24tYnRuXCI+ROG7q25nPC9idXR0b24+XG4gICAgPC9kaXY+XG4gIGA7XG5cbiAgLy8gLS0tIDQuIENBTlZBUyBTRVRVUCAtLS1cbiAgLy8gSU5DUkVBU0VEIEhFSUdIVCBmcm9tIDUwMCAtPiA2MDBcbiAgY29uc3QgbG9naWNhbFdpZHRoID0gMzgwO1xuICBjb25zdCBsb2dpY2FsSGVpZ2h0ID0gNjAwOyBcbiAgY29uc3QgZHByID0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMTtcblxuICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICBjYW52YXMud2lkdGggPSBsb2dpY2FsV2lkdGggKiBkcHI7XG4gIGNhbnZhcy5oZWlnaHQgPSBsb2dpY2FsSGVpZ2h0ICogZHByO1xuICBjYW52YXMuc3R5bGUud2lkdGggPSBgJHtsb2dpY2FsV2lkdGh9cHhgO1xuICBjYW52YXMuc3R5bGUuaGVpZ2h0ID0gYCR7bG9naWNhbEhlaWdodH1weGA7XG4gIFxuICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIsIHsgYWxwaGE6IGZhbHNlIH0pO1xuICBjdHguc2NhbGUoZHByLCBkcHIpO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY2FudmFzKTtcblxuICAvLyAtLS0gNS4gR0VPTUVUUlkgJiBTVEFURSAtLS1cbiAgY29uc3QgcGVnU3BhY2luZyA9IGxvZ2ljYWxXaWR0aCAvIChjb25maWcucm93cyArIDMpO1xuICBjb25zdCBzdGFydFkgPSA2MDtcbiAgY29uc3QgcGVnUmFkaXVzID0gcGVnU3BhY2luZyAqIDAuMTI7IFxuICBjb25zdCBiYWxsUmFkaXVzID0gcGVnU3BhY2luZyAqIDAuMjM7IFxuICBjb25zdCByb3dIZWlnaHQgPSBwZWdTcGFjaW5nICogMC44NTtcblxuICAvLyBCaW4gR2VvbWV0cnlcbiAgY29uc3QgZmxvb3JZID0gbG9naWNhbEhlaWdodCAtIDEwO1xuICBjb25zdCBiaW5XaWR0aCA9IHBlZ1NwYWNpbmc7XG4gIGNvbnN0IHRvdGFsQmluV2lkdGggPSAoY29uZmlnLnJvd3MgKyAxKSAqIGJpbldpZHRoO1xuICBjb25zdCBiaW5zU3RhcnRYID0gKGxvZ2ljYWxXaWR0aCAtIHRvdGFsQmluV2lkdGgpIC8gMjtcbiAgY29uc3Qgd2FsbHNUb3BZID0gc3RhcnRZICsgKGNvbmZpZy5yb3dzKSAqIHJvd0hlaWdodCArIDE1O1xuXG4gIC8vIERFTlNFIFBBQ0tJTkcgRkFDVE9SXG4gIC8vIDcwJSBPdmVybGFwIG1lYW5zIHRoZSB2ZXJ0aWNhbCBzdGVwIGlzIHNtYWxsLlxuICAvLyBOb3JtYWwgRGlhbWV0ZXIgPSAyKnIuXG4gIC8vIFdlIHVzZSBzdGVwID0gMC42ICogci4gVGhpcyBpcyB2ZXJ5IGRlbnNlLlxuICBjb25zdCBzdGFja1N0ZXAgPSBiYWxsUmFkaXVzICogMC42OyBcblxuICAvLyBQcmUtY2FsY3VsYXRlIFBlZyBQb3NpdGlvbnNcbiAgY29uc3QgcGVnR3JpZCA9IFtdOyBcbiAgZm9yIChsZXQgciA9IDA7IHIgPCBjb25maWcucm93czsgcisrKSB7XG4gICAgY29uc3Qgcm93UGVncyA9IFtdO1xuICAgIGNvbnN0IHBlZ3NJblRoaXNSb3cgPSByICsgMTtcbiAgICBjb25zdCByb3dXaWR0aCA9IChwZWdzSW5UaGlzUm93IC0gMSkgKiBwZWdTcGFjaW5nO1xuICAgIGNvbnN0IHJvd1N0YXJ0WCA9IChsb2dpY2FsV2lkdGggLSByb3dXaWR0aCkgLyAyO1xuICAgIGZvciAobGV0IHAgPSAwOyBwIDwgcGVnc0luVGhpc1JvdzsgcCsrKSB7XG4gICAgICByb3dQZWdzLnB1c2goe1xuICAgICAgICB4OiByb3dTdGFydFggKyBwICogcGVnU3BhY2luZyxcbiAgICAgICAgeTogc3RhcnRZICsgciAqIHJvd0hlaWdodFxuICAgICAgfSk7XG4gICAgfVxuICAgIHBlZ0dyaWQucHVzaChyb3dQZWdzKTtcbiAgfVxuXG4gIC8vIFNpbXVsYXRpb24gU3RhdGVcbiAgY29uc3QgUyA9IHtcbiAgICBiYWxsczogW10sXG4gICAgYmluczogbmV3IEFycmF5KGNvbmZpZy5yb3dzICsgMSkuZmlsbCgwKSxcbiAgICBzcGF3bmVkOiAwLFxuICAgIHJ1bm5pbmc6IGZhbHNlXG4gIH07XG5cbiAgLy8gLS0tIDYuIExPR0lDIC0tLVxuICBmdW5jdGlvbiBjcmVhdGVCYWxsKCkge1xuICAgIGxldCBjdXJyZW50SW5kID0gMDsgXG4gICAgbGV0IHBhdGggPSBbXTtcbiAgICBwYXRoLnB1c2goeyB4OiBsb2dpY2FsV2lkdGggLyAyLCB5OiBzdGFydFkgLSAyMCB9KTsgXG5cbiAgICBmb3IgKGxldCByID0gMDsgciA8IGNvbmZpZy5yb3dzOyByKyspIHtcbiAgICAgICBjb25zdCBwZWcgPSBwZWdHcmlkW3JdW2N1cnJlbnRJbmRdO1xuICAgICAgIHBhdGgucHVzaCh7IHg6IHBlZy54LCB5OiBwZWcueSAtIHBlZ1JhZGl1cyAtIGJhbGxSYWRpdXMgfSk7XG4gICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPiAwLjUpIGN1cnJlbnRJbmQrKzsgXG4gICAgfVxuXG4gICAgY29uc3QgYmluWCA9IGJpbnNTdGFydFggKyBjdXJyZW50SW5kICogYmluV2lkdGggKyBiaW5XaWR0aC8yO1xuICAgIHBhdGgucHVzaCh7IHg6IGJpblgsIHk6IHdhbGxzVG9wWSB9KTtcbiAgICBwYXRoLnB1c2goeyB4OiBiaW5YLCB5OiBmbG9vclksIGlzRmxvb3I6IHRydWUsIGJpbkluZGV4OiBjdXJyZW50SW5kIH0pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHBhdGg6IHBhdGgsXG4gICAgICBzZWdtZW50OiAwLCB0OiAwLCBhY3RpdmU6IHRydWUsXG4gICAgICB4OiBwYXRoWzBdLngsIHk6IHBhdGhbMF0ueVxuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBzcGF3bigpIHtcbiAgICAgaWYgKFMuc3Bhd25lZCA+PSBjb25maWcubWF4QmFsbHMpIHJldHVybjtcbiAgICAgXG4gICAgIC8vIENoZWNrIGNhcGFjaXR5IHVzaW5nIG5ldyBERU5TRSBwYWNraW5nIGxvZ2ljXG4gICAgIC8vIEF2YWlsYWJsZSBoZWlnaHQgPSBmbG9vclkgLSB3YWxsc1RvcFlcbiAgICAgLy8gSGVpZ2h0IGNvbnN1bWVkID0gY291bnQgKiBzdGFja1N0ZXBcbiAgICAgY29uc3QgY2VudGVyQmluID0gTWF0aC5mbG9vcihjb25maWcucm93cy8yKTtcbiAgICAgY29uc3QgY3VycmVudEhlaWdodCA9IFMuYmluc1tjZW50ZXJCaW5dICogc3RhY2tTdGVwO1xuICAgICBcbiAgICAgaWYgKGN1cnJlbnRIZWlnaHQgPiAoZmxvb3JZIC0gd2FsbHNUb3BZIC0gMjApKSByZXR1cm47IC8vIC0yMCBidWZmZXJcbiAgICAgXG4gICAgIFMuYmFsbHMucHVzaChjcmVhdGVCYWxsKCkpO1xuICAgICBTLnNwYXduZWQrKztcbiAgfVxuXG4gIGZ1bmN0aW9uIHVwZGF0ZShkdCkge1xuICAgIGlmIChTLnJ1bm5pbmcpIHtcbiAgICAgICAgY29uc3Qgc3Bhd25DaGFuY2UgPSAwLjI1ICogY29uZmlnLnNwZWVkOyBcbiAgICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPCBzcGF3bkNoYW5jZSkgc3Bhd24oKTtcbiAgICB9XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IFMuYmFsbHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgYiA9IFMuYmFsbHNbaV07XG4gICAgICAgIGlmICghYi5hY3RpdmUpIGNvbnRpbnVlO1xuICAgICAgICBpZiAoIVMucnVubmluZykgY29udGludWU7XG5cbiAgICAgICAgY29uc3QgbW92ZVNwZWVkID0gMy4wICogY29uZmlnLnNwZWVkICogZHQ7XG4gICAgICAgIGIudCArPSBtb3ZlU3BlZWQ7XG5cbiAgICAgICAgaWYgKGIudCA+PSAxKSB7XG4gICAgICAgICAgICBiLnQgPSAwO1xuICAgICAgICAgICAgYi5zZWdtZW50Kys7XG4gICAgICAgICAgICBpZiAoYi5zZWdtZW50ID49IGIucGF0aC5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgYi5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBjb25zdCBmaW5hbFB0ID0gYi5wYXRoW2IucGF0aC5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgICAgICBTLmJpbnNbZmluYWxQdC5iaW5JbmRleF0rKztcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHAwID0gYi5wYXRoW2Iuc2VnbWVudF07XG4gICAgICAgIGNvbnN0IHAxID0gYi5wYXRoW2Iuc2VnbWVudCArIDFdO1xuICAgICAgICBjb25zdCB0ID0gYi50O1xuICAgICAgICBjb25zdCBlYXNlID0gdCAqIHQ7IFxuICAgICAgICBcbiAgICAgICAgYi54ID0gcDAueCArIChwMS54IC0gcDAueCkgKiB0O1xuICAgICAgICBiLnkgPSBwMC55ICsgKHAxLnkgLSBwMC55KSAqIChwMS5pc0Zsb29yID8gZWFzZSA6IGVhc2UpO1xuICAgIH1cbiAgICBcbiAgICBpZiAoUy5iYWxscy5sZW5ndGggPiBjb25maWcubWF4QmFsbHMgKyA1MCkge1xuICAgICAgICBTLmJhbGxzID0gUy5iYWxscy5maWx0ZXIoYiA9PiBiLmFjdGl2ZSk7XG4gICAgfVxuICB9XG5cbiAgLy8gLS0tIDcuIERSQVcgTE9PUCAtLS1cbiAgZnVuY3Rpb24gZHJhdygpIHtcbiAgICAvLyBDbGVhclxuICAgIGN0eC5maWxsU3R5bGUgPSBcIiNmOGY5ZmFcIjtcbiAgICBjdHguZmlsbFJlY3QoMCwgMCwgbG9naWNhbFdpZHRoLCBsb2dpY2FsSGVpZ2h0KTtcblxuICAgIC8vIFBlZ3NcbiAgICBjdHguZmlsbFN0eWxlID0gXCIjOWNhM2FmXCI7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGZvciAobGV0IHIgPSAwOyByIDwgcGVnR3JpZC5sZW5ndGg7IHIrKykge1xuICAgICAgZm9yIChsZXQgcCA9IDA7IHAgPCBwZWdHcmlkW3JdLmxlbmd0aDsgcCsrKSB7XG4gICAgICAgICBjb25zdCBwZWcgPSBwZWdHcmlkW3JdW3BdO1xuICAgICAgICAgY3R4Lm1vdmVUbyhwZWcueCArIHBlZ1JhZGl1cywgcGVnLnkpO1xuICAgICAgICAgY3R4LmFyYyhwZWcueCwgcGVnLnksIHBlZ1JhZGl1cywgMCwgTWF0aC5QSSoyKTtcbiAgICAgIH1cbiAgICB9XG4gICAgY3R4LmZpbGwoKTsgXG5cbiAgICAvLyBBY3RpdmUgQmFsbHNcbiAgICBjdHguZmlsbFN0eWxlID0gXCIjM2I4MmY2XCI7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgUy5iYWxscy5sZW5ndGg7IGkrKykge1xuICAgICAgIGNvbnN0IGIgPSBTLmJhbGxzW2ldO1xuICAgICAgIGlmIChiLmFjdGl2ZSkge1xuICAgICAgICAgY3R4Lm1vdmVUbyhiLnggKyBiYWxsUmFkaXVzLCBiLnkpO1xuICAgICAgICAgY3R4LmFyYyhiLngsIGIueSwgYmFsbFJhZGl1cywgMCwgTWF0aC5QSSoyKTtcbiAgICAgICB9XG4gICAgfVxuICAgIGN0eC5maWxsKCk7IFxuXG4gICAgLy8gQklOUyAoRGVuc2UgU3RhY2tpbmcpXG4gICAgY3R4LmZpbGxTdHlsZSA9IFwiIzNiODJmNlwiO1xuICAgIGN0eC5zdHJva2VTdHlsZSA9IFwiIzFkNGVkOFwiOyAvLyBEYXJrZXIgYm9yZGVyIGZvciBkZWZpbml0aW9uXG4gICAgY3R4LmxpbmVXaWR0aCA9IDE7XG4gICAgXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBTLmJpbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICBjb25zdCBjb3VudCA9IFMuYmluc1tpXTtcbiAgICAgICBpZiAoY291bnQgPT09IDApIGNvbnRpbnVlO1xuICAgICAgIFxuICAgICAgIGNvbnN0IGN4ID0gYmluc1N0YXJ0WCArIGkgKiBiaW5XaWR0aCArIGJpbldpZHRoLzI7XG4gICAgICAgXG4gICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY291bnQ7IGorKykge1xuICAgICAgICAgIC8vIERFTlNFIExPR0lDOiBzdGFja1N0ZXAgPSAwLjYgKiByXG4gICAgICAgICAgY29uc3QgY3kgPSBmbG9vclkgLSBiYWxsUmFkaXVzIC0gKGogKiBzdGFja1N0ZXApO1xuICAgICAgICAgIFxuICAgICAgICAgIGlmIChjeSA8IHdhbGxzVG9wWSkgYnJlYWs7IFxuICAgICAgICAgIGN0eC5tb3ZlVG8oY3ggKyBiYWxsUmFkaXVzLCBjeSk7XG4gICAgICAgICAgY3R4LmFyYyhjeCwgY3ksIGJhbGxSYWRpdXMsIDAsIE1hdGguUEkqMik7XG4gICAgICAgfVxuICAgICAgIGN0eC5maWxsKCk7XG4gICAgICAgY3R4LnN0cm9rZSgpO1xuICAgIH1cblxuICAgIC8vIFdhbGxzL0Zsb29yXG4gICAgY3R4LnN0cm9rZVN0eWxlID0gXCIjZDFkNWRiXCI7XG4gICAgY3R4LmxpbmVXaWR0aCA9IDI7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGN0eC5tb3ZlVG8oYmluc1N0YXJ0WCwgZmxvb3JZKTtcbiAgICBjdHgubGluZVRvKGJpbnNTdGFydFggKyB0b3RhbEJpbldpZHRoLCBmbG9vclkpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IGNvbmZpZy5yb3dzICsgMTsgaSsrKSB7XG4gICAgICAgY29uc3QgeCA9IGJpbnNTdGFydFggKyBpICogYmluV2lkdGg7XG4gICAgICAgY3R4Lm1vdmVUbyh4LCB3YWxsc1RvcFkpO1xuICAgICAgIGN0eC5saW5lVG8oeCwgZmxvb3JZKTtcbiAgICB9XG4gICAgY3R4LnN0cm9rZSgpO1xuXG4gICAgLy8gVGV4dFxuICAgIGN0eC5maWxsU3R5bGUgPSBcIiMzNzQxNTFcIjtcbiAgICBjdHguZm9udCA9IFwiYm9sZCAxNHB4IHNhbnMtc2VyaWZcIjtcbiAgICBjdHguZmlsbFRleHQoYFPhu5EgYmk6ICR7Uy5zcGF3bmVkfSAvICR7Y29uZmlnLm1heEJhbGxzfWAsIDEwLCAyNSk7XG4gIH1cblxuICAvLyAtLS0gOC4gUlVOVElNRSAtLS1cbiAgbGV0IGxhc3RUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gIGxldCBmcmFtZUlkO1xuICBcbiAgZnVuY3Rpb24gdGljayhub3cpIHtcbiAgICBjb25zdCBkdCA9IE1hdGgubWluKChub3cgLSBsYXN0VGltZSkgLyAxMDAwLCAwLjEpOyBcbiAgICBsYXN0VGltZSA9IG5vdztcbiAgICBcbiAgICB1cGRhdGUoZHQpO1xuICAgIGRyYXcoKTtcbiAgICBmcmFtZUlkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRpY2spO1xuICB9XG5cbiAgLy8gQmluZCBCdXR0b25zXG4gIGNvbnN0IGJ0blN0YXJ0ID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCIjYnRuLXN0YXJ0XCIpO1xuICBjb25zdCBidG5TdG9wID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCIjYnRuLXN0b3BcIik7XG5cbiAgYnRuU3RhcnQub25jbGljayA9ICgpID0+IHtcbiAgICAgaWYgKCFTLnJ1bm5pbmcgJiYgUy5zcGF3bmVkID09PSAwKSB7XG4gICAgICAgICBTLnJ1bm5pbmcgPSB0cnVlO1xuICAgICB9IGVsc2Uge1xuICAgICAgICAgUy5ydW5uaW5nID0gdHJ1ZTtcbiAgICAgICAgIGlmIChTLnNwYXduZWQgPj0gY29uZmlnLm1heEJhbGxzKSB7XG4gICAgICAgICAgICAgUy5iYWxscyA9IFtdO1xuICAgICAgICAgICAgIFMuYmlucy5maWxsKDApO1xuICAgICAgICAgICAgIFMuc3Bhd25lZCA9IDA7XG4gICAgICAgICB9XG4gICAgIH1cbiAgfTtcbiAgXG4gIGJ0blN0b3Aub25jbGljayA9ICgpID0+IHtcbiAgICAgIFMucnVubmluZyA9IGZhbHNlO1xuICB9O1xuXG4gIHRpY2socGVyZm9ybWFuY2Uubm93KCkpO1xuICBpbnZhbGlkYXRpb24udGhlbigoKSA9PiBjYW5jZWxBbmltYXRpb25GcmFtZShmcmFtZUlkKSk7XG5cbiAgcmV0dXJuIG91dGVyV3JhcHBlcjtcbn0pKCk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2Ygbm9ybWFsX2FwcHJveF9maXhlZF9heGlzID0gKCgpID0+IHtcbiAgLy8gLS0tIDEuIFNFVFVQIENPTlRBSU5FUiAtLS1cbiAgY29uc3Qgd3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gIHdyYXBwZXIuc3R5bGUuY3NzVGV4dCA9IGBcbiAgICBkaXNwbGF5OiBmbGV4O1xuICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICBmb250LWZhbWlseTogLWFwcGxlLXN5c3RlbSwgQmxpbmtNYWNTeXN0ZW1Gb250LCBcIlNlZ29lIFVJXCIsIFJvYm90bywgc2Fucy1zZXJpZjtcbiAgICBtYXJnaW4tdG9wOiAyMHB4O1xuICAgIHdpZHRoOiAxMDAlO1xuICAgIG1pbi1oZWlnaHQ6IDUwMHB4O1xuICBgO1xuXG4gIC8vIC0tLSAyLiBJTlBVVCBDUkVBVElPTiAtLS1cbiAgZnVuY3Rpb24gY3JlYXRlSW5wdXQoaWQsIGxhYmVsLCBtaW4sIG1heCwgc3RlcCwgdmFsKSB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjb250YWluZXIuc3R5bGUuY3NzVGV4dCA9IFwiZGlzcGxheTogZmxleDsgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsgd2lkdGg6IDIyMHB4O1wiO1xuICAgIFxuICAgIGNvbnN0IGxhYmVsRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGFiZWxcIik7XG4gICAgbGFiZWxFbC5odG1sRm9yID0gaWQ7XG4gICAgbGFiZWxFbC5zdHlsZS5jc3NUZXh0ID0gXCJmb250LXNpemU6IDE0cHg7IGZvbnQtd2VpZ2h0OiA2MDA7IGNvbG9yOiAjMzc0MTUxOyBtYXJnaW4tYm90dG9tOiA2cHg7XCI7XG4gICAgbGFiZWxFbC5pbm5lckhUTUwgPSBgJHtsYWJlbH0gPHNwYW4gc3R5bGU9XCJjb2xvcjogI2JlMTg1ZDtcIj4ke3ZhbH08L3NwYW4+YDtcbiAgICBcbiAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcbiAgICBpbnB1dC50eXBlID0gXCJyYW5nZVwiO1xuICAgIGlucHV0LmlkID0gaWQ7XG4gICAgaW5wdXQubWluID0gbWluO1xuICAgIGlucHV0Lm1heCA9IG1heDtcbiAgICBpbnB1dC5zdGVwID0gc3RlcDtcbiAgICBpbnB1dC52YWx1ZSA9IHZhbDtcbiAgICBpbnB1dC5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuICAgIGlucHV0LnN0eWxlLmFjY2VudENvbG9yID0gXCIjYmUxODVkXCI7IFxuICAgIFxuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChsYWJlbEVsKTtcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoaW5wdXQpO1xuICAgIHJldHVybiB7IGNvbnRhaW5lciwgaW5wdXQsIGxhYmVsRWwgfTtcbiAgfVxuXG4gIGNvbnN0IG5DdHJsID0gY3JlYXRlSW5wdXQoXCJuX3ZhbF9meFwiLCBcIlPhu5EgcGjDqXAgdGjhu60gKG4pOlwiLCAxMCwgNTAwLCAxMCwgNTApO1xuICBjb25zdCBwQ3RybCA9IGNyZWF0ZUlucHV0KFwicF92YWxfZnhcIiwgXCJYw6FjIHN14bqldCAocCk6XCIsIDAuMDUsIDAuOTUsIDAuMDUsIDAuNSk7XG5cbiAgY29uc3QgY29udHJvbHNEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICBjb250cm9sc0Rpdi5zdHlsZS5jc3NUZXh0ID0gXCJkaXNwbGF5OiBmbGV4OyBmbGV4LXdyYXA6IHdyYXA7IGdhcDogMzBweDsganVzdGlmeS1jb250ZW50OiBjZW50ZXI7IG1hcmdpbi1ib3R0b206IDIwcHg7IHdpZHRoOiAxMDAlO1wiO1xuICBjb250cm9sc0Rpdi5hcHBlbmRDaGlsZChuQ3RybC5jb250YWluZXIpO1xuICBjb250cm9sc0Rpdi5hcHBlbmRDaGlsZChwQ3RybC5jb250YWluZXIpO1xuICB3cmFwcGVyLmFwcGVuZENoaWxkKGNvbnRyb2xzRGl2KTtcblxuICAvLyBTdGF0cyBEaXNwbGF5XG4gIGNvbnN0IHN0YXRzRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgc3RhdHNEaXYuc3R5bGUuY3NzVGV4dCA9IFwiZm9udC1zaXplOiAxNnB4OyBjb2xvcjogIzM3NDE1MTsgbWFyZ2luLWJvdHRvbTogMTBweDsgZm9udC13ZWlnaHQ6IDUwMDsgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTtcIjtcbiAgd3JhcHBlci5hcHBlbmRDaGlsZChzdGF0c0Rpdik7XG4gIFxuICAvLyBQbG90IENvbnRhaW5lclxuICBjb25zdCBwbG90Q29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgd3JhcHBlci5hcHBlbmRDaGlsZChwbG90Q29udGFpbmVyKTtcblxuICAvLyAtLS0gMy4gTUFUSCBLRVJORUwgLS0tXG4gIGZ1bmN0aW9uIGxvZ0ZhY3Qobikge1xuICAgIGlmIChuIDw9IDEpIHJldHVybiAwO1xuICAgIHJldHVybiBuICogTWF0aC5sb2cobikgLSBuICsgMC41ICogTWF0aC5sb2coMiAqIE1hdGguUEkgKiBuKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEJpbm9taWFsUHJvYihrLCBuLCBwKSB7XG4gICAgaWYgKGsgPCAwIHx8IGsgPiBuKSByZXR1cm4gMDtcbiAgICBpZiAocCA8PSAwKSByZXR1cm4gayA9PT0gMCA/IDEgOiAwO1xuICAgIGlmIChwID49IDEpIHJldHVybiBrID09PSBuID8gMSA6IDA7XG4gICAgXG4gICAgY29uc3QgbG9nUCA9IGxvZ0ZhY3QobikgLSBsb2dGYWN0KGspIC0gbG9nRmFjdChuIC0gaykgKyBrICogTWF0aC5sb2cocCkgKyAobiAtIGspICogTWF0aC5sb2coMSAtIHApO1xuICAgIHJldHVybiBNYXRoLmV4cChsb2dQKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG5vcm1hbFBERih4LCBtdSwgc2lnbWEpIHtcbiAgICBpZiAoc2lnbWEgPD0gMCkgcmV0dXJuIDA7XG4gICAgcmV0dXJuICgxIC8gKHNpZ21hICogTWF0aC5zcXJ0KDIgKiBNYXRoLlBJKSkpICogTWF0aC5leHAoLTAuNSAqIE1hdGgucG93KCh4IC0gbXUpIC8gc2lnbWEsIDIpKTtcbiAgfVxuXG4gIC8vIC0tLSA0LiBSRU5ERVIgTE9HSUMgLS0tXG4gIGZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgICBjb25zdCBuID0gcGFyc2VGbG9hdChuQ3RybC5pbnB1dC52YWx1ZSk7XG4gICAgY29uc3QgcCA9IHBhcnNlRmxvYXQocEN0cmwuaW5wdXQudmFsdWUpO1xuXG4gICAgLy8gVXBkYXRlIFRleHRcbiAgICBuQ3RybC5sYWJlbEVsLnF1ZXJ5U2VsZWN0b3IoXCJzcGFuXCIpLnRleHRDb250ZW50ID0gbjtcbiAgICBwQ3RybC5sYWJlbEVsLnF1ZXJ5U2VsZWN0b3IoXCJzcGFuXCIpLnRleHRDb250ZW50ID0gcC50b0ZpeGVkKDIpO1xuXG4gICAgY29uc3QgbXUgPSBuICogcDtcbiAgICBjb25zdCBzaWdtYSA9IE1hdGguc3FydChuICogcCAqICgxIC0gcCkpO1xuXG4gICAgLy8gU3RhdHNcbiAgICBzdGF0c0Rpdi5pbm5lckhUTUwgPSBgJm11OyA9IDxiPiR7bXUudG9GaXhlZCgyKX08L2I+ICZuYnNwO3wmbmJzcDsgJnNpZ21hOyA9IDxiPiR7c2lnbWEudG9GaXhlZCgyKX08L2I+YDtcblxuICAgIC8vIENBTENVTEFUSU9OIFdJTkRPVzogV2Ugc3RpbGwgb3B0aW1pemUgY2FsY3VsYXRpb24gdG8gKy8tIDQgc2lnbWFcbiAgICAvLyB0byBrZWVwIHBlcmZvcm1hbmNlIGhpZ2gsIGV2ZW4gdGhvdWdoIHZpc3VhbCBheGlzIGlzIDAtbi5cbiAgICBsZXQgc3RhcnRLID0gTWF0aC5mbG9vcihtdSAtIDQgKiBzaWdtYSk7XG4gICAgbGV0IGVuZEsgPSBNYXRoLmNlaWwobXUgKyA0ICogc2lnbWEpO1xuICAgIGlmIChzdGFydEsgPCAwKSBzdGFydEsgPSAwO1xuICAgIGlmIChlbmRLID4gbikgZW5kSyA9IG47XG5cbiAgICAvLyAxLiBHZW5lcmF0ZSBCaW5vbWlhbCBEYXRhXG4gICAgY29uc3QgYmlub21EYXRhID0gW107XG4gICAgZm9yIChsZXQgayA9IHN0YXJ0SzsgayA8PSBlbmRLOyBrKyspIHtcbiAgICAgIGJpbm9tRGF0YS5wdXNoKHsgXG4gICAgICAgICAgazogaywgXG4gICAgICAgICAgeDE6IGsgLSAwLjUsIFxuICAgICAgICAgIHgyOiBrICsgMC41LFxuICAgICAgICAgIHByb2I6IGdldEJpbm9taWFsUHJvYihrLCBuLCBwKSBcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIDIuIEdlbmVyYXRlIE5vcm1hbCBEYXRhXG4gICAgY29uc3Qgbm9ybWFsRGF0YSA9IFtdO1xuICAgIGNvbnN0IHN0ZXAgPSAoZW5kSyAtIHN0YXJ0SykgLyAxMDA7XG4gICAgY29uc3Qgc2FmZVN0ZXAgPSBzdGVwID4gMC4xID8gc3RlcCA6IDAuMTtcbiAgICBcbiAgICBmb3IgKGxldCB4ID0gc3RhcnRLOyB4IDw9IGVuZEs7IHggKz0gc2FmZVN0ZXApIHtcbiAgICAgIG5vcm1hbERhdGEucHVzaCh7IHg6IHgsIHk6IG5vcm1hbFBERih4LCBtdSwgc2lnbWEpIH0pO1xuICAgIH1cblxuICAgIC8vIDMuIFBsb3RcbiAgICBjb25zdCBjaGFydCA9IFBsb3QucGxvdCh7XG4gICAgICB3aWR0aDogNjAwLFxuICAgICAgaGVpZ2h0OiAzODAsXG4gICAgICBtYXJnaW5Ub3A6IDMwLFxuICAgICAgbWFyZ2luTGVmdDogNDAsXG4gICAgICBtYXJnaW5Cb3R0b206IDMwLFxuICAgICAgeDogeyBcbiAgICAgICAgbGFiZWw6IFwiU+G7kSBs4bqnbiB0aMOgbmggY8O0bmcgKGspXCIsXG4gICAgICAgIC8vIEZJWDogSGFyZC1jb2RlIGRvbWFpbiB0byBmdWxsIHJhbmdlIFswLCBuXSB0byBwcmV2ZW50IGp1bXBpbmdcbiAgICAgICAgZG9tYWluOiBbMCwgbl1cbiAgICAgIH0sXG4gICAgICB5OiB7IFxuICAgICAgICBsYWJlbDogXCJYw6FjIHN14bqldFwiLCBcbiAgICAgICAgZ3JpZDogdHJ1ZSBcbiAgICAgIH0sXG4gICAgICBtYXJrczogW1xuICAgICAgICAvLyBCaW5vbWlhbFxuICAgICAgICBQbG90LnJlY3RZKGJpbm9tRGF0YSwge1xuICAgICAgICAgIHgxOiBcIngxXCIsIFxuICAgICAgICAgIHgyOiBcIngyXCIsIFxuICAgICAgICAgIHk6IFwicHJvYlwiLCBcbiAgICAgICAgICBmaWxsOiBcIiMzYjgyZjZcIiwgXG4gICAgICAgICAgZmlsbE9wYWNpdHk6IDAuNSxcbiAgICAgICAgICB0aXRsZTogZCA9PiBgazogJHtkLmt9XFxuUDogJHtkLnByb2IudG9GaXhlZCg0KX1gXG4gICAgICAgIH0pLFxuICAgICAgICBcbiAgICAgICAgLy8gTm9ybWFsIEN1cnZlXG4gICAgICAgIFBsb3QubGluZShub3JtYWxEYXRhLCB7XG4gICAgICAgICAgeDogXCJ4XCIsIFxuICAgICAgICAgIHk6IFwieVwiLCBcbiAgICAgICAgICBzdHJva2U6IFwiI2JlMTg1ZFwiLCBcbiAgICAgICAgICBzdHJva2VXaWR0aDogM1xuICAgICAgICB9KSxcbiAgICAgICAgXG4gICAgICAgIC8vIE1lYW4gTGluZVxuICAgICAgICBQbG90LnJ1bGVYKFttdV0sIHtcbiAgICAgICAgICBzdHJva2U6IFwiIzM3NDE1MVwiLCBcbiAgICAgICAgICBzdHJva2VEYXNoYXJyYXk6IFwiNCw0XCIsIFxuICAgICAgICAgIHN0cm9rZU9wYWNpdHk6IDAuNlxuICAgICAgICB9KVxuICAgICAgXVxuICAgIH0pO1xuXG4gICAgcGxvdENvbnRhaW5lci5pbm5lckhUTUwgPSBcIlwiO1xuICAgIHBsb3RDb250YWluZXIuYXBwZW5kQ2hpbGQoY2hhcnQpO1xuICB9XG5cbiAgbkN0cmwuaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIHVwZGF0ZSk7XG4gIHBDdHJsLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCB1cGRhdGUpO1xuICBcbiAgdXBkYXRlKCk7XG5cbiAgcmV0dXJuIHdyYXBwZXI7XG59KSgpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIGFjZV9zaW1fbWFudWFsID0gKCgpID0+IHtcbiAgLy8gLS0tIDEuIFNFVFVQIERPTSAmIFNUWUxFUyAtLS1cbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgY29udGFpbmVyLnN0eWxlLmNzc1RleHQgPSBgXG4gICAgd2lkdGg6IDQwMHB4O1xuICAgIGhlaWdodDogNDQwcHg7IFxuICAgIG1hcmdpbjogMCBhdXRvO1xuICAgIGZvbnQtZmFtaWx5OiAtYXBwbGUtc3lzdGVtLCBCbGlua01hY1N5c3RlbUZvbnQsIFwiU2Vnb2UgVUlcIiwgUm9ib3RvLCBzYW5zLXNlcmlmO1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgIGJvcmRlcjogMXB4IHNvbGlkIHRyYW5zcGFyZW50OyAvKiBQcmV2ZW50cyBtYXJnaW4gY29sbGFwc2UgKi9cbiAgYDtcblxuICAvLyBJbmplY3QgVUkgSFRNTCBkaXJlY3RseSAoVG90YWwgQ29udHJvbClcbiAgY29udGFpbmVyLmlubmVySFRNTCA9IGBcbiAgICA8c3R5bGU+XG4gICAgICAuYWNlLWNvbnRyb2xzLXJvdyB7XG4gICAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgICBoZWlnaHQ6IDQwcHg7XG4gICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAgICBnYXA6IDEycHg7XG4gICAgICAgIG1hcmdpbi1ib3R0b206IDVweDtcbiAgICAgIH1cbiAgICAgIC5hY2UtYnRuIHtcbiAgICAgICAgcGFkZGluZzogNnB4IDE0cHg7XG4gICAgICAgIGJvcmRlci1yYWRpdXM6IDZweDtcbiAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2QxZDVkYjtcbiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7XG4gICAgICAgIGNvbG9yOiAjMzc0MTUxO1xuICAgICAgICBmb250LXNpemU6IDE0cHg7XG4gICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7XG4gICAgICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICAgICAgbGluZS1oZWlnaHQ6IDEuMjtcbiAgICAgIH1cbiAgICAgIC5hY2UtYnRuOmhvdmVyIHsgYmFja2dyb3VuZC1jb2xvcjogI2YzZjRmNjsgfVxuICAgICAgLmFjZS1idG4tcHJpbWFyeSB7XG4gICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMzYjgyZjY7IFxuICAgICAgICBjb2xvcjogd2hpdGU7IFxuICAgICAgICBib3JkZXItY29sb3I6ICMyNTYzZWI7XG4gICAgICB9XG4gICAgICAuYWNlLWJ0bi1wcmltYXJ5OmhvdmVyIHsgYmFja2dyb3VuZC1jb2xvcjogIzI1NjNlYjsgY29sb3I6IHdoaXRlOyB9XG4gICAgICBcbiAgICAgIC5hY2UtdG9nZ2xlIHtcbiAgICAgICAgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgZ2FwOiA2cHg7XG4gICAgICAgIGZvbnQtc2l6ZTogMTRweDsgZm9udC13ZWlnaHQ6IDUwMDsgY29sb3I6ICM0YjU1NjM7XG4gICAgICAgIGN1cnNvcjogcG9pbnRlcjsgdXNlci1zZWxlY3Q6IG5vbmU7XG4gICAgICB9XG4gICAgICAuYWNlLXRvZ2dsZSBpbnB1dCB7IHdpZHRoOiAxNnB4OyBoZWlnaHQ6IDE2cHg7IGFjY2VudC1jb2xvcjogIzEwYjk4MTsgY3Vyc29yOiBwb2ludGVyOyB9XG4gICAgICBcbiAgICAgIGNhbnZhcyB7IGRpc3BsYXk6IGJsb2NrOyB9IC8qIFJlbW92ZXMgZ2hvc3QgbWFyZ2luICovXG4gICAgPC9zdHlsZT5cblxuICAgIDxkaXYgY2xhc3M9XCJhY2UtY29udHJvbHMtcm93XCI+XG4gICAgICA8YnV0dG9uIGlkPVwiYnRuLWRyYXdcIiBjbGFzcz1cImFjZS1idG4gYWNlLWJ0bi1wcmltYXJ5XCI+UsO6dCAxMCBsw6E8L2J1dHRvbj5cbiAgICAgIDxsYWJlbCBjbGFzcz1cImFjZS10b2dnbGVcIj5cbiAgICAgICAgPGlucHV0IHR5cGU9XCJjaGVja2JveFwiIGlkPVwiY2hrLWF1dG9cIj5cbiAgICAgICAgVOG7sSDEkeG7mW5nIGNo4bqheVxuICAgICAgPC9sYWJlbD5cbiAgICAgIDxidXR0b24gaWQ9XCJidG4tcmVzZXRcIiBjbGFzcz1cImFjZS1idG5cIj5Mw6BtIGzhuqFpPC9idXR0b24+XG4gICAgPC9kaXY+XG4gIGA7XG5cbiAgLy8gLS0tIDIuIENBTlZBUyBTRVRVUCAtLS1cbiAgY29uc3Qgd2lkdGggPSA0MDA7XG4gIGNvbnN0IGhlaWdodCA9IDM4MDtcbiAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgY29uc3QgZHByID0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMTtcbiAgXG4gIGNhbnZhcy53aWR0aCA9IHdpZHRoICogZHByO1xuICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0ICogZHByO1xuICBjYW52YXMuc3R5bGUud2lkdGggPSBgJHt3aWR0aH1weGA7XG4gIGNhbnZhcy5zdHlsZS5oZWlnaHQgPSBgJHtoZWlnaHR9cHhgO1xuICBcbiAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiLCB7IGFscGhhOiBmYWxzZSB9KTtcbiAgY3R4LnNjYWxlKGRwciwgZHByKTtcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKGNhbnZhcyk7XG5cbiAgLy8gLS0tIDMuIFNUQVRFICYgQ09OU1RBTlRTIC0tLVxuICBjb25zdCBTVUlUUyA9IFtcIuKZoFwiLCBcIuKZpVwiLCBcIuKZo1wiLCBcIuKZplwiXTtcbiAgY29uc3QgUkFOS1MgPSBbXCIyXCIsXCIzXCIsXCI0XCIsXCI1XCIsXCI2XCIsXCI3XCIsXCI4XCIsXCI5XCIsXCIxMFwiLFwiSlwiLFwiUVwiLFwiS1wiLFwiQVwiXTtcbiAgY29uc3QgQ0FSRF9XID0gMzAsIENBUkRfSCA9IDQ1O1xuICBcbiAgLy8gTGF5b3V0IENvbnN0YW50c1xuICBjb25zdCBZX0hFQURFUiA9IDQ1O1xuICBjb25zdCBZX0NBUkRTID0gODU7XG4gIGNvbnN0IFlfQ0hBUlRfQkFTRSA9IDMyMDtcbiAgY29uc3QgQ0hBUlRfSCA9IDYwO1xuICBcbiAgLy8gQ29sb3JzXG4gIGNvbnN0IEJHX0NPTE9SPVwiI2ZmZlwiLCBURVhUX0NPTE9SPVwiIzMzMzMzM1wiLCBBQ0VfQ09MT1I9XCIjZDM1NDAwXCIsIEFDRV9CRz1cIiNmZmZiZTZcIjtcbiAgY29uc3QgQ0FSRF9CRz1cIiNmZmZmZmZcIiwgQ0FSRF9CT1JERVI9XCIjY2NjY2NjXCIsIFJFRD1cIiNlNzRjM2NcIiwgQkxBQ0s9XCIjMmMzZTUwXCI7XG4gIGNvbnN0IENIQVJUX1RIRU89XCJyZ2JhKDQ0LCA2MiwgODAsIDAuMSlcIiwgQ0hBUlRfQUNUPVwiIzAwOTY4OFwiLCBDSEFSVF9BQ1RJVkU9XCIjMDA3OTZiXCI7XG4gIGNvbnN0IERFQ0tfQkFDSz1cIiNjMDM5MmJcIjtcblxuICBmdW5jdGlvbiBoeXBlcmdlb20oaywgTiwgSywgbikge1xuICAgICBmdW5jdGlvbiBuQ3Iobiwgcikge1xuICAgICAgICBpZiAociA8IDAgfHwgciA+IG4pIHJldHVybiAwO1xuICAgICAgICBsZXQgcmVzID0gMTtcbiAgICAgICAgZm9yKGxldCBpPTA7IGk8cjsgaSsrKSByZXMgPSByZXMgKiAobiAtIGkpIC8gKGkgKyAxKTtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgfVxuICAgICByZXR1cm4gKG5DcihLLCBrKSAqIG5DcihOIC0gSywgbiAtIGspKSAvIG5DcihOLCBuKTtcbiAgfVxuICBjb25zdCBUSEVPUkVUSUNBTCA9IFtdO1xuICBmb3IobGV0IGs9MDsgazw9NDsgaysrKSBUSEVPUkVUSUNBTFtrXSA9IGh5cGVyZ2VvbShrLCA1MiwgNCwgMTApO1xuXG4gIGNvbnN0IFMgPSB7XG4gICAgIGNvdW50czogWzAsIDAsIDAsIDAsIDBdLCBcbiAgICAgdG90YWxEZWFsczogMCxcbiAgICAgbGFzdEhhbmQ6IFtdLFxuICAgICBhbmltYXRpb246IDAsIFxuICAgICBjb29sZG93bjogMCxcbiAgICAgaXNBdXRvOiBmYWxzZVxuICB9O1xuXG4gIC8vIC0tLSA0LiBMT0dJQyAtLS1cbiAgZnVuY3Rpb24gcnVuRGVhbCgpIHtcbiAgICBsZXQgZGVjayA9IFtdO1xuICAgIGZvcihsZXQgcyBvZiBTVUlUUykge1xuICAgICAgZm9yKGxldCByIG9mIFJBTktTKSBkZWNrLnB1c2goeyByYW5rOiByLCBzdWl0OiBzLCBpc0FjZTogciA9PT0gXCJBXCIgfSk7XG4gICAgfVxuICAgIGZvcihsZXQgaT1kZWNrLmxlbmd0aC0xOyBpPjA7IGktLSkge1xuICAgICAgIGNvbnN0IGogPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoaSsxKSk7XG4gICAgICAgW2RlY2tbaV0sIGRlY2tbal1dID0gW2RlY2tbal0sIGRlY2tbaV1dO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBoYW5kID0gZGVjay5zbGljZSgwLCAxMCk7XG4gICAgY29uc3QgYWNlQ291bnQgPSBoYW5kLmZpbHRlcihjID0+IGMuaXNBY2UpLmxlbmd0aDtcbiAgICBTLmNvdW50c1thY2VDb3VudF0rKztcbiAgICBTLnRvdGFsRGVhbHMrKztcbiAgICBcbiAgICAvLyBBbmltYXRpb24gdGFyZ2V0c1xuICAgIGNvbnN0IHN0YXJ0WCA9ICh3aWR0aCAtICg1ICogKENBUkRfVyArIDgpKSkgLyAyICsgNDtcbiAgICBTLmxhc3RIYW5kID0gaGFuZC5tYXAoKGMsIGkpID0+IHtcbiAgICAgICBjb25zdCByb3cgPSBNYXRoLmZsb29yKGkgLyA1KTtcbiAgICAgICBjb25zdCBjb2wgPSBpICUgNTtcbiAgICAgICByZXR1cm4ge1xuICAgICAgICAgLi4uYyxcbiAgICAgICAgIHg6IDMwLCB5OiAzMCxcbiAgICAgICAgIHRhcmdldFg6IHN0YXJ0WCArIGNvbCAqIChDQVJEX1cgKyA4KSxcbiAgICAgICAgIHRhcmdldFk6IFlfQ0FSRFMgKyByb3cgKiAoQ0FSRF9IICsgMTIpLFxuICAgICAgICAgdDogMFxuICAgICAgIH07XG4gICAgfSk7XG4gICAgUy5hbmltYXRpb24gPSAxO1xuICAgIFMuY29vbGRvd24gPSAwOyBcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlc2V0KCkge1xuICAgICBTLmNvdW50cyA9IFswLDAsMCwwLDBdO1xuICAgICBTLnRvdGFsRGVhbHMgPSAwO1xuICAgICBTLmxhc3RIYW5kID0gW107XG4gICAgIFMuYW5pbWF0aW9uID0gMDtcbiAgfVxuXG4gIC8vIC0tLSA1LiBMT09QIC0tLVxuICBmdW5jdGlvbiB1cGRhdGUoKSB7XG4gICAgIGlmIChTLmlzQXV0byAmJiBTLmFuaW1hdGlvbiA9PT0gMCkge1xuICAgICAgICBTLmNvb2xkb3duKys7XG4gICAgICAgIGlmIChTLmNvb2xkb3duID4gNDApIHJ1bkRlYWwoKTtcbiAgICAgfVxuXG4gICAgIGlmIChTLmFuaW1hdGlvbiA9PT0gMSkge1xuICAgICAgIGxldCBkb25lID0gdHJ1ZTtcbiAgICAgICBmb3IgKGxldCBjIG9mIFMubGFzdEhhbmQpIHtcbiAgICAgICAgICBpZiAoYy50IDwgMSkge1xuICAgICAgICAgICAgIGMudCArPSAwLjE7IFxuICAgICAgICAgICAgIGlmIChjLnQgPiAxKSBjLnQgPSAxO1xuICAgICAgICAgICAgIGNvbnN0IGVhc2UgPSAxIC0gTWF0aC5wb3coMSAtIGMudCwgMyk7XG4gICAgICAgICAgICAgYy54ID0gMzAgKyAoYy50YXJnZXRYIC0gMzApICogZWFzZTtcbiAgICAgICAgICAgICBjLnkgPSAzMCArIChjLnRhcmdldFkgLSAzMCkgKiBlYXNlO1xuICAgICAgICAgICAgIGRvbmUgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgfVxuICAgICAgIGlmIChkb25lKSBTLmFuaW1hdGlvbiA9IDA7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gZHJhdygpIHtcbiAgICBjdHguZmlsbFN0eWxlID0gQkdfQ09MT1I7XG4gICAgY3R4LmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuICAgIFxuICAgIGN0eC5zYXZlKCk7XG4gICAgY3R4LmZvbnQgPSBcImJvbGQgMTRweCAtYXBwbGUtc3lzdGVtLCBCbGlua01hY1N5c3RlbUZvbnQsIHNhbnMtc2VyaWZcIjtcbiAgICBjdHguZm9udFZhcmlhbnROdW1lcmljID0gXCJ0YWJ1bGFyLW51bXNcIjtcblxuICAgIC8vIEhlYWRlclxuICAgIGN0eC50ZXh0QWxpZ24gPSBcImxlZnRcIjsgY3R4LmZpbGxTdHlsZSA9IFRFWFRfQ09MT1I7XG4gICAgY3R4LmZpbGxUZXh0KGBM4bqnbiByw7p0OiAke1MudG90YWxEZWFsc31gLCA3NSwgWV9IRUFERVIpOyBcbiAgICBcbiAgICBpZiAoUy5pc0F1dG8pIHtcbiAgICAgICAgY3R4LnRleHRBbGlnbiA9IFwiY2VudGVyXCI7IGN0eC5maWxsU3R5bGUgPSBDSEFSVF9BQ1Q7XG4gICAgICAgIGN0eC5maWxsVGV4dChcIuKXjyDEkGFuZyBjaOG6oXkuLi5cIiwgd2lkdGgvMiwgWV9IRUFERVIpO1xuICAgIH1cblxuICAgIGlmIChTLmxhc3RIYW5kLmxlbmd0aCA+IDApIHtcbiAgICAgICBjb25zdCBhY2VzID0gUy5sYXN0SGFuZC5maWx0ZXIoYz0+Yy5pc0FjZSkubGVuZ3RoO1xuICAgICAgIGN0eC50ZXh0QWxpZ24gPSBcInJpZ2h0XCI7IGN0eC5maWxsU3R5bGUgPSBBQ0VfQ09MT1I7XG4gICAgICAgY3R4LmZpbGxUZXh0KGBL4bq/dCBxdeG6ozogJHthY2VzfSBsw6Egw4F0YCwgd2lkdGggLSAzMCwgWV9IRUFERVIpOyBcbiAgICB9XG4gICAgY3R4LnJlc3RvcmUoKTtcblxuICAgIC8vIERlY2tcbiAgICBmb3IobGV0IGk9MDsgaTwzOyBpKyspIHtcbiAgICAgIGN0eC5maWxsU3R5bGUgPSBcIndoaXRlXCI7IGN0eC5zdHJva2VTdHlsZSA9IFwiI2NjY1wiO1xuICAgICAgY3R4LmZpbGxSZWN0KDMwLWkqMiwgMzAtaSoyLCBDQVJEX1csIENBUkRfSCk7XG4gICAgICBjdHguc3Ryb2tlUmVjdCgzMC1pKjIsIDMwLWkqMiwgQ0FSRF9XLCBDQVJEX0gpO1xuICAgIH1cbiAgICBjdHguZmlsbFN0eWxlID0gREVDS19CQUNLOyBjdHguZmlsbFJlY3QoMzAsIDMwLCBDQVJEX1csIENBUkRfSCk7XG4gICAgY3R4LnN0cm9rZVN0eWxlID0gXCJ3aGl0ZVwiOyBjdHgubGluZVdpZHRoID0gMjsgY3R4LnN0cm9rZVJlY3QoMzQsIDM0LCBDQVJEX1ctOCwgQ0FSRF9ILTgpO1xuICAgIGN0eC5saW5lV2lkdGggPSAxO1xuXG4gICAgLy8gSGFuZFxuICAgIGZvciAobGV0IGMgb2YgUy5sYXN0SGFuZCkge1xuICAgICAgICBjdHguZmlsbFN0eWxlID0gYy5pc0FjZSA/IEFDRV9CRyA6IENBUkRfQkc7XG4gICAgICAgIGN0eC5maWxsUmVjdChjLngsIGMueSwgQ0FSRF9XLCBDQVJEX0gpO1xuICAgICAgICBcbiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gYy5pc0FjZSA/IEFDRV9DT0xPUiA6IENBUkRfQk9SREVSO1xuICAgICAgICBjdHguc3Ryb2tlUmVjdChjLngsIGMueSwgQ0FSRF9XLCBDQVJEX0gpO1xuXG4gICAgICAgIGNvbnN0IGlzUmVkID0gKGMuc3VpdCA9PT0gXCLimaVcIiB8fCBjLnN1aXQgPT09IFwi4pmmXCIpO1xuICAgICAgICBjdHguZmlsbFN0eWxlID0gYy5pc0FjZSA/IEFDRV9DT0xPUiA6IChpc1JlZCA/IFJFRCA6IEJMQUNLKTtcbiAgICAgICAgY3R4LnRleHRBbGlnbiA9IFwibGVmdFwiOyBjdHgudGV4dEJhc2VsaW5lID0gXCJ0b3BcIjtcbiAgICAgICAgY3R4LmZvbnQgPSBcImJvbGQgMTRweCBzYW5zLXNlcmlmXCI7XG4gICAgICAgIGN0eC5maWxsVGV4dChjLnJhbmssIGMueCArIDMsIGMueSArIDQpO1xuICAgICAgICBjdHguZm9udCA9IFwiMTZweCBzYW5zLXNlcmlmXCI7XG4gICAgICAgIGN0eC5maWxsVGV4dChjLnN1aXQsIGMueCArIDMsIGMueSArIDIwKTtcbiAgICB9XG5cbiAgICAvLyBDaGFydFxuICAgIGNvbnN0IGNoYXJ0WCA9IDUwLCBiYXJXID0gNDAsIGdhcCA9IDI1O1xuICAgIFxuICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4LnN0cm9rZVN0eWxlID0gXCIjYmRjM2M3XCI7IGN0eC5saW5lV2lkdGggPSAxO1xuICAgIGN0eC5tb3ZlVG8oY2hhcnRYIC0gMTAsIFlfQ0hBUlRfQkFTRSk7IGN0eC5saW5lVG8od2lkdGggLSAyMCwgWV9DSEFSVF9CQVNFKTsgY3R4LnN0cm9rZSgpO1xuICAgIFxuICAgIGN0eC5zYXZlKCk7XG4gICAgY3R4LmZpbGxTdHlsZSA9IFRFWFRfQ09MT1I7IGN0eC5mb250ID0gXCIxMnB4IHNhbnMtc2VyaWZcIjsgY3R4LnRleHRBbGlnbiA9IFwiY2VudGVyXCI7XG4gICAgY3R4LmZpbGxUZXh0KFwiU+G7kSBsw6Egw4F0IHLDunQgxJHGsOG7o2MgKGspXCIsIHdpZHRoLzIgKyAxNSwgWV9DSEFSVF9CQVNFICsgMzUpO1xuICAgIFxuICAgIGN0eC50cmFuc2xhdGUoMjAsIFlfQ0hBUlRfQkFTRSAtIENIQVJUX0gvMik7XG4gICAgY3R4LnJvdGF0ZSgtTWF0aC5QSS8yKTtcbiAgICBjdHguZmlsbFN0eWxlID0gXCIjN2Y4YzhkXCI7XG4gICAgY3R4LmZpbGxUZXh0KFwiVOG6p24gc3XhuqV0XCIsIDAsIDApO1xuICAgIGN0eC5yZXN0b3JlKCk7XG5cbiAgICBjb25zdCBhY3RpdmVBY2VzID0gUy5sYXN0SGFuZC5maWx0ZXIoYz0+Yy5pc0FjZSkubGVuZ3RoO1xuXG4gICAgZm9yIChsZXQgayA9IDA7IGsgPD0gNDsgaysrKSB7XG4gICAgICAgY29uc3QgeCA9IGNoYXJ0WCArIGsgKiAoYmFyVyArIGdhcCk7XG4gICAgICAgY29uc3QgWV9TQ0FMRSA9IDAuNTtcbiAgICAgICBcbiAgICAgICBjb25zdCB0aGVvSCA9IChUSEVPUkVUSUNBTFtrXSAvIFlfU0NBTEUpICogQ0hBUlRfSDtcbiAgICAgICBjdHguZmlsbFN0eWxlID0gQ0hBUlRfVEhFTztcbiAgICAgICBjdHguZmlsbFJlY3QoeCwgWV9DSEFSVF9CQVNFIC0gdGhlb0gsIGJhclcsIHRoZW9IKTtcbiAgICAgICBcbiAgICAgICBsZXQgY291bnQgPSBTLmNvdW50c1trXTtcbiAgICAgICBsZXQgcGN0ID0gUy50b3RhbERlYWxzID4gMCA/IGNvdW50IC8gUy50b3RhbERlYWxzIDogMDtcbiAgICAgICBsZXQgYmFySCA9IChwY3QgLyBZX1NDQUxFKSAqIENIQVJUX0g7XG4gICAgICAgaWYgKGJhckggPiBDSEFSVF9IICsgMTApIGJhckggPSBDSEFSVF9IICsgMTA7XG4gICAgICAgXG4gICAgICAgY29uc3QgaXNBY3RpdmUgPSAoUy5hbmltYXRpb24gPT09IDAgJiYgUy50b3RhbERlYWxzID4gMCAmJiBrID09PSBhY3RpdmVBY2VzKTtcbiAgICAgICBjdHguZmlsbFN0eWxlID0gaXNBY3RpdmUgPyBDSEFSVF9BQ1RJVkUgOiBDSEFSVF9BQ1Q7XG4gICAgICAgY3R4LmZpbGxSZWN0KHgsIFlfQ0hBUlRfQkFTRSAtIGJhckgsIGJhclcsIGJhckgpO1xuICAgICAgIFxuICAgICAgIGN0eC5zYXZlKCk7XG4gICAgICAgY3R4LmZvbnRWYXJpYW50TnVtZXJpYyA9IFwidGFidWxhci1udW1zXCI7XG4gICAgICAgY3R4LmZpbGxTdHlsZSA9IFRFWFRfQ09MT1I7IGN0eC5mb250ID0gXCIxMnB4IHNhbnMtc2VyaWZcIjsgY3R4LnRleHRBbGlnbiA9IFwiY2VudGVyXCI7XG4gICAgICAgY3R4LmZpbGxUZXh0KGssIHggKyBiYXJXLzIsIFlfQ0hBUlRfQkFTRSArIDE1KTtcbiAgICAgICBjdHgucmVzdG9yZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8vIC0tLSA2LiBCSU5ESU5HUyAtLS1cbiAgY29uc3QgYnRuRHJhdyA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiI2J0bi1kcmF3XCIpO1xuICBjb25zdCBidG5SZXNldCA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiI2J0bi1yZXNldFwiKTtcbiAgY29uc3QgY2hrQXV0byA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiI2Noay1hdXRvXCIpO1xuXG4gIGJ0bkRyYXcub25jbGljayA9ICgpID0+IHJ1bkRlYWwoKTtcbiAgYnRuUmVzZXQub25jbGljayA9ICgpID0+IHJlc2V0KCk7XG4gIGNoa0F1dG8ub25jaGFuZ2UgPSAoZSkgPT4geyBTLmlzQXV0byA9IGUudGFyZ2V0LmNoZWNrZWQ7IH07XG5cbiAgbGV0IGZyYW1lSWQ7XG4gIGZ1bmN0aW9uIHRpY2soKSB7XG4gICAgdXBkYXRlKCk7XG4gICAgZHJhdygpO1xuICAgIGZyYW1lSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGljayk7XG4gIH1cbiAgdGljaygpO1xuXG4gIC8vIENsZWFuIHVwXG4gIGlmICh0aGlzICYmIHRoaXMuaW52YWxpZGF0aW9uKSB0aGlzLmludmFsaWRhdGlvbi50aGVuKCgpID0+IGNhbmNlbEFuaW1hdGlvbkZyYW1lKGZyYW1lSWQpKTtcblxuICByZXR1cm4gY29udGFpbmVyO1xufSkoKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBwb2lzc29uX3Zpc3VhbF9maW5hbCA9ICgoKSA9PiB7XG4gIC8vIC0tLSAxLiBDT05GSUdVUkFUSU9OIC0tLVxuICBjb25zdCBsYW1iZGEgPSA1OyBcbiAgXG4gIC8vIElucHV0IFNsaWRlciAoV2lkdGggNDAwcHggdG8gbWF0Y2ggYmlubmluZyBiYXIpXG4gIGNvbnN0IGZvcm0gPSBJbnB1dHMucmFuZ2UoWzEwLCAzNjBdLCB7XG4gICAgdmFsdWU6IDEwLCBcbiAgICBzdGVwOiA1LCBcbiAgICBsYWJlbDogXCJDaGlhIDEgZ2nhu50gdGjDoG5oIG4ga2hv4bqjbmcgKG4pXCJcbiAgfSk7XG4gIFxuICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgd3JhcHBlci5zdHlsZS5jc3NUZXh0ID0gYFxuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgIGZvbnQtZmFtaWx5OiAtYXBwbGUtc3lzdGVtLCBCbGlua01hY1N5c3RlbUZvbnQsIFwiU2Vnb2UgVUlcIiwgUm9ib3RvLCBzYW5zLXNlcmlmO1xuICAgIG1hcmdpbi10b3A6IDIwcHg7XG4gIGA7XG4gIFxuICAvLyAtLS0gMi4gVElNRSBCSU4gVklTVUFMSVpBVElPTiAoQ2FudmFzKSAtLS1cbiAgY29uc3QgdGltZUNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gIGNvbnN0IHRpbWVXID0gNDAwOyAvLyBSRURVQ0VEIFdJRFRIXG4gIGNvbnN0IHRpbWVIID0gNTA7XG4gIGNvbnN0IGRwciA9IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIHx8IDE7XG4gIFxuICB0aW1lQ2FudmFzLndpZHRoID0gdGltZVcgKiBkcHI7XG4gIHRpbWVDYW52YXMuaGVpZ2h0ID0gdGltZUggKiBkcHI7XG4gIHRpbWVDYW52YXMuc3R5bGUud2lkdGggPSBgJHt0aW1lV31weGA7XG4gIHRpbWVDYW52YXMuc3R5bGUuaGVpZ2h0ID0gYCR7dGltZUh9cHhgO1xuICB0aW1lQ2FudmFzLnN0eWxlLm1hcmdpblRvcCA9IFwiMTBweFwiOyBcbiAgdGltZUNhbnZhcy5zdHlsZS5tYXJnaW5Cb3R0b20gPSBcIjVweFwiO1xuICBcbiAgY29uc3QgdEN0eCA9IHRpbWVDYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICB0Q3R4LnNjYWxlKGRwciwgZHByKTtcblxuICAvLyAtLS0gMy4gU1RBVFMgRElTUExBWSAtLS1cbiAgY29uc3Qgc3RhdHNEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICBzdGF0c0Rpdi5zdHlsZS5jc3NUZXh0ID0gYFxuICAgIG1hcmdpbi1ib3R0b206IDVweDsgXG4gICAgZm9udC1zaXplOiAxNnB4OyBcbiAgICBjb2xvcjogIzMzMztcbiAgICBmb250LXdlaWdodDogNTAwO1xuICBgO1xuICBcbiAgLy8gLS0tIDQuIEFQUEVORCBFTEVNRU5UUyAoT3JkZXI6IElucHV0IC0+IEJpbm5pbmcgLT4gU3RhdHMgLT4gUGxvdCkgLS0tXG4gIHdyYXBwZXIuYXBwZW5kQ2hpbGQoZm9ybSk7ICAgICAgIFxuICB3cmFwcGVyLmFwcGVuZENoaWxkKHRpbWVDYW52YXMpOyBcbiAgd3JhcHBlci5hcHBlbmRDaGlsZChzdGF0c0Rpdik7ICAgXG4gIGNvbnN0IHBsb3RDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICB3cmFwcGVyLmFwcGVuZENoaWxkKHBsb3RDb250YWluZXIpOyBcblxuICAvLyAtLS0gNS4gTUFUSCBIRUxQRVJTIC0tLVxuICBmdW5jdGlvbiBnZXRCaW5vbWlhbERhdGEobiwgcCkge1xuICAgIGNvbnN0IGRhdGEgPSBbXTtcbiAgICBsZXQgcHJvYiA9IE1hdGgucG93KDEgLSBwLCBuKTsgXG4gICAgZm9yIChsZXQgayA9IDA7IGsgPD0gMTY7IGsrKykge1xuICAgICAgZGF0YS5wdXNoKHtrLCB0eXBlOiBcIkJpbm9taWFsXCIsIHByb2J9KTtcbiAgICAgIGlmIChrIDwgbikge1xuICAgICAgICBwcm9iID0gcHJvYiAqICgobiAtIGspIC8gKGsgKyAxKSkgKiAocCAvICgxIC0gcCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcHJvYiA9IDA7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkYXRhO1xuICB9XG5cbiAgY29uc3QgcG9pc3NvbkRhdGEgPSBbXTtcbiAge1xuICAgIGxldCBwcm9iID0gTWF0aC5leHAoLWxhbWJkYSk7IFxuICAgIGZvciAobGV0IGsgPSAwOyBrIDw9IDE2OyBrKyspIHtcbiAgICAgIHBvaXNzb25EYXRhLnB1c2goe2ssIHR5cGU6IFwiUG9pc3NvblwiLCBwcm9ifSk7XG4gICAgICBwcm9iID0gcHJvYiAqIGxhbWJkYSAvIChrICsgMSk7XG4gICAgfVxuICB9XG5cbiAgLy8gLS0tIDYuIFJFTkRFUiBMT09QUyAtLS1cbiAgZnVuY3Rpb24gZHJhd1RpbWVCaW5zKG4pIHtcbiAgICB0Q3R4LmNsZWFyUmVjdCgwLCAwLCB0aW1lVywgdGltZUgpO1xuICAgIFxuICAgIGNvbnN0IGJhclggPSAwOyAvLyBTdGFydCBhdCAwIHNpbmNlIGNhbnZhcyBpcyBub3cgZXhhY3Qgd2lkdGhcbiAgICBjb25zdCBiYXJZID0gMTU7XG4gICAgY29uc3QgYmFyVyA9IHRpbWVXO1xuICAgIGNvbnN0IGJhckggPSAyMDtcbiAgICBcbiAgICAvLyBCYWNrZ3JvdW5kXG4gICAgdEN0eC5maWxsU3R5bGUgPSBcIiNmM2Y0ZjZcIjtcbiAgICB0Q3R4LmZpbGxSZWN0KGJhclgsIGJhclksIGJhclcsIGJhckgpO1xuICAgIHRDdHguc3Ryb2tlU3R5bGUgPSBcIiM5Y2EzYWZcIjtcbiAgICB0Q3R4LmxpbmVXaWR0aCA9IDE7XG4gICAgdEN0eC5zdHJva2VSZWN0KGJhclgsIGJhclksIGJhclcsIGJhckgpO1xuICAgIFxuICAgIC8vIERyYXcgRGl2aWRlcnNcbiAgICB0Q3R4LmJlZ2luUGF0aCgpO1xuICAgIHRDdHguc3Ryb2tlU3R5bGUgPSBuID4gMTUwID8gXCJyZ2JhKDEwNywgMTE0LCAxMjgsIDAuNSlcIiA6IFwiIzZiNzI4MFwiO1xuICAgIHRDdHgubGluZVdpZHRoID0gbiA+IDIwMCA/IDAuNSA6IDE7IFxuXG4gICAgY29uc3QgYmluU2l6ZSA9IGJhclcgLyBuO1xuICAgIFxuICAgIC8vIERyYXcgaW50ZXJuYWwgbGluZXNcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IG47IGkrKykge1xuICAgICAgICBjb25zdCB4ID0gTWF0aC5mbG9vcihiYXJYICsgaSAqIGJpblNpemUpICsgMC41O1xuICAgICAgICB0Q3R4Lm1vdmVUbyh4LCBiYXJZKTtcbiAgICAgICAgdEN0eC5saW5lVG8oeCwgYmFyWSArIGJhckgpO1xuICAgIH1cbiAgICB0Q3R4LnN0cm9rZSgpO1xuICAgIFxuICAgIC8vIExhYmVsc1xuICAgIHRDdHguZmlsbFN0eWxlID0gXCIjMzc0MTUxXCI7XG4gICAgdEN0eC5mb250ID0gXCJib2xkIDEycHggc2Fucy1zZXJpZlwiO1xuICAgIFxuICAgIHRDdHgudGV4dEFsaWduID0gXCJsZWZ0XCI7IFxuICAgIHRDdHguZmlsbFRleHQoXCIwXCIsIGJhclgsIGJhclkgKyBiYXJIICsgMTQpO1xuICAgIFxuICAgIHRDdHgudGV4dEFsaWduID0gXCJyaWdodFwiOyBcbiAgICB0Q3R4LmZpbGxUZXh0KFwiMWhcIiwgYmFyWCArIGJhclcsIGJhclkgKyBiYXJIICsgMTQpO1xuICAgIFxuICAgIC8vIENlbnRlciBMYWJlbCAoQ2hhbmdlZCBUZXh0KVxuICAgIHRDdHgudGV4dEFsaWduID0gXCJjZW50ZXJcIjsgXG4gICAgdEN0eC5maWxsU3R5bGUgPSBcIiMzYjgyZjZcIjtcbiAgICB0Q3R4LmZpbGxUZXh0KGAke259IHBow6lwIHRo4butIGxpw6puIHRp4bq/cGAsIHRpbWVXIC8gMiwgYmFyWSAtIDUpO1xuICB9XG5cbiAgZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgIGNvbnN0IG4gPSBmb3JtLnZhbHVlO1xuICAgIGNvbnN0IHAgPSBsYW1iZGEgLyBuOyBcbiAgICBcbiAgICAvLyBVcGRhdGUgU3RhdHNcbiAgICBzdGF0c0Rpdi5pbm5lckhUTUwgPSBgbiA9ICR7bn0gJm5ic3A7fCZuYnNwOyBwID0gJHtwLnRvRml4ZWQoNCl9ICZuYnNwO3wmbmJzcDsgbnAgPSAkeyhuKnApLnRvRml4ZWQoMSl9YDtcblxuICAgIC8vIFVwZGF0ZSBUb3AgQ2FudmFzXG4gICAgZHJhd1RpbWVCaW5zKG4pO1xuXG4gICAgLy8gVXBkYXRlIFBsb3RcbiAgICBjb25zdCBiaW5vbURhdGEgPSBnZXRCaW5vbWlhbERhdGEobiwgcCk7XG4gICAgY29uc3QgY29tYmluZWREYXRhID0gcG9pc3NvbkRhdGEuY29uY2F0KGJpbm9tRGF0YSk7XG4gICAgY29uc3QgeERvbWFpbiA9IEFycmF5LmZyb20oe2xlbmd0aDogMTd9LCAoXywgaSkgPT4gaSk7XG5cbiAgICBjb25zdCBjaGFydCA9IFBsb3QucGxvdCh7XG4gICAgICB3aWR0aDogNjAwLFxuICAgICAgaGVpZ2h0OiAzMjAsXG4gICAgICBtYXJnaW5Ub3A6IDIwLFxuICAgICAgeDogeyBcbiAgICAgICAgdHlwZTogXCJiYW5kXCIsIFxuICAgICAgICBkb21haW46IHhEb21haW4sIFxuICAgICAgICBsYWJlbDogXCJT4buRIHRpbiBuaOG6r24gKGspXCIsXG4gICAgICAgIHBhZGRpbmc6IDAuMVxuICAgICAgfSxcbiAgICAgIHk6IHsgbGFiZWw6IFwiWMOhYyBzdeG6pXRcIiwgZG9tYWluOiBbMCwgMC4yXSB9LFxuICAgICAgbWFya3M6IFtcbiAgICAgICAgLy8gQmlub21pYWwgQmFyc1xuICAgICAgICBQbG90LmJhclkoY29tYmluZWREYXRhLmZpbHRlcihkID0+IGQudHlwZSA9PT0gXCJCaW5vbWlhbFwiKSwge1xuICAgICAgICAgIHg6IFwia1wiLCBcbiAgICAgICAgICB5OiBcInByb2JcIiwgXG4gICAgICAgICAgZmlsbDogXCIjM2I4MmY2XCIsIFxuICAgICAgICAgIGZpbGxPcGFjaXR5OiAwLjYsXG4gICAgICAgICAgdGl0bGU6IGQgPT4gYEJpbm9taWFsOiAke2QucHJvYi50b0ZpeGVkKDQpfWBcbiAgICAgICAgfSksXG4gICAgICAgIC8vIFBvaXNzb24gTGluZVxuICAgICAgICBQbG90LmxpbmUoY29tYmluZWREYXRhLmZpbHRlcihkID0+IGQudHlwZSA9PT0gXCJQb2lzc29uXCIpLCB7XG4gICAgICAgICAgeDogXCJrXCIsIFxuICAgICAgICAgIHk6IFwicHJvYlwiLCBcbiAgICAgICAgICBzdHJva2U6IFwiI2JlMTg1ZFwiLCBcbiAgICAgICAgICBzdHJva2VXaWR0aDogMyxcbiAgICAgICAgICBjdXJ2ZTogXCJtb25vdG9uZS14XCJcbiAgICAgICAgfSksXG4gICAgICAgIC8vIFBvaXNzb24gRG90c1xuICAgICAgICBQbG90LmRvdChjb21iaW5lZERhdGEuZmlsdGVyKGQgPT4gZC50eXBlID09PSBcIlBvaXNzb25cIiksIHtcbiAgICAgICAgICB4OiBcImtcIiwgXG4gICAgICAgICAgeTogXCJwcm9iXCIsIFxuICAgICAgICAgIGZpbGw6IFwiI2JlMTg1ZFwiLFxuICAgICAgICAgIHI6IDRcbiAgICAgICAgfSksXG4gICAgICAgIFBsb3QucnVsZVkoWzBdKVxuICAgICAgXVxuICAgIH0pO1xuXG4gICAgcGxvdENvbnRhaW5lci5pbm5lckhUTUwgPSBcIlwiO1xuICAgIHBsb3RDb250YWluZXIuYXBwZW5kQ2hpbGQoY2hhcnQpO1xuICB9XG5cbiAgZm9ybS5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgdXBkYXRlKTtcbiAgdXBkYXRlKCk7XG5cbiAgcmV0dXJuIHdyYXBwZXI7XG59KSgpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdjb2luX3NpbV9tYW51YWwnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnZ2FsdG9uX3NoYXJwJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2dhbHRvbl9zaW1fZGVuc2UnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnbm9ybWFsX2FwcHJveF9maXhlZF9heGlzJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2FjZV9zaW1fbWFudWFsJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3BvaXNzb25fdmlzdWFsX2ZpbmFsJykifV19
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../..";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "thinhong/s4bvn";
    script.dataset.repoId = "R_kgDOQtVYcQ";
    script.dataset.category = "General";
    script.dataset.categoryId = "DIC_kwDOQtVYcc4C00o0";
    script.dataset.mapping = "title";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./distr.html" class="pagination-link" aria-label="Phân phối xác suất">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Phân phối xác suất</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./distr-bin.html" class="pagination-link" aria-label="Phân phối nhị thức">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Phân phối nhị thức</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>