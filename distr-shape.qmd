---
title: "Hình dạng phân phối"
format: html
---

## Moments

Xác suất của mỗi giá trị trong một phân phối được xác định bằng hàm mật độ xác suất (với biến liên tục) hoặc hàm khối lượng xác suất (với biến rời rạc).

Hình dạng của phân phối là hình dạng của các hàm số này, được xác định bằng những giá trị gọi là mô-men (moment) của hàm. Thuật ngữ này được mượn từ Vật lý: mô-men (hay mô-men lực) còn gọi là lực xoắn, là lực làm quay một vật thể quanh một điểm tựa. Tưởng tượng một cái mỏ lết quay quanh một con ốc.

![](img/moment-physics.svg)

Trong thống kê, moment đo lường vị trí của phân phối so với một điểm mốc. Đối với một biến ngẫu nhiên $X$, moment cấp $n$ quanh điểm $a$ (the $n$-th moment about $a$) là:

$$E[(X - a)^n]$$

Có 2 loại moment:

-   Moment gốc (raw moment, xoay quanh điểm 0): khi $a = 0$, moment là $E[X^n]$.
-   Moment tập trung (central moment, xoay quanh giá trị trung bình): khi $a = E[X]$, moment là $E[(X - E[X])^n]$.

Cấp của moment có thể từ 0 đến $\infty$. Nếu biết hết toàn bộ các moment sẽ có thể vẽ lại chính xác hình dạng của đồ thị phân phối đó. Chúng ta thường quan tâm tới 4 loại moment sau:

| Loại moment | Kí hiệu | Tên thường gọi | Ý nghĩa |
|----|----|----|----|
| Gốc cấp 1 | $E[X]$ | Kỳ vọng (Mean) | Vị trí (tâm của phân phối) |
| Tập trung cấp 2 | $E[(X - E[X])^2]$ | Phương sai (Variance) | Độ phân tán (dữ liệu biến động thế nào) |
| Tập trung cấp 3 | $E[(X - E[X])^3]$ | Độ lệch (Skewness)\* | Tính bất đối xứng (bên nào có đuôi dài hơn) |
| Tập trung cấp 4 | $E[(X - E[X])^4]$ | Độ nhọn (Kurtosis)\* | Độ dày của đuôi |

*Độ lệch và Độ nhọn thường được chuẩn hóa (standardised) bằng cách chia cho độ lệch chuẩn $\sigma$, ý nghĩa là gấp bao nhiêu lần độ lệch chuẩn.

```{r}
#| echo: false
#| message: false
library(plotly)

# 1. SETTINGS
mu <- 2  # The new mean
sigma <- 1

# 2. Define the grid (Shifted to center around the new mean)
# Range is now roughly [mu - 3, mu + 3]
x <- seq(mu - 3, mu + 3, length.out = 100)
y <- seq(mu - 3, mu + 3, length.out = 100)

# 3. Calculate density
# We subtract 'mu' from x and y in the formula
z <- outer(x, y, function(x, y) {
  (1 / (2 * pi * sigma^2)) * exp(-0.5 * ((x - mu)^2 + (y - mu)^2) / sigma^2)
})

# Peak height (constant for standard normal, but good to keep dynamic)
z_peak <- (1 / (2 * pi * sigma^2))

# 4. Create the Plot
plot_ly() |>
  add_surface(x = ~x, y = ~y, z = ~z, 
              colorscale = "Viridis",
              opacity = 0.5,
              showscale = FALSE) |>
  
  # Update the Vertical Line to sit at (2, 2)
  add_trace(
    type = "scatter3d",
    mode = "lines",
    x = c(0, 0),  # Position X = 2
    y = c(0, 0),  # Position Y = 2
    z = c(0, z_peak),
    line = list(color = "blue", width = 5),
    name = "(0, 0)"
  ) |>
  
  add_trace(
    type = "scatter3d",
    mode = "lines",
    x = c(mu, mu),  # Position X = 2
    y = c(mu, mu),  # Position Y = 2
    z = c(0, z_peak),
    line = list(color = "black", width = 5),
    name = "Mean"
  ) |>
  
  layout(
    scene = list(
      xaxis = list(title = "X"),
      yaxis = list(title = "Y"),
      zaxis = list(title = "Density"),
      camera = list(
        eye = list(x = 1.5, y = -1.5, z = 1.2)
      )
    )
  )
```


### Moment gốc cấp 1

Cho biết vị trí trọng tâm của phân phối nằm ở đâu so với điểm 0.

$$E[X] = \frac{\sum^N_{i = 1}x_i}{N} = \sum^N_{i = 1}x_i \mathbb{P}(x_i)$$

### Moment tập trung cấp 2

Cho biết khoảng cách của từng giá trị trong phân phối so với giá trị trung bình. Phép bình phương giúp ngăn chặn các độ lệch âm và dương triệt tiêu lẫn nhau.

$$E[(X - E[X])^2] = E[X^2] - (E[X])^2$$

### Moment tập trung cấp 3

Thường được gọi là Độ lệch (Skewness). Nó phản ánh sự không đối xứng.

$$E\left[\left(\frac{X - E[X]}{\sigma}\right)^3\right]$$

Lũy thừa bậc 3 giữ nguyên dấu (số âm mũ 3 vẫn là âm)

### Moment tập trung cấp 4

Thường được gọi là Độ nhọn (Kurtosis). Tên gọi này bắt nguồn từ tiếng Hy Lạp: κυρτός - kyrtos, nghĩa là "cong, vòm".

$$E\left[\left(\frac{X - E[X]}{\sigma}\right)^4\right]$$

Lũy thừa bậc 4 làm cho những giá trị nhỏ (gần trung bình) trở nên siêu nhỏ, và những giá trị lớn (xa trung bình - outliers) trở nên lớn hơn nhiều lần. Moment này càng lớn thì đuôi của phân phối càng dày, nghĩa là xác suất xảy ra các sự kiện cực đoan càng lớn.

```{r}
library(tidyverse)
library(patchwork) # Great for combining plots

# --- DATA GENERATION ---
# We create a sequence of X values
x_seq <- seq(-6, 6, length.out = 2000)

# Create a data frame with three different densities
df_kurtosis <- data.frame(x = x_seq) |>
  mutate(
    # Reference: Standard Normal (Mesokurtic)
    Normal = dnorm(x, mean = 0, sd = 1),

    # High Kurtosis (Leptokurtic): Using a t-distribution with low df
    # t-dist has heavier tails than normal.
    High_Kurtosis = dt(x, df = 3),

    # Low Kurtosis (Platykurtic): Using a bounded distribution approach
    # A uniform distribution is the extreme version of low kurtosis.
    # To make it look comparable, we use a wider normal and truncate it,
    # or simply use a uniform density scaled to match roughly.
    # A simpler visual proxy for platykurtic is a low-variance uniform:
    Low_Kurtosis = dunif(x, min = -sqrt(3), max = sqrt(3))
  ) |>
  # Reshape for ggplot
  pivot_longer(cols = -x, names_to = "Type", values_to = "Density") |>
  mutate(Type = factor(Type, levels = c("High_Kurtosis", "Normal", "Low_Kurtosis")))

# --- PLOT 1: THE BIG PICTURE ---
p1 <- ggplot(df_kurtosis, aes(x = x, y = Density, color = Type, size = Type)) +
  geom_line() +
  scale_color_manual(values = c("red", "black", "blue")) +
  scale_size_manual(values = c(1.2, 0.8, 1.2)) +
  theme_minimal() +
  labs(title = "1. The Big Picture (Peak vs Shoulders)",
       subtitle = "Notice the red peak is highest, but its 'shoulders' are lower than normal.",
       y = "Probability Density") +
  theme(legend.position = "bottom") +
  coord_cartesian(xlim = c(-5, 5), ylim = c(0, 0.45))


# --- PLOT 2: THE TAIL ZOOM ---
# We use the exact same data, just zoom the coordinates
p2 <- ggplot(df_kurtosis, aes(x = x, y = Density, color = Type, size = Type)) +
  geom_line() +
  scale_color_manual(values = c("red", "black", "blue")) +
  scale_size_manual(values = c(1.5, 0.8, 1.5)) + # Thicker lines for emphasis
  theme_minimal() +
  # IMPORTANT: The zoom focus areas
  coord_cartesian(xlim = c(2.5, 6), ylim = c(0, 0.025)) +
  labs(title = "2. The Tail Zoom (Where outliers live)",
       subtitle = "Crucial: The red line is now HIGHER than the others.",
       y = "", x = "X (Extreme Values)") +
  theme(legend.position = "none",
        axis.text.y = element_blank(),
        panel.grid.minor = element_blank())

# --- COMBINE WITH PATCHWORK ---
final_plot <- p1 + p2 + plot_layout(widths = c(2, 1))

print(final_plot)
```


Estimate

Estimand

Estimator
