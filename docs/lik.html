<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>9&nbsp; Hàm hợp lý – Statistics for babies</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./bayes.html" rel="next">
<link href="./distr-pl.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-832c273f0af7a47d06e59912ec7b3523.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-N2T5TFNFY7"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-N2T5TFNFY7', { 'anonymize_ip': true});
</script>
<script type="module" src="site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./lik.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hàm hợp lý</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Statistics for babies</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prob.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Xác suất</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Phân phối xác suất</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./distr-d.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Phân phối rời rạc</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-bin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Phân phối nhị thức</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-pois.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Phân phối Poisson</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./distr-c.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Phân phối liên tục</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-norm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Phân phối bình thường</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-lnorm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Phân phối log-normal</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-exp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Phân phối mũ</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distr-pl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Phân phối quy tắc lũy thừa</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lik.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hàm hợp lý</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Bayesian</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mcmc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">MCMC</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./unc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Sự không chắc chắn</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./thanks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lời cảm ơn</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tài liệu tham khảo</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#định-nghĩa" id="toc-định-nghĩa" class="nav-link active" data-scroll-target="#định-nghĩa"><span class="header-section-number">9.1</span> Định nghĩa</a></li>
  <li><a href="#đường-cong-hợp-lý" id="toc-đường-cong-hợp-lý" class="nav-link" data-scroll-target="#đường-cong-hợp-lý"><span class="header-section-number">9.2</span> Đường cong hợp lý</a></li>
  <li><a href="#tỉ-số-hợp-lý" id="toc-tỉ-số-hợp-lý" class="nav-link" data-scroll-target="#tỉ-số-hợp-lý"><span class="header-section-number">9.3</span> Tỉ số hợp lý</a></li>
  <li><a href="#phép-kiểm-tỉ-số-hợp-lý" id="toc-phép-kiểm-tỉ-số-hợp-lý" class="nav-link" data-scroll-target="#phép-kiểm-tỉ-số-hợp-lý"><span class="header-section-number">9.4</span> Phép kiểm tỉ số hợp lý</a></li>
  <li><a href="#khoảng-tin-cậy" id="toc-khoảng-tin-cậy" class="nav-link" data-scroll-target="#khoảng-tin-cậy"><span class="header-section-number">9.5</span> Khoảng tin cậy</a></li>
  <li><a href="#tính-định-danh" id="toc-tính-định-danh" class="nav-link" data-scroll-target="#tính-định-danh"><span class="header-section-number">9.6</span> Tính định danh</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hàm hợp lý</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb1" data-startfrom="8" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 7;"><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { createSlider<span class="op">,</span> createButton<span class="op">,</span> injectStyle } <span class="im">from</span> <span class="st">"./_slider.js"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-1" data-nodetype="declaration">

</div>
</div>
</div>
<section id="định-nghĩa" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="định-nghĩa"><span class="header-section-number">9.1</span> Định nghĩa</h2>
<p><span class="math display">\[\mathcal{L}(\theta \mid x) = \mathbb{P}(x \mid \theta)\]</span></p>
<p>Hàm hợp lý (Likelihood function) là xác suất quan sát được dữ liệu <span class="math inline">\(x\)</span> nếu mô hình với tham số <span class="math inline">\(\theta\)</span> là đúng.</p>
<p>Likelihood được sử dụng khi chúng ta <strong>đã có dữ liệu</strong> <span class="math inline">\(x\)</span>, và muốn tìm <span class="math inline">\(\theta\)</span> hợp lý nhất với dữ liệu này.</p>
<p><span class="math inline">\(\mathcal{L}\)</span> không phải là một phân phối xác suất. Chúng ta chỉ có 1 bộ dữ liệu <span class="math inline">\(x\)</span>, nhưng có nhiều giả thiết tham số <span class="math inline">\(\theta\)</span> khác nhau. Như chúng ta đã học, xác suất có điều kiện thực chất là thu nhỏ không gian mẫu.</p>
<p><span class="math display">\[\begin{aligned}
\sum_{\theta} \mathcal{L}(\theta \mid x) &amp;= \sum_{\theta} \mathbb{P}(x \mid \theta) \\
&amp;= \mathbb{P}(x \mid \theta_1) + \mathbb{P}(x \mid \theta_2) + \dots + \mathbb{P}(x \mid \theta_n) \\
&amp;\neq 1
\end{aligned}\]</span></p>
<p>Mỗi số hạng <span class="math inline">\(\mathbb{P}(x \mid \theta_i)\)</span> có mẫu số khác nhau, nên tổng không thể bằng 1.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Tổng xác suất của mọi dữ liệu <span class="math inline">\(x\)</span> trên một tham số <span class="math inline">\(\theta\)</span> cố định thì bằng 1 (<span class="math inline">\(\sum_x \mathbb{P}(x \mid \theta) = 1\)</span>).</li>
<li>Nhưng tổng Likelihood của mọi tham số <span class="math inline">\(\theta\)</span> trên một dữ liệu <span class="math inline">\(x\)</span> cố định thì không bằng 1 (<span class="math inline">\(\sum_\theta \mathcal{L}(\theta \mid x) \neq 1\)</span>).</li>
</ul>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb2" data-startfrom="35" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 34;"><span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>viewof pdf_vs_lik_large <span class="op">=</span> (() <span class="kw">=&gt;</span> {</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 1. MATH</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">lnComb</span>(n<span class="op">,</span> k) {</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (k <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">||</span> k <span class="op">&gt;</span> n) <span class="cf">return</span> <span class="op">-</span><span class="kw">Infinity</span><span class="op">;</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (k <span class="op">===</span> <span class="dv">0</span> <span class="op">||</span> k <span class="op">===</span> n) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> s <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> k<span class="op">;</span> i<span class="op">++</span>) s <span class="op">+=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(n <span class="op">-</span> i) <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(i <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> s<span class="op">;</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">binomPMF</span>(k<span class="op">,</span> n<span class="op">,</span> p) {</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (p <span class="op">&lt;=</span> <span class="dv">0</span>) <span class="cf">return</span> k <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (p <span class="op">&gt;=</span> <span class="dv">1</span>) <span class="cf">return</span> k <span class="op">===</span> n <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="fu">lnComb</span>(n<span class="op">,</span> k) <span class="op">+</span> k <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(p) <span class="op">+</span> (n <span class="op">-</span> k) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="dv">1</span> <span class="op">-</span> p))<span class="op">;</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">binomLogLik</span>(k<span class="op">,</span> n<span class="op">,</span> p) {</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (p <span class="op">&lt;=</span> <span class="dv">0</span>) <span class="cf">return</span> k <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> <span class="op">-</span><span class="kw">Infinity</span><span class="op">;</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (p <span class="op">&gt;=</span> <span class="dv">1</span>) <span class="cf">return</span> k <span class="op">===</span> n <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> <span class="op">-</span><span class="kw">Infinity</span><span class="op">;</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">lnComb</span>(n<span class="op">,</span> k) <span class="op">+</span> k <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(p) <span class="op">+</span> (n <span class="op">-</span> k) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="dv">1</span> <span class="op">-</span> p)<span class="op">;</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 2. WRAPPER</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> wrapper <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`display:flex;flex-direction:column;align-items:center;</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="vs">    width:100%;max-width:960px;margin:0 auto;`</span><span class="op">;</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(<span class="fu">injectStyle</span>())<span class="op">;</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Colors: p = blue, k = red — EVERYWHERE</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> CP <span class="op">=</span> <span class="st">"#3b82f6"</span><span class="op">;</span> <span class="co">// p color</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> CK <span class="op">=</span> <span class="st">"#dc2626"</span><span class="op">;</span> <span class="co">// k color</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 3. FORMULA BOX (Reverted to smaller size)</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formulaBox <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>  formulaBox<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a><span class="vs">    width:100%;padding:16px 20px;border-radius:12px;margin-bottom:14px;</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a><span class="vs">    background:#f8fafc;border:1px solid #e2e8f0;text-align:center;</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-size:16px;line-height:1.9;color:#334155;</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-family:"SF Mono",SFMono-Regular,Menlo,Consolas,monospace;</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(formulaBox)<span class="op">;</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 4. CONTROLS</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> SL <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">n</span> <span class="op">=</span> <span class="fu">createSlider</span>(<span class="st">"n (trials)"</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="st">"#1e293b"</span><span class="op">,</span> <span class="st">"dark"</span>)<span class="op">;</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">p</span> <span class="op">=</span> <span class="fu">createSlider</span>(<span class="st">"p (probability)"</span><span class="op">,</span> <span class="fl">0.01</span><span class="op">,</span> <span class="fl">0.99</span><span class="op">,</span> <span class="fl">0.01</span><span class="op">,</span> <span class="fl">0.60</span><span class="op">,</span> CP<span class="op">,</span> <span class="st">"blue"</span>)<span class="op">;</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">k</span> <span class="op">=</span> <span class="fu">createSlider</span>(<span class="st">"k (observed successes)"</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> CK<span class="op">,</span> <span class="st">"red"</span>)<span class="op">;</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> r1 <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span> r1<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display:flex;gap:20px;width:100%;margin-bottom:10px;"</span><span class="op">;</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>  r1<span class="op">.</span><span class="fu">appendChild</span>(SL<span class="op">.</span><span class="at">n</span><span class="op">.</span><span class="at">el</span>)<span class="op">;</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(r1)<span class="op">;</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> r2 <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span> r2<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display:flex;gap:20px;width:100%;margin-bottom:12px;"</span><span class="op">;</span></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>  r2<span class="op">.</span><span class="fu">appendChild</span>(SL<span class="op">.</span><span class="at">p</span><span class="op">.</span><span class="at">el</span>)<span class="op">;</span> r2<span class="op">.</span><span class="fu">appendChild</span>(SL<span class="op">.</span><span class="at">k</span><span class="op">.</span><span class="at">el</span>)<span class="op">;</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(r2)<span class="op">;</span></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>  <span class="co">// NLL toggle</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> showNLL <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> toggleRow <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>  toggleRow<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display:flex;gap:12px;width:100%;margin-bottom:14px;align-items:center;"</span><span class="op">;</span></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> toggleLabel <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"span"</span>)<span class="op">;</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>  toggleLabel<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"font-size:13px;font-weight:600;color:#64748b;"</span><span class="op">;</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>  toggleLabel<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">"Likelihood panel:"</span><span class="op">;</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> btnLik <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"button"</span>)<span class="op">;</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> btnNLL <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"button"</span>)<span class="op">;</span></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">styleToggle</span>(btn<span class="op">,</span> active<span class="op">,</span> color) {</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>    btn<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`padding:6px 16px;border-radius:8px;font-size:13px;font-weight:700;</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a><span class="vs">      font-family:inherit;cursor:pointer;transition:all 0.15s;</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a><span class="vs">      border:2px solid </span><span class="sc">${</span>color<span class="sc">}</span><span class="vs">;</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a><span class="vs">      background:</span><span class="sc">${</span>active <span class="op">?</span> color <span class="op">:</span> <span class="st">"#fff"</span><span class="sc">}</span><span class="vs">;color:</span><span class="sc">${</span>active <span class="op">?</span> <span class="st">"#fff"</span> <span class="op">:</span> color<span class="sc">}</span><span class="vs">;`</span><span class="op">;</span></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>  btnLik<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">"L(p | k)"</span><span class="op">;</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>  btnNLL<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">"</span><span class="sc">\u2212</span><span class="st">log L(p | k)"</span><span class="op">;</span></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>  toggleRow<span class="op">.</span><span class="fu">appendChild</span>(toggleLabel)<span class="op">;</span> toggleRow<span class="op">.</span><span class="fu">appendChild</span>(btnLik)<span class="op">;</span> toggleRow<span class="op">.</span><span class="fu">appendChild</span>(btnNLL)<span class="op">;</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(toggleRow)<span class="op">;</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>  btnLik<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> { showNLL <span class="op">=</span> <span class="kw">false</span><span class="op">;</span> <span class="fu">updateAll</span>()<span class="op">;</span> })<span class="op">;</span></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>  btnNLL<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> { showNLL <span class="op">=</span> <span class="kw">true</span><span class="op">;</span> <span class="fu">updateAll</span>()<span class="op">;</span> })<span class="op">;</span></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 5. SVG PANELS</span></span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> NS <span class="op">=</span> <span class="st">"http://www.w3.org/2000/svg"</span><span class="op">;</span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> PW <span class="op">=</span> <span class="dv">460</span><span class="op">,</span> PH <span class="op">=</span> <span class="dv">400</span><span class="op">;</span> <span class="co">// Increased height</span></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Increased margins significantly to fit larger fonts</span></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mg_ <span class="op">=</span> { <span class="dt">t</span><span class="op">:</span> <span class="dv">80</span><span class="op">,</span> <span class="dt">r</span><span class="op">:</span> <span class="dv">25</span><span class="op">,</span> <span class="dt">b</span><span class="op">:</span> <span class="dv">80</span><span class="op">,</span> <span class="dt">l</span><span class="op">:</span> <span class="dv">75</span> }<span class="op">;</span></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pw_ <span class="op">=</span> PW <span class="op">-</span> mg_<span class="op">.</span><span class="at">l</span> <span class="op">-</span> mg_<span class="op">.</span><span class="at">r</span><span class="op">,</span> ph_ <span class="op">=</span> PH <span class="op">-</span> mg_<span class="op">.</span><span class="at">t</span> <span class="op">-</span> mg_<span class="op">.</span><span class="at">b</span><span class="op">;</span></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">mkEl</span>(tag<span class="op">,</span> a) {</span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> e <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElementNS</span>(NS<span class="op">,</span> tag)<span class="op">;</span></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (a) <span class="cf">for</span> (<span class="kw">const</span> [k<span class="op">,</span>v] <span class="kw">of</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">entries</span>(a)) e<span class="op">.</span><span class="fu">setAttribute</span>(k<span class="op">,</span>v)<span class="op">;</span></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> e<span class="op">;</span></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">createPanel</span>() {</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> svg <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElementNS</span>(NS<span class="op">,</span> <span class="st">"svg"</span>)<span class="op">;</span></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="vs">`0 0 </span><span class="sc">${</span>PW<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>PH<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"flex:1;min-width:0;border-radius:12px;border:1px solid #e2e8f0;background:#fff;"</span><span class="op">;</span></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>    <span class="co">// HUGE FONTS</span></span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> title <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"text"</span><span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="bu">String</span>(PW <span class="op">/</span> <span class="dv">2</span>)<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"34"</span><span class="op">,</span> <span class="st">"text-anchor"</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="st">"font-size"</span><span class="op">:</span> <span class="st">"26"</span><span class="op">,</span> <span class="st">"font-weight"</span><span class="op">:</span> <span class="st">"700"</span> })<span class="op">;</span></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">appendChild</span>(title)<span class="op">;</span></span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sub <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"text"</span><span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="bu">String</span>(PW <span class="op">/</span> <span class="dv">2</span>)<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"60"</span><span class="op">,</span> <span class="st">"text-anchor"</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="st">"font-size"</span><span class="op">:</span> <span class="st">"18"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"#64748b"</span> })<span class="op">;</span></span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">appendChild</span>(sub)<span class="op">;</span></span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> grids <span class="op">=</span> []<span class="op">;</span> <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">4</span><span class="op">;</span> i<span class="op">++</span>) { svg<span class="op">.</span><span class="fu">appendChild</span>(<span class="fu">mkEl</span>(<span class="st">"line"</span><span class="op">,</span> { <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#f1f5f9"</span><span class="op">,</span> <span class="st">"stroke-width"</span><span class="op">:</span> <span class="st">"1"</span> }))<span class="op">;</span> grids<span class="op">.</span><span class="fu">push</span>(svg<span class="op">.</span><span class="at">lastChild</span>)<span class="op">;</span> }</span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Y-Tick Font 16</span></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yLbls <span class="op">=</span> []<span class="op">;</span> <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">4</span><span class="op">;</span> i<span class="op">++</span>) { svg<span class="op">.</span><span class="fu">appendChild</span>(<span class="fu">mkEl</span>(<span class="st">"text"</span><span class="op">,</span> { <span class="st">"text-anchor"</span><span class="op">:</span> <span class="st">"end"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"#94a3b8"</span><span class="op">,</span> <span class="st">"font-size"</span><span class="op">:</span> <span class="st">"16"</span><span class="op">,</span> <span class="st">"font-family"</span><span class="op">:</span> <span class="st">"'SF Mono',monospace"</span> }))<span class="op">;</span> yLbls<span class="op">.</span><span class="fu">push</span>(svg<span class="op">.</span><span class="at">lastChild</span>)<span class="op">;</span> }</span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> bars <span class="op">=</span> []<span class="op">;</span> <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">31</span><span class="op">;</span> i<span class="op">++</span>) { <span class="kw">const</span> r <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"rect"</span><span class="op">,</span> { <span class="dt">rx</span><span class="op">:</span> <span class="st">"2"</span> })<span class="op">;</span> r<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span> svg<span class="op">.</span><span class="fu">appendChild</span>(r)<span class="op">;</span> bars<span class="op">.</span><span class="fu">push</span>(r)<span class="op">;</span> }</span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pathFill <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"path"</span><span class="op">,</span> { <span class="st">"stroke-width"</span><span class="op">:</span> <span class="st">"0"</span> })<span class="op">;</span> pathFill<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span> svg<span class="op">.</span><span class="fu">appendChild</span>(pathFill)<span class="op">;</span></span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> path <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"path"</span><span class="op">,</span> { <span class="dt">fill</span><span class="op">:</span> <span class="st">"none"</span><span class="op">,</span> <span class="st">"stroke-width"</span><span class="op">:</span> <span class="st">"3"</span> })<span class="op">;</span> path<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span> svg<span class="op">.</span><span class="fu">appendChild</span>(path)<span class="op">;</span></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">appendChild</span>(<span class="fu">mkEl</span>(<span class="st">"line"</span><span class="op">,</span> { <span class="dt">x1</span><span class="op">:</span> <span class="bu">String</span>(mg_<span class="op">.</span><span class="at">l</span>)<span class="op">,</span> <span class="dt">x2</span><span class="op">:</span> <span class="bu">String</span>(mg_<span class="op">.</span><span class="at">l</span>)<span class="op">,</span> <span class="dt">y1</span><span class="op">:</span> <span class="bu">String</span>(mg_<span class="op">.</span><span class="at">t</span>)<span class="op">,</span> <span class="dt">y2</span><span class="op">:</span> <span class="bu">String</span>(mg_<span class="op">.</span><span class="at">t</span> <span class="op">+</span> ph_)<span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#cbd5e1"</span> }))<span class="op">;</span></span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> xAx <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"line"</span><span class="op">,</span> { <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#cbd5e1"</span> })<span class="op">;</span> svg<span class="op">.</span><span class="fu">appendChild</span>(xAx)<span class="op">;</span></span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>    <span class="co">// X-Tick Font 16</span></span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> xTicks <span class="op">=</span> []<span class="op">;</span> <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">31</span><span class="op">;</span> i<span class="op">++</span>) { <span class="kw">const</span> t <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"text"</span><span class="op">,</span> { <span class="st">"text-anchor"</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"#64748b"</span><span class="op">,</span> <span class="st">"font-size"</span><span class="op">:</span> <span class="st">"16"</span><span class="op">,</span> <span class="st">"font-family"</span><span class="op">:</span> <span class="st">"'SF Mono',monospace"</span> })<span class="op">;</span> t<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span> svg<span class="op">.</span><span class="fu">appendChild</span>(t)<span class="op">;</span> xTicks<span class="op">.</span><span class="fu">push</span>(t)<span class="op">;</span> }</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Axis Label Font 18</span></span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> xLabel <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"text"</span><span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="bu">String</span>(mg_<span class="op">.</span><span class="at">l</span> <span class="op">+</span> pw_ <span class="op">/</span> <span class="dv">2</span>)<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="bu">String</span>(PH <span class="op">-</span> <span class="dv">12</span>)<span class="op">,</span> <span class="st">"text-anchor"</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"#64748b"</span><span class="op">,</span> <span class="st">"font-size"</span><span class="op">:</span> <span class="st">"18"</span><span class="op">,</span> <span class="st">"font-weight"</span><span class="op">:</span> <span class="st">"600"</span> })<span class="op">;</span></span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">appendChild</span>(xLabel)<span class="op">;</span></span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Y-axis label (rotated) - Font 18</span></span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yLabel <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"text"</span><span class="op">,</span> { <span class="st">"text-anchor"</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"#64748b"</span><span class="op">,</span> <span class="st">"font-size"</span><span class="op">:</span> <span class="st">"18"</span><span class="op">,</span> <span class="st">"font-weight"</span><span class="op">:</span> <span class="st">"600"</span> })<span class="op">;</span></span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">appendChild</span>(yLabel)<span class="op">;</span></span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Highlight elements (hidden by default)</span></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hlLine <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"line"</span><span class="op">,</span> { <span class="st">"stroke-width"</span><span class="op">:</span> <span class="st">"2"</span><span class="op">,</span> <span class="st">"stroke-dasharray"</span><span class="op">:</span> <span class="st">"5,3"</span> })<span class="op">;</span> hlLine<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span> svg<span class="op">.</span><span class="fu">appendChild</span>(hlLine)<span class="op">;</span></span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hlDot <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"circle"</span><span class="op">,</span> { <span class="dt">r</span><span class="op">:</span> <span class="st">"7"</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#fff"</span><span class="op">,</span> <span class="st">"stroke-width"</span><span class="op">:</span> <span class="st">"2.5"</span> })<span class="op">;</span> hlDot<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span> svg<span class="op">.</span><span class="fu">appendChild</span>(hlDot)<span class="op">;</span></span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hlLabel <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"text"</span><span class="op">,</span> { <span class="st">"text-anchor"</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="st">"font-size"</span><span class="op">:</span> <span class="st">"16"</span><span class="op">,</span> <span class="st">"font-weight"</span><span class="op">:</span> <span class="st">"700"</span> })<span class="op">;</span> hlLabel<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span> svg<span class="op">.</span><span class="fu">appendChild</span>(hlLabel)<span class="op">;</span></span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { svg<span class="op">,</span> title<span class="op">,</span> sub<span class="op">,</span> grids<span class="op">,</span> yLbls<span class="op">,</span> bars<span class="op">,</span> path<span class="op">,</span> pathFill<span class="op">,</span> xAx<span class="op">,</span> xTicks<span class="op">,</span> xLabel<span class="op">,</span> yLabel<span class="op">,</span> hlLine<span class="op">,</span> hlDot<span class="op">,</span> hlLabel }<span class="op">;</span></span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelPDF <span class="op">=</span> <span class="fu">createPanel</span>()<span class="op">;</span></span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelLik <span class="op">=</span> <span class="fu">createPanel</span>()<span class="op">;</span></span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chartRow <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>  chartRow<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display:flex;gap:12px;width:100%;"</span><span class="op">;</span></span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a>  chartRow<span class="op">.</span><span class="fu">appendChild</span>(panelPDF<span class="op">.</span><span class="at">svg</span>)<span class="op">;</span> chartRow<span class="op">.</span><span class="fu">appendChild</span>(panelLik<span class="op">.</span><span class="at">svg</span>)<span class="op">;</span></span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(chartRow)<span class="op">;</span></span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 6. RENDER</span></span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">fmtY</span>(v) { <span class="cf">if</span> (v <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="st">"0"</span><span class="op">;</span> <span class="cf">if</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(v) <span class="op">&gt;</span> <span class="dv">100</span>) <span class="cf">return</span> v<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>)<span class="op">;</span> <span class="cf">if</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(v) <span class="op">&gt;=</span> <span class="dv">10</span>) <span class="cf">return</span> v<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="op">;</span> <span class="cf">if</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(v) <span class="op">&gt;=</span> <span class="dv">1</span>) <span class="cf">return</span> v<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span> <span class="cf">if</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(v) <span class="op">&lt;</span> <span class="fl">0.01</span>) <span class="cf">return</span> v<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="op">;</span> <span class="cf">return</span> v<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span> }</span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">setYLabel</span>(panel<span class="op">,</span> text<span class="op">,</span> color) {</span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> lx <span class="op">=</span> <span class="dv">24</span><span class="op">,</span> ly <span class="op">=</span> mg_<span class="op">.</span><span class="at">t</span> <span class="op">+</span> ph_ <span class="op">/</span> <span class="dv">2</span><span class="op">;</span> <span class="co">// Adjusted lx for larger font</span></span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">yLabel</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span> lx)<span class="op">;</span> panel<span class="op">.</span><span class="at">yLabel</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span> ly)<span class="op">;</span></span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">yLabel</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`rotate(-90,</span><span class="sc">${</span>lx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>ly<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">yLabel</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> color)<span class="op">;</span></span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">yLabel</span><span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> text<span class="op">;</span></span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">renderPDF</span>(panel<span class="op">,</span> n<span class="op">,</span> p<span class="op">,</span> k) {</span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">title</span><span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">"PDF:  P( k | p )"</span><span class="op">;</span></span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">title</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> CP)<span class="op">;</span></span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">sub</span><span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`Fix p = </span><span class="sc">${</span>p<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">, vary k = 0, 1, </span><span class="sc">\u2026</span><span class="vs">, </span><span class="sc">${</span>n<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setYLabel</span>(panel<span class="op">,</span> <span class="st">"P(k)"</span><span class="op">,</span> CP)<span class="op">;</span></span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> vals <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> ki <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> ki <span class="op">&lt;=</span> n<span class="op">;</span> ki<span class="op">++</span>) vals<span class="op">.</span><span class="fu">push</span>(<span class="fu">binomPMF</span>(ki<span class="op">,</span> n<span class="op">,</span> p))<span class="op">;</span></span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> maxVal <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>vals) <span class="op">*</span> <span class="fl">1.25</span> <span class="op">||</span> <span class="fl">0.1</span><span class="op">;</span></span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> baseline <span class="op">=</span> mg_<span class="op">.</span><span class="at">t</span> <span class="op">+</span> ph_<span class="op">;</span></span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sx <span class="op">=</span> ki <span class="kw">=&gt;</span> mg_<span class="op">.</span><span class="at">l</span> <span class="op">+</span> (ki <span class="op">+</span> <span class="fl">0.5</span>) <span class="op">/</span> (n <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> pw_<span class="op">;</span></span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sy <span class="op">=</span> v <span class="kw">=&gt;</span> mg_<span class="op">.</span><span class="at">t</span> <span class="op">+</span> ph_ <span class="op">-</span> (v <span class="op">/</span> maxVal) <span class="op">*</span> ph_<span class="op">;</span></span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> barW <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">4</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">28</span><span class="op">,</span> pw_ <span class="op">/</span> (n <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fl">0.7</span>))<span class="op">;</span></span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">4</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> v <span class="op">=</span> (maxVal <span class="op">/</span> <span class="dv">4</span>) <span class="op">*</span> i<span class="op">,</span> yy <span class="op">=</span> <span class="fu">sy</span>(v)<span class="op">;</span></span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a>      panel<span class="op">.</span><span class="at">grids</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x1"</span><span class="op">,</span> mg_<span class="op">.</span><span class="at">l</span>)<span class="op">;</span> panel<span class="op">.</span><span class="at">grids</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x2"</span><span class="op">,</span> PW <span class="op">-</span> mg_<span class="op">.</span><span class="at">r</span>)<span class="op">;</span></span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a>      panel<span class="op">.</span><span class="at">grids</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y1"</span><span class="op">,</span> yy)<span class="op">;</span> panel<span class="op">.</span><span class="at">grids</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y2"</span><span class="op">,</span> yy)<span class="op">;</span></span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a>      panel<span class="op">.</span><span class="at">yLbls</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span> mg_<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="dv">10</span>)<span class="op">;</span> panel<span class="op">.</span><span class="at">yLbls</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span> yy <span class="op">+</span> <span class="dv">6</span>)<span class="op">;</span></span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a>      panel<span class="op">.</span><span class="at">yLbls</span>[i]<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="fu">fmtY</span>(v)<span class="op">;</span></span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">31</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (i <span class="op">&lt;=</span> n) {</span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> bx <span class="op">=</span> <span class="fu">sx</span>(i) <span class="op">-</span> barW <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> by <span class="op">=</span> <span class="fu">sy</span>(vals[i])<span class="op">;</span></span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">bars</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span> bx)<span class="op">;</span> panel<span class="op">.</span><span class="at">bars</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span> by)<span class="op">;</span></span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">bars</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"width"</span><span class="op">,</span> barW)<span class="op">;</span></span>
<span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">bars</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"height"</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> baseline <span class="op">-</span> by))<span class="op">;</span></span>
<span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">bars</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#93c5fd"</span>)<span class="op">;</span></span>
<span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">bars</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#60a5fa"</span>)<span class="op">;</span></span>
<span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">bars</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"0.5"</span>)<span class="op">;</span></span>
<span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">bars</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="st">"0.55"</span>)<span class="op">;</span></span>
<span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">bars</span>[i]<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> { panel<span class="op">.</span><span class="at">bars</span>[i]<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span> }</span>
<span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">31</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (i <span class="op">&lt;=</span> n) {</span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> step <span class="op">=</span> n <span class="op">&gt;</span> <span class="dv">20</span> <span class="op">?</span> <span class="dv">5</span> <span class="op">:</span> n <span class="op">&gt;</span> <span class="dv">10</span> <span class="op">?</span> <span class="dv">2</span> <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">sx</span>(i))<span class="op">;</span> panel<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span> baseline <span class="op">+</span> <span class="dv">24</span>)<span class="op">;</span></span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> i <span class="op">%</span> step <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> i <span class="op">:</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#64748b"</span>)<span class="op">;</span></span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"400"</span>)<span class="op">;</span></span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> { panel<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span> }</span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">xAx</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x1"</span><span class="op">,</span> mg_<span class="op">.</span><span class="at">l</span>)<span class="op">;</span> panel<span class="op">.</span><span class="at">xAx</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x2"</span><span class="op">,</span> PW <span class="op">-</span> mg_<span class="op">.</span><span class="at">r</span>)<span class="op">;</span></span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">xAx</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y1"</span><span class="op">,</span> baseline)<span class="op">;</span> panel<span class="op">.</span><span class="at">xAx</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y2"</span><span class="op">,</span> baseline)<span class="op">;</span></span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">xLabel</span><span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">"k (number of successes)"</span><span class="op">;</span></span>
<span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">xLabel</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> CK)<span class="op">;</span></span>
<span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">hlDot</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span> panel<span class="op">.</span><span class="at">hlLabel</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span></span>
<span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">hlLine</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span></span>
<span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">path</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span> panel<span class="op">.</span><span class="at">pathFill</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span></span>
<span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">renderLik</span>(panel<span class="op">,</span> n<span class="op">,</span> p<span class="op">,</span> k) {</span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> nll <span class="op">=</span> showNLL<span class="op">;</span></span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">title</span><span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> nll <span class="op">?</span> <span class="st">"Neg Log-Lik:  </span><span class="sc">\u2212</span><span class="st">ln L( p | k )"</span> <span class="op">:</span> <span class="st">"Likelihood:  L( p | k )"</span><span class="op">;</span></span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">title</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> CK)<span class="op">;</span></span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">sub</span><span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`Fix k = </span><span class="sc">${</span>k<span class="sc">}</span><span class="vs">, vary p </span><span class="sc">\u2208</span><span class="vs"> [0, 1]`</span><span class="op">;</span></span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setYLabel</span>(panel<span class="op">,</span> nll <span class="op">?</span> <span class="st">"</span><span class="sc">\u2212</span><span class="st">ln L(p)"</span> <span class="op">:</span> <span class="st">"L(p)"</span><span class="op">,</span> CK)<span class="op">;</span></span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> NPTS <span class="op">=</span> <span class="dv">200</span><span class="op">;</span></span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> curve <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> NPTS<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> pi <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="fl">0.001</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="fl">0.999</span><span class="op">,</span> i <span class="op">/</span> NPTS))<span class="op">;</span></span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a>      curve<span class="op">.</span><span class="fu">push</span>({ <span class="dt">p</span><span class="op">:</span> pi<span class="op">,</span> <span class="dt">v</span><span class="op">:</span> nll <span class="op">?</span> <span class="op">-</span><span class="fu">binomLogLik</span>(k<span class="op">,</span> n<span class="op">,</span> pi) <span class="op">:</span> <span class="fu">binomPMF</span>(k<span class="op">,</span> n<span class="op">,</span> pi) })<span class="op">;</span></span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> minVal<span class="op">,</span> maxVal<span class="op">;</span></span>
<span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (nll) {</span>
<span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a>      minVal <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="op">...</span>curve<span class="op">.</span><span class="fu">map</span>(c <span class="kw">=&gt;</span> c<span class="op">.</span><span class="at">v</span>))<span class="op">;</span></span>
<span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a>      maxVal <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>curve<span class="op">.</span><span class="fu">filter</span>(c <span class="kw">=&gt;</span> <span class="pp">isFinite</span>(c<span class="op">.</span><span class="at">v</span>))<span class="op">.</span><span class="fu">map</span>(c <span class="kw">=&gt;</span> c<span class="op">.</span><span class="at">v</span>))<span class="op">;</span></span>
<span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> range <span class="op">=</span> maxVal <span class="op">-</span> minVal <span class="op">||</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a>      maxVal <span class="op">=</span> minVal <span class="op">+</span> range <span class="op">*</span> <span class="fl">1.2</span><span class="op">;</span></span>
<span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a>      minVal <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a>      maxVal <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>curve<span class="op">.</span><span class="fu">map</span>(c <span class="kw">=&gt;</span> c<span class="op">.</span><span class="at">v</span>)) <span class="op">*</span> <span class="fl">1.25</span> <span class="op">||</span> <span class="fl">0.1</span><span class="op">;</span></span>
<span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> baseline <span class="op">=</span> mg_<span class="op">.</span><span class="at">t</span> <span class="op">+</span> ph_<span class="op">;</span></span>
<span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sx <span class="op">=</span> pi <span class="kw">=&gt;</span> mg_<span class="op">.</span><span class="at">l</span> <span class="op">+</span> pi <span class="op">*</span> pw_<span class="op">;</span></span>
<span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sy <span class="op">=</span> v <span class="kw">=&gt;</span> mg_<span class="op">.</span><span class="at">t</span> <span class="op">+</span> ph_ <span class="op">-</span> ((v <span class="op">-</span> minVal) <span class="op">/</span> ((maxVal <span class="op">-</span> minVal) <span class="op">||</span> <span class="dv">1</span>)) <span class="op">*</span> ph_<span class="op">;</span></span>
<span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">4</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> v <span class="op">=</span> minVal <span class="op">+</span> ((maxVal <span class="op">-</span> minVal) <span class="op">/</span> <span class="dv">4</span>) <span class="op">*</span> i<span class="op">,</span> yy <span class="op">=</span> <span class="fu">sy</span>(v)<span class="op">;</span></span>
<span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a>      panel<span class="op">.</span><span class="at">grids</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x1"</span><span class="op">,</span> mg_<span class="op">.</span><span class="at">l</span>)<span class="op">;</span> panel<span class="op">.</span><span class="at">grids</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x2"</span><span class="op">,</span> PW <span class="op">-</span> mg_<span class="op">.</span><span class="at">r</span>)<span class="op">;</span></span>
<span id="cb2-288"><a href="#cb2-288" aria-hidden="true" tabindex="-1"></a>      panel<span class="op">.</span><span class="at">grids</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y1"</span><span class="op">,</span> yy)<span class="op">;</span> panel<span class="op">.</span><span class="at">grids</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y2"</span><span class="op">,</span> yy)<span class="op">;</span></span>
<span id="cb2-289"><a href="#cb2-289" aria-hidden="true" tabindex="-1"></a>      panel<span class="op">.</span><span class="at">yLbls</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span> mg_<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="dv">10</span>)<span class="op">;</span> panel<span class="op">.</span><span class="at">yLbls</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span> yy <span class="op">+</span> <span class="dv">6</span>)<span class="op">;</span></span>
<span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a>      panel<span class="op">.</span><span class="at">yLbls</span>[i]<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="fu">fmtY</span>(v)<span class="op">;</span></span>
<span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> d <span class="op">=</span> <span class="st">""</span><span class="op">,</span> dFill <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>nll) dFill <span class="op">=</span> <span class="vs">`M</span><span class="sc">${</span><span class="fu">sx</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>baseline<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb2-295"><a href="#cb2-295" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> NPTS<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb2-296"><a href="#cb2-296" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> px <span class="op">=</span> <span class="fu">sx</span>(curve[i]<span class="op">.</span><span class="at">p</span>)<span class="op">,</span> py <span class="op">=</span> <span class="fu">sy</span>(curve[i]<span class="op">.</span><span class="at">v</span>)<span class="op">;</span></span>
<span id="cb2-297"><a href="#cb2-297" aria-hidden="true" tabindex="-1"></a>      d <span class="op">+=</span> (i <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"M"</span> <span class="op">:</span> <span class="st">"L"</span>) <span class="op">+</span> px<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>) <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> py<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb2-298"><a href="#cb2-298" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>nll) dFill <span class="op">+=</span> <span class="vs">`L</span><span class="sc">${</span>px<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>py<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb2-299"><a href="#cb2-299" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-300"><a href="#cb2-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-301"><a href="#cb2-301" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>nll) {</span>
<span id="cb2-302"><a href="#cb2-302" aria-hidden="true" tabindex="-1"></a>      dFill <span class="op">+=</span> <span class="vs">`L</span><span class="sc">${</span><span class="fu">sx</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>baseline<span class="sc">}</span><span class="vs">Z`</span><span class="op">;</span></span>
<span id="cb2-303"><a href="#cb2-303" aria-hidden="true" tabindex="-1"></a>      panel<span class="op">.</span><span class="at">pathFill</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"d"</span><span class="op">,</span> dFill)<span class="op">;</span> panel<span class="op">.</span><span class="at">pathFill</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#fecaca"</span>)<span class="op">;</span></span>
<span id="cb2-304"><a href="#cb2-304" aria-hidden="true" tabindex="-1"></a>      panel<span class="op">.</span><span class="at">pathFill</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="st">"0.3"</span>)<span class="op">;</span> panel<span class="op">.</span><span class="at">pathFill</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb2-305"><a href="#cb2-305" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> { panel<span class="op">.</span><span class="at">pathFill</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span> }</span>
<span id="cb2-306"><a href="#cb2-306" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">path</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"d"</span><span class="op">,</span> d)<span class="op">;</span> panel<span class="op">.</span><span class="at">path</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"stroke"</span><span class="op">,</span> CK)<span class="op">;</span></span>
<span id="cb2-307"><a href="#cb2-307" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">path</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb2-308"><a href="#cb2-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-309"><a href="#cb2-309" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">31</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb2-310"><a href="#cb2-310" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (i <span class="op">&lt;=</span> <span class="dv">10</span>) {</span>
<span id="cb2-311"><a href="#cb2-311" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> pi <span class="op">=</span> i <span class="op">/</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb2-312"><a href="#cb2-312" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">sx</span>(pi))<span class="op">;</span> panel<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span> baseline <span class="op">+</span> <span class="dv">24</span>)<span class="op">;</span></span>
<span id="cb2-313"><a href="#cb2-313" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> i <span class="op">%</span> <span class="dv">2</span> <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> pi<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>) <span class="op">:</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb2-314"><a href="#cb2-314" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#64748b"</span>)<span class="op">;</span> panel<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"400"</span>)<span class="op">;</span></span>
<span id="cb2-315"><a href="#cb2-315" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb2-316"><a href="#cb2-316" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> { panel<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span> }</span>
<span id="cb2-317"><a href="#cb2-317" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-318"><a href="#cb2-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-319"><a href="#cb2-319" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">xAx</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x1"</span><span class="op">,</span> mg_<span class="op">.</span><span class="at">l</span>)<span class="op">;</span> panel<span class="op">.</span><span class="at">xAx</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x2"</span><span class="op">,</span> PW <span class="op">-</span> mg_<span class="op">.</span><span class="at">r</span>)<span class="op">;</span></span>
<span id="cb2-320"><a href="#cb2-320" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">xAx</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y1"</span><span class="op">,</span> baseline)<span class="op">;</span> panel<span class="op">.</span><span class="at">xAx</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y2"</span><span class="op">,</span> baseline)<span class="op">;</span></span>
<span id="cb2-321"><a href="#cb2-321" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">xLabel</span><span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">"p (probability parameter)"</span><span class="op">;</span></span>
<span id="cb2-322"><a href="#cb2-322" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">xLabel</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> CP)<span class="op">;</span></span>
<span id="cb2-323"><a href="#cb2-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-324"><a href="#cb2-324" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">hlLine</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span></span>
<span id="cb2-325"><a href="#cb2-325" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">hlDot</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span></span>
<span id="cb2-326"><a href="#cb2-326" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">hlLabel</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span></span>
<span id="cb2-327"><a href="#cb2-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-328"><a href="#cb2-328" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">31</span><span class="op">;</span> i<span class="op">++</span>) panel<span class="op">.</span><span class="at">bars</span>[i]<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span></span>
<span id="cb2-329"><a href="#cb2-329" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-330"><a href="#cb2-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-331"><a href="#cb2-331" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateFormula</span>(n<span class="op">,</span> p<span class="op">,</span> k) {</span>
<span id="cb2-332"><a href="#cb2-332" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> nmk <span class="op">=</span> n <span class="op">-</span> k<span class="op">;</span></span>
<span id="cb2-333"><a href="#cb2-333" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> omp <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> p)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb2-334"><a href="#cb2-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-335"><a href="#cb2-335" aria-hidden="true" tabindex="-1"></a>    <span class="co">// REVERTED to smaller formula font sizes</span></span>
<span id="cb2-336"><a href="#cb2-336" aria-hidden="true" tabindex="-1"></a>    formulaBox<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb2-337"><a href="#cb2-337" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div style="margin-bottom:6px;font-size:13px;color:#64748b;"&gt;Same formula — different perspective:&lt;/div&gt;</span></span>
<span id="cb2-338"><a href="#cb2-338" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div style="font-size:18px;margin-bottom:12px;"&gt;</span></span>
<span id="cb2-339"><a href="#cb2-339" aria-hidden="true" tabindex="-1"></a><span class="vs">        f(&lt;span style="color:</span><span class="sc">${</span>CK<span class="sc">}</span><span class="vs">;font-weight:700"&gt;k&lt;/span&gt;, &lt;span style="color:</span><span class="sc">${</span>CP<span class="sc">}</span><span class="vs">;font-weight:700"&gt;p&lt;/span&gt;)</span></span>
<span id="cb2-340"><a href="#cb2-340" aria-hidden="true" tabindex="-1"></a><span class="vs">        = C(n, &lt;span style="color:</span><span class="sc">${</span>CK<span class="sc">}</span><span class="vs">"&gt;k&lt;/span&gt;)</span></span>
<span id="cb2-341"><a href="#cb2-341" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span><span class="sc">\u00D7</span><span class="vs"> &lt;span style="color:</span><span class="sc">${</span>CP<span class="sc">}</span><span class="vs">"&gt;p&lt;/span&gt;&lt;sup style="color:</span><span class="sc">${</span>CK<span class="sc">}</span><span class="vs">"&gt;k&lt;/sup&gt;</span></span>
<span id="cb2-342"><a href="#cb2-342" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span><span class="sc">\u00D7</span><span class="vs"> (1 </span><span class="sc">\u2212</span><span class="vs"> &lt;span style="color:</span><span class="sc">${</span>CP<span class="sc">}</span><span class="vs">"&gt;p&lt;/span&gt;)&lt;sup style="color:</span><span class="sc">${</span>CK<span class="sc">}</span><span class="vs">"&gt;n</span><span class="sc">\u2212</span><span class="vs">k&lt;/sup&gt;</span></span>
<span id="cb2-343"><a href="#cb2-343" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb2-344"><a href="#cb2-344" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div style="display:flex;gap:24px;justify-content:center;flex-wrap:wrap;"&gt;</span></span>
<span id="cb2-345"><a href="#cb2-345" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div style="text-align:center;padding:10px 18px;border-radius:8px;background:#eff6ff;border:1px solid #bfdbfe;"&gt;</span></span>
<span id="cb2-346"><a href="#cb2-346" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;div style="font-size:13px;color:</span><span class="sc">${</span>CP<span class="sc">}</span><span class="vs">;font-weight:700;margin-bottom:6px;"&gt;PDF: fix &lt;span style="color:</span><span class="sc">${</span>CP<span class="sc">}</span><span class="vs">"&gt;p = </span><span class="sc">${</span>p<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">&lt;/span&gt;, vary &lt;span style="color:</span><span class="sc">${</span>CK<span class="sc">}</span><span class="vs">"&gt;k&lt;/span&gt;&lt;/div&gt;</span></span>
<span id="cb2-347"><a href="#cb2-347" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;div style="font-size:16px;color:#334155;"&gt;</span></span>
<span id="cb2-348"><a href="#cb2-348" aria-hidden="true" tabindex="-1"></a><span class="vs">            P(&lt;span style="color:</span><span class="sc">${</span>CK<span class="sc">}</span><span class="vs">;font-weight:700"&gt;k&lt;/span&gt;)</span></span>
<span id="cb2-349"><a href="#cb2-349" aria-hidden="true" tabindex="-1"></a><span class="vs">            = C(</span><span class="sc">${</span>n<span class="sc">}</span><span class="vs">, &lt;span style="color:</span><span class="sc">${</span>CK<span class="sc">}</span><span class="vs">;font-weight:700"&gt;k&lt;/span&gt;)</span></span>
<span id="cb2-350"><a href="#cb2-350" aria-hidden="true" tabindex="-1"></a><span class="vs">            </span><span class="sc">\u00D7</span><span class="vs"> </span><span class="sc">${</span>p<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">&lt;sup style="color:</span><span class="sc">${</span>CK<span class="sc">}</span><span class="vs">;font-weight:700"&gt;k&lt;/sup&gt;</span></span>
<span id="cb2-351"><a href="#cb2-351" aria-hidden="true" tabindex="-1"></a><span class="vs">            </span><span class="sc">\u00D7</span><span class="vs"> </span><span class="sc">${</span>omp<span class="sc">}</span><span class="vs">&lt;sup style="font-size:13px"&gt;</span><span class="sc">${</span>n<span class="sc">}\u2212</span><span class="vs">&lt;span style="color:</span><span class="sc">${</span>CK<span class="sc">}</span><span class="vs">;font-weight:700"&gt;k&lt;/span&gt;&lt;/sup&gt;</span></span>
<span id="cb2-352"><a href="#cb2-352" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;/div&gt;</span></span>
<span id="cb2-353"><a href="#cb2-353" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb2-354"><a href="#cb2-354" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div style="text-align:center;padding:10px 18px;border-radius:8px;background:#fef2f2;border:1px solid #fecaca;"&gt;</span></span>
<span id="cb2-355"><a href="#cb2-355" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;div style="font-size:13px;color:</span><span class="sc">${</span>CK<span class="sc">}</span><span class="vs">;font-weight:700;margin-bottom:6px;"&gt;Likelihood: fix &lt;span style="color:</span><span class="sc">${</span>CK<span class="sc">}</span><span class="vs">"&gt;k = </span><span class="sc">${</span>k<span class="sc">}</span><span class="vs">&lt;/span&gt;, vary &lt;span style="color:</span><span class="sc">${</span>CP<span class="sc">}</span><span class="vs">"&gt;p&lt;/span&gt;&lt;/div&gt;</span></span>
<span id="cb2-356"><a href="#cb2-356" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;div style="font-size:16px;color:#334155;"&gt;</span></span>
<span id="cb2-357"><a href="#cb2-357" aria-hidden="true" tabindex="-1"></a><span class="vs">            L(&lt;span style="color:</span><span class="sc">${</span>CP<span class="sc">}</span><span class="vs">;font-weight:700"&gt;p&lt;/span&gt;)</span></span>
<span id="cb2-358"><a href="#cb2-358" aria-hidden="true" tabindex="-1"></a><span class="vs">            = C(</span><span class="sc">${</span>n<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>k<span class="sc">}</span><span class="vs">)</span></span>
<span id="cb2-359"><a href="#cb2-359" aria-hidden="true" tabindex="-1"></a><span class="vs">            </span><span class="sc">\u00D7</span><span class="vs"> &lt;span style="color:</span><span class="sc">${</span>CP<span class="sc">}</span><span class="vs">;font-weight:700"&gt;p&lt;/span&gt;&lt;sup&gt;</span><span class="sc">${</span>k<span class="sc">}</span><span class="vs">&lt;/sup&gt;</span></span>
<span id="cb2-360"><a href="#cb2-360" aria-hidden="true" tabindex="-1"></a><span class="vs">            </span><span class="sc">\u00D7</span><span class="vs"> (1</span><span class="sc">\u2212</span><span class="vs">&lt;span style="color:</span><span class="sc">${</span>CP<span class="sc">}</span><span class="vs">;font-weight:700"&gt;p&lt;/span&gt;)&lt;sup&gt;</span><span class="sc">${</span>nmk<span class="sc">}</span><span class="vs">&lt;/sup&gt;</span></span>
<span id="cb2-361"><a href="#cb2-361" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;/div&gt;</span></span>
<span id="cb2-362"><a href="#cb2-362" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb2-363"><a href="#cb2-363" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb2-364"><a href="#cb2-364" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb2-365"><a href="#cb2-365" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-366"><a href="#cb2-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-367"><a href="#cb2-367" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateAll</span>() {</span>
<span id="cb2-368"><a href="#cb2-368" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> n <span class="op">=</span> SL<span class="op">.</span><span class="at">n</span><span class="op">.</span><span class="fu">val</span>()<span class="op">;</span></span>
<span id="cb2-369"><a href="#cb2-369" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> p <span class="op">=</span> SL<span class="op">.</span><span class="at">p</span><span class="op">.</span><span class="fu">val</span>()<span class="op">;</span></span>
<span id="cb2-370"><a href="#cb2-370" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> k <span class="op">=</span> SL<span class="op">.</span><span class="at">k</span><span class="op">.</span><span class="fu">val</span>()<span class="op">;</span></span>
<span id="cb2-371"><a href="#cb2-371" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (k <span class="op">&gt;</span> n) { SL<span class="op">.</span><span class="at">k</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="at">value</span> <span class="op">=</span> n<span class="op">;</span> SL<span class="op">.</span><span class="at">k</span><span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span> k <span class="op">=</span> n<span class="op">;</span> }</span>
<span id="cb2-372"><a href="#cb2-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-373"><a href="#cb2-373" aria-hidden="true" tabindex="-1"></a>    <span class="fu">styleToggle</span>(btnLik<span class="op">,</span> <span class="op">!</span>showNLL<span class="op">,</span> CK)<span class="op">;</span></span>
<span id="cb2-374"><a href="#cb2-374" aria-hidden="true" tabindex="-1"></a>    <span class="fu">styleToggle</span>(btnNLL<span class="op">,</span> showNLL<span class="op">,</span> CK)<span class="op">;</span></span>
<span id="cb2-375"><a href="#cb2-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-376"><a href="#cb2-376" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateFormula</span>(n<span class="op">,</span> p<span class="op">,</span> k)<span class="op">;</span></span>
<span id="cb2-377"><a href="#cb2-377" aria-hidden="true" tabindex="-1"></a>    <span class="fu">renderPDF</span>(panelPDF<span class="op">,</span> n<span class="op">,</span> p<span class="op">,</span> k)<span class="op">;</span></span>
<span id="cb2-378"><a href="#cb2-378" aria-hidden="true" tabindex="-1"></a>    <span class="fu">renderLik</span>(panelLik<span class="op">,</span> n<span class="op">,</span> p<span class="op">,</span> k)<span class="op">;</span></span>
<span id="cb2-379"><a href="#cb2-379" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-380"><a href="#cb2-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-381"><a href="#cb2-381" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-382"><a href="#cb2-382" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 7. EVENTS</span></span>
<span id="cb2-383"><a href="#cb2-383" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb2-384"><a href="#cb2-384" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">onInput</span>() { SL<span class="op">.</span><span class="at">n</span><span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span> SL<span class="op">.</span><span class="at">p</span><span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span> SL<span class="op">.</span><span class="at">k</span><span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span> <span class="fu">updateAll</span>()<span class="op">;</span> }</span>
<span id="cb2-385"><a href="#cb2-385" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">n</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span> onInput)<span class="op">;</span></span>
<span id="cb2-386"><a href="#cb2-386" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">p</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span> onInput)<span class="op">;</span></span>
<span id="cb2-387"><a href="#cb2-387" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">k</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span> onInput)<span class="op">;</span></span>
<span id="cb2-388"><a href="#cb2-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateAll</span>()<span class="op">;</span></span>
<span id="cb2-389"><a href="#cb2-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-390"><a href="#cb2-390" aria-hidden="true" tabindex="-1"></a>  invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb2-391"><a href="#cb2-391" aria-hidden="true" tabindex="-1"></a>    SL<span class="op">.</span><span class="at">n</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"input"</span><span class="op">,</span> onInput)<span class="op">;</span></span>
<span id="cb2-392"><a href="#cb2-392" aria-hidden="true" tabindex="-1"></a>    SL<span class="op">.</span><span class="at">p</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"input"</span><span class="op">,</span> onInput)<span class="op">;</span></span>
<span id="cb2-393"><a href="#cb2-393" aria-hidden="true" tabindex="-1"></a>    SL<span class="op">.</span><span class="at">k</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"input"</span><span class="op">,</span> onInput)<span class="op">;</span></span>
<span id="cb2-394"><a href="#cb2-394" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb2-395"><a href="#cb2-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-396"><a href="#cb2-396" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="at">value</span> <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb2-397"><a href="#cb2-397" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> wrapper<span class="op">;</span></span>
<span id="cb2-398"><a href="#cb2-398" aria-hidden="true" tabindex="-1"></a>})()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
</div>
</div>
</section>
<section id="đường-cong-hợp-lý" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="đường-cong-hợp-lý"><span class="header-section-number">9.2</span> Đường cong hợp lý</h2>
</section>
<section id="tỉ-số-hợp-lý" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="tỉ-số-hợp-lý"><span class="header-section-number">9.3</span> Tỉ số hợp lý</h2>
<p>Giả sử ta có các mô hình <span class="math inline">\(\theta_1, \theta_2 \dots\)</span> và một bộ dữ liệu <span class="math inline">\(x\)</span>. Để xác định mô hình nào giải thích dữ liệu tốt hơn, ta so sánh khả năng sinh ra dữ liệu <span class="math inline">\(x\)</span> của từng mô hình.</p>
<p>Tỉ số hợp lý (likelihood ratio) được tính bằng cách chia các giá trị likelihood này cho nhau, nhằm định lượng mức độ ủng hộ của dữ liệu đối với mô hình này so với mô hình kia <span class="citation" data-cites="bolker2008">(<a href="references.html#ref-bolker2008" role="doc-biblioref">Bolker 2008</a>)</span>.</p>
<p><span class="math display">\[LR = \frac{\mathcal{L}(\theta_1 \mid x)}{\mathcal{L}(\theta_2 \mid x)}\]</span></p>
<ul>
<li><span class="math inline">\(LR &gt; 1\)</span>: dữ liệu <span class="math inline">\(x\)</span> cho thấy <span class="math inline">\(\theta_1\)</span> hợp lý hơn</li>
<li><span class="math inline">\(LR &lt; 1\)</span>: dữ liệu <span class="math inline">\(x\)</span> cho thấy <span class="math inline">\(\theta_2\)</span> hợp lý hơn</li>
</ul>
</section>
<section id="phép-kiểm-tỉ-số-hợp-lý" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="phép-kiểm-tỉ-số-hợp-lý"><span class="header-section-number">9.4</span> Phép kiểm tỉ số hợp lý</h2>
<p>Phép kiểm tỉ số hợp lý (Likelihood Ratio Test, LRT) is a procedure to compare two models.</p>
<p><span class="math display">\[2 \left[ \text{neglog}(\mathcal{L}_2) - \text{neglog}(\mathcal{L}_1) \right] \sim \chi^2_r\]</span></p>
<p>Với <span class="math inline">\(r\)</span> là số parameter đang ước lượng.</p>
</section>
<section id="khoảng-tin-cậy" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="khoảng-tin-cậy"><span class="header-section-number">9.5</span> Khoảng tin cậy</h2>
<p>Nguyên lý: Tìm tập hợp các giá trị tham số sao cho mô hình fit dữ liệu kém hơn mức tối ưu, nhưng nằm trong giới hạn chấp nhận được.</p>
<p>Theo định lý Wilks, sự chênh lệch log-likelihood tuân theo phân phối Chi-bình phương (<span class="math inline">\(\chi^2\)</span>).</p>
<p><span class="math display">\[2 \left[ \text{NLL}(\theta) - \text{NLL}_{\min} \right] \le \chi^2_k(1-\alpha)\]</span></p>
<p>Với <span class="math inline">\(\text{NLL}_\text{min}\)</span> là điểm cực tiểu của <span class="math inline">\(NLL\)</span> tìm được bằng MLE.</p>
<p><span class="math display">\[\text{NLL}_{\text{cutoff}} = \text{NLL}_{\min} + \frac{\chi^2_k(1-\alpha)}{2}\]</span></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb3" data-startfrom="435" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 434;"><span id="cb3-435"><a href="#cb3-435" aria-hidden="true" tabindex="-1"></a>viewof ci_nll_clipped <span class="op">=</span> (() <span class="kw">=&gt;</span> {</span>
<span id="cb3-436"><a href="#cb3-436" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-437"><a href="#cb3-437" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 1. MATH</span></span>
<span id="cb3-438"><a href="#cb3-438" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-439"><a href="#cb3-439" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">lnComb</span>(n<span class="op">,</span> k) {</span>
<span id="cb3-440"><a href="#cb3-440" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (k <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">||</span> k <span class="op">&gt;</span> n) <span class="cf">return</span> <span class="op">-</span><span class="kw">Infinity</span><span class="op">;</span></span>
<span id="cb3-441"><a href="#cb3-441" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (k <span class="op">===</span> <span class="dv">0</span> <span class="op">||</span> k <span class="op">===</span> n) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-442"><a href="#cb3-442" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> s <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-443"><a href="#cb3-443" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> k<span class="op">;</span> i<span class="op">++</span>) s <span class="op">+=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(n <span class="op">-</span> i) <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(i <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-444"><a href="#cb3-444" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> s<span class="op">;</span></span>
<span id="cb3-445"><a href="#cb3-445" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-446"><a href="#cb3-446" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">binomLogLik</span>(k<span class="op">,</span> n<span class="op">,</span> p) {</span>
<span id="cb3-447"><a href="#cb3-447" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (p <span class="op">&lt;=</span> <span class="dv">0</span>) <span class="cf">return</span> k <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> <span class="op">-</span><span class="kw">Infinity</span><span class="op">;</span></span>
<span id="cb3-448"><a href="#cb3-448" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (p <span class="op">&gt;=</span> <span class="dv">1</span>) <span class="cf">return</span> k <span class="op">===</span> n <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> <span class="op">-</span><span class="kw">Infinity</span><span class="op">;</span></span>
<span id="cb3-449"><a href="#cb3-449" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">lnComb</span>(n<span class="op">,</span> k) <span class="op">+</span> k <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(p) <span class="op">+</span> (n <span class="op">-</span> k) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="dv">1</span> <span class="op">-</span> p)<span class="op">;</span></span>
<span id="cb3-450"><a href="#cb3-450" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-451"><a href="#cb3-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-452"><a href="#cb3-452" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Chi-square PDF (df=1)</span></span>
<span id="cb3-453"><a href="#cb3-453" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">chi2PDF</span>(x) {</span>
<span id="cb3-454"><a href="#cb3-454" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (x <span class="op">&lt;=</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-455"><a href="#cb3-455" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> x <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(x) <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>))<span class="op">;</span></span>
<span id="cb3-456"><a href="#cb3-456" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-457"><a href="#cb3-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-458"><a href="#cb3-458" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Chi-square quantile (df=1)</span></span>
<span id="cb3-459"><a href="#cb3-459" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">normCDF</span>(z) {</span>
<span id="cb3-460"><a href="#cb3-460" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> a1 <span class="op">=</span> <span class="fl">0.254829592</span><span class="op">,</span> a2 <span class="op">=</span> <span class="op">-</span><span class="fl">0.284496736</span><span class="op">,</span> a3 <span class="op">=</span> <span class="fl">1.421413741</span><span class="op">,</span> a4 <span class="op">=</span> <span class="op">-</span><span class="fl">1.453152027</span><span class="op">,</span> a5 <span class="op">=</span> <span class="fl">1.061405429</span><span class="op">,</span> pp <span class="op">=</span> <span class="fl">0.3275911</span><span class="op">;</span></span>
<span id="cb3-461"><a href="#cb3-461" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sign <span class="op">=</span> z <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="op">-</span><span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-462"><a href="#cb3-462" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(z) <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">SQRT2</span><span class="op">;</span></span>
<span id="cb3-463"><a href="#cb3-463" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> t <span class="op">=</span> <span class="fl">1.0</span> <span class="op">/</span> (<span class="fl">1.0</span> <span class="op">+</span> pp <span class="op">*</span> z)<span class="op">;</span></span>
<span id="cb3-464"><a href="#cb3-464" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> y <span class="op">=</span> <span class="fl">1.0</span> <span class="op">-</span> (((((a5 <span class="op">*</span> t <span class="op">+</span> a4) <span class="op">*</span> t) <span class="op">+</span> a3) <span class="op">*</span> t <span class="op">+</span> a2) <span class="op">*</span> t <span class="op">+</span> a1) <span class="op">*</span> t <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="op">-</span>z <span class="op">*</span> z)<span class="op">;</span></span>
<span id="cb3-465"><a href="#cb3-465" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fl">0.5</span> <span class="op">*</span> (<span class="fl">1.0</span> <span class="op">+</span> sign <span class="op">*</span> y)<span class="op">;</span></span>
<span id="cb3-466"><a href="#cb3-466" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-467"><a href="#cb3-467" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">chi2CDF</span>(x) {</span>
<span id="cb3-468"><a href="#cb3-468" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (x <span class="op">&lt;=</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-469"><a href="#cb3-469" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">2</span> <span class="op">*</span> <span class="fu">normCDF</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(x)) <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-470"><a href="#cb3-470" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-471"><a href="#cb3-471" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">chi2Quantile</span>(cl) {</span>
<span id="cb3-472"><a href="#cb3-472" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> lo <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> hi <span class="op">=</span> <span class="dv">30</span><span class="op">;</span></span>
<span id="cb3-473"><a href="#cb3-473" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">80</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-474"><a href="#cb3-474" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> mid <span class="op">=</span> (lo <span class="op">+</span> hi) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb3-475"><a href="#cb3-475" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">chi2CDF</span>(mid) <span class="op">&lt;</span> cl) lo <span class="op">=</span> mid<span class="op">;</span> <span class="cf">else</span> hi <span class="op">=</span> mid<span class="op">;</span></span>
<span id="cb3-476"><a href="#cb3-476" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-477"><a href="#cb3-477" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (lo <span class="op">+</span> hi) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb3-478"><a href="#cb3-478" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-479"><a href="#cb3-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-480"><a href="#cb3-480" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-481"><a href="#cb3-481" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 2. WRAPPER</span></span>
<span id="cb3-482"><a href="#cb3-482" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-483"><a href="#cb3-483" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> wrapper <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb3-484"><a href="#cb3-484" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`display:flex;flex-direction:column;align-items:center;</span></span>
<span id="cb3-485"><a href="#cb3-485" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;</span></span>
<span id="cb3-486"><a href="#cb3-486" aria-hidden="true" tabindex="-1"></a><span class="vs">    width:100%;max-width:960px;margin:0 auto;`</span><span class="op">;</span></span>
<span id="cb3-487"><a href="#cb3-487" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(<span class="fu">injectStyle</span>())<span class="op">;</span></span>
<span id="cb3-488"><a href="#cb3-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-489"><a href="#cb3-489" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> COL <span class="op">=</span> { <span class="dt">nll</span><span class="op">:</span> <span class="st">"#7c3aed"</span><span class="op">,</span> <span class="dt">chi</span><span class="op">:</span> <span class="st">"#dc2626"</span><span class="op">,</span> <span class="dt">ci</span><span class="op">:</span> <span class="st">"#16a34a"</span><span class="op">,</span> <span class="dt">mle</span><span class="op">:</span> <span class="st">"#3b82f6"</span> }<span class="op">;</span></span>
<span id="cb3-490"><a href="#cb3-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-491"><a href="#cb3-491" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-492"><a href="#cb3-492" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 4. CONTROLS</span></span>
<span id="cb3-493"><a href="#cb3-493" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-494"><a href="#cb3-494" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> SL <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb3-495"><a href="#cb3-495" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">n</span>  <span class="op">=</span> <span class="fu">createSlider</span>(<span class="st">"n (trials)"</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="st">"#1e293b"</span><span class="op">,</span> <span class="st">"dark"</span>)<span class="op">;</span></span>
<span id="cb3-496"><a href="#cb3-496" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">k</span>  <span class="op">=</span> <span class="fu">createSlider</span>(<span class="st">"k (successes)"</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="st">"#1e293b"</span><span class="op">,</span> <span class="st">"dark"</span>)<span class="op">;</span></span>
<span id="cb3-497"><a href="#cb3-497" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">cl</span> <span class="op">=</span> <span class="fu">createSlider</span>(<span class="st">"Confidence level"</span><span class="op">,</span> <span class="fl">0.50</span><span class="op">,</span> <span class="fl">0.99</span><span class="op">,</span> <span class="fl">0.01</span><span class="op">,</span> <span class="fl">0.95</span><span class="op">,</span> COL<span class="op">.</span><span class="at">ci</span><span class="op">,</span> <span class="st">"green"</span>)<span class="op">;</span></span>
<span id="cb3-498"><a href="#cb3-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-499"><a href="#cb3-499" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> r1 <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span> r1<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display:flex;gap:20px;width:100%;margin-bottom:10px;"</span><span class="op">;</span></span>
<span id="cb3-500"><a href="#cb3-500" aria-hidden="true" tabindex="-1"></a>  r1<span class="op">.</span><span class="fu">appendChild</span>(SL<span class="op">.</span><span class="at">n</span><span class="op">.</span><span class="at">el</span>)<span class="op">;</span> r1<span class="op">.</span><span class="fu">appendChild</span>(SL<span class="op">.</span><span class="at">k</span><span class="op">.</span><span class="at">el</span>)<span class="op">;</span></span>
<span id="cb3-501"><a href="#cb3-501" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(r1)<span class="op">;</span></span>
<span id="cb3-502"><a href="#cb3-502" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> r2 <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span> r2<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display:flex;gap:20px;width:100%;margin-bottom:16px;"</span><span class="op">;</span></span>
<span id="cb3-503"><a href="#cb3-503" aria-hidden="true" tabindex="-1"></a>  r2<span class="op">.</span><span class="fu">appendChild</span>(SL<span class="op">.</span><span class="at">cl</span><span class="op">.</span><span class="at">el</span>)<span class="op">;</span></span>
<span id="cb3-504"><a href="#cb3-504" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sp <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span> sp<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"flex:1;"</span><span class="op">;</span></span>
<span id="cb3-505"><a href="#cb3-505" aria-hidden="true" tabindex="-1"></a>  r2<span class="op">.</span><span class="fu">appendChild</span>(sp)<span class="op">;</span></span>
<span id="cb3-506"><a href="#cb3-506" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(r2)<span class="op">;</span></span>
<span id="cb3-507"><a href="#cb3-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-508"><a href="#cb3-508" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-509"><a href="#cb3-509" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 5. SVG PANELS</span></span>
<span id="cb3-510"><a href="#cb3-510" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-511"><a href="#cb3-511" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> NS <span class="op">=</span> <span class="st">"http://www.w3.org/2000/svg"</span><span class="op">;</span></span>
<span id="cb3-512"><a href="#cb3-512" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> PW <span class="op">=</span> <span class="dv">460</span><span class="op">,</span> PH <span class="op">=</span> <span class="dv">400</span><span class="op">;</span> <span class="co">// Increased Height</span></span>
<span id="cb3-513"><a href="#cb3-513" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Increased Margins for larger text</span></span>
<span id="cb3-514"><a href="#cb3-514" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mg_ <span class="op">=</span> { <span class="dt">t</span><span class="op">:</span> <span class="dv">90</span><span class="op">,</span> <span class="dt">r</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span> <span class="dt">b</span><span class="op">:</span> <span class="dv">80</span><span class="op">,</span> <span class="dt">l</span><span class="op">:</span> <span class="dv">80</span> }<span class="op">;</span></span>
<span id="cb3-515"><a href="#cb3-515" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pw_ <span class="op">=</span> PW <span class="op">-</span> mg_<span class="op">.</span><span class="at">l</span> <span class="op">-</span> mg_<span class="op">.</span><span class="at">r</span><span class="op">,</span> ph_ <span class="op">=</span> PH <span class="op">-</span> mg_<span class="op">.</span><span class="at">t</span> <span class="op">-</span> mg_<span class="op">.</span><span class="at">b</span><span class="op">;</span></span>
<span id="cb3-516"><a href="#cb3-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-517"><a href="#cb3-517" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">mkEl</span>(tag<span class="op">,</span> a) {</span>
<span id="cb3-518"><a href="#cb3-518" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> e <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElementNS</span>(NS<span class="op">,</span> tag)<span class="op">;</span></span>
<span id="cb3-519"><a href="#cb3-519" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (a) <span class="cf">for</span> (<span class="kw">const</span> [k<span class="op">,</span>v] <span class="kw">of</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">entries</span>(a)) e<span class="op">.</span><span class="fu">setAttribute</span>(k<span class="op">,</span>v)<span class="op">;</span></span>
<span id="cb3-520"><a href="#cb3-520" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> e<span class="op">;</span></span>
<span id="cb3-521"><a href="#cb3-521" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-522"><a href="#cb3-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-523"><a href="#cb3-523" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">createPanel</span>(bg) {</span>
<span id="cb3-524"><a href="#cb3-524" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> svg <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElementNS</span>(NS<span class="op">,</span> <span class="st">"svg"</span>)<span class="op">;</span></span>
<span id="cb3-525"><a href="#cb3-525" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="vs">`0 0 </span><span class="sc">${</span>PW<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>PH<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb3-526"><a href="#cb3-526" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`flex:1;min-width:0;border-radius:12px;border:1px solid #e2e8f0;background:</span><span class="sc">${</span>bg <span class="op">||</span> <span class="st">"#fff"</span><span class="sc">}</span><span class="vs">;`</span><span class="op">;</span></span>
<span id="cb3-527"><a href="#cb3-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-528"><a href="#cb3-528" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1. DEFINE CLIP PATH (To fix the horizontal line issue)</span></span>
<span id="cb3-529"><a href="#cb3-529" aria-hidden="true" tabindex="-1"></a>    <span class="co">// This allows the curve to go "off screen" mathematically, but visually cut at the border.</span></span>
<span id="cb3-530"><a href="#cb3-530" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> defs <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElementNS</span>(NS<span class="op">,</span> <span class="st">"defs"</span>)<span class="op">;</span></span>
<span id="cb3-531"><a href="#cb3-531" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> clipId <span class="op">=</span> <span class="st">"chart-clip-"</span> <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>()<span class="op">.</span><span class="fu">toString</span>(<span class="dv">36</span>)<span class="op">.</span><span class="fu">substr</span>(<span class="dv">2</span><span class="op">,</span><span class="dv">9</span>)<span class="op">;</span></span>
<span id="cb3-532"><a href="#cb3-532" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> clipPath <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElementNS</span>(NS<span class="op">,</span> <span class="st">"clipPath"</span>)<span class="op">;</span></span>
<span id="cb3-533"><a href="#cb3-533" aria-hidden="true" tabindex="-1"></a>    clipPath<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"id"</span><span class="op">,</span> clipId)<span class="op">;</span></span>
<span id="cb3-534"><a href="#cb3-534" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> clipRect <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElementNS</span>(NS<span class="op">,</span> <span class="st">"rect"</span>)<span class="op">;</span></span>
<span id="cb3-535"><a href="#cb3-535" aria-hidden="true" tabindex="-1"></a>    clipRect<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span> mg_<span class="op">.</span><span class="at">l</span>)<span class="op">;</span></span>
<span id="cb3-536"><a href="#cb3-536" aria-hidden="true" tabindex="-1"></a>    clipRect<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span> mg_<span class="op">.</span><span class="at">t</span>)<span class="op">;</span></span>
<span id="cb3-537"><a href="#cb3-537" aria-hidden="true" tabindex="-1"></a>    clipRect<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"width"</span><span class="op">,</span> pw_)<span class="op">;</span></span>
<span id="cb3-538"><a href="#cb3-538" aria-hidden="true" tabindex="-1"></a>    clipRect<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"height"</span><span class="op">,</span> ph_)<span class="op">;</span></span>
<span id="cb3-539"><a href="#cb3-539" aria-hidden="true" tabindex="-1"></a>    clipPath<span class="op">.</span><span class="fu">appendChild</span>(clipRect)<span class="op">;</span></span>
<span id="cb3-540"><a href="#cb3-540" aria-hidden="true" tabindex="-1"></a>    defs<span class="op">.</span><span class="fu">appendChild</span>(clipPath)<span class="op">;</span></span>
<span id="cb3-541"><a href="#cb3-541" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">appendChild</span>(defs)<span class="op">;</span></span>
<span id="cb3-542"><a href="#cb3-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-543"><a href="#cb3-543" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Title Font Size 24</span></span>
<span id="cb3-544"><a href="#cb3-544" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> title <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"text"</span><span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="bu">String</span>(PW <span class="op">/</span> <span class="dv">2</span>)<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"32"</span><span class="op">,</span> <span class="st">"text-anchor"</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="st">"font-size"</span><span class="op">:</span> <span class="st">"24"</span><span class="op">,</span> <span class="st">"font-weight"</span><span class="op">:</span> <span class="st">"700"</span> })<span class="op">;</span></span>
<span id="cb3-545"><a href="#cb3-545" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">appendChild</span>(title)<span class="op">;</span></span>
<span id="cb3-546"><a href="#cb3-546" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Subtitle Font Size 18</span></span>
<span id="cb3-547"><a href="#cb3-547" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sub <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"text"</span><span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="bu">String</span>(PW <span class="op">/</span> <span class="dv">2</span>)<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"58"</span><span class="op">,</span> <span class="st">"text-anchor"</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="st">"font-size"</span><span class="op">:</span> <span class="st">"18"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"#64748b"</span> })<span class="op">;</span></span>
<span id="cb3-548"><a href="#cb3-548" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">appendChild</span>(sub)<span class="op">;</span></span>
<span id="cb3-549"><a href="#cb3-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-550"><a href="#cb3-550" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> grids <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb3-551"><a href="#cb3-551" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++</span>) { svg<span class="op">.</span><span class="fu">appendChild</span>(<span class="fu">mkEl</span>(<span class="st">"line"</span><span class="op">,</span> { <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#f1f5f9"</span><span class="op">,</span> <span class="st">"stroke-width"</span><span class="op">:</span> <span class="st">"1"</span> }))<span class="op">;</span> grids<span class="op">.</span><span class="fu">push</span>(svg<span class="op">.</span><span class="at">lastChild</span>)<span class="op">;</span> }</span>
<span id="cb3-552"><a href="#cb3-552" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Y-Labels Font Size 15</span></span>
<span id="cb3-553"><a href="#cb3-553" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yLbls <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb3-554"><a href="#cb3-554" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++</span>) { svg<span class="op">.</span><span class="fu">appendChild</span>(<span class="fu">mkEl</span>(<span class="st">"text"</span><span class="op">,</span> { <span class="st">"text-anchor"</span><span class="op">:</span> <span class="st">"end"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"#94a3b8"</span><span class="op">,</span> <span class="st">"font-size"</span><span class="op">:</span> <span class="st">"15"</span><span class="op">,</span> <span class="st">"font-family"</span><span class="op">:</span> <span class="st">"'SF Mono',monospace"</span> }))<span class="op">;</span> yLbls<span class="op">.</span><span class="fu">push</span>(svg<span class="op">.</span><span class="at">lastChild</span>)<span class="op">;</span> }</span>
<span id="cb3-555"><a href="#cb3-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-556"><a href="#cb3-556" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Apply Clip Path to curves and fills</span></span>
<span id="cb3-557"><a href="#cb3-557" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> fillPath <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"path"</span><span class="op">,</span> { <span class="st">"stroke-width"</span><span class="op">:</span> <span class="st">"0"</span><span class="op">,</span> <span class="st">"clip-path"</span><span class="op">:</span> <span class="vs">`url(#</span><span class="sc">${</span>clipId<span class="sc">}</span><span class="vs">)`</span> })<span class="op">;</span> </span>
<span id="cb3-558"><a href="#cb3-558" aria-hidden="true" tabindex="-1"></a>    fillPath<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span> svg<span class="op">.</span><span class="fu">appendChild</span>(fillPath)<span class="op">;</span></span>
<span id="cb3-559"><a href="#cb3-559" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-560"><a href="#cb3-560" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> curvePath <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"path"</span><span class="op">,</span> { <span class="dt">fill</span><span class="op">:</span> <span class="st">"none"</span><span class="op">,</span> <span class="st">"stroke-width"</span><span class="op">:</span> <span class="st">"3"</span><span class="op">,</span> <span class="st">"stroke-linejoin"</span><span class="op">:</span> <span class="st">"round"</span><span class="op">,</span> <span class="st">"clip-path"</span><span class="op">:</span> <span class="vs">`url(#</span><span class="sc">${</span>clipId<span class="sc">}</span><span class="vs">)`</span> })<span class="op">;</span> </span>
<span id="cb3-561"><a href="#cb3-561" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">appendChild</span>(curvePath)<span class="op">;</span></span>
<span id="cb3-562"><a href="#cb3-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-563"><a href="#cb3-563" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">appendChild</span>(<span class="fu">mkEl</span>(<span class="st">"line"</span><span class="op">,</span> { <span class="dt">x1</span><span class="op">:</span> <span class="bu">String</span>(mg_<span class="op">.</span><span class="at">l</span>)<span class="op">,</span> <span class="dt">x2</span><span class="op">:</span> <span class="bu">String</span>(mg_<span class="op">.</span><span class="at">l</span>)<span class="op">,</span> <span class="dt">y1</span><span class="op">:</span> <span class="bu">String</span>(mg_<span class="op">.</span><span class="at">t</span>)<span class="op">,</span> <span class="dt">y2</span><span class="op">:</span> <span class="bu">String</span>(mg_<span class="op">.</span><span class="at">t</span> <span class="op">+</span> ph_)<span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#cbd5e1"</span> }))<span class="op">;</span></span>
<span id="cb3-564"><a href="#cb3-564" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> xAx <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"line"</span><span class="op">,</span> { <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#cbd5e1"</span> })<span class="op">;</span> svg<span class="op">.</span><span class="fu">appendChild</span>(xAx)<span class="op">;</span></span>
<span id="cb3-565"><a href="#cb3-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-566"><a href="#cb3-566" aria-hidden="true" tabindex="-1"></a>    <span class="co">// X-Ticks Font Size 15</span></span>
<span id="cb3-567"><a href="#cb3-567" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> xTicks <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb3-568"><a href="#cb3-568" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">20</span><span class="op">;</span> i<span class="op">++</span>) { <span class="kw">const</span> t <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"text"</span><span class="op">,</span> { <span class="st">"text-anchor"</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"#64748b"</span><span class="op">,</span> <span class="st">"font-size"</span><span class="op">:</span> <span class="st">"15"</span><span class="op">,</span> <span class="st">"font-family"</span><span class="op">:</span> <span class="st">"'SF Mono',monospace"</span> })<span class="op">;</span> t<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span> svg<span class="op">.</span><span class="fu">appendChild</span>(t)<span class="op">;</span> xTicks<span class="op">.</span><span class="fu">push</span>(t)<span class="op">;</span> }</span>
<span id="cb3-569"><a href="#cb3-569" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-570"><a href="#cb3-570" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Axis Label Font Size 18</span></span>
<span id="cb3-571"><a href="#cb3-571" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> xLabel <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"text"</span><span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="bu">String</span>(mg_<span class="op">.</span><span class="at">l</span> <span class="op">+</span> pw_ <span class="op">/</span> <span class="dv">2</span>)<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="bu">String</span>(PH <span class="op">-</span> <span class="dv">12</span>)<span class="op">,</span> <span class="st">"text-anchor"</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"#64748b"</span><span class="op">,</span> <span class="st">"font-size"</span><span class="op">:</span> <span class="st">"18"</span><span class="op">,</span> <span class="st">"font-weight"</span><span class="op">:</span> <span class="st">"600"</span> })<span class="op">;</span></span>
<span id="cb3-572"><a href="#cb3-572" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">appendChild</span>(xLabel)<span class="op">;</span></span>
<span id="cb3-573"><a href="#cb3-573" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-574"><a href="#cb3-574" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Y Axis Label Font Size 18</span></span>
<span id="cb3-575"><a href="#cb3-575" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yLabel <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"text"</span><span class="op">,</span> { <span class="st">"text-anchor"</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"#64748b"</span><span class="op">,</span> <span class="st">"font-size"</span><span class="op">:</span> <span class="st">"18"</span><span class="op">,</span> <span class="st">"font-weight"</span><span class="op">:</span> <span class="st">"600"</span> })<span class="op">;</span></span>
<span id="cb3-576"><a href="#cb3-576" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">appendChild</span>(yLabel)<span class="op">;</span></span>
<span id="cb3-577"><a href="#cb3-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-578"><a href="#cb3-578" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { svg<span class="op">,</span> title<span class="op">,</span> sub<span class="op">,</span> grids<span class="op">,</span> yLbls<span class="op">,</span> fillPath<span class="op">,</span> curvePath<span class="op">,</span> xAx<span class="op">,</span> xTicks<span class="op">,</span> xLabel<span class="op">,</span> yLabel<span class="op">,</span> clipId }<span class="op">;</span></span>
<span id="cb3-579"><a href="#cb3-579" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-580"><a href="#cb3-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-581"><a href="#cb3-581" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pNLL <span class="op">=</span> <span class="fu">createPanel</span>(<span class="st">"#fff"</span>)<span class="op">;</span></span>
<span id="cb3-582"><a href="#cb3-582" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pChi <span class="op">=</span> <span class="fu">createPanel</span>(<span class="st">"#fff"</span>)<span class="op">;</span></span>
<span id="cb3-583"><a href="#cb3-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-584"><a href="#cb3-584" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chartRow <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb3-585"><a href="#cb3-585" aria-hidden="true" tabindex="-1"></a>  chartRow<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="st">"display:flex;gap:12px;width:100%;margin-bottom:14px;"</span><span class="op">;</span></span>
<span id="cb3-586"><a href="#cb3-586" aria-hidden="true" tabindex="-1"></a>  chartRow<span class="op">.</span><span class="fu">appendChild</span>(pNLL<span class="op">.</span><span class="at">svg</span>)<span class="op">;</span> chartRow<span class="op">.</span><span class="fu">appendChild</span>(pChi<span class="op">.</span><span class="at">svg</span>)<span class="op">;</span></span>
<span id="cb3-587"><a href="#cb3-587" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="fu">appendChild</span>(chartRow)<span class="op">;</span></span>
<span id="cb3-588"><a href="#cb3-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-589"><a href="#cb3-589" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-590"><a href="#cb3-590" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 6. RENDER HELPERS</span></span>
<span id="cb3-591"><a href="#cb3-591" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-592"><a href="#cb3-592" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">setYLabel</span>(panel<span class="op">,</span> text<span class="op">,</span> color) {</span>
<span id="cb3-593"><a href="#cb3-593" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> lx <span class="op">=</span> <span class="dv">24</span><span class="op">,</span> ly <span class="op">=</span> mg_<span class="op">.</span><span class="at">t</span> <span class="op">+</span> ph_ <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb3-594"><a href="#cb3-594" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">yLabel</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span> lx)<span class="op">;</span> panel<span class="op">.</span><span class="at">yLabel</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span> ly)<span class="op">;</span></span>
<span id="cb3-595"><a href="#cb3-595" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">yLabel</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`rotate(-90,</span><span class="sc">${</span>lx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>ly<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb3-596"><a href="#cb3-596" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">yLabel</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> color)<span class="op">;</span></span>
<span id="cb3-597"><a href="#cb3-597" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">yLabel</span><span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> text<span class="op">;</span></span>
<span id="cb3-598"><a href="#cb3-598" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-599"><a href="#cb3-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-600"><a href="#cb3-600" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">setGrid</span>(panel<span class="op">,</span> minV<span class="op">,</span> maxV<span class="op">,</span> nGrid) {</span>
<span id="cb3-601"><a href="#cb3-601" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> nGrid<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-602"><a href="#cb3-602" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> v <span class="op">=</span> minV <span class="op">+</span> (maxV <span class="op">-</span> minV) <span class="op">/</span> nGrid <span class="op">*</span> i<span class="op">;</span></span>
<span id="cb3-603"><a href="#cb3-603" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> yy <span class="op">=</span> mg_<span class="op">.</span><span class="at">t</span> <span class="op">+</span> ph_ <span class="op">-</span> ((v <span class="op">-</span> minV) <span class="op">/</span> ((maxV <span class="op">-</span> minV) <span class="op">||</span> <span class="dv">1</span>)) <span class="op">*</span> ph_<span class="op">;</span></span>
<span id="cb3-604"><a href="#cb3-604" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (i <span class="op">&lt;</span> panel<span class="op">.</span><span class="at">grids</span><span class="op">.</span><span class="at">length</span>) {</span>
<span id="cb3-605"><a href="#cb3-605" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">grids</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x1"</span><span class="op">,</span> mg_<span class="op">.</span><span class="at">l</span>)<span class="op">;</span> panel<span class="op">.</span><span class="at">grids</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x2"</span><span class="op">,</span> PW <span class="op">-</span> mg_<span class="op">.</span><span class="at">r</span>)<span class="op">;</span></span>
<span id="cb3-606"><a href="#cb3-606" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">grids</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y1"</span><span class="op">,</span> yy)<span class="op">;</span> panel<span class="op">.</span><span class="at">grids</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y2"</span><span class="op">,</span> yy)<span class="op">;</span></span>
<span id="cb3-607"><a href="#cb3-607" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">grids</span>[i]<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb3-608"><a href="#cb3-608" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">yLbls</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span> mg_<span class="op">.</span><span class="at">l</span> <span class="op">-</span> <span class="dv">10</span>)<span class="op">;</span> panel<span class="op">.</span><span class="at">yLbls</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span> yy <span class="op">+</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb3-609"><a href="#cb3-609" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> fmt <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(v) <span class="op">&gt;</span> <span class="dv">10</span> <span class="op">?</span> v<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>) <span class="op">:</span> v<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-610"><a href="#cb3-610" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">yLbls</span>[i]<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> fmt<span class="op">;</span></span>
<span id="cb3-611"><a href="#cb3-611" aria-hidden="true" tabindex="-1"></a>        panel<span class="op">.</span><span class="at">yLbls</span>[i]<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb3-612"><a href="#cb3-612" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-613"><a href="#cb3-613" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-614"><a href="#cb3-614" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> nGrid <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> panel<span class="op">.</span><span class="at">grids</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) { panel<span class="op">.</span><span class="at">grids</span>[i]<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span> panel<span class="op">.</span><span class="at">yLbls</span>[i]<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span> }</span>
<span id="cb3-615"><a href="#cb3-615" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-616"><a href="#cb3-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-617"><a href="#cb3-617" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">setXAxis</span>(panel) {</span>
<span id="cb3-618"><a href="#cb3-618" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> baseline <span class="op">=</span> mg_<span class="op">.</span><span class="at">t</span> <span class="op">+</span> ph_<span class="op">;</span></span>
<span id="cb3-619"><a href="#cb3-619" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">xAx</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x1"</span><span class="op">,</span> mg_<span class="op">.</span><span class="at">l</span>)<span class="op">;</span> panel<span class="op">.</span><span class="at">xAx</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x2"</span><span class="op">,</span> PW <span class="op">-</span> mg_<span class="op">.</span><span class="at">r</span>)<span class="op">;</span></span>
<span id="cb3-620"><a href="#cb3-620" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="at">xAx</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y1"</span><span class="op">,</span> baseline)<span class="op">;</span> panel<span class="op">.</span><span class="at">xAx</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y2"</span><span class="op">,</span> baseline)<span class="op">;</span></span>
<span id="cb3-621"><a href="#cb3-621" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-622"><a href="#cb3-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-623"><a href="#cb3-623" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-624"><a href="#cb3-624" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 7. RENDER NLL (left)</span></span>
<span id="cb3-625"><a href="#cb3-625" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-626"><a href="#cb3-626" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nllHLine <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"line"</span><span class="op">,</span> { <span class="st">"stroke-width"</span><span class="op">:</span> <span class="st">"2"</span><span class="op">,</span> <span class="st">"stroke-dasharray"</span><span class="op">:</span> <span class="st">"6,4"</span> })<span class="op">;</span></span>
<span id="cb3-627"><a href="#cb3-627" aria-hidden="true" tabindex="-1"></a>  pNLL<span class="op">.</span><span class="at">svg</span><span class="op">.</span><span class="fu">appendChild</span>(nllHLine)<span class="op">;</span></span>
<span id="cb3-628"><a href="#cb3-628" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-629"><a href="#cb3-629" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Apply clip-path to the CI Fill area too</span></span>
<span id="cb3-630"><a href="#cb3-630" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nllCIFill <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"path"</span><span class="op">,</span> { <span class="st">"stroke-width"</span><span class="op">:</span> <span class="st">"0"</span><span class="op">,</span> <span class="st">"clip-path"</span><span class="op">:</span> <span class="vs">`url(#</span><span class="sc">${</span>pNLL<span class="op">.</span><span class="at">clipId</span><span class="sc">}</span><span class="vs">)`</span> })<span class="op">;</span> </span>
<span id="cb3-631"><a href="#cb3-631" aria-hidden="true" tabindex="-1"></a>  pNLL<span class="op">.</span><span class="at">svg</span><span class="op">.</span><span class="fu">appendChild</span>(nllCIFill)<span class="op">;</span></span>
<span id="cb3-632"><a href="#cb3-632" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-633"><a href="#cb3-633" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nllMLELine <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"line"</span><span class="op">,</span> { <span class="st">"stroke-width"</span><span class="op">:</span> <span class="st">"2"</span><span class="op">,</span> <span class="st">"stroke-dasharray"</span><span class="op">:</span> <span class="st">"4,3"</span> })<span class="op">;</span> pNLL<span class="op">.</span><span class="at">svg</span><span class="op">.</span><span class="fu">appendChild</span>(nllMLELine)<span class="op">;</span></span>
<span id="cb3-634"><a href="#cb3-634" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nllMLEDot <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"circle"</span><span class="op">,</span> { <span class="dt">r</span><span class="op">:</span> <span class="st">"6"</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#fff"</span><span class="op">,</span> <span class="st">"stroke-width"</span><span class="op">:</span> <span class="st">"2"</span> })<span class="op">;</span> pNLL<span class="op">.</span><span class="at">svg</span><span class="op">.</span><span class="fu">appendChild</span>(nllMLEDot)<span class="op">;</span></span>
<span id="cb3-635"><a href="#cb3-635" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Annotations 16px</span></span>
<span id="cb3-636"><a href="#cb3-636" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nllMLELabel <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"text"</span><span class="op">,</span> { <span class="st">"text-anchor"</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="st">"font-size"</span><span class="op">:</span> <span class="st">"16"</span><span class="op">,</span> <span class="st">"font-weight"</span><span class="op">:</span> <span class="st">"700"</span> })<span class="op">;</span> pNLL<span class="op">.</span><span class="at">svg</span><span class="op">.</span><span class="fu">appendChild</span>(nllMLELabel)<span class="op">;</span></span>
<span id="cb3-637"><a href="#cb3-637" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nllCILLine <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"line"</span><span class="op">,</span> { <span class="st">"stroke-width"</span><span class="op">:</span> <span class="st">"2"</span><span class="op">,</span> <span class="st">"stroke-dasharray"</span><span class="op">:</span> <span class="st">"4,3"</span> })<span class="op">;</span> pNLL<span class="op">.</span><span class="at">svg</span><span class="op">.</span><span class="fu">appendChild</span>(nllCILLine)<span class="op">;</span></span>
<span id="cb3-638"><a href="#cb3-638" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nllCIRLine <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"line"</span><span class="op">,</span> { <span class="st">"stroke-width"</span><span class="op">:</span> <span class="st">"2"</span><span class="op">,</span> <span class="st">"stroke-dasharray"</span><span class="op">:</span> <span class="st">"4,3"</span> })<span class="op">;</span> pNLL<span class="op">.</span><span class="at">svg</span><span class="op">.</span><span class="fu">appendChild</span>(nllCIRLine)<span class="op">;</span></span>
<span id="cb3-639"><a href="#cb3-639" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nllCILLabel <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"text"</span><span class="op">,</span> { <span class="st">"text-anchor"</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="st">"font-size"</span><span class="op">:</span> <span class="st">"16"</span><span class="op">,</span> <span class="st">"font-weight"</span><span class="op">:</span> <span class="st">"700"</span> })<span class="op">;</span> pNLL<span class="op">.</span><span class="at">svg</span><span class="op">.</span><span class="fu">appendChild</span>(nllCILLabel)<span class="op">;</span></span>
<span id="cb3-640"><a href="#cb3-640" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nllCIRLabel <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"text"</span><span class="op">,</span> { <span class="st">"text-anchor"</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="st">"font-size"</span><span class="op">:</span> <span class="st">"16"</span><span class="op">,</span> <span class="st">"font-weight"</span><span class="op">:</span> <span class="st">"700"</span> })<span class="op">;</span> pNLL<span class="op">.</span><span class="at">svg</span><span class="op">.</span><span class="fu">appendChild</span>(nllCIRLabel)<span class="op">;</span></span>
<span id="cb3-641"><a href="#cb3-641" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nllCutLabel <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"text"</span><span class="op">,</span> { <span class="st">"text-anchor"</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span> <span class="st">"font-size"</span><span class="op">:</span> <span class="st">"16"</span><span class="op">,</span> <span class="st">"font-weight"</span><span class="op">:</span> <span class="st">"600"</span> })<span class="op">;</span> pNLL<span class="op">.</span><span class="at">svg</span><span class="op">.</span><span class="fu">appendChild</span>(nllCutLabel)<span class="op">;</span></span>
<span id="cb3-642"><a href="#cb3-642" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nllBracket <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"line"</span><span class="op">,</span> { <span class="st">"stroke-width"</span><span class="op">:</span> <span class="st">"3"</span><span class="op">,</span> <span class="st">"stroke-linecap"</span><span class="op">:</span> <span class="st">"round"</span> })<span class="op">;</span> pNLL<span class="op">.</span><span class="at">svg</span><span class="op">.</span><span class="fu">appendChild</span>(nllBracket)<span class="op">;</span></span>
<span id="cb3-643"><a href="#cb3-643" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nllBracketLabel <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"text"</span><span class="op">,</span> { <span class="st">"text-anchor"</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="st">"font-size"</span><span class="op">:</span> <span class="st">"16"</span><span class="op">,</span> <span class="st">"font-weight"</span><span class="op">:</span> <span class="st">"700"</span> })<span class="op">;</span> pNLL<span class="op">.</span><span class="at">svg</span><span class="op">.</span><span class="fu">appendChild</span>(nllBracketLabel)<span class="op">;</span></span>
<span id="cb3-644"><a href="#cb3-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-645"><a href="#cb3-645" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">renderNLL</span>(n<span class="op">,</span> k<span class="op">,</span> cl) {</span>
<span id="cb3-646"><a href="#cb3-646" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chiQ <span class="op">=</span> <span class="fu">chi2Quantile</span>(cl)<span class="op">;</span></span>
<span id="cb3-647"><a href="#cb3-647" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cutoff <span class="op">=</span> chiQ <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb3-648"><a href="#cb3-648" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> mle <span class="op">=</span> n <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> k <span class="op">/</span> n <span class="op">:</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb3-649"><a href="#cb3-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-650"><a href="#cb3-650" aria-hidden="true" tabindex="-1"></a>    pNLL<span class="op">.</span><span class="at">title</span><span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">"Negative Log-Likelihood"</span><span class="op">;</span></span>
<span id="cb3-651"><a href="#cb3-651" aria-hidden="true" tabindex="-1"></a>    pNLL<span class="op">.</span><span class="at">title</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">nll</span>)<span class="op">;</span></span>
<span id="cb3-652"><a href="#cb3-652" aria-hidden="true" tabindex="-1"></a>    pNLL<span class="op">.</span><span class="at">sub</span><span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`n = </span><span class="sc">${</span>n<span class="sc">}</span><span class="vs">,  k = </span><span class="sc">${</span>k<span class="sc">}</span><span class="vs">,  p</span><span class="sc">\u0302</span><span class="vs"> = </span><span class="sc">${</span>mle<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb3-653"><a href="#cb3-653" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setYLabel</span>(pNLL<span class="op">,</span> <span class="st">"</span><span class="sc">\u2212</span><span class="st">ln L(p) + const"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">nll</span>)<span class="op">;</span></span>
<span id="cb3-654"><a href="#cb3-654" aria-hidden="true" tabindex="-1"></a>    pNLL<span class="op">.</span><span class="at">xLabel</span><span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">"p"</span><span class="op">;</span> pNLL<span class="op">.</span><span class="at">xLabel</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">nll</span>)<span class="op">;</span></span>
<span id="cb3-655"><a href="#cb3-655" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setXAxis</span>(pNLL)<span class="op">;</span></span>
<span id="cb3-656"><a href="#cb3-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-657"><a href="#cb3-657" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> NPTS <span class="op">=</span> <span class="dv">300</span><span class="op">;</span></span>
<span id="cb3-658"><a href="#cb3-658" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> curve <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb3-659"><a href="#cb3-659" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pMin <span class="op">=</span> <span class="fl">0.001</span><span class="op">,</span> pMax <span class="op">=</span> <span class="fl">0.999</span><span class="op">;</span></span>
<span id="cb3-660"><a href="#cb3-660" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> nllMLE <span class="op">=</span> <span class="op">-</span><span class="fu">binomLogLik</span>(k<span class="op">,</span> n<span class="op">,</span> mle)<span class="op">;</span></span>
<span id="cb3-661"><a href="#cb3-661" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> NPTS<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-662"><a href="#cb3-662" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> p <span class="op">=</span> pMin <span class="op">+</span> (pMax <span class="op">-</span> pMin) <span class="op">*</span> i <span class="op">/</span> NPTS<span class="op">;</span></span>
<span id="cb3-663"><a href="#cb3-663" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> nll <span class="op">=</span> <span class="op">-</span><span class="fu">binomLogLik</span>(k<span class="op">,</span> n<span class="op">,</span> p) <span class="op">-</span> nllMLE<span class="op">;</span></span>
<span id="cb3-664"><a href="#cb3-664" aria-hidden="true" tabindex="-1"></a>      curve<span class="op">.</span><span class="fu">push</span>({ p<span class="op">,</span> nll })<span class="op">;</span></span>
<span id="cb3-665"><a href="#cb3-665" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-666"><a href="#cb3-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-667"><a href="#cb3-667" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yMax <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(cutoff <span class="op">*</span> <span class="fl">2.5</span><span class="op">,</span> <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb3-668"><a href="#cb3-668" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yMin <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-669"><a href="#cb3-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-670"><a href="#cb3-670" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setGrid</span>(pNLL<span class="op">,</span> yMin<span class="op">,</span> yMax<span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb3-671"><a href="#cb3-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-672"><a href="#cb3-672" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> baseline <span class="op">=</span> mg_<span class="op">.</span><span class="at">t</span> <span class="op">+</span> ph_<span class="op">;</span></span>
<span id="cb3-673"><a href="#cb3-673" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sx <span class="op">=</span> p <span class="kw">=&gt;</span> mg_<span class="op">.</span><span class="at">l</span> <span class="op">+</span> ((p <span class="op">-</span> pMin) <span class="op">/</span> (pMax <span class="op">-</span> pMin)) <span class="op">*</span> pw_<span class="op">;</span></span>
<span id="cb3-674"><a href="#cb3-674" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sy <span class="op">=</span> v <span class="kw">=&gt;</span> mg_<span class="op">.</span><span class="at">t</span> <span class="op">+</span> ph_ <span class="op">-</span> ((v <span class="op">-</span> yMin) <span class="op">/</span> (yMax <span class="op">-</span> yMin)) <span class="op">*</span> ph_<span class="op">;</span></span>
<span id="cb3-675"><a href="#cb3-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-676"><a href="#cb3-676" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">20</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-677"><a href="#cb3-677" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (i <span class="op">&lt;=</span> <span class="dv">10</span>) {</span>
<span id="cb3-678"><a href="#cb3-678" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> v <span class="op">=</span> i <span class="op">/</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb3-679"><a href="#cb3-679" aria-hidden="true" tabindex="-1"></a>        pNLL<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">sx</span>(v))<span class="op">;</span> pNLL<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span> baseline <span class="op">+</span> <span class="dv">24</span>)<span class="op">;</span></span>
<span id="cb3-680"><a href="#cb3-680" aria-hidden="true" tabindex="-1"></a>        pNLL<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> i <span class="op">%</span> <span class="dv">2</span> <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> v<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>) <span class="op">:</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb3-681"><a href="#cb3-681" aria-hidden="true" tabindex="-1"></a>        pNLL<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb3-682"><a href="#cb3-682" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> { pNLL<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span> }</span>
<span id="cb3-683"><a href="#cb3-683" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-684"><a href="#cb3-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-685"><a href="#cb3-685" aria-hidden="true" tabindex="-1"></a>    <span class="co">// DRAW CURVE (No Math.min clamping, rely on ClipPath)</span></span>
<span id="cb3-686"><a href="#cb3-686" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> d <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb3-687"><a href="#cb3-687" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> NPTS<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-688"><a href="#cb3-688" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> px <span class="op">=</span> <span class="fu">sx</span>(curve[i]<span class="op">.</span><span class="at">p</span>)<span class="op">;</span></span>
<span id="cb3-689"><a href="#cb3-689" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> py <span class="op">=</span> <span class="fu">sy</span>(curve[i]<span class="op">.</span><span class="at">nll</span>)<span class="op">;</span> <span class="co">// Just plot the true value!</span></span>
<span id="cb3-690"><a href="#cb3-690" aria-hidden="true" tabindex="-1"></a>      d <span class="op">+=</span> (i <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"M"</span> <span class="op">:</span> <span class="st">"L"</span>) <span class="op">+</span> px<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>) <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> py<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-691"><a href="#cb3-691" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-692"><a href="#cb3-692" aria-hidden="true" tabindex="-1"></a>    pNLL<span class="op">.</span><span class="at">curvePath</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"d"</span><span class="op">,</span> d)<span class="op">;</span> pNLL<span class="op">.</span><span class="at">curvePath</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"stroke"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">nll</span>)<span class="op">;</span></span>
<span id="cb3-693"><a href="#cb3-693" aria-hidden="true" tabindex="-1"></a>    pNLL<span class="op">.</span><span class="at">fillPath</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span></span>
<span id="cb3-694"><a href="#cb3-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-695"><a href="#cb3-695" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> mleX <span class="op">=</span> <span class="fu">sx</span>(mle)<span class="op">,</span> mleY <span class="op">=</span> <span class="fu">sy</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb3-696"><a href="#cb3-696" aria-hidden="true" tabindex="-1"></a>    nllMLELine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x1"</span><span class="op">,</span> mleX)<span class="op">;</span> nllMLELine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x2"</span><span class="op">,</span> mleX)<span class="op">;</span></span>
<span id="cb3-697"><a href="#cb3-697" aria-hidden="true" tabindex="-1"></a>    nllMLELine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y1"</span><span class="op">,</span> <span class="fu">sy</span>(<span class="dv">0</span>))<span class="op">;</span> nllMLELine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y2"</span><span class="op">,</span> baseline)<span class="op">;</span></span>
<span id="cb3-698"><a href="#cb3-698" aria-hidden="true" tabindex="-1"></a>    nllMLELine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"stroke"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">mle</span>)<span class="op">;</span></span>
<span id="cb3-699"><a href="#cb3-699" aria-hidden="true" tabindex="-1"></a>    nllMLEDot<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"cx"</span><span class="op">,</span> mleX)<span class="op">;</span> nllMLEDot<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"cy"</span><span class="op">,</span> mleY)<span class="op">;</span></span>
<span id="cb3-700"><a href="#cb3-700" aria-hidden="true" tabindex="-1"></a>    nllMLEDot<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">mle</span>)<span class="op">;</span></span>
<span id="cb3-701"><a href="#cb3-701" aria-hidden="true" tabindex="-1"></a>    nllMLELabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span> mleX)<span class="op">;</span> nllMLELabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span> mleY <span class="op">-</span> <span class="dv">16</span>)<span class="op">;</span></span>
<span id="cb3-702"><a href="#cb3-702" aria-hidden="true" tabindex="-1"></a>    nllMLELabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">mle</span>)<span class="op">;</span></span>
<span id="cb3-703"><a href="#cb3-703" aria-hidden="true" tabindex="-1"></a>    nllMLELabel<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`p</span><span class="sc">\u0302</span><span class="vs"> = </span><span class="sc">${</span>mle<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb3-704"><a href="#cb3-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-705"><a href="#cb3-705" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cutY <span class="op">=</span> <span class="fu">sy</span>(cutoff)<span class="op">;</span></span>
<span id="cb3-706"><a href="#cb3-706" aria-hidden="true" tabindex="-1"></a>    nllHLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x1"</span><span class="op">,</span> mg_<span class="op">.</span><span class="at">l</span>)<span class="op">;</span> nllHLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x2"</span><span class="op">,</span> PW <span class="op">-</span> mg_<span class="op">.</span><span class="at">r</span>)<span class="op">;</span></span>
<span id="cb3-707"><a href="#cb3-707" aria-hidden="true" tabindex="-1"></a>    nllHLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y1"</span><span class="op">,</span> cutY)<span class="op">;</span> nllHLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y2"</span><span class="op">,</span> cutY)<span class="op">;</span></span>
<span id="cb3-708"><a href="#cb3-708" aria-hidden="true" tabindex="-1"></a>    nllHLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"stroke"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">ci</span>)<span class="op">;</span></span>
<span id="cb3-709"><a href="#cb3-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-710"><a href="#cb3-710" aria-hidden="true" tabindex="-1"></a>    nllCutLabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span> PW <span class="op">-</span> mg_<span class="op">.</span><span class="at">r</span> <span class="op">-</span> <span class="dv">2</span>)<span class="op">;</span> nllCutLabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span> cutY <span class="op">-</span> <span class="dv">8</span>)<span class="op">;</span></span>
<span id="cb3-711"><a href="#cb3-711" aria-hidden="true" tabindex="-1"></a>    nllCutLabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"end"</span>)<span class="op">;</span></span>
<span id="cb3-712"><a href="#cb3-712" aria-hidden="true" tabindex="-1"></a>    nllCutLabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">ci</span>)<span class="op">;</span></span>
<span id="cb3-713"><a href="#cb3-713" aria-hidden="true" tabindex="-1"></a>    nllCutLabel<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">\u03C7\u00B2</span><span class="vs"> / 2 = </span><span class="sc">${</span>cutoff<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb3-714"><a href="#cb3-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-715"><a href="#cb3-715" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> ciLo <span class="op">=</span> pMin<span class="op">,</span> ciHi <span class="op">=</span> pMax<span class="op">;</span></span>
<span id="cb3-716"><a href="#cb3-716" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb3-717"><a href="#cb3-717" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> lo <span class="op">=</span> pMin<span class="op">,</span> hi <span class="op">=</span> mle<span class="op">;</span></span>
<span id="cb3-718"><a href="#cb3-718" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (<span class="kw">let</span> iter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> iter <span class="op">&lt;</span> <span class="dv">80</span><span class="op">;</span> iter<span class="op">++</span>) {</span>
<span id="cb3-719"><a href="#cb3-719" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> mid <span class="op">=</span> (lo <span class="op">+</span> hi) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb3-720"><a href="#cb3-720" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> nll <span class="op">=</span> <span class="op">-</span><span class="fu">binomLogLik</span>(k<span class="op">,</span> n<span class="op">,</span> mid) <span class="op">-</span> nllMLE<span class="op">;</span></span>
<span id="cb3-721"><a href="#cb3-721" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (nll <span class="op">&gt;</span> cutoff) lo <span class="op">=</span> mid<span class="op">;</span> <span class="cf">else</span> hi <span class="op">=</span> mid<span class="op">;</span></span>
<span id="cb3-722"><a href="#cb3-722" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-723"><a href="#cb3-723" aria-hidden="true" tabindex="-1"></a>      ciLo <span class="op">=</span> (lo <span class="op">+</span> hi) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb3-724"><a href="#cb3-724" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-725"><a href="#cb3-725" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb3-726"><a href="#cb3-726" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> lo <span class="op">=</span> mle<span class="op">,</span> hi <span class="op">=</span> pMax<span class="op">;</span></span>
<span id="cb3-727"><a href="#cb3-727" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (<span class="kw">let</span> iter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> iter <span class="op">&lt;</span> <span class="dv">80</span><span class="op">;</span> iter<span class="op">++</span>) {</span>
<span id="cb3-728"><a href="#cb3-728" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> mid <span class="op">=</span> (lo <span class="op">+</span> hi) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb3-729"><a href="#cb3-729" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> nll <span class="op">=</span> <span class="op">-</span><span class="fu">binomLogLik</span>(k<span class="op">,</span> n<span class="op">,</span> mid) <span class="op">-</span> nllMLE<span class="op">;</span></span>
<span id="cb3-730"><a href="#cb3-730" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (nll <span class="op">&gt;</span> cutoff) hi <span class="op">=</span> mid<span class="op">;</span> <span class="cf">else</span> lo <span class="op">=</span> mid<span class="op">;</span></span>
<span id="cb3-731"><a href="#cb3-731" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-732"><a href="#cb3-732" aria-hidden="true" tabindex="-1"></a>      ciHi <span class="op">=</span> (lo <span class="op">+</span> hi) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb3-733"><a href="#cb3-733" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-734"><a href="#cb3-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-735"><a href="#cb3-735" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> dFill <span class="op">=</span> <span class="vs">`M</span><span class="sc">${</span><span class="fu">sx</span>(ciLo)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>baseline<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb3-736"><a href="#cb3-736" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> NPTS<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-737"><a href="#cb3-737" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (curve[i]<span class="op">.</span><span class="at">p</span> <span class="op">&gt;=</span> ciLo <span class="op">&amp;&amp;</span> curve[i]<span class="op">.</span><span class="at">p</span> <span class="op">&lt;=</span> ciHi) {</span>
<span id="cb3-738"><a href="#cb3-738" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Use true value, let clip-path handle the cutoff top</span></span>
<span id="cb3-739"><a href="#cb3-739" aria-hidden="true" tabindex="-1"></a>        dFill <span class="op">+=</span> <span class="vs">`L</span><span class="sc">${</span><span class="fu">sx</span>(curve[i]<span class="op">.</span><span class="at">p</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span><span class="fu">sy</span>(curve[i]<span class="op">.</span><span class="at">nll</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb3-740"><a href="#cb3-740" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-741"><a href="#cb3-741" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-742"><a href="#cb3-742" aria-hidden="true" tabindex="-1"></a>    dFill <span class="op">+=</span> <span class="vs">`L</span><span class="sc">${</span><span class="fu">sx</span>(ciHi)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>baseline<span class="sc">}</span><span class="vs">Z`</span><span class="op">;</span></span>
<span id="cb3-743"><a href="#cb3-743" aria-hidden="true" tabindex="-1"></a>    nllCIFill<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"d"</span><span class="op">,</span> dFill)<span class="op">;</span></span>
<span id="cb3-744"><a href="#cb3-744" aria-hidden="true" tabindex="-1"></a>    nllCIFill<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">ci</span>)<span class="op">;</span> nllCIFill<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="st">"0.12"</span>)<span class="op">;</span></span>
<span id="cb3-745"><a href="#cb3-745" aria-hidden="true" tabindex="-1"></a>    nllCIFill<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb3-746"><a href="#cb3-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-747"><a href="#cb3-747" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cLoX <span class="op">=</span> <span class="fu">sx</span>(ciLo)<span class="op">,</span> cHiX <span class="op">=</span> <span class="fu">sx</span>(ciHi)<span class="op">;</span></span>
<span id="cb3-748"><a href="#cb3-748" aria-hidden="true" tabindex="-1"></a>    nllCILLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x1"</span><span class="op">,</span> cLoX)<span class="op">;</span> nllCILLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x2"</span><span class="op">,</span> cLoX)<span class="op">;</span></span>
<span id="cb3-749"><a href="#cb3-749" aria-hidden="true" tabindex="-1"></a>    nllCILLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y1"</span><span class="op">,</span> cutY)<span class="op">;</span> nllCILLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y2"</span><span class="op">,</span> baseline)<span class="op">;</span></span>
<span id="cb3-750"><a href="#cb3-750" aria-hidden="true" tabindex="-1"></a>    nllCILLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"stroke"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">ci</span>)<span class="op">;</span></span>
<span id="cb3-751"><a href="#cb3-751" aria-hidden="true" tabindex="-1"></a>    nllCIRLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x1"</span><span class="op">,</span> cHiX)<span class="op">;</span> nllCIRLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x2"</span><span class="op">,</span> cHiX)<span class="op">;</span></span>
<span id="cb3-752"><a href="#cb3-752" aria-hidden="true" tabindex="-1"></a>    nllCIRLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y1"</span><span class="op">,</span> cutY)<span class="op">;</span> nllCIRLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y2"</span><span class="op">,</span> baseline)<span class="op">;</span></span>
<span id="cb3-753"><a href="#cb3-753" aria-hidden="true" tabindex="-1"></a>    nllCIRLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"stroke"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">ci</span>)<span class="op">;</span></span>
<span id="cb3-754"><a href="#cb3-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-755"><a href="#cb3-755" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 95% CI text above the line, increase the number to make it go down</span></span>
<span id="cb3-756"><a href="#cb3-756" aria-hidden="true" tabindex="-1"></a>    nllCILLabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span> cLoX)<span class="op">;</span> nllCILLabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span> baseline <span class="op">+</span> <span class="dv">40</span>)<span class="op">;</span></span>
<span id="cb3-757"><a href="#cb3-757" aria-hidden="true" tabindex="-1"></a>    nllCILLabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">ci</span>)<span class="op">;</span> nllCILLabel<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> ciLo<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb3-758"><a href="#cb3-758" aria-hidden="true" tabindex="-1"></a>    nllCIRLabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span> cHiX)<span class="op">;</span> nllCIRLabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span> baseline <span class="op">+</span> <span class="dv">40</span>)<span class="op">;</span></span>
<span id="cb3-759"><a href="#cb3-759" aria-hidden="true" tabindex="-1"></a>    nllCIRLabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">ci</span>)<span class="op">;</span> nllCIRLabel<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> ciHi<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb3-760"><a href="#cb3-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-761"><a href="#cb3-761" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> bracketY <span class="op">=</span> baseline <span class="op">+</span> <span class="dv">48</span><span class="op">;</span></span>
<span id="cb3-762"><a href="#cb3-762" aria-hidden="true" tabindex="-1"></a>    nllBracket<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x1"</span><span class="op">,</span> cLoX)<span class="op">;</span> nllBracket<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x2"</span><span class="op">,</span> cHiX)<span class="op">;</span></span>
<span id="cb3-763"><a href="#cb3-763" aria-hidden="true" tabindex="-1"></a>    nllBracket<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y1"</span><span class="op">,</span> bracketY)<span class="op">;</span> nllBracket<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y2"</span><span class="op">,</span> bracketY)<span class="op">;</span></span>
<span id="cb3-764"><a href="#cb3-764" aria-hidden="true" tabindex="-1"></a>    nllBracket<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"stroke"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">ci</span>)<span class="op">;</span></span>
<span id="cb3-765"><a href="#cb3-765" aria-hidden="true" tabindex="-1"></a>    nllBracketLabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span> (cLoX <span class="op">+</span> cHiX) <span class="op">/</span> <span class="dv">2</span>)<span class="op">;</span> nllBracketLabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span> bracketY <span class="op">+</span> <span class="dv">18</span>)<span class="op">;</span></span>
<span id="cb3-766"><a href="#cb3-766" aria-hidden="true" tabindex="-1"></a>    nllBracketLabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">ci</span>)<span class="op">;</span></span>
<span id="cb3-767"><a href="#cb3-767" aria-hidden="true" tabindex="-1"></a>    nllBracketLabel<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>(cl <span class="op">*</span> <span class="dv">100</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>)<span class="sc">}</span><span class="vs">% CI`</span><span class="op">;</span></span>
<span id="cb3-768"><a href="#cb3-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-769"><a href="#cb3-769" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { ciLo<span class="op">,</span> ciHi<span class="op">,</span> mle<span class="op">,</span> chiQ<span class="op">,</span> cutoff }<span class="op">;</span></span>
<span id="cb3-770"><a href="#cb3-770" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-771"><a href="#cb3-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-772"><a href="#cb3-772" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-773"><a href="#cb3-773" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 8. RENDER CHI-SQUARE (right)</span></span>
<span id="cb3-774"><a href="#cb3-774" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-775"><a href="#cb3-775" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chiCritLine <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"line"</span><span class="op">,</span> { <span class="st">"stroke-width"</span><span class="op">:</span> <span class="st">"2.5"</span> })<span class="op">;</span> pChi<span class="op">.</span><span class="at">svg</span><span class="op">.</span><span class="fu">appendChild</span>(chiCritLine)<span class="op">;</span></span>
<span id="cb3-776"><a href="#cb3-776" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chiCritDot <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"circle"</span><span class="op">,</span> { <span class="dt">r</span><span class="op">:</span> <span class="st">"6"</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#fff"</span><span class="op">,</span> <span class="st">"stroke-width"</span><span class="op">:</span> <span class="st">"2"</span> })<span class="op">;</span> pChi<span class="op">.</span><span class="at">svg</span><span class="op">.</span><span class="fu">appendChild</span>(chiCritDot)<span class="op">;</span></span>
<span id="cb3-777"><a href="#cb3-777" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chiCritLabel <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"text"</span><span class="op">,</span> { <span class="st">"text-anchor"</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="st">"font-size"</span><span class="op">:</span> <span class="st">"16"</span><span class="op">,</span> <span class="st">"font-weight"</span><span class="op">:</span> <span class="st">"700"</span> })<span class="op">;</span> pChi<span class="op">.</span><span class="at">svg</span><span class="op">.</span><span class="fu">appendChild</span>(chiCritLabel)<span class="op">;</span></span>
<span id="cb3-778"><a href="#cb3-778" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chiAreaLabel <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"text"</span><span class="op">,</span> { <span class="st">"text-anchor"</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="st">"font-size"</span><span class="op">:</span> <span class="st">"16"</span><span class="op">,</span> <span class="st">"font-weight"</span><span class="op">:</span> <span class="st">"600"</span> })<span class="op">;</span> pChi<span class="op">.</span><span class="at">svg</span><span class="op">.</span><span class="fu">appendChild</span>(chiAreaLabel)<span class="op">;</span></span>
<span id="cb3-779"><a href="#cb3-779" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Apply clip path to shade too</span></span>
<span id="cb3-780"><a href="#cb3-780" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chiShade <span class="op">=</span> <span class="fu">mkEl</span>(<span class="st">"path"</span><span class="op">,</span> { <span class="st">"stroke-width"</span><span class="op">:</span> <span class="st">"0"</span><span class="op">,</span> <span class="st">"clip-path"</span><span class="op">:</span> <span class="vs">`url(#</span><span class="sc">${</span>pChi<span class="op">.</span><span class="at">clipId</span><span class="sc">}</span><span class="vs">)`</span> })<span class="op">;</span> </span>
<span id="cb3-781"><a href="#cb3-781" aria-hidden="true" tabindex="-1"></a>  pChi<span class="op">.</span><span class="at">svg</span><span class="op">.</span><span class="fu">insertBefore</span>(chiShade<span class="op">,</span> pChi<span class="op">.</span><span class="at">curvePath</span>)<span class="op">;</span></span>
<span id="cb3-782"><a href="#cb3-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-783"><a href="#cb3-783" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">renderChi</span>(cl<span class="op">,</span> chiQ) {</span>
<span id="cb3-784"><a href="#cb3-784" aria-hidden="true" tabindex="-1"></a>    pChi<span class="op">.</span><span class="at">title</span><span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">"Chi-Squared Distribution (df = 1)"</span><span class="op">;</span></span>
<span id="cb3-785"><a href="#cb3-785" aria-hidden="true" tabindex="-1"></a>    pChi<span class="op">.</span><span class="at">title</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">chi</span>)<span class="op">;</span></span>
<span id="cb3-786"><a href="#cb3-786" aria-hidden="true" tabindex="-1"></a>    pChi<span class="op">.</span><span class="at">sub</span><span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`Critical value at </span><span class="sc">${</span>(cl <span class="op">*</span> <span class="dv">100</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>)<span class="sc">}</span><span class="vs">% level`</span><span class="op">;</span></span>
<span id="cb3-787"><a href="#cb3-787" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setYLabel</span>(pChi<span class="op">,</span> <span class="st">"f(x)"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">chi</span>)<span class="op">;</span></span>
<span id="cb3-788"><a href="#cb3-788" aria-hidden="true" tabindex="-1"></a>    pChi<span class="op">.</span><span class="at">xLabel</span><span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">"x"</span><span class="op">;</span> pChi<span class="op">.</span><span class="at">xLabel</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">chi</span>)<span class="op">;</span></span>
<span id="cb3-789"><a href="#cb3-789" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setXAxis</span>(pChi)<span class="op">;</span></span>
<span id="cb3-790"><a href="#cb3-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-791"><a href="#cb3-791" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> xMax <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(chiQ <span class="op">*</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">6</span>)<span class="op">;</span></span>
<span id="cb3-792"><a href="#cb3-792" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> NPTS <span class="op">=</span> <span class="dv">300</span><span class="op">;</span></span>
<span id="cb3-793"><a href="#cb3-793" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> curve <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb3-794"><a href="#cb3-794" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> NPTS<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-795"><a href="#cb3-795" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x <span class="op">=</span> <span class="fl">0.01</span> <span class="op">+</span> (xMax <span class="op">-</span> <span class="fl">0.01</span>) <span class="op">*</span> i <span class="op">/</span> NPTS<span class="op">;</span></span>
<span id="cb3-796"><a href="#cb3-796" aria-hidden="true" tabindex="-1"></a>      curve<span class="op">.</span><span class="fu">push</span>({ x<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="fu">chi2PDF</span>(x) })<span class="op">;</span></span>
<span id="cb3-797"><a href="#cb3-797" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-798"><a href="#cb3-798" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yMax <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="fl">2.0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>curve<span class="op">.</span><span class="fu">map</span>(c <span class="kw">=&gt;</span> c<span class="op">.</span><span class="at">y</span>)) <span class="op">*</span> <span class="fl">1.1</span>)<span class="op">;</span></span>
<span id="cb3-799"><a href="#cb3-799" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yMin <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-800"><a href="#cb3-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-801"><a href="#cb3-801" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setGrid</span>(pChi<span class="op">,</span> yMin<span class="op">,</span> yMax<span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb3-802"><a href="#cb3-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-803"><a href="#cb3-803" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> baseline <span class="op">=</span> mg_<span class="op">.</span><span class="at">t</span> <span class="op">+</span> ph_<span class="op">;</span></span>
<span id="cb3-804"><a href="#cb3-804" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sxC <span class="op">=</span> x <span class="kw">=&gt;</span> mg_<span class="op">.</span><span class="at">l</span> <span class="op">+</span> (x <span class="op">/</span> xMax) <span class="op">*</span> pw_<span class="op">;</span></span>
<span id="cb3-805"><a href="#cb3-805" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> syC <span class="op">=</span> y <span class="kw">=&gt;</span> mg_<span class="op">.</span><span class="at">t</span> <span class="op">+</span> ph_ <span class="op">-</span> ((y <span class="op">-</span> yMin) <span class="op">/</span> ((yMax <span class="op">-</span> yMin) <span class="op">||</span> <span class="dv">1</span>)) <span class="op">*</span> ph_<span class="op">;</span></span>
<span id="cb3-806"><a href="#cb3-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-807"><a href="#cb3-807" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> xStep <span class="op">=</span> xMax <span class="op">&gt;</span> <span class="dv">10</span> <span class="op">?</span> <span class="dv">2</span> <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-808"><a href="#cb3-808" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">20</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-809"><a href="#cb3-809" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> v <span class="op">=</span> i <span class="op">*</span> xStep<span class="op">;</span></span>
<span id="cb3-810"><a href="#cb3-810" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (v <span class="op">&lt;=</span> xMax) {</span>
<span id="cb3-811"><a href="#cb3-811" aria-hidden="true" tabindex="-1"></a>        pChi<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">sxC</span>(v))<span class="op">;</span> pChi<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span> baseline <span class="op">+</span> <span class="dv">24</span>)<span class="op">;</span></span>
<span id="cb3-812"><a href="#cb3-812" aria-hidden="true" tabindex="-1"></a>        pChi<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> v<span class="op">;</span></span>
<span id="cb3-813"><a href="#cb3-813" aria-hidden="true" tabindex="-1"></a>        pChi<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb3-814"><a href="#cb3-814" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> { pChi<span class="op">.</span><span class="at">xTicks</span>[i]<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span> }</span>
<span id="cb3-815"><a href="#cb3-815" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-816"><a href="#cb3-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-817"><a href="#cb3-817" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> d <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb3-818"><a href="#cb3-818" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> NPTS<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-819"><a href="#cb3-819" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> px <span class="op">=</span> <span class="fu">sxC</span>(curve[i]<span class="op">.</span><span class="at">x</span>)<span class="op">,</span> py <span class="op">=</span> <span class="fu">syC</span>(curve[i]<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb3-820"><a href="#cb3-820" aria-hidden="true" tabindex="-1"></a>      d <span class="op">+=</span> (i <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"M"</span> <span class="op">:</span> <span class="st">"L"</span>) <span class="op">+</span> px<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>) <span class="op">+</span> <span class="st">","</span> <span class="op">+</span> py<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-821"><a href="#cb3-821" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-822"><a href="#cb3-822" aria-hidden="true" tabindex="-1"></a>    pChi<span class="op">.</span><span class="at">curvePath</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"d"</span><span class="op">,</span> d)<span class="op">;</span> pChi<span class="op">.</span><span class="at">curvePath</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"stroke"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">chi</span>)<span class="op">;</span></span>
<span id="cb3-823"><a href="#cb3-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-824"><a href="#cb3-824" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> dShade <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb3-825"><a href="#cb3-825" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> started <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb3-826"><a href="#cb3-826" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> NPTS<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-827"><a href="#cb3-827" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (curve[i]<span class="op">.</span><span class="at">x</span> <span class="op">&gt;=</span> chiQ) {</span>
<span id="cb3-828"><a href="#cb3-828" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> px <span class="op">=</span> <span class="fu">sxC</span>(curve[i]<span class="op">.</span><span class="at">x</span>)<span class="op">,</span> py <span class="op">=</span> <span class="fu">syC</span>(curve[i]<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb3-829"><a href="#cb3-829" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>started) { dShade <span class="op">=</span> <span class="vs">`M</span><span class="sc">${</span>px<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>baseline<span class="sc">}</span><span class="vs">`</span><span class="op">;</span> started <span class="op">=</span> <span class="kw">true</span><span class="op">;</span> }</span>
<span id="cb3-830"><a href="#cb3-830" aria-hidden="true" tabindex="-1"></a>        dShade <span class="op">+=</span> <span class="vs">`L</span><span class="sc">${</span>px<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>py<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb3-831"><a href="#cb3-831" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-832"><a href="#cb3-832" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-833"><a href="#cb3-833" aria-hidden="true" tabindex="-1"></a>    dShade <span class="op">+=</span> <span class="vs">`L</span><span class="sc">${</span><span class="fu">sxC</span>(xMax)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>baseline<span class="sc">}</span><span class="vs">Z`</span><span class="op">;</span></span>
<span id="cb3-834"><a href="#cb3-834" aria-hidden="true" tabindex="-1"></a>    chiShade<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"d"</span><span class="op">,</span> dShade)<span class="op">;</span> chiShade<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">chi</span>)<span class="op">;</span></span>
<span id="cb3-835"><a href="#cb3-835" aria-hidden="true" tabindex="-1"></a>    chiShade<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="st">"0.15"</span>)<span class="op">;</span> chiShade<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb3-836"><a href="#cb3-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-837"><a href="#cb3-837" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> dBody <span class="op">=</span> <span class="vs">`M</span><span class="sc">${</span><span class="fu">sxC</span>(<span class="fl">0.01</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>baseline<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb3-838"><a href="#cb3-838" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> NPTS<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-839"><a href="#cb3-839" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (curve[i]<span class="op">.</span><span class="at">x</span> <span class="op">&lt;=</span> chiQ) {</span>
<span id="cb3-840"><a href="#cb3-840" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> px <span class="op">=</span> <span class="fu">sxC</span>(curve[i]<span class="op">.</span><span class="at">x</span>)<span class="op">,</span> py <span class="op">=</span> <span class="fu">syC</span>(curve[i]<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb3-841"><a href="#cb3-841" aria-hidden="true" tabindex="-1"></a>        dBody <span class="op">+=</span> <span class="vs">`L</span><span class="sc">${</span>px<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>py<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb3-842"><a href="#cb3-842" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-843"><a href="#cb3-843" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-844"><a href="#cb3-844" aria-hidden="true" tabindex="-1"></a>    dBody <span class="op">+=</span> <span class="vs">`L</span><span class="sc">${</span><span class="fu">sxC</span>(chiQ)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>baseline<span class="sc">}</span><span class="vs">Z`</span><span class="op">;</span></span>
<span id="cb3-845"><a href="#cb3-845" aria-hidden="true" tabindex="-1"></a>    pChi<span class="op">.</span><span class="at">fillPath</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"d"</span><span class="op">,</span> dBody)<span class="op">;</span> pChi<span class="op">.</span><span class="at">fillPath</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">ci</span>)<span class="op">;</span></span>
<span id="cb3-846"><a href="#cb3-846" aria-hidden="true" tabindex="-1"></a>    pChi<span class="op">.</span><span class="at">fillPath</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="st">"0.1"</span>)<span class="op">;</span> pChi<span class="op">.</span><span class="at">fillPath</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb3-847"><a href="#cb3-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-848"><a href="#cb3-848" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> critX <span class="op">=</span> <span class="fu">sxC</span>(chiQ)<span class="op">,</span> critY <span class="op">=</span> <span class="fu">syC</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="fu">chi2PDF</span>(chiQ)<span class="op">,</span> yMax))<span class="op">;</span></span>
<span id="cb3-849"><a href="#cb3-849" aria-hidden="true" tabindex="-1"></a>    chiCritLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x1"</span><span class="op">,</span> critX)<span class="op">;</span> chiCritLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x2"</span><span class="op">,</span> critX)<span class="op">;</span></span>
<span id="cb3-850"><a href="#cb3-850" aria-hidden="true" tabindex="-1"></a>    chiCritLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y1"</span><span class="op">,</span> critY)<span class="op">;</span> chiCritLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y2"</span><span class="op">,</span> baseline)<span class="op">;</span></span>
<span id="cb3-851"><a href="#cb3-851" aria-hidden="true" tabindex="-1"></a>    chiCritLine<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"stroke"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">ci</span>)<span class="op">;</span></span>
<span id="cb3-852"><a href="#cb3-852" aria-hidden="true" tabindex="-1"></a>    chiCritDot<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"cx"</span><span class="op">,</span> critX)<span class="op">;</span> chiCritDot<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"cy"</span><span class="op">,</span> critY)<span class="op">;</span></span>
<span id="cb3-853"><a href="#cb3-853" aria-hidden="true" tabindex="-1"></a>    chiCritDot<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">ci</span>)<span class="op">;</span></span>
<span id="cb3-854"><a href="#cb3-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-855"><a href="#cb3-855" aria-hidden="true" tabindex="-1"></a>    chiCritLabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span> critX)<span class="op">;</span> chiCritLabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span> critY <span class="op">-</span> <span class="dv">16</span>)<span class="op">;</span></span>
<span id="cb3-856"><a href="#cb3-856" aria-hidden="true" tabindex="-1"></a>    chiCritLabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">ci</span>)<span class="op">;</span></span>
<span id="cb3-857"><a href="#cb3-857" aria-hidden="true" tabindex="-1"></a>    chiCritLabel<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">\u03C7\u00B2</span><span class="vs"> = </span><span class="sc">${</span>chiQ<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb3-858"><a href="#cb3-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-859"><a href="#cb3-859" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> bodyMidX <span class="op">=</span> <span class="fu">sxC</span>(chiQ <span class="op">*</span> <span class="fl">0.4</span>)<span class="op">;</span></span>
<span id="cb3-860"><a href="#cb3-860" aria-hidden="true" tabindex="-1"></a>    chiAreaLabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"x"</span><span class="op">,</span> bodyMidX)<span class="op">;</span> chiAreaLabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"y"</span><span class="op">,</span> baseline <span class="op">-</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb3-861"><a href="#cb3-861" aria-hidden="true" tabindex="-1"></a>    chiAreaLabel<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"fill"</span><span class="op">,</span> COL<span class="op">.</span><span class="at">ci</span>)<span class="op">;</span></span>
<span id="cb3-862"><a href="#cb3-862" aria-hidden="true" tabindex="-1"></a>    chiAreaLabel<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>(cl <span class="op">*</span> <span class="dv">100</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>)<span class="sc">}</span><span class="vs">%`</span><span class="op">;</span></span>
<span id="cb3-863"><a href="#cb3-863" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-864"><a href="#cb3-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-865"><a href="#cb3-865" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-866"><a href="#cb3-866" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 9. UPDATE</span></span>
<span id="cb3-867"><a href="#cb3-867" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ══════════════════════════════════════════════════════</span></span>
<span id="cb3-868"><a href="#cb3-868" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateAll</span>() {</span>
<span id="cb3-869"><a href="#cb3-869" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> n <span class="op">=</span> SL<span class="op">.</span><span class="at">n</span><span class="op">.</span><span class="fu">val</span>()<span class="op">;</span></span>
<span id="cb3-870"><a href="#cb3-870" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> k <span class="op">=</span> SL<span class="op">.</span><span class="at">k</span><span class="op">.</span><span class="fu">val</span>()<span class="op">;</span></span>
<span id="cb3-871"><a href="#cb3-871" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (k <span class="op">&gt;</span> n) { SL<span class="op">.</span><span class="at">k</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="at">value</span> <span class="op">=</span> n<span class="op">;</span> SL<span class="op">.</span><span class="at">k</span><span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span> k <span class="op">=</span> n<span class="op">;</span> }</span>
<span id="cb3-872"><a href="#cb3-872" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cl <span class="op">=</span> SL<span class="op">.</span><span class="at">cl</span><span class="op">.</span><span class="fu">val</span>()<span class="op">;</span></span>
<span id="cb3-873"><a href="#cb3-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-874"><a href="#cb3-874" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> { ciLo<span class="op">,</span> ciHi<span class="op">,</span> mle<span class="op">,</span> chiQ<span class="op">,</span> cutoff } <span class="op">=</span> <span class="fu">renderNLL</span>(n<span class="op">,</span> k<span class="op">,</span> cl)<span class="op">;</span></span>
<span id="cb3-875"><a href="#cb3-875" aria-hidden="true" tabindex="-1"></a>    <span class="fu">renderChi</span>(cl<span class="op">,</span> chiQ)<span class="op">;</span></span>
<span id="cb3-876"><a href="#cb3-876" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-877"><a href="#cb3-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-878"><a href="#cb3-878" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">onInput</span>() { SL<span class="op">.</span><span class="at">n</span><span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span> SL<span class="op">.</span><span class="at">k</span><span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span> SL<span class="op">.</span><span class="at">cl</span><span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span> <span class="fu">updateAll</span>()<span class="op">;</span> }</span>
<span id="cb3-879"><a href="#cb3-879" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">n</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span> onInput)<span class="op">;</span></span>
<span id="cb3-880"><a href="#cb3-880" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">k</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span> onInput)<span class="op">;</span></span>
<span id="cb3-881"><a href="#cb3-881" aria-hidden="true" tabindex="-1"></a>  SL<span class="op">.</span><span class="at">cl</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span> onInput)<span class="op">;</span></span>
<span id="cb3-882"><a href="#cb3-882" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateAll</span>()<span class="op">;</span></span>
<span id="cb3-883"><a href="#cb3-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-884"><a href="#cb3-884" aria-hidden="true" tabindex="-1"></a>  invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb3-885"><a href="#cb3-885" aria-hidden="true" tabindex="-1"></a>    SL<span class="op">.</span><span class="at">n</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"input"</span><span class="op">,</span> onInput)<span class="op">;</span></span>
<span id="cb3-886"><a href="#cb3-886" aria-hidden="true" tabindex="-1"></a>    SL<span class="op">.</span><span class="at">k</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"input"</span><span class="op">,</span> onInput)<span class="op">;</span></span>
<span id="cb3-887"><a href="#cb3-887" aria-hidden="true" tabindex="-1"></a>    SL<span class="op">.</span><span class="at">cl</span><span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"input"</span><span class="op">,</span> onInput)<span class="op">;</span></span>
<span id="cb3-888"><a href="#cb3-888" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb3-889"><a href="#cb3-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-890"><a href="#cb3-890" aria-hidden="true" tabindex="-1"></a>  wrapper<span class="op">.</span><span class="at">value</span> <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb3-891"><a href="#cb3-891" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> wrapper<span class="op">;</span></span>
<span id="cb3-892"><a href="#cb3-892" aria-hidden="true" tabindex="-1"></a>})()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="declaration">

</div>
</div>
</div>
<p>Khoảng tin cậy đo lường mức độ không chắc chắn của tham số ước lượng. Khoảng tin cậy 95% <span class="math inline">\([\theta_{\text{lower}}, \theta_{\text{upper}}]\)</span> của 1 tham số ước lượng <span class="math inline">\(\hat{\theta}\)</span> được diễn giải là: giá trị thực <span class="math inline">\(\theta^*\)</span> nằm trong <span class="math inline">\([\theta_{\text{lower}}, \theta_{\text{upper}}]\)</span> với xác suất là 95% <span class="citation" data-cites="raue2010">(<a href="references.html#ref-raue2010" role="doc-biblioref">Raue et al. 2010</a>)</span>.</p>
</section>
<section id="tính-định-danh" class="level2" data-number="9.6">
<h2 data-number="9.6" class="anchored" data-anchor-id="tính-định-danh"><span class="header-section-number">9.6</span> Tính định danh</h2>
<p>Tính định danh (identifiability) của một tham số <span class="math inline">\(\theta_i\)</span> được định nghĩa như sau <span class="citation" data-cites="raue2010">(<a href="references.html#ref-raue2010" role="doc-biblioref">Raue et al. 2010</a>)</span>:</p>
<ul>
<li><p>Tính định danh cấu trúc (structurally identifiable): nếu ước lượng <span class="math inline">\(\hat{\theta}_i\)</span> của nó là cực tiểu duy nhất của hàm <span class="math inline">\(\chi^2(\theta)\)</span>.</p></li>
<li><p>Tính định danh thực tế (practically identifiable) nếu khoảng tin cậy của ước lượng đó là hữu hạn.</p></li>
<li><p>Không định danh được (nonidentifiable) khi khoảng tin cậy của nó là vô hạn.</p></li>
</ul>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-bolker2008" class="csl-entry" role="listitem">
Bolker, Benjamin M. 2008. <em>Ecological Models and Data in R</em>. Princeton University Press. <a href="https://doi.org/10.1515/9781400840908">https://doi.org/10.1515/9781400840908</a>.
</div>
<div id="ref-raue2010" class="csl-entry" role="listitem">
Raue, A., V. Becker, U. Klingmüller, and J. Timmer. 2010. <span>“Identifiability and Observability Analysis for Experimental Design in Nonlinear Dynamical Models.”</span> <em>Chaos: An Interdisciplinary Journal of Nonlinear Science</em> 20 (4): 045105. <a href="https://doi.org/10.1063/1.3528102">https://doi.org/10.1063/1.3528102</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImltcG9ydCB7IGNyZWF0ZVNsaWRlciwgY3JlYXRlQnV0dG9uLCBpbmplY3RTdHlsZSB9IGZyb20gXCIuL19zbGlkZXIuanNcIlxyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgcGRmX3ZzX2xpa19sYXJnZSA9ICgoKSA9PiB7XHJcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgLy8gMS4gTUFUSFxyXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gIGZ1bmN0aW9uIGxuQ29tYihuLCBrKSB7XHJcbiAgICBpZiAoayA8IDAgfHwgayA+IG4pIHJldHVybiAtSW5maW5pdHk7XHJcbiAgICBpZiAoayA9PT0gMCB8fCBrID09PSBuKSByZXR1cm4gMDtcclxuICAgIGxldCBzID0gMDtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgazsgaSsrKSBzICs9IE1hdGgubG9nKG4gLSBpKSAtIE1hdGgubG9nKGkgKyAxKTtcclxuICAgIHJldHVybiBzO1xyXG4gIH1cclxuICBmdW5jdGlvbiBiaW5vbVBNRihrLCBuLCBwKSB7XHJcbiAgICBpZiAocCA8PSAwKSByZXR1cm4gayA9PT0gMCA/IDEgOiAwO1xyXG4gICAgaWYgKHAgPj0gMSkgcmV0dXJuIGsgPT09IG4gPyAxIDogMDtcclxuICAgIHJldHVybiBNYXRoLmV4cChsbkNvbWIobiwgaykgKyBrICogTWF0aC5sb2cocCkgKyAobiAtIGspICogTWF0aC5sb2coMSAtIHApKTtcclxuICB9XHJcbiAgZnVuY3Rpb24gYmlub21Mb2dMaWsoaywgbiwgcCkge1xyXG4gICAgaWYgKHAgPD0gMCkgcmV0dXJuIGsgPT09IDAgPyAwIDogLUluZmluaXR5O1xyXG4gICAgaWYgKHAgPj0gMSkgcmV0dXJuIGsgPT09IG4gPyAwIDogLUluZmluaXR5O1xyXG4gICAgcmV0dXJuIGxuQ29tYihuLCBrKSArIGsgKiBNYXRoLmxvZyhwKSArIChuIC0gaykgKiBNYXRoLmxvZygxIC0gcCk7XHJcbiAgfVxyXG5cclxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcclxuICAvLyAyLiBXUkFQUEVSXHJcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgY29uc3Qgd3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgd3JhcHBlci5zdHlsZS5jc3NUZXh0ID0gYGRpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47YWxpZ24taXRlbXM6Y2VudGVyO1xyXG4gICAgZm9udC1mYW1pbHk6LWFwcGxlLXN5c3RlbSxCbGlua01hY1N5c3RlbUZvbnQsXCJTZWdvZSBVSVwiLFJvYm90byxzYW5zLXNlcmlmO1xyXG4gICAgd2lkdGg6MTAwJTttYXgtd2lkdGg6OTYwcHg7bWFyZ2luOjAgYXV0bztgO1xyXG4gIHdyYXBwZXIuYXBwZW5kQ2hpbGQoaW5qZWN0U3R5bGUoKSk7XHJcblxyXG4gIC8vIENvbG9yczogcCA9IGJsdWUsIGsgPSByZWQg4oCUIEVWRVJZV0hFUkVcclxuICBjb25zdCBDUCA9IFwiIzNiODJmNlwiOyAvLyBwIGNvbG9yXHJcbiAgY29uc3QgQ0sgPSBcIiNkYzI2MjZcIjsgLy8gayBjb2xvclxyXG5cclxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcclxuICAvLyAzLiBGT1JNVUxBIEJPWCAoUmV2ZXJ0ZWQgdG8gc21hbGxlciBzaXplKVxyXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gIGNvbnN0IGZvcm11bGFCb3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gIGZvcm11bGFCb3guc3R5bGUuY3NzVGV4dCA9IGBcclxuICAgIHdpZHRoOjEwMCU7cGFkZGluZzoxNnB4IDIwcHg7Ym9yZGVyLXJhZGl1czoxMnB4O21hcmdpbi1ib3R0b206MTRweDtcclxuICAgIGJhY2tncm91bmQ6I2Y4ZmFmYztib3JkZXI6MXB4IHNvbGlkICNlMmU4ZjA7dGV4dC1hbGlnbjpjZW50ZXI7XHJcbiAgICBmb250LXNpemU6MTZweDtsaW5lLWhlaWdodDoxLjk7Y29sb3I6IzMzNDE1NTtcclxuICAgIGZvbnQtZmFtaWx5OlwiU0YgTW9ub1wiLFNGTW9uby1SZWd1bGFyLE1lbmxvLENvbnNvbGFzLG1vbm9zcGFjZTtcclxuICBgO1xyXG4gIHdyYXBwZXIuYXBwZW5kQ2hpbGQoZm9ybXVsYUJveCk7XHJcblxyXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gIC8vIDQuIENPTlRST0xTXHJcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgY29uc3QgU0wgPSB7fTtcclxuICBTTC5uID0gY3JlYXRlU2xpZGVyKFwibiAodHJpYWxzKVwiLCAxLCAzMCwgMSwgMTAsIFwiIzFlMjkzYlwiLCBcImRhcmtcIik7XHJcbiAgU0wucCA9IGNyZWF0ZVNsaWRlcihcInAgKHByb2JhYmlsaXR5KVwiLCAwLjAxLCAwLjk5LCAwLjAxLCAwLjYwLCBDUCwgXCJibHVlXCIpO1xyXG4gIFNMLmsgPSBjcmVhdGVTbGlkZXIoXCJrIChvYnNlcnZlZCBzdWNjZXNzZXMpXCIsIDAsIDMwLCAxLCA2LCBDSywgXCJyZWRcIik7XHJcblxyXG4gIGNvbnN0IHIxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTsgcjEuc3R5bGUuY3NzVGV4dCA9IFwiZGlzcGxheTpmbGV4O2dhcDoyMHB4O3dpZHRoOjEwMCU7bWFyZ2luLWJvdHRvbToxMHB4O1wiO1xyXG4gIHIxLmFwcGVuZENoaWxkKFNMLm4uZWwpO1xyXG4gIHdyYXBwZXIuYXBwZW5kQ2hpbGQocjEpO1xyXG4gIGNvbnN0IHIyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTsgcjIuc3R5bGUuY3NzVGV4dCA9IFwiZGlzcGxheTpmbGV4O2dhcDoyMHB4O3dpZHRoOjEwMCU7bWFyZ2luLWJvdHRvbToxMnB4O1wiO1xyXG4gIHIyLmFwcGVuZENoaWxkKFNMLnAuZWwpOyByMi5hcHBlbmRDaGlsZChTTC5rLmVsKTtcclxuICB3cmFwcGVyLmFwcGVuZENoaWxkKHIyKTtcclxuXHJcbiAgLy8gTkxMIHRvZ2dsZVxyXG4gIGxldCBzaG93TkxMID0gZmFsc2U7XHJcbiAgY29uc3QgdG9nZ2xlUm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICB0b2dnbGVSb3cuc3R5bGUuY3NzVGV4dCA9IFwiZGlzcGxheTpmbGV4O2dhcDoxMnB4O3dpZHRoOjEwMCU7bWFyZ2luLWJvdHRvbToxNHB4O2FsaWduLWl0ZW1zOmNlbnRlcjtcIjtcclxuICBjb25zdCB0b2dnbGVMYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gIHRvZ2dsZUxhYmVsLnN0eWxlLmNzc1RleHQgPSBcImZvbnQtc2l6ZToxM3B4O2ZvbnQtd2VpZ2h0OjYwMDtjb2xvcjojNjQ3NDhiO1wiO1xyXG4gIHRvZ2dsZUxhYmVsLnRleHRDb250ZW50ID0gXCJMaWtlbGlob29kIHBhbmVsOlwiO1xyXG4gIGNvbnN0IGJ0bkxpayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XHJcbiAgY29uc3QgYnRuTkxMID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICBmdW5jdGlvbiBzdHlsZVRvZ2dsZShidG4sIGFjdGl2ZSwgY29sb3IpIHtcclxuICAgIGJ0bi5zdHlsZS5jc3NUZXh0ID0gYHBhZGRpbmc6NnB4IDE2cHg7Ym9yZGVyLXJhZGl1czo4cHg7Zm9udC1zaXplOjEzcHg7Zm9udC13ZWlnaHQ6NzAwO1xyXG4gICAgICBmb250LWZhbWlseTppbmhlcml0O2N1cnNvcjpwb2ludGVyO3RyYW5zaXRpb246YWxsIDAuMTVzO1xyXG4gICAgICBib3JkZXI6MnB4IHNvbGlkICR7Y29sb3J9O1xyXG4gICAgICBiYWNrZ3JvdW5kOiR7YWN0aXZlID8gY29sb3IgOiBcIiNmZmZcIn07Y29sb3I6JHthY3RpdmUgPyBcIiNmZmZcIiA6IGNvbG9yfTtgO1xyXG4gIH1cclxuICBidG5MaWsudGV4dENvbnRlbnQgPSBcIkwocCB8IGspXCI7XHJcbiAgYnRuTkxMLnRleHRDb250ZW50ID0gXCJcXHUyMjEybG9nIEwocCB8IGspXCI7XHJcbiAgdG9nZ2xlUm93LmFwcGVuZENoaWxkKHRvZ2dsZUxhYmVsKTsgdG9nZ2xlUm93LmFwcGVuZENoaWxkKGJ0bkxpayk7IHRvZ2dsZVJvdy5hcHBlbmRDaGlsZChidG5OTEwpO1xyXG4gIHdyYXBwZXIuYXBwZW5kQ2hpbGQodG9nZ2xlUm93KTtcclxuXHJcbiAgYnRuTGlrLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7IHNob3dOTEwgPSBmYWxzZTsgdXBkYXRlQWxsKCk7IH0pO1xyXG4gIGJ0bk5MTC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4geyBzaG93TkxMID0gdHJ1ZTsgdXBkYXRlQWxsKCk7IH0pO1xyXG5cclxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcclxuICAvLyA1LiBTVkcgUEFORUxTXHJcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgY29uc3QgTlMgPSBcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCI7XHJcbiAgY29uc3QgUFcgPSA0NjAsIFBIID0gNDAwOyAvLyBJbmNyZWFzZWQgaGVpZ2h0XHJcbiAgLy8gSW5jcmVhc2VkIG1hcmdpbnMgc2lnbmlmaWNhbnRseSB0byBmaXQgbGFyZ2VyIGZvbnRzXHJcbiAgY29uc3QgbWdfID0geyB0OiA4MCwgcjogMjUsIGI6IDgwLCBsOiA3NSB9O1xyXG4gIGNvbnN0IHB3XyA9IFBXIC0gbWdfLmwgLSBtZ18uciwgcGhfID0gUEggLSBtZ18udCAtIG1nXy5iO1xyXG5cclxuICBmdW5jdGlvbiBta0VsKHRhZywgYSkge1xyXG4gICAgY29uc3QgZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhOUywgdGFnKTtcclxuICAgIGlmIChhKSBmb3IgKGNvbnN0IFtrLHZdIG9mIE9iamVjdC5lbnRyaWVzKGEpKSBlLnNldEF0dHJpYnV0ZShrLHYpO1xyXG4gICAgcmV0dXJuIGU7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBjcmVhdGVQYW5lbCgpIHtcclxuICAgIGNvbnN0IHN2ZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhOUywgXCJzdmdcIik7XHJcbiAgICBzdmcuc2V0QXR0cmlidXRlKFwidmlld0JveFwiLCBgMCAwICR7UFd9ICR7UEh9YCk7XHJcbiAgICBzdmcuc3R5bGUuY3NzVGV4dCA9IFwiZmxleDoxO21pbi13aWR0aDowO2JvcmRlci1yYWRpdXM6MTJweDtib3JkZXI6MXB4IHNvbGlkICNlMmU4ZjA7YmFja2dyb3VuZDojZmZmO1wiO1xyXG5cclxuICAgIC8vIEhVR0UgRk9OVFNcclxuICAgIGNvbnN0IHRpdGxlID0gbWtFbChcInRleHRcIiwgeyB4OiBTdHJpbmcoUFcgLyAyKSwgeTogXCIzNFwiLCBcInRleHQtYW5jaG9yXCI6IFwibWlkZGxlXCIsIFwiZm9udC1zaXplXCI6IFwiMjZcIiwgXCJmb250LXdlaWdodFwiOiBcIjcwMFwiIH0pO1xyXG4gICAgc3ZnLmFwcGVuZENoaWxkKHRpdGxlKTtcclxuICAgIGNvbnN0IHN1YiA9IG1rRWwoXCJ0ZXh0XCIsIHsgeDogU3RyaW5nKFBXIC8gMiksIHk6IFwiNjBcIiwgXCJ0ZXh0LWFuY2hvclwiOiBcIm1pZGRsZVwiLCBcImZvbnQtc2l6ZVwiOiBcIjE4XCIsIGZpbGw6IFwiIzY0NzQ4YlwiIH0pO1xyXG4gICAgc3ZnLmFwcGVuZENoaWxkKHN1Yik7XHJcblxyXG4gICAgY29uc3QgZ3JpZHMgPSBbXTsgZm9yIChsZXQgaSA9IDA7IGkgPD0gNDsgaSsrKSB7IHN2Zy5hcHBlbmRDaGlsZChta0VsKFwibGluZVwiLCB7IHN0cm9rZTogXCIjZjFmNWY5XCIsIFwic3Ryb2tlLXdpZHRoXCI6IFwiMVwiIH0pKTsgZ3JpZHMucHVzaChzdmcubGFzdENoaWxkKTsgfVxyXG4gICAgLy8gWS1UaWNrIEZvbnQgMTZcclxuICAgIGNvbnN0IHlMYmxzID0gW107IGZvciAobGV0IGkgPSAwOyBpIDw9IDQ7IGkrKykgeyBzdmcuYXBwZW5kQ2hpbGQobWtFbChcInRleHRcIiwgeyBcInRleHQtYW5jaG9yXCI6IFwiZW5kXCIsIGZpbGw6IFwiIzk0YTNiOFwiLCBcImZvbnQtc2l6ZVwiOiBcIjE2XCIsIFwiZm9udC1mYW1pbHlcIjogXCInU0YgTW9ubycsbW9ub3NwYWNlXCIgfSkpOyB5TGJscy5wdXNoKHN2Zy5sYXN0Q2hpbGQpOyB9XHJcblxyXG4gICAgY29uc3QgYmFycyA9IFtdOyBmb3IgKGxldCBpID0gMDsgaSA8IDMxOyBpKyspIHsgY29uc3QgciA9IG1rRWwoXCJyZWN0XCIsIHsgcng6IFwiMlwiIH0pOyByLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjsgc3ZnLmFwcGVuZENoaWxkKHIpOyBiYXJzLnB1c2gocik7IH1cclxuXHJcbiAgICBjb25zdCBwYXRoRmlsbCA9IG1rRWwoXCJwYXRoXCIsIHsgXCJzdHJva2Utd2lkdGhcIjogXCIwXCIgfSk7IHBhdGhGaWxsLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjsgc3ZnLmFwcGVuZENoaWxkKHBhdGhGaWxsKTtcclxuICAgIGNvbnN0IHBhdGggPSBta0VsKFwicGF0aFwiLCB7IGZpbGw6IFwibm9uZVwiLCBcInN0cm9rZS13aWR0aFwiOiBcIjNcIiB9KTsgcGF0aC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7IHN2Zy5hcHBlbmRDaGlsZChwYXRoKTtcclxuXHJcbiAgICBzdmcuYXBwZW5kQ2hpbGQobWtFbChcImxpbmVcIiwgeyB4MTogU3RyaW5nKG1nXy5sKSwgeDI6IFN0cmluZyhtZ18ubCksIHkxOiBTdHJpbmcobWdfLnQpLCB5MjogU3RyaW5nKG1nXy50ICsgcGhfKSwgc3Ryb2tlOiBcIiNjYmQ1ZTFcIiB9KSk7XHJcbiAgICBjb25zdCB4QXggPSBta0VsKFwibGluZVwiLCB7IHN0cm9rZTogXCIjY2JkNWUxXCIgfSk7IHN2Zy5hcHBlbmRDaGlsZCh4QXgpO1xyXG4gICAgXHJcbiAgICAvLyBYLVRpY2sgRm9udCAxNlxyXG4gICAgY29uc3QgeFRpY2tzID0gW107IGZvciAobGV0IGkgPSAwOyBpIDwgMzE7IGkrKykgeyBjb25zdCB0ID0gbWtFbChcInRleHRcIiwgeyBcInRleHQtYW5jaG9yXCI6IFwibWlkZGxlXCIsIGZpbGw6IFwiIzY0NzQ4YlwiLCBcImZvbnQtc2l6ZVwiOiBcIjE2XCIsIFwiZm9udC1mYW1pbHlcIjogXCInU0YgTW9ubycsbW9ub3NwYWNlXCIgfSk7IHQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiOyBzdmcuYXBwZW5kQ2hpbGQodCk7IHhUaWNrcy5wdXNoKHQpOyB9XHJcbiAgICBcclxuICAgIC8vIEF4aXMgTGFiZWwgRm9udCAxOFxyXG4gICAgY29uc3QgeExhYmVsID0gbWtFbChcInRleHRcIiwgeyB4OiBTdHJpbmcobWdfLmwgKyBwd18gLyAyKSwgeTogU3RyaW5nKFBIIC0gMTIpLCBcInRleHQtYW5jaG9yXCI6IFwibWlkZGxlXCIsIGZpbGw6IFwiIzY0NzQ4YlwiLCBcImZvbnQtc2l6ZVwiOiBcIjE4XCIsIFwiZm9udC13ZWlnaHRcIjogXCI2MDBcIiB9KTtcclxuICAgIHN2Zy5hcHBlbmRDaGlsZCh4TGFiZWwpO1xyXG5cclxuICAgIC8vIFktYXhpcyBsYWJlbCAocm90YXRlZCkgLSBGb250IDE4XHJcbiAgICBjb25zdCB5TGFiZWwgPSBta0VsKFwidGV4dFwiLCB7IFwidGV4dC1hbmNob3JcIjogXCJtaWRkbGVcIiwgZmlsbDogXCIjNjQ3NDhiXCIsIFwiZm9udC1zaXplXCI6IFwiMThcIiwgXCJmb250LXdlaWdodFwiOiBcIjYwMFwiIH0pO1xyXG4gICAgc3ZnLmFwcGVuZENoaWxkKHlMYWJlbCk7XHJcblxyXG4gICAgLy8gSGlnaGxpZ2h0IGVsZW1lbnRzIChoaWRkZW4gYnkgZGVmYXVsdClcclxuICAgIGNvbnN0IGhsTGluZSA9IG1rRWwoXCJsaW5lXCIsIHsgXCJzdHJva2Utd2lkdGhcIjogXCIyXCIsIFwic3Ryb2tlLWRhc2hhcnJheVwiOiBcIjUsM1wiIH0pOyBobExpbmUuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiOyBzdmcuYXBwZW5kQ2hpbGQoaGxMaW5lKTtcclxuICAgIGNvbnN0IGhsRG90ID0gbWtFbChcImNpcmNsZVwiLCB7IHI6IFwiN1wiLCBzdHJva2U6IFwiI2ZmZlwiLCBcInN0cm9rZS13aWR0aFwiOiBcIjIuNVwiIH0pOyBobERvdC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7IHN2Zy5hcHBlbmRDaGlsZChobERvdCk7XHJcbiAgICBjb25zdCBobExhYmVsID0gbWtFbChcInRleHRcIiwgeyBcInRleHQtYW5jaG9yXCI6IFwibWlkZGxlXCIsIFwiZm9udC1zaXplXCI6IFwiMTZcIiwgXCJmb250LXdlaWdodFwiOiBcIjcwMFwiIH0pOyBobExhYmVsLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjsgc3ZnLmFwcGVuZENoaWxkKGhsTGFiZWwpO1xyXG5cclxuICAgIHJldHVybiB7IHN2ZywgdGl0bGUsIHN1YiwgZ3JpZHMsIHlMYmxzLCBiYXJzLCBwYXRoLCBwYXRoRmlsbCwgeEF4LCB4VGlja3MsIHhMYWJlbCwgeUxhYmVsLCBobExpbmUsIGhsRG90LCBobExhYmVsIH07XHJcbiAgfVxyXG5cclxuICBjb25zdCBwYW5lbFBERiA9IGNyZWF0ZVBhbmVsKCk7XHJcbiAgY29uc3QgcGFuZWxMaWsgPSBjcmVhdGVQYW5lbCgpO1xyXG5cclxuICBjb25zdCBjaGFydFJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgY2hhcnRSb3cuc3R5bGUuY3NzVGV4dCA9IFwiZGlzcGxheTpmbGV4O2dhcDoxMnB4O3dpZHRoOjEwMCU7XCI7XHJcbiAgY2hhcnRSb3cuYXBwZW5kQ2hpbGQocGFuZWxQREYuc3ZnKTsgY2hhcnRSb3cuYXBwZW5kQ2hpbGQocGFuZWxMaWsuc3ZnKTtcclxuICB3cmFwcGVyLmFwcGVuZENoaWxkKGNoYXJ0Um93KTtcclxuXHJcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgLy8gNi4gUkVOREVSXHJcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgZnVuY3Rpb24gZm10WSh2KSB7IGlmICh2ID09PSAwKSByZXR1cm4gXCIwXCI7IGlmIChNYXRoLmFicyh2KSA+IDEwMCkgcmV0dXJuIHYudG9GaXhlZCgwKTsgaWYgKE1hdGguYWJzKHYpID49IDEwKSByZXR1cm4gdi50b0ZpeGVkKDEpOyBpZiAoTWF0aC5hYnModikgPj0gMSkgcmV0dXJuIHYudG9GaXhlZCgyKTsgaWYgKE1hdGguYWJzKHYpIDwgMC4wMSkgcmV0dXJuIHYudG9GaXhlZCgzKTsgcmV0dXJuIHYudG9GaXhlZCgyKTsgfVxyXG5cclxuICBmdW5jdGlvbiBzZXRZTGFiZWwocGFuZWwsIHRleHQsIGNvbG9yKSB7XHJcbiAgICBjb25zdCBseCA9IDI0LCBseSA9IG1nXy50ICsgcGhfIC8gMjsgLy8gQWRqdXN0ZWQgbHggZm9yIGxhcmdlciBmb250XHJcbiAgICBwYW5lbC55TGFiZWwuc2V0QXR0cmlidXRlKFwieFwiLCBseCk7IHBhbmVsLnlMYWJlbC5zZXRBdHRyaWJ1dGUoXCJ5XCIsIGx5KTtcclxuICAgIHBhbmVsLnlMYWJlbC5zZXRBdHRyaWJ1dGUoXCJ0cmFuc2Zvcm1cIiwgYHJvdGF0ZSgtOTAsJHtseH0sJHtseX0pYCk7XHJcbiAgICBwYW5lbC55TGFiZWwuc2V0QXR0cmlidXRlKFwiZmlsbFwiLCBjb2xvcik7XHJcbiAgICBwYW5lbC55TGFiZWwudGV4dENvbnRlbnQgPSB0ZXh0O1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcmVuZGVyUERGKHBhbmVsLCBuLCBwLCBrKSB7XHJcbiAgICBwYW5lbC50aXRsZS50ZXh0Q29udGVudCA9IFwiUERGOiAgUCggayB8IHAgKVwiO1xyXG4gICAgcGFuZWwudGl0bGUuc2V0QXR0cmlidXRlKFwiZmlsbFwiLCBDUCk7XHJcbiAgICBwYW5lbC5zdWIudGV4dENvbnRlbnQgPSBgRml4IHAgPSAke3AudG9GaXhlZCgyKX0sIHZhcnkgayA9IDAsIDEsIFxcdTIwMjYsICR7bn1gO1xyXG4gICAgc2V0WUxhYmVsKHBhbmVsLCBcIlAoaylcIiwgQ1ApO1xyXG5cclxuICAgIGNvbnN0IHZhbHMgPSBbXTtcclxuICAgIGZvciAobGV0IGtpID0gMDsga2kgPD0gbjsga2krKykgdmFscy5wdXNoKGJpbm9tUE1GKGtpLCBuLCBwKSk7XHJcbiAgICBjb25zdCBtYXhWYWwgPSBNYXRoLm1heCguLi52YWxzKSAqIDEuMjUgfHwgMC4xO1xyXG5cclxuICAgIGNvbnN0IGJhc2VsaW5lID0gbWdfLnQgKyBwaF87XHJcbiAgICBjb25zdCBzeCA9IGtpID0+IG1nXy5sICsgKGtpICsgMC41KSAvIChuICsgMSkgKiBwd187XHJcbiAgICBjb25zdCBzeSA9IHYgPT4gbWdfLnQgKyBwaF8gLSAodiAvIG1heFZhbCkgKiBwaF87XHJcbiAgICBjb25zdCBiYXJXID0gTWF0aC5tYXgoNCwgTWF0aC5taW4oMjgsIHB3XyAvIChuICsgMSkgKiAwLjcpKTtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSA0OyBpKyspIHtcclxuICAgICAgY29uc3QgdiA9IChtYXhWYWwgLyA0KSAqIGksIHl5ID0gc3kodik7XHJcbiAgICAgIHBhbmVsLmdyaWRzW2ldLnNldEF0dHJpYnV0ZShcIngxXCIsIG1nXy5sKTsgcGFuZWwuZ3JpZHNbaV0uc2V0QXR0cmlidXRlKFwieDJcIiwgUFcgLSBtZ18ucik7XHJcbiAgICAgIHBhbmVsLmdyaWRzW2ldLnNldEF0dHJpYnV0ZShcInkxXCIsIHl5KTsgcGFuZWwuZ3JpZHNbaV0uc2V0QXR0cmlidXRlKFwieTJcIiwgeXkpO1xyXG4gICAgICBwYW5lbC55TGJsc1tpXS5zZXRBdHRyaWJ1dGUoXCJ4XCIsIG1nXy5sIC0gMTApOyBwYW5lbC55TGJsc1tpXS5zZXRBdHRyaWJ1dGUoXCJ5XCIsIHl5ICsgNik7XHJcbiAgICAgIHBhbmVsLnlMYmxzW2ldLnRleHRDb250ZW50ID0gZm10WSh2KTtcclxuICAgIH1cclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDMxOyBpKyspIHtcclxuICAgICAgaWYgKGkgPD0gbikge1xyXG4gICAgICAgIGNvbnN0IGJ4ID0gc3goaSkgLSBiYXJXIC8gMiwgYnkgPSBzeSh2YWxzW2ldKTtcclxuICAgICAgICBwYW5lbC5iYXJzW2ldLnNldEF0dHJpYnV0ZShcInhcIiwgYngpOyBwYW5lbC5iYXJzW2ldLnNldEF0dHJpYnV0ZShcInlcIiwgYnkpO1xyXG4gICAgICAgIHBhbmVsLmJhcnNbaV0uc2V0QXR0cmlidXRlKFwid2lkdGhcIiwgYmFyVyk7XHJcbiAgICAgICAgcGFuZWwuYmFyc1tpXS5zZXRBdHRyaWJ1dGUoXCJoZWlnaHRcIiwgTWF0aC5tYXgoMCwgYmFzZWxpbmUgLSBieSkpO1xyXG4gICAgICAgIHBhbmVsLmJhcnNbaV0uc2V0QXR0cmlidXRlKFwiZmlsbFwiLCBcIiM5M2M1ZmRcIik7XHJcbiAgICAgICAgcGFuZWwuYmFyc1tpXS5zZXRBdHRyaWJ1dGUoXCJzdHJva2VcIiwgXCIjNjBhNWZhXCIpO1xyXG4gICAgICAgIHBhbmVsLmJhcnNbaV0uc2V0QXR0cmlidXRlKFwic3Ryb2tlLXdpZHRoXCIsIFwiMC41XCIpO1xyXG4gICAgICAgIHBhbmVsLmJhcnNbaV0uc2V0QXR0cmlidXRlKFwib3BhY2l0eVwiLCBcIjAuNTVcIik7XHJcbiAgICAgICAgcGFuZWwuYmFyc1tpXS5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcclxuICAgICAgfSBlbHNlIHsgcGFuZWwuYmFyc1tpXS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7IH1cclxuICAgIH1cclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDMxOyBpKyspIHtcclxuICAgICAgaWYgKGkgPD0gbikge1xyXG4gICAgICAgIGNvbnN0IHN0ZXAgPSBuID4gMjAgPyA1IDogbiA+IDEwID8gMiA6IDE7XHJcbiAgICAgICAgcGFuZWwueFRpY2tzW2ldLnNldEF0dHJpYnV0ZShcInhcIiwgc3goaSkpOyBwYW5lbC54VGlja3NbaV0uc2V0QXR0cmlidXRlKFwieVwiLCBiYXNlbGluZSArIDI0KTtcclxuICAgICAgICBwYW5lbC54VGlja3NbaV0udGV4dENvbnRlbnQgPSBpICUgc3RlcCA9PT0gMCA/IGkgOiBcIlwiO1xyXG4gICAgICAgIHBhbmVsLnhUaWNrc1tpXS5zZXRBdHRyaWJ1dGUoXCJmaWxsXCIsIFwiIzY0NzQ4YlwiKTtcclxuICAgICAgICBwYW5lbC54VGlja3NbaV0uc2V0QXR0cmlidXRlKFwiZm9udC13ZWlnaHRcIiwgXCI0MDBcIik7XHJcbiAgICAgICAgcGFuZWwueFRpY2tzW2ldLnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xyXG4gICAgICB9IGVsc2UgeyBwYW5lbC54VGlja3NbaV0uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiOyB9XHJcbiAgICB9XHJcblxyXG4gICAgcGFuZWwueEF4LnNldEF0dHJpYnV0ZShcIngxXCIsIG1nXy5sKTsgcGFuZWwueEF4LnNldEF0dHJpYnV0ZShcIngyXCIsIFBXIC0gbWdfLnIpO1xyXG4gICAgcGFuZWwueEF4LnNldEF0dHJpYnV0ZShcInkxXCIsIGJhc2VsaW5lKTsgcGFuZWwueEF4LnNldEF0dHJpYnV0ZShcInkyXCIsIGJhc2VsaW5lKTtcclxuICAgIHBhbmVsLnhMYWJlbC50ZXh0Q29udGVudCA9IFwiayAobnVtYmVyIG9mIHN1Y2Nlc3NlcylcIjtcclxuICAgIHBhbmVsLnhMYWJlbC5zZXRBdHRyaWJ1dGUoXCJmaWxsXCIsIENLKTtcclxuXHJcbiAgICBwYW5lbC5obERvdC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7IHBhbmVsLmhsTGFiZWwuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgcGFuZWwuaGxMaW5lLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgIHBhbmVsLnBhdGguc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiOyBwYW5lbC5wYXRoRmlsbC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiByZW5kZXJMaWsocGFuZWwsIG4sIHAsIGspIHtcclxuICAgIGNvbnN0IG5sbCA9IHNob3dOTEw7XHJcbiAgICBwYW5lbC50aXRsZS50ZXh0Q29udGVudCA9IG5sbCA/IFwiTmVnIExvZy1MaWs6ICBcXHUyMjEybG4gTCggcCB8IGsgKVwiIDogXCJMaWtlbGlob29kOiAgTCggcCB8IGsgKVwiO1xyXG4gICAgcGFuZWwudGl0bGUuc2V0QXR0cmlidXRlKFwiZmlsbFwiLCBDSyk7XHJcbiAgICBwYW5lbC5zdWIudGV4dENvbnRlbnQgPSBgRml4IGsgPSAke2t9LCB2YXJ5IHAgXFx1MjIwOCBbMCwgMV1gO1xyXG4gICAgc2V0WUxhYmVsKHBhbmVsLCBubGwgPyBcIlxcdTIyMTJsbiBMKHApXCIgOiBcIkwocClcIiwgQ0spO1xyXG5cclxuICAgIGNvbnN0IE5QVFMgPSAyMDA7XHJcbiAgICBjb25zdCBjdXJ2ZSA9IFtdO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gTlBUUzsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IHBpID0gTWF0aC5tYXgoMC4wMDEsIE1hdGgubWluKDAuOTk5LCBpIC8gTlBUUykpO1xyXG4gICAgICBjdXJ2ZS5wdXNoKHsgcDogcGksIHY6IG5sbCA/IC1iaW5vbUxvZ0xpayhrLCBuLCBwaSkgOiBiaW5vbVBNRihrLCBuLCBwaSkgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IG1pblZhbCwgbWF4VmFsO1xyXG4gICAgaWYgKG5sbCkge1xyXG4gICAgICBtaW5WYWwgPSBNYXRoLm1pbiguLi5jdXJ2ZS5tYXAoYyA9PiBjLnYpKTtcclxuICAgICAgbWF4VmFsID0gTWF0aC5tYXgoLi4uY3VydmUuZmlsdGVyKGMgPT4gaXNGaW5pdGUoYy52KSkubWFwKGMgPT4gYy52KSk7XHJcbiAgICAgIGNvbnN0IHJhbmdlID0gbWF4VmFsIC0gbWluVmFsIHx8IDE7XHJcbiAgICAgIG1heFZhbCA9IG1pblZhbCArIHJhbmdlICogMS4yO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbWluVmFsID0gMDtcclxuICAgICAgbWF4VmFsID0gTWF0aC5tYXgoLi4uY3VydmUubWFwKGMgPT4gYy52KSkgKiAxLjI1IHx8IDAuMTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBiYXNlbGluZSA9IG1nXy50ICsgcGhfO1xyXG4gICAgY29uc3Qgc3ggPSBwaSA9PiBtZ18ubCArIHBpICogcHdfO1xyXG4gICAgY29uc3Qgc3kgPSB2ID0+IG1nXy50ICsgcGhfIC0gKCh2IC0gbWluVmFsKSAvICgobWF4VmFsIC0gbWluVmFsKSB8fCAxKSkgKiBwaF87XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gNDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IHYgPSBtaW5WYWwgKyAoKG1heFZhbCAtIG1pblZhbCkgLyA0KSAqIGksIHl5ID0gc3kodik7XHJcbiAgICAgIHBhbmVsLmdyaWRzW2ldLnNldEF0dHJpYnV0ZShcIngxXCIsIG1nXy5sKTsgcGFuZWwuZ3JpZHNbaV0uc2V0QXR0cmlidXRlKFwieDJcIiwgUFcgLSBtZ18ucik7XHJcbiAgICAgIHBhbmVsLmdyaWRzW2ldLnNldEF0dHJpYnV0ZShcInkxXCIsIHl5KTsgcGFuZWwuZ3JpZHNbaV0uc2V0QXR0cmlidXRlKFwieTJcIiwgeXkpO1xyXG4gICAgICBwYW5lbC55TGJsc1tpXS5zZXRBdHRyaWJ1dGUoXCJ4XCIsIG1nXy5sIC0gMTApOyBwYW5lbC55TGJsc1tpXS5zZXRBdHRyaWJ1dGUoXCJ5XCIsIHl5ICsgNik7XHJcbiAgICAgIHBhbmVsLnlMYmxzW2ldLnRleHRDb250ZW50ID0gZm10WSh2KTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgZCA9IFwiXCIsIGRGaWxsID0gXCJcIjtcclxuICAgIGlmICghbmxsKSBkRmlsbCA9IGBNJHtzeCgwKS50b0ZpeGVkKDEpfSwke2Jhc2VsaW5lfWA7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBOUFRTOyBpKyspIHtcclxuICAgICAgY29uc3QgcHggPSBzeChjdXJ2ZVtpXS5wKSwgcHkgPSBzeShjdXJ2ZVtpXS52KTtcclxuICAgICAgZCArPSAoaSA9PT0gMCA/IFwiTVwiIDogXCJMXCIpICsgcHgudG9GaXhlZCgxKSArIFwiLFwiICsgcHkudG9GaXhlZCgxKTtcclxuICAgICAgaWYgKCFubGwpIGRGaWxsICs9IGBMJHtweC50b0ZpeGVkKDEpfSwke3B5LnRvRml4ZWQoMSl9YDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIW5sbCkge1xyXG4gICAgICBkRmlsbCArPSBgTCR7c3goMSkudG9GaXhlZCgxKX0sJHtiYXNlbGluZX1aYDtcclxuICAgICAgcGFuZWwucGF0aEZpbGwuc2V0QXR0cmlidXRlKFwiZFwiLCBkRmlsbCk7IHBhbmVsLnBhdGhGaWxsLnNldEF0dHJpYnV0ZShcImZpbGxcIiwgXCIjZmVjYWNhXCIpO1xyXG4gICAgICBwYW5lbC5wYXRoRmlsbC5zZXRBdHRyaWJ1dGUoXCJvcGFjaXR5XCIsIFwiMC4zXCIpOyBwYW5lbC5wYXRoRmlsbC5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcclxuICAgIH0gZWxzZSB7IHBhbmVsLnBhdGhGaWxsLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjsgfVxyXG4gICAgcGFuZWwucGF0aC5zZXRBdHRyaWJ1dGUoXCJkXCIsIGQpOyBwYW5lbC5wYXRoLnNldEF0dHJpYnV0ZShcInN0cm9rZVwiLCBDSyk7XHJcbiAgICBwYW5lbC5wYXRoLnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMzE7IGkrKykge1xyXG4gICAgICBpZiAoaSA8PSAxMCkge1xyXG4gICAgICAgIGNvbnN0IHBpID0gaSAvIDEwO1xyXG4gICAgICAgIHBhbmVsLnhUaWNrc1tpXS5zZXRBdHRyaWJ1dGUoXCJ4XCIsIHN4KHBpKSk7IHBhbmVsLnhUaWNrc1tpXS5zZXRBdHRyaWJ1dGUoXCJ5XCIsIGJhc2VsaW5lICsgMjQpO1xyXG4gICAgICAgIHBhbmVsLnhUaWNrc1tpXS50ZXh0Q29udGVudCA9IGkgJSAyID09PSAwID8gcGkudG9GaXhlZCgxKSA6IFwiXCI7XHJcbiAgICAgICAgcGFuZWwueFRpY2tzW2ldLnNldEF0dHJpYnV0ZShcImZpbGxcIiwgXCIjNjQ3NDhiXCIpOyBwYW5lbC54VGlja3NbaV0uc2V0QXR0cmlidXRlKFwiZm9udC13ZWlnaHRcIiwgXCI0MDBcIik7XHJcbiAgICAgICAgcGFuZWwueFRpY2tzW2ldLnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xyXG4gICAgICB9IGVsc2UgeyBwYW5lbC54VGlja3NbaV0uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiOyB9XHJcbiAgICB9XHJcblxyXG4gICAgcGFuZWwueEF4LnNldEF0dHJpYnV0ZShcIngxXCIsIG1nXy5sKTsgcGFuZWwueEF4LnNldEF0dHJpYnV0ZShcIngyXCIsIFBXIC0gbWdfLnIpO1xyXG4gICAgcGFuZWwueEF4LnNldEF0dHJpYnV0ZShcInkxXCIsIGJhc2VsaW5lKTsgcGFuZWwueEF4LnNldEF0dHJpYnV0ZShcInkyXCIsIGJhc2VsaW5lKTtcclxuICAgIHBhbmVsLnhMYWJlbC50ZXh0Q29udGVudCA9IFwicCAocHJvYmFiaWxpdHkgcGFyYW1ldGVyKVwiO1xyXG4gICAgcGFuZWwueExhYmVsLnNldEF0dHJpYnV0ZShcImZpbGxcIiwgQ1ApO1xyXG5cclxuICAgIHBhbmVsLmhsTGluZS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICBwYW5lbC5obERvdC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICBwYW5lbC5obExhYmVsLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDMxOyBpKyspIHBhbmVsLmJhcnNbaV0uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gdXBkYXRlRm9ybXVsYShuLCBwLCBrKSB7XHJcbiAgICBjb25zdCBubWsgPSBuIC0gaztcclxuICAgIGNvbnN0IG9tcCA9ICgxIC0gcCkudG9GaXhlZCgyKTtcclxuXHJcbiAgICAvLyBSRVZFUlRFRCB0byBzbWFsbGVyIGZvcm11bGEgZm9udCBzaXplc1xyXG4gICAgZm9ybXVsYUJveC5pbm5lckhUTUwgPSBgXHJcbiAgICAgIDxkaXYgc3R5bGU9XCJtYXJnaW4tYm90dG9tOjZweDtmb250LXNpemU6MTNweDtjb2xvcjojNjQ3NDhiO1wiPlNhbWUgZm9ybXVsYSDigJQgZGlmZmVyZW50IHBlcnNwZWN0aXZlOjwvZGl2PlxyXG4gICAgICA8ZGl2IHN0eWxlPVwiZm9udC1zaXplOjE4cHg7bWFyZ2luLWJvdHRvbToxMnB4O1wiPlxyXG4gICAgICAgIGYoPHNwYW4gc3R5bGU9XCJjb2xvcjoke0NLfTtmb250LXdlaWdodDo3MDBcIj5rPC9zcGFuPiwgPHNwYW4gc3R5bGU9XCJjb2xvcjoke0NQfTtmb250LXdlaWdodDo3MDBcIj5wPC9zcGFuPilcclxuICAgICAgICA9IEMobiwgPHNwYW4gc3R5bGU9XCJjb2xvcjoke0NLfVwiPms8L3NwYW4+KVxyXG4gICAgICAgIFxcdTAwRDcgPHNwYW4gc3R5bGU9XCJjb2xvcjoke0NQfVwiPnA8L3NwYW4+PHN1cCBzdHlsZT1cImNvbG9yOiR7Q0t9XCI+azwvc3VwPlxyXG4gICAgICAgIFxcdTAwRDcgKDEgXFx1MjIxMiA8c3BhbiBzdHlsZT1cImNvbG9yOiR7Q1B9XCI+cDwvc3Bhbj4pPHN1cCBzdHlsZT1cImNvbG9yOiR7Q0t9XCI+blxcdTIyMTJrPC9zdXA+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgICA8ZGl2IHN0eWxlPVwiZGlzcGxheTpmbGV4O2dhcDoyNHB4O2p1c3RpZnktY29udGVudDpjZW50ZXI7ZmxleC13cmFwOndyYXA7XCI+XHJcbiAgICAgICAgPGRpdiBzdHlsZT1cInRleHQtYWxpZ246Y2VudGVyO3BhZGRpbmc6MTBweCAxOHB4O2JvcmRlci1yYWRpdXM6OHB4O2JhY2tncm91bmQ6I2VmZjZmZjtib3JkZXI6MXB4IHNvbGlkICNiZmRiZmU7XCI+XHJcbiAgICAgICAgICA8ZGl2IHN0eWxlPVwiZm9udC1zaXplOjEzcHg7Y29sb3I6JHtDUH07Zm9udC13ZWlnaHQ6NzAwO21hcmdpbi1ib3R0b206NnB4O1wiPlBERjogZml4IDxzcGFuIHN0eWxlPVwiY29sb3I6JHtDUH1cIj5wID0gJHtwLnRvRml4ZWQoMil9PC9zcGFuPiwgdmFyeSA8c3BhbiBzdHlsZT1cImNvbG9yOiR7Q0t9XCI+azwvc3Bhbj48L2Rpdj5cclxuICAgICAgICAgIDxkaXYgc3R5bGU9XCJmb250LXNpemU6MTZweDtjb2xvcjojMzM0MTU1O1wiPlxyXG4gICAgICAgICAgICBQKDxzcGFuIHN0eWxlPVwiY29sb3I6JHtDS307Zm9udC13ZWlnaHQ6NzAwXCI+azwvc3Bhbj4pXHJcbiAgICAgICAgICAgID0gQygke259LCA8c3BhbiBzdHlsZT1cImNvbG9yOiR7Q0t9O2ZvbnQtd2VpZ2h0OjcwMFwiPms8L3NwYW4+KVxyXG4gICAgICAgICAgICBcXHUwMEQ3ICR7cC50b0ZpeGVkKDIpfTxzdXAgc3R5bGU9XCJjb2xvcjoke0NLfTtmb250LXdlaWdodDo3MDBcIj5rPC9zdXA+XHJcbiAgICAgICAgICAgIFxcdTAwRDcgJHtvbXB9PHN1cCBzdHlsZT1cImZvbnQtc2l6ZToxM3B4XCI+JHtufVxcdTIyMTI8c3BhbiBzdHlsZT1cImNvbG9yOiR7Q0t9O2ZvbnQtd2VpZ2h0OjcwMFwiPms8L3NwYW4+PC9zdXA+XHJcbiAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8ZGl2IHN0eWxlPVwidGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzoxMHB4IDE4cHg7Ym9yZGVyLXJhZGl1czo4cHg7YmFja2dyb3VuZDojZmVmMmYyO2JvcmRlcjoxcHggc29saWQgI2ZlY2FjYTtcIj5cclxuICAgICAgICAgIDxkaXYgc3R5bGU9XCJmb250LXNpemU6MTNweDtjb2xvcjoke0NLfTtmb250LXdlaWdodDo3MDA7bWFyZ2luLWJvdHRvbTo2cHg7XCI+TGlrZWxpaG9vZDogZml4IDxzcGFuIHN0eWxlPVwiY29sb3I6JHtDS31cIj5rID0gJHtrfTwvc3Bhbj4sIHZhcnkgPHNwYW4gc3R5bGU9XCJjb2xvcjoke0NQfVwiPnA8L3NwYW4+PC9kaXY+XHJcbiAgICAgICAgICA8ZGl2IHN0eWxlPVwiZm9udC1zaXplOjE2cHg7Y29sb3I6IzMzNDE1NTtcIj5cclxuICAgICAgICAgICAgTCg8c3BhbiBzdHlsZT1cImNvbG9yOiR7Q1B9O2ZvbnQtd2VpZ2h0OjcwMFwiPnA8L3NwYW4+KVxyXG4gICAgICAgICAgICA9IEMoJHtufSwgJHtrfSlcclxuICAgICAgICAgICAgXFx1MDBENyA8c3BhbiBzdHlsZT1cImNvbG9yOiR7Q1B9O2ZvbnQtd2VpZ2h0OjcwMFwiPnA8L3NwYW4+PHN1cD4ke2t9PC9zdXA+XHJcbiAgICAgICAgICAgIFxcdTAwRDcgKDFcXHUyMjEyPHNwYW4gc3R5bGU9XCJjb2xvcjoke0NQfTtmb250LXdlaWdodDo3MDBcIj5wPC9zcGFuPik8c3VwPiR7bm1rfTwvc3VwPlxyXG4gICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgYDtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHVwZGF0ZUFsbCgpIHtcclxuICAgIGNvbnN0IG4gPSBTTC5uLnZhbCgpO1xyXG4gICAgY29uc3QgcCA9IFNMLnAudmFsKCk7XHJcbiAgICBsZXQgayA9IFNMLmsudmFsKCk7XHJcbiAgICBpZiAoayA+IG4pIHsgU0wuay5pbnB1dC52YWx1ZSA9IG47IFNMLmsuc3luYygpOyBrID0gbjsgfVxyXG5cclxuICAgIHN0eWxlVG9nZ2xlKGJ0bkxpaywgIXNob3dOTEwsIENLKTtcclxuICAgIHN0eWxlVG9nZ2xlKGJ0bk5MTCwgc2hvd05MTCwgQ0spO1xyXG5cclxuICAgIHVwZGF0ZUZvcm11bGEobiwgcCwgayk7XHJcbiAgICByZW5kZXJQREYocGFuZWxQREYsIG4sIHAsIGspO1xyXG4gICAgcmVuZGVyTGlrKHBhbmVsTGlrLCBuLCBwLCBrKTtcclxuICB9XHJcblxyXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gIC8vIDcuIEVWRU5UU1xyXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gIGZ1bmN0aW9uIG9uSW5wdXQoKSB7IFNMLm4uc3luYygpOyBTTC5wLnN5bmMoKTsgU0wuay5zeW5jKCk7IHVwZGF0ZUFsbCgpOyB9XHJcbiAgU0wubi5pbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgb25JbnB1dCk7XHJcbiAgU0wucC5pbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgb25JbnB1dCk7XHJcbiAgU0wuay5pbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgb25JbnB1dCk7XHJcbiAgdXBkYXRlQWxsKCk7XHJcblxyXG4gIGludmFsaWRhdGlvbi50aGVuKCgpID0+IHtcclxuICAgIFNMLm4uaW5wdXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIG9uSW5wdXQpO1xyXG4gICAgU0wucC5pbnB1dC5yZW1vdmVFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgb25JbnB1dCk7XHJcbiAgICBTTC5rLmlucHV0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCBvbklucHV0KTtcclxuICB9KTtcclxuXHJcbiAgd3JhcHBlci52YWx1ZSA9IHt9O1xyXG4gIHJldHVybiB3cmFwcGVyO1xyXG59KSgpXHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBjaV9ubGxfY2xpcHBlZCA9ICgoKSA9PiB7XHJcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgLy8gMS4gTUFUSFxyXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gIGZ1bmN0aW9uIGxuQ29tYihuLCBrKSB7XHJcbiAgICBpZiAoayA8IDAgfHwgayA+IG4pIHJldHVybiAtSW5maW5pdHk7XHJcbiAgICBpZiAoayA9PT0gMCB8fCBrID09PSBuKSByZXR1cm4gMDtcclxuICAgIGxldCBzID0gMDtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgazsgaSsrKSBzICs9IE1hdGgubG9nKG4gLSBpKSAtIE1hdGgubG9nKGkgKyAxKTtcclxuICAgIHJldHVybiBzO1xyXG4gIH1cclxuICBmdW5jdGlvbiBiaW5vbUxvZ0xpayhrLCBuLCBwKSB7XHJcbiAgICBpZiAocCA8PSAwKSByZXR1cm4gayA9PT0gMCA/IDAgOiAtSW5maW5pdHk7XHJcbiAgICBpZiAocCA+PSAxKSByZXR1cm4gayA9PT0gbiA/IDAgOiAtSW5maW5pdHk7XHJcbiAgICByZXR1cm4gbG5Db21iKG4sIGspICsgayAqIE1hdGgubG9nKHApICsgKG4gLSBrKSAqIE1hdGgubG9nKDEgLSBwKTtcclxuICB9XHJcblxyXG4gIC8vIENoaS1zcXVhcmUgUERGIChkZj0xKVxyXG4gIGZ1bmN0aW9uIGNoaTJQREYoeCkge1xyXG4gICAgaWYgKHggPD0gMCkgcmV0dXJuIDA7XHJcbiAgICByZXR1cm4gTWF0aC5leHAoLTAuNSAqIHggLSAwLjUgKiBNYXRoLmxvZyh4KSAtIDAuNSAqIE1hdGgubG9nKDIgKiBNYXRoLlBJKSk7XHJcbiAgfVxyXG5cclxuICAvLyBDaGktc3F1YXJlIHF1YW50aWxlIChkZj0xKVxyXG4gIGZ1bmN0aW9uIG5vcm1DREYoeikge1xyXG4gICAgY29uc3QgYTEgPSAwLjI1NDgyOTU5MiwgYTIgPSAtMC4yODQ0OTY3MzYsIGEzID0gMS40MjE0MTM3NDEsIGE0ID0gLTEuNDUzMTUyMDI3LCBhNSA9IDEuMDYxNDA1NDI5LCBwcCA9IDAuMzI3NTkxMTtcclxuICAgIGNvbnN0IHNpZ24gPSB6IDwgMCA/IC0xIDogMTtcclxuICAgIHogPSBNYXRoLmFicyh6KSAvIE1hdGguU1FSVDI7XHJcbiAgICBjb25zdCB0ID0gMS4wIC8gKDEuMCArIHBwICogeik7XHJcbiAgICBjb25zdCB5ID0gMS4wIC0gKCgoKChhNSAqIHQgKyBhNCkgKiB0KSArIGEzKSAqIHQgKyBhMikgKiB0ICsgYTEpICogdCAqIE1hdGguZXhwKC16ICogeik7XHJcbiAgICByZXR1cm4gMC41ICogKDEuMCArIHNpZ24gKiB5KTtcclxuICB9XHJcbiAgZnVuY3Rpb24gY2hpMkNERih4KSB7XHJcbiAgICBpZiAoeCA8PSAwKSByZXR1cm4gMDtcclxuICAgIHJldHVybiAyICogbm9ybUNERihNYXRoLnNxcnQoeCkpIC0gMTtcclxuICB9XHJcbiAgZnVuY3Rpb24gY2hpMlF1YW50aWxlKGNsKSB7XHJcbiAgICBsZXQgbG8gPSAwLCBoaSA9IDMwO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCA4MDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IG1pZCA9IChsbyArIGhpKSAvIDI7XHJcbiAgICAgIGlmIChjaGkyQ0RGKG1pZCkgPCBjbCkgbG8gPSBtaWQ7IGVsc2UgaGkgPSBtaWQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gKGxvICsgaGkpIC8gMjtcclxuICB9XHJcblxyXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gIC8vIDIuIFdSQVBQRVJcclxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcclxuICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICB3cmFwcGVyLnN0eWxlLmNzc1RleHQgPSBgZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbjthbGlnbi1pdGVtczpjZW50ZXI7XHJcbiAgICBmb250LWZhbWlseTotYXBwbGUtc3lzdGVtLEJsaW5rTWFjU3lzdGVtRm9udCxcIlNlZ29lIFVJXCIsUm9ib3RvLHNhbnMtc2VyaWY7XHJcbiAgICB3aWR0aDoxMDAlO21heC13aWR0aDo5NjBweDttYXJnaW46MCBhdXRvO2A7XHJcbiAgd3JhcHBlci5hcHBlbmRDaGlsZChpbmplY3RTdHlsZSgpKTtcclxuXHJcbiAgY29uc3QgQ09MID0geyBubGw6IFwiIzdjM2FlZFwiLCBjaGk6IFwiI2RjMjYyNlwiLCBjaTogXCIjMTZhMzRhXCIsIG1sZTogXCIjM2I4MmY2XCIgfTtcclxuXHJcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgLy8gNC4gQ09OVFJPTFNcclxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcclxuICBjb25zdCBTTCA9IHt9O1xyXG4gIFNMLm4gID0gY3JlYXRlU2xpZGVyKFwibiAodHJpYWxzKVwiLCA1LCAxMDAsIDEsIDIwLCBcIiMxZTI5M2JcIiwgXCJkYXJrXCIpO1xyXG4gIFNMLmsgID0gY3JlYXRlU2xpZGVyKFwiayAoc3VjY2Vzc2VzKVwiLCAwLCAxMDAsIDEsIDYsIFwiIzFlMjkzYlwiLCBcImRhcmtcIik7XHJcbiAgU0wuY2wgPSBjcmVhdGVTbGlkZXIoXCJDb25maWRlbmNlIGxldmVsXCIsIDAuNTAsIDAuOTksIDAuMDEsIDAuOTUsIENPTC5jaSwgXCJncmVlblwiKTtcclxuXHJcbiAgY29uc3QgcjEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpOyByMS5zdHlsZS5jc3NUZXh0ID0gXCJkaXNwbGF5OmZsZXg7Z2FwOjIwcHg7d2lkdGg6MTAwJTttYXJnaW4tYm90dG9tOjEwcHg7XCI7XHJcbiAgcjEuYXBwZW5kQ2hpbGQoU0wubi5lbCk7IHIxLmFwcGVuZENoaWxkKFNMLmsuZWwpO1xyXG4gIHdyYXBwZXIuYXBwZW5kQ2hpbGQocjEpO1xyXG4gIGNvbnN0IHIyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTsgcjIuc3R5bGUuY3NzVGV4dCA9IFwiZGlzcGxheTpmbGV4O2dhcDoyMHB4O3dpZHRoOjEwMCU7bWFyZ2luLWJvdHRvbToxNnB4O1wiO1xyXG4gIHIyLmFwcGVuZENoaWxkKFNMLmNsLmVsKTtcclxuICBjb25zdCBzcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7IHNwLnN0eWxlLmNzc1RleHQgPSBcImZsZXg6MTtcIjtcclxuICByMi5hcHBlbmRDaGlsZChzcCk7XHJcbiAgd3JhcHBlci5hcHBlbmRDaGlsZChyMik7XHJcblxyXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gIC8vIDUuIFNWRyBQQU5FTFNcclxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcclxuICBjb25zdCBOUyA9IFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIjtcclxuICBjb25zdCBQVyA9IDQ2MCwgUEggPSA0MDA7IC8vIEluY3JlYXNlZCBIZWlnaHRcclxuICAvLyBJbmNyZWFzZWQgTWFyZ2lucyBmb3IgbGFyZ2VyIHRleHRcclxuICBjb25zdCBtZ18gPSB7IHQ6IDkwLCByOiAzMCwgYjogODAsIGw6IDgwIH07XHJcbiAgY29uc3QgcHdfID0gUFcgLSBtZ18ubCAtIG1nXy5yLCBwaF8gPSBQSCAtIG1nXy50IC0gbWdfLmI7XHJcblxyXG4gIGZ1bmN0aW9uIG1rRWwodGFnLCBhKSB7XHJcbiAgICBjb25zdCBlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKE5TLCB0YWcpO1xyXG4gICAgaWYgKGEpIGZvciAoY29uc3QgW2ssdl0gb2YgT2JqZWN0LmVudHJpZXMoYSkpIGUuc2V0QXR0cmlidXRlKGssdik7XHJcbiAgICByZXR1cm4gZTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGNyZWF0ZVBhbmVsKGJnKSB7XHJcbiAgICBjb25zdCBzdmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoTlMsIFwic3ZnXCIpO1xyXG4gICAgc3ZnLnNldEF0dHJpYnV0ZShcInZpZXdCb3hcIiwgYDAgMCAke1BXfSAke1BIfWApO1xyXG4gICAgc3ZnLnN0eWxlLmNzc1RleHQgPSBgZmxleDoxO21pbi13aWR0aDowO2JvcmRlci1yYWRpdXM6MTJweDtib3JkZXI6MXB4IHNvbGlkICNlMmU4ZjA7YmFja2dyb3VuZDoke2JnIHx8IFwiI2ZmZlwifTtgO1xyXG5cclxuICAgIC8vIDEuIERFRklORSBDTElQIFBBVEggKFRvIGZpeCB0aGUgaG9yaXpvbnRhbCBsaW5lIGlzc3VlKVxyXG4gICAgLy8gVGhpcyBhbGxvd3MgdGhlIGN1cnZlIHRvIGdvIFwib2ZmIHNjcmVlblwiIG1hdGhlbWF0aWNhbGx5LCBidXQgdmlzdWFsbHkgY3V0IGF0IHRoZSBib3JkZXIuXHJcbiAgICBjb25zdCBkZWZzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKE5TLCBcImRlZnNcIik7XHJcbiAgICBjb25zdCBjbGlwSWQgPSBcImNoYXJ0LWNsaXAtXCIgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiw5KTtcclxuICAgIGNvbnN0IGNsaXBQYXRoID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKE5TLCBcImNsaXBQYXRoXCIpO1xyXG4gICAgY2xpcFBhdGguc2V0QXR0cmlidXRlKFwiaWRcIiwgY2xpcElkKTtcclxuICAgIGNvbnN0IGNsaXBSZWN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKE5TLCBcInJlY3RcIik7XHJcbiAgICBjbGlwUmVjdC5zZXRBdHRyaWJ1dGUoXCJ4XCIsIG1nXy5sKTtcclxuICAgIGNsaXBSZWN0LnNldEF0dHJpYnV0ZShcInlcIiwgbWdfLnQpO1xyXG4gICAgY2xpcFJlY3Quc2V0QXR0cmlidXRlKFwid2lkdGhcIiwgcHdfKTtcclxuICAgIGNsaXBSZWN0LnNldEF0dHJpYnV0ZShcImhlaWdodFwiLCBwaF8pO1xyXG4gICAgY2xpcFBhdGguYXBwZW5kQ2hpbGQoY2xpcFJlY3QpO1xyXG4gICAgZGVmcy5hcHBlbmRDaGlsZChjbGlwUGF0aCk7XHJcbiAgICBzdmcuYXBwZW5kQ2hpbGQoZGVmcyk7XHJcblxyXG4gICAgLy8gVGl0bGUgRm9udCBTaXplIDI0XHJcbiAgICBjb25zdCB0aXRsZSA9IG1rRWwoXCJ0ZXh0XCIsIHsgeDogU3RyaW5nKFBXIC8gMiksIHk6IFwiMzJcIiwgXCJ0ZXh0LWFuY2hvclwiOiBcIm1pZGRsZVwiLCBcImZvbnQtc2l6ZVwiOiBcIjI0XCIsIFwiZm9udC13ZWlnaHRcIjogXCI3MDBcIiB9KTtcclxuICAgIHN2Zy5hcHBlbmRDaGlsZCh0aXRsZSk7XHJcbiAgICAvLyBTdWJ0aXRsZSBGb250IFNpemUgMThcclxuICAgIGNvbnN0IHN1YiA9IG1rRWwoXCJ0ZXh0XCIsIHsgeDogU3RyaW5nKFBXIC8gMiksIHk6IFwiNThcIiwgXCJ0ZXh0LWFuY2hvclwiOiBcIm1pZGRsZVwiLCBcImZvbnQtc2l6ZVwiOiBcIjE4XCIsIGZpbGw6IFwiIzY0NzQ4YlwiIH0pO1xyXG4gICAgc3ZnLmFwcGVuZENoaWxkKHN1Yik7XHJcblxyXG4gICAgY29uc3QgZ3JpZHMgPSBbXTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IDU7IGkrKykgeyBzdmcuYXBwZW5kQ2hpbGQobWtFbChcImxpbmVcIiwgeyBzdHJva2U6IFwiI2YxZjVmOVwiLCBcInN0cm9rZS13aWR0aFwiOiBcIjFcIiB9KSk7IGdyaWRzLnB1c2goc3ZnLmxhc3RDaGlsZCk7IH1cclxuICAgIC8vIFktTGFiZWxzIEZvbnQgU2l6ZSAxNVxyXG4gICAgY29uc3QgeUxibHMgPSBbXTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IDU7IGkrKykgeyBzdmcuYXBwZW5kQ2hpbGQobWtFbChcInRleHRcIiwgeyBcInRleHQtYW5jaG9yXCI6IFwiZW5kXCIsIGZpbGw6IFwiIzk0YTNiOFwiLCBcImZvbnQtc2l6ZVwiOiBcIjE1XCIsIFwiZm9udC1mYW1pbHlcIjogXCInU0YgTW9ubycsbW9ub3NwYWNlXCIgfSkpOyB5TGJscy5wdXNoKHN2Zy5sYXN0Q2hpbGQpOyB9XHJcblxyXG4gICAgLy8gQXBwbHkgQ2xpcCBQYXRoIHRvIGN1cnZlcyBhbmQgZmlsbHNcclxuICAgIGNvbnN0IGZpbGxQYXRoID0gbWtFbChcInBhdGhcIiwgeyBcInN0cm9rZS13aWR0aFwiOiBcIjBcIiwgXCJjbGlwLXBhdGhcIjogYHVybCgjJHtjbGlwSWR9KWAgfSk7IFxyXG4gICAgZmlsbFBhdGguc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiOyBzdmcuYXBwZW5kQ2hpbGQoZmlsbFBhdGgpO1xyXG4gICAgXHJcbiAgICBjb25zdCBjdXJ2ZVBhdGggPSBta0VsKFwicGF0aFwiLCB7IGZpbGw6IFwibm9uZVwiLCBcInN0cm9rZS13aWR0aFwiOiBcIjNcIiwgXCJzdHJva2UtbGluZWpvaW5cIjogXCJyb3VuZFwiLCBcImNsaXAtcGF0aFwiOiBgdXJsKCMke2NsaXBJZH0pYCB9KTsgXHJcbiAgICBzdmcuYXBwZW5kQ2hpbGQoY3VydmVQYXRoKTtcclxuXHJcbiAgICBzdmcuYXBwZW5kQ2hpbGQobWtFbChcImxpbmVcIiwgeyB4MTogU3RyaW5nKG1nXy5sKSwgeDI6IFN0cmluZyhtZ18ubCksIHkxOiBTdHJpbmcobWdfLnQpLCB5MjogU3RyaW5nKG1nXy50ICsgcGhfKSwgc3Ryb2tlOiBcIiNjYmQ1ZTFcIiB9KSk7XHJcbiAgICBjb25zdCB4QXggPSBta0VsKFwibGluZVwiLCB7IHN0cm9rZTogXCIjY2JkNWUxXCIgfSk7IHN2Zy5hcHBlbmRDaGlsZCh4QXgpO1xyXG5cclxuICAgIC8vIFgtVGlja3MgRm9udCBTaXplIDE1XHJcbiAgICBjb25zdCB4VGlja3MgPSBbXTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjA7IGkrKykgeyBjb25zdCB0ID0gbWtFbChcInRleHRcIiwgeyBcInRleHQtYW5jaG9yXCI6IFwibWlkZGxlXCIsIGZpbGw6IFwiIzY0NzQ4YlwiLCBcImZvbnQtc2l6ZVwiOiBcIjE1XCIsIFwiZm9udC1mYW1pbHlcIjogXCInU0YgTW9ubycsbW9ub3NwYWNlXCIgfSk7IHQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiOyBzdmcuYXBwZW5kQ2hpbGQodCk7IHhUaWNrcy5wdXNoKHQpOyB9XHJcbiAgICBcclxuICAgIC8vIEF4aXMgTGFiZWwgRm9udCBTaXplIDE4XHJcbiAgICBjb25zdCB4TGFiZWwgPSBta0VsKFwidGV4dFwiLCB7IHg6IFN0cmluZyhtZ18ubCArIHB3XyAvIDIpLCB5OiBTdHJpbmcoUEggLSAxMiksIFwidGV4dC1hbmNob3JcIjogXCJtaWRkbGVcIiwgZmlsbDogXCIjNjQ3NDhiXCIsIFwiZm9udC1zaXplXCI6IFwiMThcIiwgXCJmb250LXdlaWdodFwiOiBcIjYwMFwiIH0pO1xyXG4gICAgc3ZnLmFwcGVuZENoaWxkKHhMYWJlbCk7XHJcbiAgICBcclxuICAgIC8vIFkgQXhpcyBMYWJlbCBGb250IFNpemUgMThcclxuICAgIGNvbnN0IHlMYWJlbCA9IG1rRWwoXCJ0ZXh0XCIsIHsgXCJ0ZXh0LWFuY2hvclwiOiBcIm1pZGRsZVwiLCBmaWxsOiBcIiM2NDc0OGJcIiwgXCJmb250LXNpemVcIjogXCIxOFwiLCBcImZvbnQtd2VpZ2h0XCI6IFwiNjAwXCIgfSk7XHJcbiAgICBzdmcuYXBwZW5kQ2hpbGQoeUxhYmVsKTtcclxuXHJcbiAgICByZXR1cm4geyBzdmcsIHRpdGxlLCBzdWIsIGdyaWRzLCB5TGJscywgZmlsbFBhdGgsIGN1cnZlUGF0aCwgeEF4LCB4VGlja3MsIHhMYWJlbCwgeUxhYmVsLCBjbGlwSWQgfTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHBOTEwgPSBjcmVhdGVQYW5lbChcIiNmZmZcIik7XHJcbiAgY29uc3QgcENoaSA9IGNyZWF0ZVBhbmVsKFwiI2ZmZlwiKTtcclxuXHJcbiAgY29uc3QgY2hhcnRSb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gIGNoYXJ0Um93LnN0eWxlLmNzc1RleHQgPSBcImRpc3BsYXk6ZmxleDtnYXA6MTJweDt3aWR0aDoxMDAlO21hcmdpbi1ib3R0b206MTRweDtcIjtcclxuICBjaGFydFJvdy5hcHBlbmRDaGlsZChwTkxMLnN2Zyk7IGNoYXJ0Um93LmFwcGVuZENoaWxkKHBDaGkuc3ZnKTtcclxuICB3cmFwcGVyLmFwcGVuZENoaWxkKGNoYXJ0Um93KTtcclxuXHJcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgLy8gNi4gUkVOREVSIEhFTFBFUlNcclxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcclxuICBmdW5jdGlvbiBzZXRZTGFiZWwocGFuZWwsIHRleHQsIGNvbG9yKSB7XHJcbiAgICBjb25zdCBseCA9IDI0LCBseSA9IG1nXy50ICsgcGhfIC8gMjtcclxuICAgIHBhbmVsLnlMYWJlbC5zZXRBdHRyaWJ1dGUoXCJ4XCIsIGx4KTsgcGFuZWwueUxhYmVsLnNldEF0dHJpYnV0ZShcInlcIiwgbHkpO1xyXG4gICAgcGFuZWwueUxhYmVsLnNldEF0dHJpYnV0ZShcInRyYW5zZm9ybVwiLCBgcm90YXRlKC05MCwke2x4fSwke2x5fSlgKTtcclxuICAgIHBhbmVsLnlMYWJlbC5zZXRBdHRyaWJ1dGUoXCJmaWxsXCIsIGNvbG9yKTtcclxuICAgIHBhbmVsLnlMYWJlbC50ZXh0Q29udGVudCA9IHRleHQ7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBzZXRHcmlkKHBhbmVsLCBtaW5WLCBtYXhWLCBuR3JpZCkge1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gbkdyaWQ7IGkrKykge1xyXG4gICAgICBjb25zdCB2ID0gbWluViArIChtYXhWIC0gbWluVikgLyBuR3JpZCAqIGk7XHJcbiAgICAgIGNvbnN0IHl5ID0gbWdfLnQgKyBwaF8gLSAoKHYgLSBtaW5WKSAvICgobWF4ViAtIG1pblYpIHx8IDEpKSAqIHBoXztcclxuICAgICAgaWYgKGkgPCBwYW5lbC5ncmlkcy5sZW5ndGgpIHtcclxuICAgICAgICBwYW5lbC5ncmlkc1tpXS5zZXRBdHRyaWJ1dGUoXCJ4MVwiLCBtZ18ubCk7IHBhbmVsLmdyaWRzW2ldLnNldEF0dHJpYnV0ZShcIngyXCIsIFBXIC0gbWdfLnIpO1xyXG4gICAgICAgIHBhbmVsLmdyaWRzW2ldLnNldEF0dHJpYnV0ZShcInkxXCIsIHl5KTsgcGFuZWwuZ3JpZHNbaV0uc2V0QXR0cmlidXRlKFwieTJcIiwgeXkpO1xyXG4gICAgICAgIHBhbmVsLmdyaWRzW2ldLnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xyXG4gICAgICAgIHBhbmVsLnlMYmxzW2ldLnNldEF0dHJpYnV0ZShcInhcIiwgbWdfLmwgLSAxMCk7IHBhbmVsLnlMYmxzW2ldLnNldEF0dHJpYnV0ZShcInlcIiwgeXkgKyA1KTtcclxuICAgICAgICBjb25zdCBmbXQgPSBNYXRoLmFicyh2KSA+IDEwID8gdi50b0ZpeGVkKDEpIDogdi50b0ZpeGVkKDIpO1xyXG4gICAgICAgIHBhbmVsLnlMYmxzW2ldLnRleHRDb250ZW50ID0gZm10O1xyXG4gICAgICAgIHBhbmVsLnlMYmxzW2ldLnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBmb3IgKGxldCBpID0gbkdyaWQgKyAxOyBpIDwgcGFuZWwuZ3JpZHMubGVuZ3RoOyBpKyspIHsgcGFuZWwuZ3JpZHNbaV0uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiOyBwYW5lbC55TGJsc1tpXS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7IH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHNldFhBeGlzKHBhbmVsKSB7XHJcbiAgICBjb25zdCBiYXNlbGluZSA9IG1nXy50ICsgcGhfO1xyXG4gICAgcGFuZWwueEF4LnNldEF0dHJpYnV0ZShcIngxXCIsIG1nXy5sKTsgcGFuZWwueEF4LnNldEF0dHJpYnV0ZShcIngyXCIsIFBXIC0gbWdfLnIpO1xyXG4gICAgcGFuZWwueEF4LnNldEF0dHJpYnV0ZShcInkxXCIsIGJhc2VsaW5lKTsgcGFuZWwueEF4LnNldEF0dHJpYnV0ZShcInkyXCIsIGJhc2VsaW5lKTtcclxuICB9XHJcblxyXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gIC8vIDcuIFJFTkRFUiBOTEwgKGxlZnQpXHJcbiAgLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgY29uc3QgbmxsSExpbmUgPSBta0VsKFwibGluZVwiLCB7IFwic3Ryb2tlLXdpZHRoXCI6IFwiMlwiLCBcInN0cm9rZS1kYXNoYXJyYXlcIjogXCI2LDRcIiB9KTtcclxuICBwTkxMLnN2Zy5hcHBlbmRDaGlsZChubGxITGluZSk7XHJcbiAgXHJcbiAgLy8gQXBwbHkgY2xpcC1wYXRoIHRvIHRoZSBDSSBGaWxsIGFyZWEgdG9vXHJcbiAgY29uc3QgbmxsQ0lGaWxsID0gbWtFbChcInBhdGhcIiwgeyBcInN0cm9rZS13aWR0aFwiOiBcIjBcIiwgXCJjbGlwLXBhdGhcIjogYHVybCgjJHtwTkxMLmNsaXBJZH0pYCB9KTsgXHJcbiAgcE5MTC5zdmcuYXBwZW5kQ2hpbGQobmxsQ0lGaWxsKTtcclxuICBcclxuICBjb25zdCBubGxNTEVMaW5lID0gbWtFbChcImxpbmVcIiwgeyBcInN0cm9rZS13aWR0aFwiOiBcIjJcIiwgXCJzdHJva2UtZGFzaGFycmF5XCI6IFwiNCwzXCIgfSk7IHBOTEwuc3ZnLmFwcGVuZENoaWxkKG5sbE1MRUxpbmUpO1xyXG4gIGNvbnN0IG5sbE1MRURvdCA9IG1rRWwoXCJjaXJjbGVcIiwgeyByOiBcIjZcIiwgc3Ryb2tlOiBcIiNmZmZcIiwgXCJzdHJva2Utd2lkdGhcIjogXCIyXCIgfSk7IHBOTEwuc3ZnLmFwcGVuZENoaWxkKG5sbE1MRURvdCk7XHJcbiAgLy8gQW5ub3RhdGlvbnMgMTZweFxyXG4gIGNvbnN0IG5sbE1MRUxhYmVsID0gbWtFbChcInRleHRcIiwgeyBcInRleHQtYW5jaG9yXCI6IFwibWlkZGxlXCIsIFwiZm9udC1zaXplXCI6IFwiMTZcIiwgXCJmb250LXdlaWdodFwiOiBcIjcwMFwiIH0pOyBwTkxMLnN2Zy5hcHBlbmRDaGlsZChubGxNTEVMYWJlbCk7XHJcbiAgY29uc3QgbmxsQ0lMTGluZSA9IG1rRWwoXCJsaW5lXCIsIHsgXCJzdHJva2Utd2lkdGhcIjogXCIyXCIsIFwic3Ryb2tlLWRhc2hhcnJheVwiOiBcIjQsM1wiIH0pOyBwTkxMLnN2Zy5hcHBlbmRDaGlsZChubGxDSUxMaW5lKTtcclxuICBjb25zdCBubGxDSVJMaW5lID0gbWtFbChcImxpbmVcIiwgeyBcInN0cm9rZS13aWR0aFwiOiBcIjJcIiwgXCJzdHJva2UtZGFzaGFycmF5XCI6IFwiNCwzXCIgfSk7IHBOTEwuc3ZnLmFwcGVuZENoaWxkKG5sbENJUkxpbmUpO1xyXG4gIGNvbnN0IG5sbENJTExhYmVsID0gbWtFbChcInRleHRcIiwgeyBcInRleHQtYW5jaG9yXCI6IFwibWlkZGxlXCIsIFwiZm9udC1zaXplXCI6IFwiMTZcIiwgXCJmb250LXdlaWdodFwiOiBcIjcwMFwiIH0pOyBwTkxMLnN2Zy5hcHBlbmRDaGlsZChubGxDSUxMYWJlbCk7XHJcbiAgY29uc3QgbmxsQ0lSTGFiZWwgPSBta0VsKFwidGV4dFwiLCB7IFwidGV4dC1hbmNob3JcIjogXCJtaWRkbGVcIiwgXCJmb250LXNpemVcIjogXCIxNlwiLCBcImZvbnQtd2VpZ2h0XCI6IFwiNzAwXCIgfSk7IHBOTEwuc3ZnLmFwcGVuZENoaWxkKG5sbENJUkxhYmVsKTtcclxuICBjb25zdCBubGxDdXRMYWJlbCA9IG1rRWwoXCJ0ZXh0XCIsIHsgXCJ0ZXh0LWFuY2hvclwiOiBcInN0YXJ0XCIsIFwiZm9udC1zaXplXCI6IFwiMTZcIiwgXCJmb250LXdlaWdodFwiOiBcIjYwMFwiIH0pOyBwTkxMLnN2Zy5hcHBlbmRDaGlsZChubGxDdXRMYWJlbCk7XHJcbiAgY29uc3QgbmxsQnJhY2tldCA9IG1rRWwoXCJsaW5lXCIsIHsgXCJzdHJva2Utd2lkdGhcIjogXCIzXCIsIFwic3Ryb2tlLWxpbmVjYXBcIjogXCJyb3VuZFwiIH0pOyBwTkxMLnN2Zy5hcHBlbmRDaGlsZChubGxCcmFja2V0KTtcclxuICBjb25zdCBubGxCcmFja2V0TGFiZWwgPSBta0VsKFwidGV4dFwiLCB7IFwidGV4dC1hbmNob3JcIjogXCJtaWRkbGVcIiwgXCJmb250LXNpemVcIjogXCIxNlwiLCBcImZvbnQtd2VpZ2h0XCI6IFwiNzAwXCIgfSk7IHBOTEwuc3ZnLmFwcGVuZENoaWxkKG5sbEJyYWNrZXRMYWJlbCk7XHJcblxyXG4gIGZ1bmN0aW9uIHJlbmRlck5MTChuLCBrLCBjbCkge1xyXG4gICAgY29uc3QgY2hpUSA9IGNoaTJRdWFudGlsZShjbCk7XHJcbiAgICBjb25zdCBjdXRvZmYgPSBjaGlRIC8gMjtcclxuICAgIGNvbnN0IG1sZSA9IG4gPiAwID8gayAvIG4gOiAwLjU7XHJcblxyXG4gICAgcE5MTC50aXRsZS50ZXh0Q29udGVudCA9IFwiTmVnYXRpdmUgTG9nLUxpa2VsaWhvb2RcIjtcclxuICAgIHBOTEwudGl0bGUuc2V0QXR0cmlidXRlKFwiZmlsbFwiLCBDT0wubmxsKTtcclxuICAgIHBOTEwuc3ViLnRleHRDb250ZW50ID0gYG4gPSAke259LCAgayA9ICR7a30sICBwXFx1MDMwMiA9ICR7bWxlLnRvRml4ZWQoMyl9YDtcclxuICAgIHNldFlMYWJlbChwTkxMLCBcIlxcdTIyMTJsbiBMKHApICsgY29uc3RcIiwgQ09MLm5sbCk7XHJcbiAgICBwTkxMLnhMYWJlbC50ZXh0Q29udGVudCA9IFwicFwiOyBwTkxMLnhMYWJlbC5zZXRBdHRyaWJ1dGUoXCJmaWxsXCIsIENPTC5ubGwpO1xyXG4gICAgc2V0WEF4aXMocE5MTCk7XHJcblxyXG4gICAgY29uc3QgTlBUUyA9IDMwMDtcclxuICAgIGNvbnN0IGN1cnZlID0gW107XHJcbiAgICBjb25zdCBwTWluID0gMC4wMDEsIHBNYXggPSAwLjk5OTtcclxuICAgIGNvbnN0IG5sbE1MRSA9IC1iaW5vbUxvZ0xpayhrLCBuLCBtbGUpO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gTlBUUzsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IHAgPSBwTWluICsgKHBNYXggLSBwTWluKSAqIGkgLyBOUFRTO1xyXG4gICAgICBjb25zdCBubGwgPSAtYmlub21Mb2dMaWsoaywgbiwgcCkgLSBubGxNTEU7XHJcbiAgICAgIGN1cnZlLnB1c2goeyBwLCBubGwgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeU1heCA9IE1hdGgubWF4KGN1dG9mZiAqIDIuNSwgNCk7XHJcbiAgICBjb25zdCB5TWluID0gMDtcclxuXHJcbiAgICBzZXRHcmlkKHBOTEwsIHlNaW4sIHlNYXgsIDUpO1xyXG5cclxuICAgIGNvbnN0IGJhc2VsaW5lID0gbWdfLnQgKyBwaF87XHJcbiAgICBjb25zdCBzeCA9IHAgPT4gbWdfLmwgKyAoKHAgLSBwTWluKSAvIChwTWF4IC0gcE1pbikpICogcHdfO1xyXG4gICAgY29uc3Qgc3kgPSB2ID0+IG1nXy50ICsgcGhfIC0gKCh2IC0geU1pbikgLyAoeU1heCAtIHlNaW4pKSAqIHBoXztcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDIwOyBpKyspIHtcclxuICAgICAgaWYgKGkgPD0gMTApIHtcclxuICAgICAgICBjb25zdCB2ID0gaSAvIDEwO1xyXG4gICAgICAgIHBOTEwueFRpY2tzW2ldLnNldEF0dHJpYnV0ZShcInhcIiwgc3godikpOyBwTkxMLnhUaWNrc1tpXS5zZXRBdHRyaWJ1dGUoXCJ5XCIsIGJhc2VsaW5lICsgMjQpO1xyXG4gICAgICAgIHBOTEwueFRpY2tzW2ldLnRleHRDb250ZW50ID0gaSAlIDIgPT09IDAgPyB2LnRvRml4ZWQoMSkgOiBcIlwiO1xyXG4gICAgICAgIHBOTEwueFRpY2tzW2ldLnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xyXG4gICAgICB9IGVsc2UgeyBwTkxMLnhUaWNrc1tpXS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7IH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBEUkFXIENVUlZFIChObyBNYXRoLm1pbiBjbGFtcGluZywgcmVseSBvbiBDbGlwUGF0aClcclxuICAgIGxldCBkID0gXCJcIjtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IE5QVFM7IGkrKykge1xyXG4gICAgICBjb25zdCBweCA9IHN4KGN1cnZlW2ldLnApO1xyXG4gICAgICBjb25zdCBweSA9IHN5KGN1cnZlW2ldLm5sbCk7IC8vIEp1c3QgcGxvdCB0aGUgdHJ1ZSB2YWx1ZSFcclxuICAgICAgZCArPSAoaSA9PT0gMCA/IFwiTVwiIDogXCJMXCIpICsgcHgudG9GaXhlZCgxKSArIFwiLFwiICsgcHkudG9GaXhlZCgxKTtcclxuICAgIH1cclxuICAgIHBOTEwuY3VydmVQYXRoLnNldEF0dHJpYnV0ZShcImRcIiwgZCk7IHBOTEwuY3VydmVQYXRoLnNldEF0dHJpYnV0ZShcInN0cm9rZVwiLCBDT0wubmxsKTtcclxuICAgIHBOTEwuZmlsbFBhdGguc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG5cclxuICAgIGNvbnN0IG1sZVggPSBzeChtbGUpLCBtbGVZID0gc3koMCk7XHJcbiAgICBubGxNTEVMaW5lLnNldEF0dHJpYnV0ZShcIngxXCIsIG1sZVgpOyBubGxNTEVMaW5lLnNldEF0dHJpYnV0ZShcIngyXCIsIG1sZVgpO1xyXG4gICAgbmxsTUxFTGluZS5zZXRBdHRyaWJ1dGUoXCJ5MVwiLCBzeSgwKSk7IG5sbE1MRUxpbmUuc2V0QXR0cmlidXRlKFwieTJcIiwgYmFzZWxpbmUpO1xyXG4gICAgbmxsTUxFTGluZS5zZXRBdHRyaWJ1dGUoXCJzdHJva2VcIiwgQ09MLm1sZSk7XHJcbiAgICBubGxNTEVEb3Quc2V0QXR0cmlidXRlKFwiY3hcIiwgbWxlWCk7IG5sbE1MRURvdC5zZXRBdHRyaWJ1dGUoXCJjeVwiLCBtbGVZKTtcclxuICAgIG5sbE1MRURvdC5zZXRBdHRyaWJ1dGUoXCJmaWxsXCIsIENPTC5tbGUpO1xyXG4gICAgbmxsTUxFTGFiZWwuc2V0QXR0cmlidXRlKFwieFwiLCBtbGVYKTsgbmxsTUxFTGFiZWwuc2V0QXR0cmlidXRlKFwieVwiLCBtbGVZIC0gMTYpO1xyXG4gICAgbmxsTUxFTGFiZWwuc2V0QXR0cmlidXRlKFwiZmlsbFwiLCBDT0wubWxlKTtcclxuICAgIG5sbE1MRUxhYmVsLnRleHRDb250ZW50ID0gYHBcXHUwMzAyID0gJHttbGUudG9GaXhlZCgzKX1gO1xyXG5cclxuICAgIGNvbnN0IGN1dFkgPSBzeShjdXRvZmYpO1xyXG4gICAgbmxsSExpbmUuc2V0QXR0cmlidXRlKFwieDFcIiwgbWdfLmwpOyBubGxITGluZS5zZXRBdHRyaWJ1dGUoXCJ4MlwiLCBQVyAtIG1nXy5yKTtcclxuICAgIG5sbEhMaW5lLnNldEF0dHJpYnV0ZShcInkxXCIsIGN1dFkpOyBubGxITGluZS5zZXRBdHRyaWJ1dGUoXCJ5MlwiLCBjdXRZKTtcclxuICAgIG5sbEhMaW5lLnNldEF0dHJpYnV0ZShcInN0cm9rZVwiLCBDT0wuY2kpO1xyXG5cclxuICAgIG5sbEN1dExhYmVsLnNldEF0dHJpYnV0ZShcInhcIiwgUFcgLSBtZ18uciAtIDIpOyBubGxDdXRMYWJlbC5zZXRBdHRyaWJ1dGUoXCJ5XCIsIGN1dFkgLSA4KTtcclxuICAgIG5sbEN1dExhYmVsLnNldEF0dHJpYnV0ZShcInRleHQtYW5jaG9yXCIsIFwiZW5kXCIpO1xyXG4gICAgbmxsQ3V0TGFiZWwuc2V0QXR0cmlidXRlKFwiZmlsbFwiLCBDT0wuY2kpO1xyXG4gICAgbmxsQ3V0TGFiZWwudGV4dENvbnRlbnQgPSBgXFx1MDNDN1xcdTAwQjIgLyAyID0gJHtjdXRvZmYudG9GaXhlZCgzKX1gO1xyXG5cclxuICAgIGxldCBjaUxvID0gcE1pbiwgY2lIaSA9IHBNYXg7XHJcbiAgICB7XHJcbiAgICAgIGxldCBsbyA9IHBNaW4sIGhpID0gbWxlO1xyXG4gICAgICBmb3IgKGxldCBpdGVyID0gMDsgaXRlciA8IDgwOyBpdGVyKyspIHtcclxuICAgICAgICBjb25zdCBtaWQgPSAobG8gKyBoaSkgLyAyO1xyXG4gICAgICAgIGNvbnN0IG5sbCA9IC1iaW5vbUxvZ0xpayhrLCBuLCBtaWQpIC0gbmxsTUxFO1xyXG4gICAgICAgIGlmIChubGwgPiBjdXRvZmYpIGxvID0gbWlkOyBlbHNlIGhpID0gbWlkO1xyXG4gICAgICB9XHJcbiAgICAgIGNpTG8gPSAobG8gKyBoaSkgLyAyO1xyXG4gICAgfVxyXG4gICAge1xyXG4gICAgICBsZXQgbG8gPSBtbGUsIGhpID0gcE1heDtcclxuICAgICAgZm9yIChsZXQgaXRlciA9IDA7IGl0ZXIgPCA4MDsgaXRlcisrKSB7XHJcbiAgICAgICAgY29uc3QgbWlkID0gKGxvICsgaGkpIC8gMjtcclxuICAgICAgICBjb25zdCBubGwgPSAtYmlub21Mb2dMaWsoaywgbiwgbWlkKSAtIG5sbE1MRTtcclxuICAgICAgICBpZiAobmxsID4gY3V0b2ZmKSBoaSA9IG1pZDsgZWxzZSBsbyA9IG1pZDtcclxuICAgICAgfVxyXG4gICAgICBjaUhpID0gKGxvICsgaGkpIC8gMjtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgZEZpbGwgPSBgTSR7c3goY2lMbykudG9GaXhlZCgxKX0sJHtiYXNlbGluZX1gO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gTlBUUzsgaSsrKSB7XHJcbiAgICAgIGlmIChjdXJ2ZVtpXS5wID49IGNpTG8gJiYgY3VydmVbaV0ucCA8PSBjaUhpKSB7XHJcbiAgICAgICAgLy8gVXNlIHRydWUgdmFsdWUsIGxldCBjbGlwLXBhdGggaGFuZGxlIHRoZSBjdXRvZmYgdG9wXHJcbiAgICAgICAgZEZpbGwgKz0gYEwke3N4KGN1cnZlW2ldLnApLnRvRml4ZWQoMSl9LCR7c3koY3VydmVbaV0ubmxsKS50b0ZpeGVkKDEpfWA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGRGaWxsICs9IGBMJHtzeChjaUhpKS50b0ZpeGVkKDEpfSwke2Jhc2VsaW5lfVpgO1xyXG4gICAgbmxsQ0lGaWxsLnNldEF0dHJpYnV0ZShcImRcIiwgZEZpbGwpO1xyXG4gICAgbmxsQ0lGaWxsLnNldEF0dHJpYnV0ZShcImZpbGxcIiwgQ09MLmNpKTsgbmxsQ0lGaWxsLnNldEF0dHJpYnV0ZShcIm9wYWNpdHlcIiwgXCIwLjEyXCIpO1xyXG4gICAgbmxsQ0lGaWxsLnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xyXG5cclxuICAgIGNvbnN0IGNMb1ggPSBzeChjaUxvKSwgY0hpWCA9IHN4KGNpSGkpO1xyXG4gICAgbmxsQ0lMTGluZS5zZXRBdHRyaWJ1dGUoXCJ4MVwiLCBjTG9YKTsgbmxsQ0lMTGluZS5zZXRBdHRyaWJ1dGUoXCJ4MlwiLCBjTG9YKTtcclxuICAgIG5sbENJTExpbmUuc2V0QXR0cmlidXRlKFwieTFcIiwgY3V0WSk7IG5sbENJTExpbmUuc2V0QXR0cmlidXRlKFwieTJcIiwgYmFzZWxpbmUpO1xyXG4gICAgbmxsQ0lMTGluZS5zZXRBdHRyaWJ1dGUoXCJzdHJva2VcIiwgQ09MLmNpKTtcclxuICAgIG5sbENJUkxpbmUuc2V0QXR0cmlidXRlKFwieDFcIiwgY0hpWCk7IG5sbENJUkxpbmUuc2V0QXR0cmlidXRlKFwieDJcIiwgY0hpWCk7XHJcbiAgICBubGxDSVJMaW5lLnNldEF0dHJpYnV0ZShcInkxXCIsIGN1dFkpOyBubGxDSVJMaW5lLnNldEF0dHJpYnV0ZShcInkyXCIsIGJhc2VsaW5lKTtcclxuICAgIG5sbENJUkxpbmUuc2V0QXR0cmlidXRlKFwic3Ryb2tlXCIsIENPTC5jaSk7XHJcblxyXG4gICAgLy8gOTUlIENJIHRleHQgYWJvdmUgdGhlIGxpbmUsIGluY3JlYXNlIHRoZSBudW1iZXIgdG8gbWFrZSBpdCBnbyBkb3duXHJcbiAgICBubGxDSUxMYWJlbC5zZXRBdHRyaWJ1dGUoXCJ4XCIsIGNMb1gpOyBubGxDSUxMYWJlbC5zZXRBdHRyaWJ1dGUoXCJ5XCIsIGJhc2VsaW5lICsgNDApO1xyXG4gICAgbmxsQ0lMTGFiZWwuc2V0QXR0cmlidXRlKFwiZmlsbFwiLCBDT0wuY2kpOyBubGxDSUxMYWJlbC50ZXh0Q29udGVudCA9IGNpTG8udG9GaXhlZCgzKTtcclxuICAgIG5sbENJUkxhYmVsLnNldEF0dHJpYnV0ZShcInhcIiwgY0hpWCk7IG5sbENJUkxhYmVsLnNldEF0dHJpYnV0ZShcInlcIiwgYmFzZWxpbmUgKyA0MCk7XHJcbiAgICBubGxDSVJMYWJlbC5zZXRBdHRyaWJ1dGUoXCJmaWxsXCIsIENPTC5jaSk7IG5sbENJUkxhYmVsLnRleHRDb250ZW50ID0gY2lIaS50b0ZpeGVkKDMpO1xyXG5cclxuICAgIGNvbnN0IGJyYWNrZXRZID0gYmFzZWxpbmUgKyA0ODtcclxuICAgIG5sbEJyYWNrZXQuc2V0QXR0cmlidXRlKFwieDFcIiwgY0xvWCk7IG5sbEJyYWNrZXQuc2V0QXR0cmlidXRlKFwieDJcIiwgY0hpWCk7XHJcbiAgICBubGxCcmFja2V0LnNldEF0dHJpYnV0ZShcInkxXCIsIGJyYWNrZXRZKTsgbmxsQnJhY2tldC5zZXRBdHRyaWJ1dGUoXCJ5MlwiLCBicmFja2V0WSk7XHJcbiAgICBubGxCcmFja2V0LnNldEF0dHJpYnV0ZShcInN0cm9rZVwiLCBDT0wuY2kpO1xyXG4gICAgbmxsQnJhY2tldExhYmVsLnNldEF0dHJpYnV0ZShcInhcIiwgKGNMb1ggKyBjSGlYKSAvIDIpOyBubGxCcmFja2V0TGFiZWwuc2V0QXR0cmlidXRlKFwieVwiLCBicmFja2V0WSArIDE4KTtcclxuICAgIG5sbEJyYWNrZXRMYWJlbC5zZXRBdHRyaWJ1dGUoXCJmaWxsXCIsIENPTC5jaSk7XHJcbiAgICBubGxCcmFja2V0TGFiZWwudGV4dENvbnRlbnQgPSBgJHsoY2wgKiAxMDApLnRvRml4ZWQoMCl9JSBDSWA7XHJcblxyXG4gICAgcmV0dXJuIHsgY2lMbywgY2lIaSwgbWxlLCBjaGlRLCBjdXRvZmYgfTtcclxuICB9XHJcblxyXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gIC8vIDguIFJFTkRFUiBDSEktU1FVQVJFIChyaWdodClcclxuICAvLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcclxuICBjb25zdCBjaGlDcml0TGluZSA9IG1rRWwoXCJsaW5lXCIsIHsgXCJzdHJva2Utd2lkdGhcIjogXCIyLjVcIiB9KTsgcENoaS5zdmcuYXBwZW5kQ2hpbGQoY2hpQ3JpdExpbmUpO1xyXG4gIGNvbnN0IGNoaUNyaXREb3QgPSBta0VsKFwiY2lyY2xlXCIsIHsgcjogXCI2XCIsIHN0cm9rZTogXCIjZmZmXCIsIFwic3Ryb2tlLXdpZHRoXCI6IFwiMlwiIH0pOyBwQ2hpLnN2Zy5hcHBlbmRDaGlsZChjaGlDcml0RG90KTtcclxuICBjb25zdCBjaGlDcml0TGFiZWwgPSBta0VsKFwidGV4dFwiLCB7IFwidGV4dC1hbmNob3JcIjogXCJtaWRkbGVcIiwgXCJmb250LXNpemVcIjogXCIxNlwiLCBcImZvbnQtd2VpZ2h0XCI6IFwiNzAwXCIgfSk7IHBDaGkuc3ZnLmFwcGVuZENoaWxkKGNoaUNyaXRMYWJlbCk7XHJcbiAgY29uc3QgY2hpQXJlYUxhYmVsID0gbWtFbChcInRleHRcIiwgeyBcInRleHQtYW5jaG9yXCI6IFwibWlkZGxlXCIsIFwiZm9udC1zaXplXCI6IFwiMTZcIiwgXCJmb250LXdlaWdodFwiOiBcIjYwMFwiIH0pOyBwQ2hpLnN2Zy5hcHBlbmRDaGlsZChjaGlBcmVhTGFiZWwpO1xyXG4gIC8vIEFwcGx5IGNsaXAgcGF0aCB0byBzaGFkZSB0b29cclxuICBjb25zdCBjaGlTaGFkZSA9IG1rRWwoXCJwYXRoXCIsIHsgXCJzdHJva2Utd2lkdGhcIjogXCIwXCIsIFwiY2xpcC1wYXRoXCI6IGB1cmwoIyR7cENoaS5jbGlwSWR9KWAgfSk7IFxyXG4gIHBDaGkuc3ZnLmluc2VydEJlZm9yZShjaGlTaGFkZSwgcENoaS5jdXJ2ZVBhdGgpO1xyXG5cclxuICBmdW5jdGlvbiByZW5kZXJDaGkoY2wsIGNoaVEpIHtcclxuICAgIHBDaGkudGl0bGUudGV4dENvbnRlbnQgPSBcIkNoaS1TcXVhcmVkIERpc3RyaWJ1dGlvbiAoZGYgPSAxKVwiO1xyXG4gICAgcENoaS50aXRsZS5zZXRBdHRyaWJ1dGUoXCJmaWxsXCIsIENPTC5jaGkpO1xyXG4gICAgcENoaS5zdWIudGV4dENvbnRlbnQgPSBgQ3JpdGljYWwgdmFsdWUgYXQgJHsoY2wgKiAxMDApLnRvRml4ZWQoMCl9JSBsZXZlbGA7XHJcbiAgICBzZXRZTGFiZWwocENoaSwgXCJmKHgpXCIsIENPTC5jaGkpO1xyXG4gICAgcENoaS54TGFiZWwudGV4dENvbnRlbnQgPSBcInhcIjsgcENoaS54TGFiZWwuc2V0QXR0cmlidXRlKFwiZmlsbFwiLCBDT0wuY2hpKTtcclxuICAgIHNldFhBeGlzKHBDaGkpO1xyXG5cclxuICAgIGNvbnN0IHhNYXggPSBNYXRoLm1heChjaGlRICogMiwgNik7XHJcbiAgICBjb25zdCBOUFRTID0gMzAwO1xyXG4gICAgY29uc3QgY3VydmUgPSBbXTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IE5QVFM7IGkrKykge1xyXG4gICAgICBjb25zdCB4ID0gMC4wMSArICh4TWF4IC0gMC4wMSkgKiBpIC8gTlBUUztcclxuICAgICAgY3VydmUucHVzaCh7IHgsIHk6IGNoaTJQREYoeCkgfSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCB5TWF4ID0gTWF0aC5taW4oMi4wLCBNYXRoLm1heCguLi5jdXJ2ZS5tYXAoYyA9PiBjLnkpKSAqIDEuMSk7XHJcbiAgICBjb25zdCB5TWluID0gMDtcclxuXHJcbiAgICBzZXRHcmlkKHBDaGksIHlNaW4sIHlNYXgsIDUpO1xyXG5cclxuICAgIGNvbnN0IGJhc2VsaW5lID0gbWdfLnQgKyBwaF87XHJcbiAgICBjb25zdCBzeEMgPSB4ID0+IG1nXy5sICsgKHggLyB4TWF4KSAqIHB3XztcclxuICAgIGNvbnN0IHN5QyA9IHkgPT4gbWdfLnQgKyBwaF8gLSAoKHkgLSB5TWluKSAvICgoeU1heCAtIHlNaW4pIHx8IDEpKSAqIHBoXztcclxuXHJcbiAgICBjb25zdCB4U3RlcCA9IHhNYXggPiAxMCA/IDIgOiAxO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyMDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IHYgPSBpICogeFN0ZXA7XHJcbiAgICAgIGlmICh2IDw9IHhNYXgpIHtcclxuICAgICAgICBwQ2hpLnhUaWNrc1tpXS5zZXRBdHRyaWJ1dGUoXCJ4XCIsIHN4Qyh2KSk7IHBDaGkueFRpY2tzW2ldLnNldEF0dHJpYnV0ZShcInlcIiwgYmFzZWxpbmUgKyAyNCk7XHJcbiAgICAgICAgcENoaS54VGlja3NbaV0udGV4dENvbnRlbnQgPSB2O1xyXG4gICAgICAgIHBDaGkueFRpY2tzW2ldLnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xyXG4gICAgICB9IGVsc2UgeyBwQ2hpLnhUaWNrc1tpXS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7IH1cclxuICAgIH1cclxuXHJcbiAgICBsZXQgZCA9IFwiXCI7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBOUFRTOyBpKyspIHtcclxuICAgICAgY29uc3QgcHggPSBzeEMoY3VydmVbaV0ueCksIHB5ID0gc3lDKGN1cnZlW2ldLnkpO1xyXG4gICAgICBkICs9IChpID09PSAwID8gXCJNXCIgOiBcIkxcIikgKyBweC50b0ZpeGVkKDEpICsgXCIsXCIgKyBweS50b0ZpeGVkKDEpO1xyXG4gICAgfVxyXG4gICAgcENoaS5jdXJ2ZVBhdGguc2V0QXR0cmlidXRlKFwiZFwiLCBkKTsgcENoaS5jdXJ2ZVBhdGguc2V0QXR0cmlidXRlKFwic3Ryb2tlXCIsIENPTC5jaGkpO1xyXG5cclxuICAgIGxldCBkU2hhZGUgPSBcIlwiO1xyXG4gICAgbGV0IHN0YXJ0ZWQgPSBmYWxzZTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IE5QVFM7IGkrKykge1xyXG4gICAgICBpZiAoY3VydmVbaV0ueCA+PSBjaGlRKSB7XHJcbiAgICAgICAgY29uc3QgcHggPSBzeEMoY3VydmVbaV0ueCksIHB5ID0gc3lDKGN1cnZlW2ldLnkpO1xyXG4gICAgICAgIGlmICghc3RhcnRlZCkgeyBkU2hhZGUgPSBgTSR7cHgudG9GaXhlZCgxKX0sJHtiYXNlbGluZX1gOyBzdGFydGVkID0gdHJ1ZTsgfVxyXG4gICAgICAgIGRTaGFkZSArPSBgTCR7cHgudG9GaXhlZCgxKX0sJHtweS50b0ZpeGVkKDEpfWA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGRTaGFkZSArPSBgTCR7c3hDKHhNYXgpLnRvRml4ZWQoMSl9LCR7YmFzZWxpbmV9WmA7XHJcbiAgICBjaGlTaGFkZS5zZXRBdHRyaWJ1dGUoXCJkXCIsIGRTaGFkZSk7IGNoaVNoYWRlLnNldEF0dHJpYnV0ZShcImZpbGxcIiwgQ09MLmNoaSk7XHJcbiAgICBjaGlTaGFkZS5zZXRBdHRyaWJ1dGUoXCJvcGFjaXR5XCIsIFwiMC4xNVwiKTsgY2hpU2hhZGUuc3R5bGUuZGlzcGxheSA9IFwiXCI7XHJcblxyXG4gICAgbGV0IGRCb2R5ID0gYE0ke3N4QygwLjAxKS50b0ZpeGVkKDEpfSwke2Jhc2VsaW5lfWA7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBOUFRTOyBpKyspIHtcclxuICAgICAgaWYgKGN1cnZlW2ldLnggPD0gY2hpUSkge1xyXG4gICAgICAgIGNvbnN0IHB4ID0gc3hDKGN1cnZlW2ldLngpLCBweSA9IHN5QyhjdXJ2ZVtpXS55KTtcclxuICAgICAgICBkQm9keSArPSBgTCR7cHgudG9GaXhlZCgxKX0sJHtweS50b0ZpeGVkKDEpfWA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGRCb2R5ICs9IGBMJHtzeEMoY2hpUSkudG9GaXhlZCgxKX0sJHtiYXNlbGluZX1aYDtcclxuICAgIHBDaGkuZmlsbFBhdGguc2V0QXR0cmlidXRlKFwiZFwiLCBkQm9keSk7IHBDaGkuZmlsbFBhdGguc2V0QXR0cmlidXRlKFwiZmlsbFwiLCBDT0wuY2kpO1xyXG4gICAgcENoaS5maWxsUGF0aC5zZXRBdHRyaWJ1dGUoXCJvcGFjaXR5XCIsIFwiMC4xXCIpOyBwQ2hpLmZpbGxQYXRoLnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xyXG5cclxuICAgIGNvbnN0IGNyaXRYID0gc3hDKGNoaVEpLCBjcml0WSA9IHN5QyhNYXRoLm1pbihjaGkyUERGKGNoaVEpLCB5TWF4KSk7XHJcbiAgICBjaGlDcml0TGluZS5zZXRBdHRyaWJ1dGUoXCJ4MVwiLCBjcml0WCk7IGNoaUNyaXRMaW5lLnNldEF0dHJpYnV0ZShcIngyXCIsIGNyaXRYKTtcclxuICAgIGNoaUNyaXRMaW5lLnNldEF0dHJpYnV0ZShcInkxXCIsIGNyaXRZKTsgY2hpQ3JpdExpbmUuc2V0QXR0cmlidXRlKFwieTJcIiwgYmFzZWxpbmUpO1xyXG4gICAgY2hpQ3JpdExpbmUuc2V0QXR0cmlidXRlKFwic3Ryb2tlXCIsIENPTC5jaSk7XHJcbiAgICBjaGlDcml0RG90LnNldEF0dHJpYnV0ZShcImN4XCIsIGNyaXRYKTsgY2hpQ3JpdERvdC5zZXRBdHRyaWJ1dGUoXCJjeVwiLCBjcml0WSk7XHJcbiAgICBjaGlDcml0RG90LnNldEF0dHJpYnV0ZShcImZpbGxcIiwgQ09MLmNpKTtcclxuXHJcbiAgICBjaGlDcml0TGFiZWwuc2V0QXR0cmlidXRlKFwieFwiLCBjcml0WCk7IGNoaUNyaXRMYWJlbC5zZXRBdHRyaWJ1dGUoXCJ5XCIsIGNyaXRZIC0gMTYpO1xyXG4gICAgY2hpQ3JpdExhYmVsLnNldEF0dHJpYnV0ZShcImZpbGxcIiwgQ09MLmNpKTtcclxuICAgIGNoaUNyaXRMYWJlbC50ZXh0Q29udGVudCA9IGBcXHUwM0M3XFx1MDBCMiA9ICR7Y2hpUS50b0ZpeGVkKDMpfWA7XHJcblxyXG4gICAgY29uc3QgYm9keU1pZFggPSBzeEMoY2hpUSAqIDAuNCk7XHJcbiAgICBjaGlBcmVhTGFiZWwuc2V0QXR0cmlidXRlKFwieFwiLCBib2R5TWlkWCk7IGNoaUFyZWFMYWJlbC5zZXRBdHRyaWJ1dGUoXCJ5XCIsIGJhc2VsaW5lIC0gMTApO1xyXG4gICAgY2hpQXJlYUxhYmVsLnNldEF0dHJpYnV0ZShcImZpbGxcIiwgQ09MLmNpKTtcclxuICAgIGNoaUFyZWFMYWJlbC50ZXh0Q29udGVudCA9IGAkeyhjbCAqIDEwMCkudG9GaXhlZCgwKX0lYDtcclxuICB9XHJcblxyXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gIC8vIDkuIFVQREFURVxyXG4gIC8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gIGZ1bmN0aW9uIHVwZGF0ZUFsbCgpIHtcclxuICAgIGNvbnN0IG4gPSBTTC5uLnZhbCgpO1xyXG4gICAgbGV0IGsgPSBTTC5rLnZhbCgpO1xyXG4gICAgaWYgKGsgPiBuKSB7IFNMLmsuaW5wdXQudmFsdWUgPSBuOyBTTC5rLnN5bmMoKTsgayA9IG47IH1cclxuICAgIGNvbnN0IGNsID0gU0wuY2wudmFsKCk7XHJcblxyXG4gICAgY29uc3QgeyBjaUxvLCBjaUhpLCBtbGUsIGNoaVEsIGN1dG9mZiB9ID0gcmVuZGVyTkxMKG4sIGssIGNsKTtcclxuICAgIHJlbmRlckNoaShjbCwgY2hpUSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBvbklucHV0KCkgeyBTTC5uLnN5bmMoKTsgU0wuay5zeW5jKCk7IFNMLmNsLnN5bmMoKTsgdXBkYXRlQWxsKCk7IH1cclxuICBTTC5uLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCBvbklucHV0KTtcclxuICBTTC5rLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCBvbklucHV0KTtcclxuICBTTC5jbC5pbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgb25JbnB1dCk7XHJcbiAgdXBkYXRlQWxsKCk7XHJcblxyXG4gIGludmFsaWRhdGlvbi50aGVuKCgpID0+IHtcclxuICAgIFNMLm4uaW5wdXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIG9uSW5wdXQpO1xyXG4gICAgU0wuay5pbnB1dC5yZW1vdmVFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgb25JbnB1dCk7XHJcbiAgICBTTC5jbC5pbnB1dC5yZW1vdmVFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgb25JbnB1dCk7XHJcbiAgfSk7XHJcblxyXG4gIHdyYXBwZXIudmFsdWUgPSB7fTtcclxuICByZXR1cm4gd3JhcHBlcjtcclxufSkoKVxyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3BkZl92c19saWtfbGFyZ2UnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnY2lfbmxsX2NsaXBwZWQnKSJ9XX0=
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../..";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "thinhong/s4bvn";
    script.dataset.repoId = "R_kgDOQtVYcQ";
    script.dataset.category = "General";
    script.dataset.categoryId = "DIC_kwDOQtVYcc4C00o0";
    script.dataset.mapping = "title";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./distr-pl.html" class="pagination-link" aria-label="Phân phối quy tắc lũy thừa">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Phân phối quy tắc lũy thừa</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./bayes.html" class="pagination-link" aria-label="Bayesian">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Bayesian</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>